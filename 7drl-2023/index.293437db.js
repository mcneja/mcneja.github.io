function e(e,t,o,n){Object.defineProperty(e,t,{get:o,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},r={},s=o.parcelRequire550f;null==s&&((s=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var o={id:e,exports:{}};return n[e]=o,t.call(o.exports,o,o.exports),o.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){r[e]=t},o.parcelRequire550f=s),s.register("27Lyk",(function(t,o){var n,r;e(t.exports,"register",(()=>n),(e=>n=e)),e(t.exports,"resolve",(()=>r),(e=>r=e));var s={};n=function(e){for(var t=Object.keys(e),o=0;o<t.length;o++)s[t[o]]=e[t[o]]},r=function(e){var t=s[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),s.register("cmoHh",(function(e,t){!function(e,t,o){function n(e){var t=this,o=function(){var e=4022871197,t=function(t){t=String(t);for(var o=0;o<t.length;o++){var n=.02519603282416938*(e+=t.charCodeAt(o));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=o(" "),t.s1=o(" "),t.s2=o(" "),t.s0-=o(e),t.s0<0&&(t.s0+=1),t.s1-=o(e),t.s1<0&&(t.s1+=1),t.s2-=o(e),t.s2<0&&(t.s2+=1),o=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function s(e,t){var o=new n(e),s=t&&t.state,a=o.next;return a.int32=function(){return 4294967296*o.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,s&&("object"==typeof s&&r(s,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=s:o&&o.amd?o((function(){return s})):this.alea=s}(0,e,"function"==typeof define&&define)})),s.register("euRi5",(function(e,t){!function(e,t,o){function n(e){var t=this,o="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:o+=e;for(var n=0;n<o.length+64;n++)t.x^=0|o.charCodeAt(n),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function s(e,t){var o=new n(e),s=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},a.int32=o.next,a.quick=a,s&&("object"==typeof s&&r(s,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=s:o&&o.amd?o((function(){return s})):this.xor128=s}(0,e,"function"==typeof define&&define)})),s.register("hDsEw",(function(e,t){!function(e,t,o){function n(e){var t=this,o="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:o+=e;for(var n=0;n<o.length+64;n++)t.x^=0|o.charCodeAt(n),n==o.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function s(e,t){var o=new n(e),s=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},a.int32=o.next,a.quick=a,s&&("object"==typeof s&&r(s,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=s:o&&o.amd?o((function(){return s})):this.xorwow=s}(0,e,"function"==typeof define&&define)})),s.register("3J2Zm",(function(e,t){!function(e,t,o){function n(e){var t=this;t.next=function(){var e,o,n=t.x,r=t.i;return e=n[r],o=(e^=e>>>7)^e<<24,o^=(e=n[r+1&7])^e>>>10,o^=(e=n[r+3&7])^e>>>3,o^=(e=n[r+4&7])^e<<7,e=n[r+7&7],o^=(e^=e<<13)^e<<9,n[r]=o,t.i=r+1&7,o},function(e,t){var o,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,o=0;o<t.length;++o)n[7&o]=n[7&o]<<15^t.charCodeAt(o)+n[o+1&7]<<13;for(;n.length<8;)n.push(0);for(o=0;o<8&&0===n[o];++o);for(8==o?n[7]=-1:n[o],e.x=n,e.i=0,o=256;o>0;--o)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function s(e,t){null==e&&(e=+new Date);var o=new n(e),s=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},a.int32=o.next,a.quick=a,s&&(s.x&&r(s,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=s:o&&o.amd?o((function(){return s})):this.xorshift7=s}(0,e,"function"==typeof define&&define)})),s.register("6Px8M",(function(e,t){!function(e,t,o){function n(e){var t=this;t.next=function(){var e,o,n=t.w,r=t.X,s=t.i;return t.w=n=n+1640531527|0,o=r[s+34&127],e=r[s=s+1&127],o^=o<<13,e^=e<<17,o^=o>>>15,e^=e>>>12,o=r[s]=o^e,t.i=s,o+(n^n>>>16)|0},function(e,t){var o,n,r,s,a,i=[],l=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,l=Math.max(l,t.length)),r=0,s=-32;s<l;++s)t&&(n^=t.charCodeAt((s+32)%t.length)),0===s&&(a=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,s>=0&&(a=a+1640531527|0,r=0==(o=i[127&s]^=n+a)?r+1:0);for(r>=128&&(i[127&(t&&t.length||0)]=-1),r=127,s=512;s>0;--s)n=i[r+34&127],o=i[r=r+1&127],n^=n<<13,o^=o<<17,n^=n>>>15,o^=o>>>12,i[r]=n^o;e.w=a,e.X=i,e.i=r}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function s(e,t){null==e&&(e=+new Date);var o=new n(e),s=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},a.int32=o.next,a.quick=a,s&&(s.X&&r(s,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=s:o&&o.amd?o((function(){return s})):this.xor4096=s}(0,e,"function"==typeof define&&define)})),s.register("lDm0S",(function(e,t){!function(e,t,o){function n(e){var t=this,o="";t.next=function(){var e=t.b,o=t.c,n=t.d,r=t.a;return e=e<<25^e>>>7^o,o=o-n|0,n=n<<24^n>>>8^r,r=r-e|0,t.b=e=e<<20^e>>>12^o,t.c=o=o-n|0,t.d=n<<16^o>>>16^r,t.a=r-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):o+=e;for(var n=0;n<o.length+20;n++)t.b^=0|o.charCodeAt(n),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function s(e,t){var o=new n(e),s=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},a.int32=o.next,a.quick=a,s&&("object"==typeof s&&r(s,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=s:o&&o.amd?o((function(){return s})):this.tychei=s}(0,e,"function"==typeof define&&define)})),s.register("kjyEk",(function(e,t){})),s.register("btQCe",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bv6MN"),import.meta.url).toString()})),s.register("lSuTm",(function(e,t){e.exports=new URL(s("27Lyk").resolve("i01ZK"),import.meta.url).toString()})),s.register("dq9sn",(function(e,t){e.exports=new URL(s("27Lyk").resolve("kMLeN"),import.meta.url).toString()})),s.register("5htDn",(function(e,t){e.exports=new URL(s("27Lyk").resolve("7QAkA"),import.meta.url).toString()})),s.register("afRm3",(function(e,t){e.exports=new URL(s("27Lyk").resolve("extGj"),import.meta.url).toString()})),s.register("haUAw",(function(e,t){e.exports=new URL(s("27Lyk").resolve("fmPyc"),import.meta.url).toString()})),s.register("kBrAM",(function(e,t){e.exports=new URL(s("27Lyk").resolve("9stv3"),import.meta.url).toString()})),s.register("k6Tdk",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iFwHo"),import.meta.url).toString()})),s.register("vDQ5G",(function(e,t){e.exports=new URL(s("27Lyk").resolve("cUkcS"),import.meta.url).toString()})),s.register("7DVvx",(function(e,t){e.exports=new URL(s("27Lyk").resolve("3WoZq"),import.meta.url).toString()})),s.register("al4v1",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4CRTl"),import.meta.url).toString()})),s.register("fO2Fk",(function(e,t){e.exports=new URL(s("27Lyk").resolve("byhsW"),import.meta.url).toString()})),s.register("kaxMC",(function(e,t){e.exports=new URL(s("27Lyk").resolve("9W38z"),import.meta.url).toString()})),s.register("lsnFy",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4Xt2t"),import.meta.url).toString()})),s.register("iSQf2",(function(e,t){e.exports=new URL(s("27Lyk").resolve("7CMGD"),import.meta.url).toString()})),s.register("9W6vc",(function(e,t){e.exports=new URL(s("27Lyk").resolve("5OaqH"),import.meta.url).toString()})),s.register("h5cAV",(function(e,t){e.exports=new URL(s("27Lyk").resolve("eMbVa"),import.meta.url).toString()})),s.register("71dbC",(function(e,t){e.exports=new URL(s("27Lyk").resolve("3axOF"),import.meta.url).toString()})),s.register("iOIx8",(function(e,t){e.exports=new URL(s("27Lyk").resolve("e7FGC"),import.meta.url).toString()})),s.register("5HSVp",(function(e,t){e.exports=new URL(s("27Lyk").resolve("ePtUz"),import.meta.url).toString()})),s.register("gjhQR",(function(e,t){e.exports=new URL(s("27Lyk").resolve("54JTP"),import.meta.url).toString()})),s.register("9yWXC",(function(e,t){e.exports=new URL(s("27Lyk").resolve("f4kGs"),import.meta.url).toString()})),s.register("8wZYi",(function(e,t){e.exports=new URL(s("27Lyk").resolve("gIhaU"),import.meta.url).toString()})),s.register("lLaFn",(function(e,t){e.exports=new URL(s("27Lyk").resolve("lqqo8"),import.meta.url).toString()})),s.register("91Ssr",(function(e,t){e.exports=new URL(s("27Lyk").resolve("cLwSE"),import.meta.url).toString()})),s.register("iPqLJ",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2KH0C"),import.meta.url).toString()})),s.register("aYURT",(function(e,t){e.exports=new URL(s("27Lyk").resolve("cpKKf"),import.meta.url).toString()})),s.register("28SI0",(function(e,t){e.exports=new URL(s("27Lyk").resolve("5MeQP"),import.meta.url).toString()})),s.register("2v7tx",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2JDpK"),import.meta.url).toString()})),s.register("2ab9R",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2zYEJ"),import.meta.url).toString()})),s.register("5mxOT",(function(e,t){e.exports=new URL(s("27Lyk").resolve("cGSNL"),import.meta.url).toString()})),s.register("6zU4W",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iv3Fr"),import.meta.url).toString()})),s.register("c5gUn",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iTJrg"),import.meta.url).toString()})),s.register("pgODr",(function(e,t){e.exports=new URL(s("27Lyk").resolve("6QPv3"),import.meta.url).toString()})),s.register("2CXE7",(function(e,t){e.exports=new URL(s("27Lyk").resolve("l0nd4"),import.meta.url).toString()})),s.register("6IDgr",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2n0fD"),import.meta.url).toString()})),s.register("sYECX",(function(e,t){e.exports=new URL(s("27Lyk").resolve("fOp9V"),import.meta.url).toString()})),s.register("5SG7D",(function(e,t){e.exports=new URL(s("27Lyk").resolve("i4uwn"),import.meta.url).toString()})),s.register("b3a1B",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bFVB0"),import.meta.url).toString()})),s.register("hNZg3",(function(e,t){e.exports=new URL(s("27Lyk").resolve("auuxb"),import.meta.url).toString()})),s.register("f54Wu",(function(e,t){e.exports=new URL(s("27Lyk").resolve("ejcPD"),import.meta.url).toString()})),s.register("lLVHT",(function(e,t){e.exports=new URL(s("27Lyk").resolve("dGQlG"),import.meta.url).toString()})),s.register("4n1uh",(function(e,t){e.exports=new URL(s("27Lyk").resolve("c1reW"),import.meta.url).toString()})),s.register("4SRyK",(function(e,t){e.exports=new URL(s("27Lyk").resolve("jbZGh"),import.meta.url).toString()})),s.register("lflvk",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4p6yy"),import.meta.url).toString()})),s.register("5v2Gn",(function(e,t){e.exports=new URL(s("27Lyk").resolve("7PaKC"),import.meta.url).toString()})),s.register("6Coqa",(function(e,t){e.exports=new URL(s("27Lyk").resolve("1HfrD"),import.meta.url).toString()})),s.register("blkyS",(function(e,t){e.exports=new URL(s("27Lyk").resolve("h9RJn"),import.meta.url).toString()})),s.register("jI2pj",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2s5z3"),import.meta.url).toString()})),s.register("anpZd",(function(e,t){e.exports=new URL(s("27Lyk").resolve("je4sD"),import.meta.url).toString()})),s.register("edgVx",(function(e,t){e.exports=new URL(s("27Lyk").resolve("91ASO"),import.meta.url).toString()})),s.register("3Gcwe",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4LHFu"),import.meta.url).toString()})),s.register("2iFWu",(function(e,t){e.exports=new URL(s("27Lyk").resolve("3FIlr"),import.meta.url).toString()})),s.register("7lSO8",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bM3ty"),import.meta.url).toString()})),s.register("38hOr",(function(e,t){e.exports=new URL(s("27Lyk").resolve("fa9Lk"),import.meta.url).toString()})),s.register("iE0tY",(function(e,t){e.exports=new URL(s("27Lyk").resolve("7iXif"),import.meta.url).toString()})),s.register("dCjg8",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iHnDX"),import.meta.url).toString()})),s.register("g0SDf",(function(e,t){e.exports=new URL(s("27Lyk").resolve("b2dYG"),import.meta.url).toString()})),s.register("8BSZm",(function(e,t){e.exports=new URL(s("27Lyk").resolve("59BJY"),import.meta.url).toString()})),s.register("gfCsy",(function(e,t){e.exports=new URL(s("27Lyk").resolve("gxLBn"),import.meta.url).toString()})),s.register("iCaDa",(function(e,t){e.exports=new URL(s("27Lyk").resolve("5dgAQ"),import.meta.url).toString()})),s.register("LEh2P",(function(e,t){e.exports=new URL(s("27Lyk").resolve("3OCXI"),import.meta.url).toString()})),s.register("26zq3",(function(e,t){e.exports=new URL(s("27Lyk").resolve("k5TMc"),import.meta.url).toString()})),s.register("dWD01",(function(e,t){e.exports=new URL(s("27Lyk").resolve("9w33w"),import.meta.url).toString()})),s.register("9h7xU",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4kHlF"),import.meta.url).toString()})),s.register("jiU0R",(function(e,t){e.exports=new URL(s("27Lyk").resolve("UrS1Y"),import.meta.url).toString()})),s.register("jMkd8",(function(e,t){e.exports=new URL(s("27Lyk").resolve("9uOV6"),import.meta.url).toString()})),s.register("1wRMv",(function(e,t){e.exports=new URL(s("27Lyk").resolve("6HjCO"),import.meta.url).toString()})),s.register("8lgeg",(function(e,t){e.exports=new URL(s("27Lyk").resolve("d5XXc"),import.meta.url).toString()})),s.register("l8xp9",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2lEVY"),import.meta.url).toString()})),s.register("alx6Z",(function(e,t){e.exports=new URL(s("27Lyk").resolve("la8N0"),import.meta.url).toString()})),s.register("ijwXJ",(function(e,t){e.exports=new URL(s("27Lyk").resolve("7cL8R"),import.meta.url).toString()})),s.register("a2kyU",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2wBmK"),import.meta.url).toString()})),s.register("5d0DW",(function(e,t){e.exports=new URL(s("27Lyk").resolve("jALpK"),import.meta.url).toString()})),s.register("dxMYB",(function(e,t){e.exports=new URL(s("27Lyk").resolve("b9dEt"),import.meta.url).toString()})),s.register("baOJW",(function(e,t){e.exports=new URL(s("27Lyk").resolve("fFe5r"),import.meta.url).toString()})),s.register("k2iei",(function(e,t){e.exports=new URL(s("27Lyk").resolve("lbRhG"),import.meta.url).toString()})),s.register("3x4yY",(function(e,t){e.exports=new URL(s("27Lyk").resolve("fpGvS"),import.meta.url).toString()})),s.register("egNqT",(function(e,t){e.exports=new URL(s("27Lyk").resolve("1sKsl"),import.meta.url).toString()})),s.register("QVkvm",(function(e,t){e.exports=new URL(s("27Lyk").resolve("gm0uu"),import.meta.url).toString()})),s.register("ggzCL",(function(e,t){e.exports=new URL(s("27Lyk").resolve("gYm3j"),import.meta.url).toString()})),s.register("h8bVj",(function(e,t){e.exports=new URL(s("27Lyk").resolve("binTT"),import.meta.url).toString()})),s.register("1NOTS",(function(e,t){e.exports=new URL(s("27Lyk").resolve("kOvrs"),import.meta.url).toString()})),s.register("6wdzE",(function(e,t){e.exports=new URL(s("27Lyk").resolve("f7gll"),import.meta.url).toString()})),s.register("7Bgvb",(function(e,t){e.exports=new URL(s("27Lyk").resolve("kxaoK"),import.meta.url).toString()})),s.register("cc8Co",(function(e,t){e.exports=new URL(s("27Lyk").resolve("1IHGt"),import.meta.url).toString()})),s.register("3Vwq5",(function(e,t){e.exports=new URL(s("27Lyk").resolve("d1AT3"),import.meta.url).toString()})),s.register("bk6h6",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iTS30"),import.meta.url).toString()})),s.register("7Du7Q",(function(e,t){e.exports=new URL(s("27Lyk").resolve("dgv1C"),import.meta.url).toString()})),s.register("aTKjT",(function(e,t){e.exports=new URL(s("27Lyk").resolve("3lODt"),import.meta.url).toString()})),s.register("8P0kg",(function(e,t){e.exports=new URL(s("27Lyk").resolve("nwoyO"),import.meta.url).toString()})),s.register("fyl73",(function(e,t){e.exports=new URL(s("27Lyk").resolve("hLJrX"),import.meta.url).toString()})),s.register("j5ffj",(function(e,t){e.exports=new URL(s("27Lyk").resolve("7NNoN"),import.meta.url).toString()})),s.register("9L8Sg",(function(e,t){e.exports=new URL(s("27Lyk").resolve("aGpum"),import.meta.url).toString()})),s.register("5Fjgc",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iOuyX"),import.meta.url).toString()})),s.register("40XLk",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iYi3V"),import.meta.url).toString()})),s.register("7jABT",(function(e,t){e.exports=new URL(s("27Lyk").resolve("jjy9s"),import.meta.url).toString()})),s.register("k4RLX",(function(e,t){e.exports=new URL(s("27Lyk").resolve("7xPeO"),import.meta.url).toString()})),s.register("34gKi",(function(e,t){e.exports=new URL(s("27Lyk").resolve("1cPlO"),import.meta.url).toString()})),s.register("fgE4t",(function(e,t){e.exports=new URL(s("27Lyk").resolve("8p5cP"),import.meta.url).toString()})),s.register("gGzmW",(function(e,t){e.exports=new URL(s("27Lyk").resolve("8Jj6R"),import.meta.url).toString()})),s.register("aUMGA",(function(e,t){e.exports=new URL(s("27Lyk").resolve("5u3ZN"),import.meta.url).toString()})),s.register("hAB2v",(function(e,t){e.exports=new URL(s("27Lyk").resolve("clDJP"),import.meta.url).toString()})),s.register("j1q3e",(function(e,t){e.exports=new URL(s("27Lyk").resolve("fnIha"),import.meta.url).toString()})),s.register("cp5Da",(function(e,t){e.exports=new URL(s("27Lyk").resolve("dxxv5"),import.meta.url).toString()})),s.register("k9vCo",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bGEJc"),import.meta.url).toString()})),s.register("fzAkK",(function(e,t){e.exports=new URL(s("27Lyk").resolve("goGEv"),import.meta.url).toString()})),s.register("2mcEF",(function(e,t){e.exports=new URL(s("27Lyk").resolve("5phrJ"),import.meta.url).toString()})),s.register("2lUVX",(function(e,t){e.exports=new URL(s("27Lyk").resolve("hZpxD"),import.meta.url).toString()})),s.register("bR2Qq",(function(e,t){e.exports=new URL(s("27Lyk").resolve("kSjuO"),import.meta.url).toString()})),s.register("4tABs",(function(e,t){e.exports=new URL(s("27Lyk").resolve("814wp"),import.meta.url).toString()})),s.register("4eWcK",(function(e,t){e.exports=new URL(s("27Lyk").resolve("6XNTC"),import.meta.url).toString()})),s.register("2IlHA",(function(e,t){e.exports=new URL(s("27Lyk").resolve("eSN3y"),import.meta.url).toString()})),s.register("b4oBR",(function(e,t){e.exports=new URL(s("27Lyk").resolve("9fotz"),import.meta.url).toString()})),s.register("bEpX3",(function(e,t){e.exports=new URL(s("27Lyk").resolve("eseEk"),import.meta.url).toString()})),s.register("zO13n",(function(e,t){e.exports=new URL(s("27Lyk").resolve("fHEVh"),import.meta.url).toString()})),s.register("hPTSL",(function(e,t){e.exports=new URL(s("27Lyk").resolve("aR76A"),import.meta.url).toString()})),s.register("5TQSa",(function(e,t){e.exports=new URL(s("27Lyk").resolve("6SX6V"),import.meta.url).toString()})),s.register("iXaO0",(function(e,t){e.exports=new URL(s("27Lyk").resolve("6vqpv"),import.meta.url).toString()})),s.register("fBP7x",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4GKs5"),import.meta.url).toString()})),s.register("aQaIJ",(function(e,t){e.exports=new URL(s("27Lyk").resolve("kOipz"),import.meta.url).toString()})),s.register("jI1w6",(function(e,t){e.exports=new URL(s("27Lyk").resolve("f3MqY"),import.meta.url).toString()})),s.register("7OaPU",(function(e,t){e.exports=new URL(s("27Lyk").resolve("8Eo8p"),import.meta.url).toString()})),s.register("eAAPp",(function(e,t){e.exports=new URL(s("27Lyk").resolve("6Z9FR"),import.meta.url).toString()})),s.register("Z94uH",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2BOzR"),import.meta.url).toString()})),s.register("2GAEF",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iFNVa"),import.meta.url).toString()})),s.register("bl9NP",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bb2lS"),import.meta.url).toString()})),s.register("avnp8",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bJNpV"),import.meta.url).toString()})),s.register("2mxOl",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bTEcp"),import.meta.url).toString()})),s.register("bvdYU",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4m6Oj"),import.meta.url).toString()})),s.register("f5YJN",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2keaG"),import.meta.url).toString()})),s.register("h733p",(function(e,t){e.exports=new URL(s("27Lyk").resolve("coxSt"),import.meta.url).toString()})),s.register("5iRGH",(function(e,t){e.exports=new URL(s("27Lyk").resolve("9mWWx"),import.meta.url).toString()})),s.register("bodaa",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iS60i"),import.meta.url).toString()})),s.register("jnTTO",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bFY2K"),import.meta.url).toString()})),s.register("4bkfm",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4VzTB"),import.meta.url).toString()})),s.register("1ZzuO",(function(e,t){e.exports=new URL(s("27Lyk").resolve("fH358"),import.meta.url).toString()})),s.register("iCpSW",(function(e,t){e.exports=new URL(s("27Lyk").resolve("eVH90"),import.meta.url).toString()})),s.register("9upNV",(function(e,t){e.exports=new URL(s("27Lyk").resolve("j31GE"),import.meta.url).toString()})),s.register("yZG5v",(function(e,t){e.exports=new URL(s("27Lyk").resolve("g59Cn"),import.meta.url).toString()})),s.register("f1guA",(function(e,t){e.exports=new URL(s("27Lyk").resolve("3M7dG"),import.meta.url).toString()})),s.register("83TDO",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bodxv"),import.meta.url).toString()})),s.register("frVxF",(function(e,t){e.exports=new URL(s("27Lyk").resolve("aD9LH"),import.meta.url).toString()})),s.register("hCPR7",(function(e,t){e.exports=new URL(s("27Lyk").resolve("hiMs1"),import.meta.url).toString()})),s.register("4Za6U",(function(e,t){e.exports=new URL(s("27Lyk").resolve("5N2Ks"),import.meta.url).toString()})),s.register("3Xk6I",(function(e,t){e.exports=new URL(s("27Lyk").resolve("dxQIJ"),import.meta.url).toString()})),s.register("dosUm",(function(e,t){e.exports=new URL(s("27Lyk").resolve("35PQn"),import.meta.url).toString()})),s.register("4gdwQ",(function(e,t){e.exports=new URL(s("27Lyk").resolve("boWMm"),import.meta.url).toString()})),s.register("aLkfr",(function(e,t){e.exports=new URL(s("27Lyk").resolve("iI5Sk"),import.meta.url).toString()})),s.register("kSLiP",(function(e,t){e.exports=new URL(s("27Lyk").resolve("icWuP"),import.meta.url).toString()})),s.register("2IENo",(function(e,t){e.exports=new URL(s("27Lyk").resolve("8kRcq"),import.meta.url).toString()})),s.register("1CFiH",(function(e,t){e.exports=new URL(s("27Lyk").resolve("k6kBH"),import.meta.url).toString()})),s.register("llhgm",(function(e,t){e.exports=new URL(s("27Lyk").resolve("64BGF"),import.meta.url).toString()})),s.register("2eW7L",(function(e,t){e.exports=new URL(s("27Lyk").resolve("gdcwz"),import.meta.url).toString()})),s.register("kZcsz",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4q8Ah"),import.meta.url).toString()})),s.register("2qpAR",(function(e,t){e.exports=new URL(s("27Lyk").resolve("9onoo"),import.meta.url).toString()})),s.register("cAyqi",(function(e,t){e.exports=new URL(s("27Lyk").resolve("93Pnl"),import.meta.url).toString()})),s.register("aEQTO",(function(e,t){e.exports=new URL(s("27Lyk").resolve("jpS1l"),import.meta.url).toString()})),s.register("ijfWN",(function(e,t){e.exports=new URL(s("27Lyk").resolve("8QomF"),import.meta.url).toString()})),s.register("7sWca",(function(e,t){e.exports=new URL(s("27Lyk").resolve("lqfpT"),import.meta.url).toString()})),s.register("fevkE",(function(e,t){e.exports=new URL(s("27Lyk").resolve("94dJT"),import.meta.url).toString()})),s.register("1B1JN",(function(e,t){e.exports=new URL(s("27Lyk").resolve("igW24"),import.meta.url).toString()})),s.register("jnuCJ",(function(e,t){e.exports=new URL(s("27Lyk").resolve("lqEqF"),import.meta.url).toString()})),s.register("cmvWY",(function(e,t){e.exports=new URL(s("27Lyk").resolve("8RJZ0"),import.meta.url).toString()})),s.register("hMHBo",(function(e,t){e.exports=new URL(s("27Lyk").resolve("dr5Sb"),import.meta.url).toString()})),s.register("9Nz7S",(function(e,t){e.exports=new URL(s("27Lyk").resolve("hrLmV"),import.meta.url).toString()})),s.register("9tCyg",(function(e,t){e.exports=new URL(s("27Lyk").resolve("9wrD0"),import.meta.url).toString()})),s.register("7ryfo",(function(e,t){e.exports=new URL(s("27Lyk").resolve("lSD3i"),import.meta.url).toString()})),s.register("eLXb8",(function(e,t){e.exports=new URL(s("27Lyk").resolve("2z5r6"),import.meta.url).toString()})),s.register("8uLuu",(function(e,t){e.exports=new URL(s("27Lyk").resolve("6WfXi"),import.meta.url).toString()})),s.register("io7hj",(function(e,t){e.exports=new URL(s("27Lyk").resolve("lOXp5"),import.meta.url).toString()})),s.register("8Mr4t",(function(e,t){e.exports=new URL(s("27Lyk").resolve("9T16N"),import.meta.url).toString()})),s.register("3gcK8",(function(e,t){e.exports=new URL(s("27Lyk").resolve("k7LDh"),import.meta.url).toString()})),s.register("3N27a",(function(e,t){e.exports=new URL(s("27Lyk").resolve("gLbJJ"),import.meta.url).toString()})),s.register("i8RlJ",(function(e,t){e.exports=new URL(s("27Lyk").resolve("4qtqX"),import.meta.url).toString()})),s.register("4vw0X",(function(e,t){e.exports=new URL(s("27Lyk").resolve("z6pdh"),import.meta.url).toString()})),s.register("6aNdh",(function(e,t){e.exports=new URL(s("27Lyk").resolve("boWBX"),import.meta.url).toString()})),s.register("i6vQ5",(function(e,t){e.exports=new URL(s("27Lyk").resolve("jChss"),import.meta.url).toString()})),s.register("5PMpx",(function(e,t){e.exports=new URL(s("27Lyk").resolve("6WkPY"),import.meta.url).toString()})),s.register("2DFDi",(function(e,t){e.exports=new URL(s("27Lyk").resolve("idVW7"),import.meta.url).toString()})),s.register("527nu",(function(e,t){e.exports=new URL(s("27Lyk").resolve("jhJBF"),import.meta.url).toString()})),s.register("54HwM",(function(e,t){e.exports=new URL(s("27Lyk").resolve("1RMnM"),import.meta.url).toString()})),s.register("4e6QO",(function(e,t){e.exports=new URL(s("27Lyk").resolve("aawqd"),import.meta.url).toString()})),s.register("7k3tw",(function(e,t){e.exports=new URL(s("27Lyk").resolve("7Azq2"),import.meta.url).toString()})),s.register("fcDaw",(function(e,t){e.exports=new URL(s("27Lyk").resolve("bO5O6"),import.meta.url).toString()})),s.register("fty2x",(function(e,t){e.exports=new URL(s("27Lyk").resolve("cMgfB"),import.meta.url).toString()})),s.register("jFsow",(function(e,t){e.exports=new URL(s("27Lyk").resolve("i0tVX"),import.meta.url).toString()})),s.register("cMmoo",(function(e,t){e.exports=new URL(s("27Lyk").resolve("haQJd"),import.meta.url).toString()})),s("27Lyk").register(JSON.parse('{"17fSe":"index.293437db.js","ilsm8":"entitytiles31color.87f9d84b.png","1e9sp":"terraintiles31color.ff7dbd4d.png","kDrfW":"font.e2d5b45b.png","8Qic0":"Minstrel_Dance.84f0fe17.mp3","aSqJ5":"level-requirement-1.1c09d439.mp3","hMICc":"level-requirement-2.d04a051d.mp3","cFOzA":"lose-game-over.be572349.mp3","iP5rH":"Minstrel Dance Easter Egg.9bfc149a.mp3","4cgQm":"footstep-wood.61af6a80.mp3","5uP20":"footstep-tile.2079c58b.mp3","koWqL":"footstep-water.9134aef9.mp3","drQCs":"footstep-gravel.9bd43b2f.mp3","aKQuT":"footstep-grass.5ff03075.mp3","bv6MN":"creak-7.7604197e.mp3","i01ZK":"creak-8.94c2430a.mp3","kMLeN":"creak-9.d5a1e06d.mp3","7QAkA":"creak-10.2438840e.mp3","extGj":"creak-11.5c1f1f3c.mp3","fmPyc":"creak-12.b2aecd09.mp3","9stv3":"hit16.mp3.12db2307.flac","iFwHo":"hit17.mp3.f1f9a130.flac","cUkcS":"hit18.mp3.9e7af88b.flac","3WoZq":"hit19.mp3.d775e463.flac","4CRTl":"hit20.mp3.3b3594b6.flac","byhsW":"hit26.mp3.ad2a87c8.flac","9W38z":"hit27.mp3.68a7736d.flac","4Xt2t":"coin.27887bdc.mp3","7CMGD":"coin-2.e8e82d5c.mp3","5OaqH":"coin-3.004f8541.mp3","eMbVa":"coin-4.6a51959e.mp3","3axOF":"coin-5.035907c7.mp3","e7FGC":"grunt.a8cde342.mp3","ePtUz":"grunt-2.30849a22.mp3","54JTP":"grunt-3.687bdfee.mp3","f4kGs":"grunt-4.4776cbdb.mp3","gIhaU":"grunt-5.7ebbc883.mp3","lqqo8":"grunt-6.b692d76a.mp3","cLwSE":"grunt-7.9923b5b3.mp3","2KH0C":"grunt-8.1912db98.mp3","cpKKf":"douse.5dfe688a.mp3","5MeQP":"douse-2.01d5e3d6.mp3","2JDpK":"douse-3.5dfe688a.mp3","2zYEJ":"douse-4.b84da553.mp3","cGSNL":"ignite.d3dd60a8.mp3","iv3Fr":"ignite-2.9dbae47a.mp3","iTJrg":"hide.b8c99711.mp3","6QPv3":"hide-2.0fe6cda6.mp3","l0nd4":"hide-3.302dff53.mp3","2n0fD":"hide-4.a97e1fc7.mp3","fOp9V":"hide-5.9bfbd476.mp3","i4uwn":"hide-6.1cd4f3d7.mp3","bFVB0":"gate.d5f8126d.mp3","auuxb":"gate-2.0044fff9.mp3","ejcPD":"gate-3.5b7711d0.mp3","dGQlG":"gate-4.1e6a5d1b.mp3","c1reW":"gate-5.72c10f72.mp3","jbZGh":"thump.f82f82c7.mp3","4p6yy":"splash1.98d8ad0b.mp3","7PaKC":"splash2.00d8e84e.mp3","1HfrD":"water-ambient.873a6917.mp3","h9RJn":"water-ambient-2.efcabd82.mp3","2s5z3":"fire.13ea005c.mp3","je4sD":"fire-and-boil.e36f20a5.mp3","91ASO":"outdoor-ambient.3d21830e.mp3","4LHFu":"outdoor-ambient-2.5fcdc149.mp3","3FIlr":"outdoor-ambient-3.53f64ba0.mp3","bM3ty":"outdoor-ambient-4.3c078af4.mp3","fa9Lk":"guard-door.570c8e5f.mp3","7iXif":"door-close.96f76874.mp3","iHnDX":"door-unlock-and-open.28ff596b.mp3","b2dYG":"door-close-and-lock.19ec2936.mp3","59BJY":"player-door-open.31e3a014.mp3","gxLBn":"player-door-close.0a90723e.mp3","5dgAQ":"player-door-unlock-and-open.e081c951.mp3","3OCXI":"player-door-close-and-lock.dd49aac6.mp3","k5TMc":"water-submerge.ecfbed99.mp3","9w33w":"water-exit.b973d802.mp3","4kHlF":"jump.e55ef093.mp3","UrS1Y":"jump-2.6fe19da4.mp3","9uOV6":"alarm.befdf3d9.mp3","6HjCO":"switch-progress.c17dfd1e.mp3","d5XXc":"switch-reset.55cbc8a6.mp3","2lEVY":"switch-success.c04b26a8.mp3","la8N0":"too high.9cb62710.mp3","7cL8R":"too high-2.e4f836e5.mp3","2wBmK":"Hmm.ab4666bb.mp3","jALpK":"What.15d09f65.mp3","b9dEt":"hey.53e8bfa8.mp3","fFe5r":"hey-2.e5982d2d.mp3","lbRhG":"hey-3.d3e5ca0c.mp3","fpGvS":"what was that.77a752f9.mp3","1sKsl":"what was that-2.d2d3ac5e.mp3","gm0uu":"what was that-3.d5e6d3bc.mp3","gYm3j":"what was that-4.0ba90c81.mp3","binTT":"what was that-5.4cee52fb.mp3","kOvrs":"who goes there.e12006f8.mp3","f7gll":"huh.0b84b50b.mp3","kxaoK":"wha.fed9d6c8.mp3","1IHGt":"wait.00b947d9.mp3","d1AT3":"who there.af08ce5f.mp3","iTS30":"what moved.5eb219b5.mp3","dgv1C":"what in the shadows.e4c09c64.mp3","3lODt":"shadow move.f9411514.mp3","nwoyO":"see something.8ae2c900.mp3","hLJrX":"hello.5375bd54.mp3","7NNoN":"ugh.d8bf005c.mp3","aGpum":"ahh.d5b34b8b.mp3","iOuyX":"aww.afe83640.mp3","iYi3V":"quiet out.e6c9a6bb.mp3","jjy9s":"rest me bones.b8117961.mp3","7xPeO":"jumpy.8728c25d.mp3","1cPlO":"jumpin shadows.2393e9a2.mp3","8p5cP":"oh well.4c7e171f.mp3","8Jj6R":"case of the jitters.d7950824.mp3","5u3ZN":"must be seeing.1cf0d466.mp3","clDJP":"what in my coffee.66632fce.mp3","fnIha":"coffee too strong.b8d95a1c.mp3","dxxv5":"hmm nothing.5e78dbae.mp3","bGEJc":"well I though I saw.a502b75d.mp3","goGEv":"nothing.0afb94af.mp3","5phrJ":"hopefully nothing.38c5aeda.mp3","hZpxD":"seeing things.a6f06709.mp3","kSjuO":"what-2.66b0ac41.mp3","814wp":"hark.c23476ea.mp3","6XNTC":"noise.b4e76638.mp3","eSN3y":"heard something.e9e5f3ce.mp3","9fotz":"cant hear now.d26c58c2.mp3","eseEk":"hearing things.369b6c03.mp3","fHEVh":"noise again.9bf45be9.mp3","aR76A":"someone there.5c5c2581.mp3","6SX6V":"who could that be.676f39e4.mp3","6vqpv":"better check it out.ebf046f4.mp3","4GKs5":"better be rats.ebf6a701.mp3","kOipz":"who that.e84cef75.mp3","f3MqY":"come out come out.beb4d769.mp3","8Eo8p":"guess nothing.d8004f20.mp3","6Z9FR":"wonder it was.d88b20b1.mp3","2BOzR":"back to post.c9710e8a.mp3","iFNVa":"quiet now.14ad7770.mp3","bb2lS":"sure I heard something.92884ce2.mp3","bJNpV":"not there anymore.d9adab1a.mp3","bTEcp":"probably nothing.61c0f4ca.mp3","4m6Oj":"i dont know why i work here.9c74a165.mp3","2keaG":"waste of my time.01eb2214.mp3","coxSt":"why do I even try.c223ca7c.mp3","9mWWx":"at least Im not on cleaning duty.a322a828.mp3","iS60i":"at least my shift ends soon.508eba67.mp3","bFY2K":"what do you want me to do about it.b4058cf6.mp3","4VzTB":"coming.2427458c.mp3","fH358":"to arms.6c7d0469.mp3","eVH90":"whistle.3a7291de.mp3","j31GE":"whistle-2.476ef42b.mp3","g59Cn":"whistle-3.6bcc64ea.mp3","3M7dG":"get em.e4bd8211.mp3","bodxv":"intruder.d29f8600.mp3","aD9LH":"oh no its a thief.95ded24b.mp3","hiMs1":"we coming for you.72c3b24e.mp3","5N2Ks":"coming for you.7bb9dc69.mp3","dxQIJ":"halt.12eee447.mp3","35PQn":"see you.859510ce.mp3","boWMm":"ill get you.dce0b107.mp3","iI5Sk":"a goner.50561a6a.mp3","icWuP":"just you wait.d2b91fc0.mp3","8kRcq":"you wont get away.800811e0.mp3","k6kBH":"no you dont.4ac92675.mp3","64BGF":"thief.2115f040.mp3","gdcwz":"thief-2.9040a582.mp3","4q8Ah":"thief-3.b8074467.mp3","9onoo":"after them.b8ebaf41.mp3","93Pnl":"what is thy business.a4047487.mp3","jpS1l":"no mercy for the wicked.5762a3e4.mp3","8QomF":"lost em.a34a1d09.mp3","lqfpT":"must have run.7a11d2a0.mp3","94dJT":"where they go.ca451290.mp3","igW24":"his holiness.4d336ce3.mp3","lqEqF":"the boss.cc03678e.mp3","8RJZ0":"huff puff give up.2bb20f55.mp3","dr5Sb":"where did he go.95b776f4.mp3","hrLmV":"drats lost him.1c6956c9.mp3","9wrD0":"gone.c866fdd9.mp3","lSD3i":"come back here.c30d95e2.mp3","2z5r6":"rotten scoundrel.aa0b2e4c.mp3","6WfXi":"aargh.09fd695b.mp3","lOXp5":"not coming back.c1590d1d.mp3","9T16N":"blast.14fafb40.mp3","k7LDh":"dont come back.5b7087c8.mp3","gLbJJ":"wont get away next time.565245ee.mp3","4qtqX":"for his holiness.674bd7fc.mp3","z6pdh":"lousy day at work.96f55006.mp3","boWBX":"i give up.14ffb14e.mp3","jChss":"what do i do help me.1938fc64.mp3","6WkPY":"oh no he got away.1ec7c74a.mp3","idVW7":"guard rant.a80c9b54.mp3","jhJBF":"take that.89a1c776.mp3","1RMnM":"oof.0fbc8e69.mp3","aawqd":"uh.0f80062b.mp3","7Azq2":"ah.f85c33dd.mp3","bO5O6":"ah-2.5f33dd73.mp3","cMgfB":"ha ya.86d45e64.mp3","i0tVX":"ha ya-2.fc4fbee2.mp3","haQJd":"ha ya-3.78dc4818.mp3"}'));class a extends Array{constructor(...e){super(...e)}static fromValues(e,t){return new a(e,t)}static create(){return new a(0,0)}static clone(e){return new a(e[0],e[1])}equals(e){return this[0]===e[0]&&this[1]===e[1]}equalsValues(e,t){return this[0]===e&&this[1]===t}copy(e){this[0]=e[0],this[1]=e[1]}set(e,t){this[0]=e,this[1]=t}add(e){return a.fromValues(this[0]+e[0],this[1]+e[1])}subtract(e){return a.fromValues(this[0]-e[0],this[1]-e[1])}multiply(e){return a.fromValues(this[0]*e[0],this[1]*e[1])}scale(e){return a.fromValues(this[0]*e,this[1]*e)}scaleAndAdd(e,t){return a.fromValues(this[0]+e[0]*t,this[1]+e[1]*t)}distance(e){const t=this[0]-e[0],o=this[1]-e[1];return Math.hypot(t,o)}squaredDistance(e){const t=this[0]-e[0],o=this[1]-e[1];return t*t+o*o}len(){return Math.hypot(this[0],this[1])}squaredLen(e){const t=this[0],o=this[1];return t*t+o*o}negate(){return a.fromValues(-this[0],-this[1])}dot(e){return this[0]*e[0]+this[1]*e[1]}lerp(e,t){return a.fromValues(this[0]+t*(e[0]-this[0]),this[1]+t*(e[1]-this[1]))}zero(){this[0]=0,this[1]=0}static copy(e,t){e[0]=t[0],e[1]=t[1]}static set(e,t,o){e[0]=t,e[1]=o}static add(e,t,o){e[0]=t[0]+o[0],e[1]=t[1]+o[1]}static subtract(e,t,o){e[0]=t[0]-o[0],e[1]=t[1]-o[1]}static multiply(e,t,o){e[0]=t[0]*o[0],e[1]=t[1]*o[1]}static scale(e,t,o){e[0]=t[0]*o,e[1]=t[1]*o}static scaleAndAdd(e,t,o,n){e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n}static distance(e,t){const o=e[0]-t[0],n=e[1]-t[1];return Math.hypot(o,n)}static squaredDistance(e,t){const o=e[0]-t[0],n=e[1]-t[1];return o*o+n*n}static len(e){return Math.hypot(e[0],e[1])}static squaredLen(e){const t=e[0],o=e[1];return t*t+o*o}static negate(e,t){e[0]=-t[0],e[1]=-t[1]}static dot(e,t){return e[0]*t[0]+e[1]*t[1]}static lerp(e,t,o,n){e[0]=t[0]+n*(o[0]-t[0]),e[1]=t[1]+n*(o[1]-t[1])}static zero(e){e[0]=0,e[1]=0}}let i;var l;(l=i||(i={})).create=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},l.copy=function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]},l.ortho=function(e,t,o,n,r,s,a){const i=1/(t-o),l=1/(n-r),u=1/(s-a);e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+o)*i,e[13]=(r+n)*l,e[14]=(a+s)*u,e[15]=1};var u={},c=s("cmoHh"),d=s("euRi5"),p=s("hDsEw"),h=s("3J2Zm"),m=s("6Px8M"),f=s("lDm0S"),g={};!function(e,t,o){var n,r=256,a=6,i="random",l=o.pow(r,a),u=o.pow(2,52),c=2*u,d=r-1;function p(s,d,p){var g=[],v=y(f((d=1==d?{entropy:!0}:d||{}).entropy?[s,x(t)]:null==s?function(){try{var o;return n&&(o=n.randomBytes)?o=o(r):(o=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(o)),x(o)}catch(o){var s=e.navigator,a=s&&s.plugins;return[+new Date,e,a,e.screen,x(t)]}}():s,3),g),S=new h(g),M=function(){for(var e=S.g(a),t=l,o=0;e<u;)e=(e+o)*r,t*=r,o=S.g(1);for(;e>=c;)e/=2,t/=2,o>>>=1;return(e+o)/t};return M.int32=function(){return 0|S.g(4)},M.quick=function(){return S.g(4)/4294967296},M.double=M,y(x(S.S),t),(d.pass||p||function(e,t,n,r){return r&&(r.S&&m(r,S),e.state=function(){return m(S,{})}),n?(o[i]=e,t):e})(M,v,"global"in d?d.global:this==o,d.state)}function h(e){var t,o=e.length,n=this,s=0,a=n.i=n.j=0,i=n.S=[];for(o||(e=[o++]);s<r;)i[s]=s++;for(s=0;s<r;s++)i[s]=i[a=d&a+e[s%o]+(t=i[s])],i[a]=t;(n.g=function(e){for(var t,o=0,s=n.i,a=n.j,i=n.S;e--;)t=i[s=d&s+1],o=o*r+i[d&(i[s]=i[a=d&a+t])+(i[a]=t)];return n.i=s,n.j=a,o})(r)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var o,n=[],r=typeof e;if(t&&"object"==r)for(o in e)try{n.push(f(e[o],t-1))}catch(e){}return n.length?n:"string"==r?e:e+"\0"}function y(e,t){for(var o,n=e+"",r=0;r<n.length;)t[d&r]=d&(o^=19*t[d&r])+n.charCodeAt(r++);return x(t)}function x(e){return String.fromCharCode.apply(0,e)}if(y(o.random(),t),g){g=p;try{n=s("kjyEk")}catch(e){}}else"function"==typeof define&&define.amd?define((function(){return p})):o["seed"+i]=p}("undefined"!=typeof self?self:g,[],Math),g.alea=c,g.xor128=d,g.xorwow=p,g.xorshift7=h,g.xor4096=m,g.tychei=f,u=g;class y{constructor(e=""){""!==e?(this.seed=e,this.rng=t(u)(e)):(this.seed="",this.rng=t(u)())}reset(){this.rng=t(u)(this.seed)}random(){return this.rng()}randomInRange(e){return Math.floor(this.rng()*e)}shuffleArray(e){for(let t=e.length-1;t>0;--t){let o=this.randomInRange(t+1),n=e[t];e[t]=e[o],e[o]=n}}}function x(e){return Math.floor(Math.random()*e)}function v(e){for(let t=e.length-1;t>0;--t){let o=x(t+1),n=e[t];e[t]=e[o],e[o]=n}}let S;var M;(M=S||(S={}))[M.Damage=0]="Damage",M[M.GuardChase=1]="GuardChase",M[M.GuardInvestigate=2]="GuardInvestigate",M[M.GuardSeeThief=3]="GuardSeeThief",M[M.GuardHearThief=4]="GuardHearThief",M[M.GuardDownWarning=5]="GuardDownWarning",M[M.GuardAwakesWarning=6]="GuardAwakesWarning",M[M.GuardExamineStolenTreasure=7]="GuardExamineStolenTreasure",M[M.GuardWarningResponse=8]="GuardWarningResponse",M[M.GuardHearGuard=9]="GuardHearGuard",M[M.GuardSpotDownedGuard=10]="GuardSpotDownedGuard",M[M.GuardSeeTorchLit=11]="GuardSeeTorchLit",M[M.GuardSeeUnlitTorch=12]="GuardSeeUnlitTorch",M[M.GuardEndChase=13]="GuardEndChase",M[M.GuardFinishInvestigating=14]="GuardFinishInvestigating",M[M.GuardFinishLooking=15]="GuardFinishLooking",M[M.GuardFinishListening=16]="GuardFinishListening",M[M.GuardFinishLightingTorch=17]="GuardFinishLightingTorch",M[M.GuardFinishLookingAtLitTorch=18]="GuardFinishLookingAtLitTorch",M[M.GuardStirring=19]="GuardStirring",M[M.GuardSpotStolenTreasure=20]="GuardSpotStolenTreasure",M[M.GuardSeeTorchDoused=21]="GuardSeeTorchDoused";class _{constructor(){this.currentSpeech="",this.currentSpeaker=void 0,this.currentSpeechAbove=!1,this.currentSpeechTimeRemaining=0,this.notification="",this.notificationWorldPos=a.create(),this.notificationTimeRemaining=0}setSpeech(e,t,o){this.currentSpeech=e,this.currentSpeaker=t,this.currentSpeechAbove=o,this.currentSpeechTimeRemaining=2}setNotification(e,t){this.notification=e,a.copy(this.notificationWorldPos,t),this.notificationTimeRemaining=2}setNotificationHold(e,t){this.notification=e,a.copy(this.notificationWorldPos,t),this.notificationTimeRemaining=1/0}clearNotification(){this.notification="",this.notificationTimeRemaining=0}isSpeechBubbleVisible(){return this.currentSpeechTimeRemaining>0}isNotificationVisible(){return this.notificationTimeRemaining>0}animate(e){this.currentSpeechTimeRemaining=Math.max(0,this.currentSpeechTimeRemaining-e),this.notificationTimeRemaining=Math.max(0,this.notificationTimeRemaining-e)}toggleShow(e){this.notificationTimeRemaining=this.notificationTimeRemaining>0?0:2,this.currentSpeechTimeRemaining>0?this.currentSpeechTimeRemaining=0:void 0!==this.currentSpeaker&&""!==this.currentSpeech&&(this.currentSpeechTimeRemaining=2,this.currentSpeechAbove=this.currentSpeaker.pos[1]>=e[1])}reset(){this.currentSpeech="",this.currentSpeaker=void 0,this.currentSpeechAbove=!1,this.currentSpeechTimeRemaining=0,this.notification="",a.zero(this.notificationWorldPos),this.notificationTimeRemaining=0}}var T={},w={linear:function(e,t,o,n){return(o-t)*e/n+t},easeInQuad:function(e,t,o,n){return(o-t)*(e/=n)*e+t},easeOutQuad:function(e,t,o,n){return-(o-t)*(e/=n)*(e-2)+t},easeInOutQuad:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?r/2*e*e+t:-r/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,o,n){return(o-t)*(e/=n)*e*e+t},easeOutCubic:function(e,t,o,n){return(o-t)*((e=e/n-1)*e*e+1)+t},easeInOutCubic:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?r/2*e*e*e+t:r/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,o,n){return(o-t)*(e/=n)*e*e*e+t},easeOutQuart:function(e,t,o,n){return-(o-t)*((e=e/n-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?r/2*e*e*e*e+t:-r/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,o,n){return(o-t)*(e/=n)*e*e*e*e+t},easeOutQuint:function(e,t,o,n){return(o-t)*((e=e/n-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?r/2*e*e*e*e*e+t:r/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,o,n){var r=o-t;return-r*Math.cos(e/n*(Math.PI/2))+r+t},easeOutSine:function(e,t,o,n){return(o-t)*Math.sin(e/n*(Math.PI/2))+t},easeInOutSine:function(e,t,o,n){return-(o-t)/2*(Math.cos(Math.PI*e/n)-1)+t},easeInExpo:function(e,t,o,n){return 0==e?t:(o-t)*Math.pow(2,10*(e/n-1))+t},easeOutExpo:function(e,t,o,n){var r=o-t;return e==n?t+r:r*(1-Math.pow(2,-10*e/n))+t},easeInOutExpo:function(e,t,o,n){var r=o-t;return 0===e?t:e===n?t+r:(e/=n/2)<1?r/2*Math.pow(2,10*(e-1))+t:r/2*(2-Math.pow(2,-10*--e))+t},easeInCirc:function(e,t,o,n){return-(o-t)*(Math.sqrt(1-(e/=n)*e)-1)+t},easeOutCirc:function(e,t,o,n){return(o-t)*Math.sqrt(1-(e=e/n-1)*e)+t},easeInOutCirc:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?-r/2*(Math.sqrt(1-e*e)-1)+t:r/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(e,t,o,n){var r,s,a,i=o-t;return a=1.70158,0===e?t:1==(e/=n)?t+i:((s=0)||(s=.3*n),(r=i)<Math.abs(i)?(r=i,a=s/4):a=s/(2*Math.PI)*Math.asin(i/r),-r*Math.pow(2,10*(e-=1))*Math.sin((e*n-a)*(2*Math.PI)/s)+t)},easeOutElastic:function(e,t,o,n){var r,s,a,i=o-t;return a=1.70158,0===e?t:1==(e/=n)?t+i:((s=0)||(s=.3*n),(r=i)<Math.abs(i)?(r=i,a=s/4):a=s/(2*Math.PI)*Math.asin(i/r),r*Math.pow(2,-10*e)*Math.sin((e*n-a)*(2*Math.PI)/s)+i+t)},easeInOutElastic:function(e,t,o,n){var r,s,a,i=o-t;return a=1.70158,0===e?t:2==(e/=n/2)?t+i:((s=0)||(s=n*(.3*1.5)),(r=i)<Math.abs(i)?(r=i,a=s/4):a=s/(2*Math.PI)*Math.asin(i/r),e<1?r*Math.pow(2,10*(e-=1))*Math.sin((e*n-a)*(2*Math.PI)/s)*-.5+t:r*Math.pow(2,-10*(e-=1))*Math.sin((e*n-a)*(2*Math.PI)/s)*.5+i+t)},easeInBack:function(e,t,o,n,r){return void 0===r&&(r=1.70158),(o-t)*(e/=n)*e*((r+1)*e-r)+t},easeOutBack:function(e,t,o,n,r){return void 0===r&&(r=1.70158),(o-t)*((e=e/n-1)*e*((r+1)*e+r)+1)+t},easeInOutBack:function(e,t,o,n,r){var s=o-t;return void 0===r&&(r=1.70158),(e/=n/2)<1?s/2*(e*e*((1+(r*=1.525))*e-r))+t:s/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t},easeInBounce:function(e,t,o,n){var r=o-t;return r-w.easeOutBounce(n-e,0,r,n)+t},easeOutBounce:function(e,t,o,n){var r=o-t;return(e/=n)<1/2.75?r*(7.5625*e*e)+t:e<2/2.75?r*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?r*(7.5625*(e-=2.25/2.75)*e+.9375)+t:r*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOutBounce:function(e,t,o,n){var r=o-t;return e<n/2?.5*w.easeInBounce(2*e,0,r,n)+t:.5*w.easeOutBounce(2*e-n,0,r,n)+.5*r+t}};T=w;class L{update(e){return!1}currentTile(){return{}}}class A extends L{constructor(e,t,o=0,n=-1){super(),this.time=0,this.tileInfo=e,this.activeFrame=o,this.frameDuration=t,this.removeOnFinish=!1,this.loops=n}update(e){this.time+=e;const t=this.frameDuration instanceof Array?this.frameDuration[this.activeFrame]:this.frameDuration;return this.time>t&&(this.activeFrame++,this.activeFrame>=this.tileInfo.length&&(this.activeFrame=0,this.loops>0&&this.loops--),this.time=0),0===this.loops}currentTile(){return this.tileInfo[this.activeFrame]}}class b extends L{constructor(e,t){super(),this.time=0,this.offset=a.clone(e[0].pt0),this.tileInfo=t,this.activeFrame=0,this.frameStep=1,this.activePt=0,this.tweenSeq=e,this.removeOnFinish=!1}update(e){const t=this.tweenSeq[this.activePt].pt0,o=this.tweenSeq[this.activePt].pt1,n=this.tweenSeq[this.activePt].duration,r=this.tweenSeq[this.activePt].fn;return void 0===t||null==o||(this.time=Math.min(this.time+e,n),this.offset[0]=r(this.time,t[0],o[0],n),this.offset[1]=r(this.time,t[1],o[1],n),this.time==n&&(this.activePt++,this.time=0,this.activeFrame++),this.activeFrame>=this.tileInfo.length&&(this.activeFrame=0),this.activePt===this.tweenSeq.length)}currentTile(){return this.tileInfo[this.activeFrame]}}class R extends L{offset=new a;duration=0;period=1;time=0;constructor(e,t,o){super(),this.tile=e,this.duration=t,this.period=o}update(e){return this.duration>0?this.time=Math.min(this.time+e,this.duration):this.time+=e,this.duration>0&&this.time===this.duration}get intensity(){return Math.sin(this.time/this.period)}agbr_color_to_tuple(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}abgr_tuple_to_color(e,t,o,n){return(Math.floor(e%256)<<24|Math.floor(t%256)<<16|Math.floor(o%256)<<8|Math.floor(n%256))>>>0}blend(e,t,o){const n=this.agbr_color_to_tuple(e),r=this.agbr_color_to_tuple(t),s=n.map(((e,t)=>e*o+r[t]*(1-o)));return this.abgr_tuple_to_color(s[0],s[1],s[2],s[3])}currentTile(){const e=(1+this.intensity)/2;return{textureIndex:this.tile.textureIndex,color:void 0!==this.tile.color&&void 0!==this.tile.unlitColor?this.blend(this.tile.color,this.tile.unlitColor,e):4294967295}}}class k extends L{constructor(e,t,o,n,r,s=new a(0,0),i=0,l=0){super(),this.time=0,this.tileInfo=e,this.offset=new a,this.centerPos=s,this.radius=t,this.speed=o,this.startingPos=n,this.duration=r,this.posRadians=n,this.removeOnFinish=!1}update(e){return this.duration>0?this.time=Math.min(this.time+e,this.duration):this.time+=e,this.posRadians+=this.speed*e,this.offset[0]=this.centerPos[0]+Math.cos(this.posRadians)*this.radius,this.offset[1]=this.centerPos[1]+Math.sin(this.posRadians)*this.radius,this.time===this.duration}currentTile(){return this.tileInfo}}let C;var I;(I=C||(C={}))[I.idle=0]="idle",I[I.dimmed=1]="dimmed",I[I.off=2]="off";class P extends L{activeFrame=0;time=0;dimDuration=300;constructor(e,t,o,n,r,s,a){super(),this.idleTiles=r,this.dimTile=s,this.offTile=a,this.lightId=t,this.lightVector=o,this.state=e,this.item=n}update(e){if(null!==this.item&&(this.item.type===ne.TorchUnlit&&(this.state=C.off),this.item.type!==ne.TorchUnlit&&this.state===C.off&&(this.state=C.idle,this.lightVector[this.lightId]=0)),this.time+=e,this.state==C.off)return!1;let t=this.lightVector[this.lightId];if(0==t&&Math.random()>.995**(60*e)?(this.state=C.dimmed,t=1.5):t>0&&(t=Math.max(t-3*e,0)),0==t){this.state=C.idle;const e=this.idleTiles[this.activeFrame][1];this.time>=e&&(this.time=0,this.activeFrame++,this.activeFrame>=this.idleTiles.length&&(this.activeFrame=0))}return this.lightVector[this.lightId]=t,!1}currentTile(){return this.state==C.idle?this.idleTiles[this.activeFrame][0]:this.state==C.dimmed?this.dimTile:this.offTile}}const H=64;let E;var D;(D=E||(E={}))[D.Patrol=0]="Patrol",D[D.Look=1]="Look",D[D.LookAtTorch=2]="LookAtTorch",D[D.Listen=3]="Listen",D[D.ChaseVisibleTarget=4]="ChaseVisibleTarget",D[D.MoveToLastSighting=5]="MoveToLastSighting",D[D.InvestigateLastSighting=6]="InvestigateLastSighting",D[D.MoveToLastSound=7]="MoveToLastSound",D[D.MoveToGuardShout=8]="MoveToGuardShout",D[D.MoveToDownedGuard=9]="MoveToDownedGuard",D[D.MoveToMissingTreasure=10]="MoveToMissingTreasure",D[D.LookAtMissingTreasure=11]="LookAtMissingTreasure",D[D.WakeGuard=12]="WakeGuard",D[D.MoveToTorch=13]="MoveToTorch",D[D.LightTorch=14]="LightTorch",D[D.Unconscious=15]="Unconscious";class W{dir=a.fromValues(1,0);mode=E.Patrol;modePrev=E.Patrol;angry=!1;hasTorch=!1;hasPurse=!1;hasVaultKey=!1;torchAnimation=null;speaking=!1;hasMoved=!1;heardThief=!1;heardThiefClosest=!1;hearingGuard=!1;heardGuard=!1;animation=null;goals=[];modeTimeout=0;constructor(e,t){const o=e[t];this.pos=a.clone(o),this.heardGuardPos=a.create(),this.goal=a.clone(o),this.patrolPath=e,this.patrolPathIndex=t,this.updateDirInitial()}overheadIcon(){return this.mode===E.Unconscious?te.Unconscious:this.mode===E.ChaseVisibleTarget?te.Chasing:F(this.mode)?this.angry?te.Angry:te.Relaxed:te.Alerted}posAnimated(){let e=this.animation?.offset??a.create();const t=a.create();return a.add(t,this.pos,e),t}allowsMoveOntoFrom(e){if(this.goals.length<=0)return!0;const t=this.goals[0];if(t.equals(this.pos))return!1;if(t.equals(e))return!1;const o=Math.floor((this.pos[0]+e[0])/2),n=Math.floor((this.pos[1]+e[1])/2);return t[0]!==o||t[1]!==n}moving(){if(this.goals.length<=0)return!1;const e=this.goals[0];return!this.pos.equals(e)}chooseMoves(e){switch(this.mode){case E.Patrol:this.goals=this.choosePatrolStep(e);break;case E.Look:case E.LookAtTorch:case E.Listen:case E.Unconscious:this.goals=this.chooseMoveTowardPosition(this.pos,e.gameMap);break;case E.ChaseVisibleTarget:case E.MoveToLastSighting:case E.InvestigateLastSighting:case E.MoveToGuardShout:case E.MoveToLastSound:this.goals=this.chooseMoveTowardPosition(this.goal,e.gameMap);break;case E.MoveToDownedGuard:case E.MoveToMissingTreasure:case E.LookAtMissingTreasure:case E.WakeGuard:case E.MoveToTorch:case E.LightTorch:this.goals=this.chooseMoveTowardAdjacentToPosition(this.goal,e.gameMap)}}bestAvailableMove(e,t,o){let n=!1;for(const r of e)if(t.guardMoveCost(this.pos,r)!=1/0)if(o.pos.equals(r))n=!0;else if(!t.isGuardAtVec(r))return[r,n];return[this.pos,n]}act(e,t){const o=a.clone(this.pos),n=e.gameMap,r=e.player,s=e.levelStats;if(this.mode!==E.Unconscious&&!F(this.mode)){const e=this.moving()?1:0;this.seesActor(n,r,e)&&(this.mode=E.ChaseVisibleTarget)}switch(this.heardThief&&this.mode!==E.Unconscious&&this.mode!==E.ChaseVisibleTarget&&(F(this.mode)&&!this.heardThiefClosest?(this.mode=E.Listen,this.modeTimeout=2+x(4),this.goals=this.chooseMoveTowardPosition(this.pos,e.gameMap)):this.mode!==E.MoveToDownedGuard&&(a.copy(this.goal,r.pos),F(this.mode)?this.goals=this.chooseMoveTowardPosition(this.pos,e.gameMap):this.goals=this.chooseMoveTowardPosition(this.goal,e.gameMap),this.mode=E.MoveToLastSound,this.modeTimeout=4+x(2))),this.mode){case E.Patrol:if(this.makeBestAvailableMove(n,r),this.pos.equals(this.patrolPath[this.patrolPathIndex])){if(this.pos.equals(o)){const e=this.patrolPath[Math.max(0,this.patrolPathIndex+this.patrolPath.length-2)%this.patrolPath.length];if(o.equals(e)){const e=1===this.patrolPath.length,t=n.tryGetPosLookAt(this.pos,e);void 0!==t&&N(this.dir,this.pos,t)}}}else this.enterPatrolMode(n);break;case E.Look:case E.Listen:this.makeBestAvailableMove(n,r),this.modeTimeout-=1,this.modeTimeout<=0&&this.enterPatrolMode(n);break;case E.LookAtTorch:this.makeBestAvailableMove(n,r),N(this.dir,this.pos,this.goal),this.modeTimeout-=1,this.modeTimeout<=0&&this.enterPatrolMode(n);break;case E.ChaseVisibleTarget:if(a.copy(this.goal,r.pos),this.adjacentTo(r.pos)&&!this.pos.equals(r.pos)){if(N(this.dir,this.pos,this.goal),this.modePrev===E.ChaseVisibleTarget){r.damagedLastTurn||t.push({speaker:this,speechType:S.Damage});const o=a.create(),n=a.create();a.subtract(n,r.pos,this.pos),a.scale(n,n,.5),this.animation=new b([{pt0:o,pt1:n,duration:.1,fn:T.easeInQuad},{pt0:n,pt1:o,duration:.1,fn:T.easeOutQuad}],[]),r.applyDamage(1),Qs(e,r.health),Ks(e),Ds(e,r.pos[0]-this.pos[0],r.pos[1]-this.pos[1]),++s.damageTaken}}else this.goals=this.chooseMoveTowardPosition(this.goal,n),this.makeBestAvailableMove(n,r);break;case E.MoveToLastSighting:this.makeBestAvailableMove(n,r),this.pos.equals(this.goal)?(this.mode=E.InvestigateLastSighting,this.modeTimeout=5):this.pos.equals(o)&&(this.modeTimeout-=1),this.modeTimeout<=0&&this.enterPatrolMode(n);break;case E.InvestigateLastSighting:this.makeBestAvailableMove(n,r),this.modeTimeout>=3&&this.pos.equals(this.goal)&&this.tryStepGoalForward(e),this.modeTimeout-=1,this.modeTimeout<=0&&this.enterPatrolMode(n);break;case E.MoveToLastSound:case E.MoveToGuardShout:this.makeBestAvailableMove(n,r),this.pos.equals(o)&&(this.modeTimeout-=1),this.modeTimeout<=0&&this.enterPatrolMode(n);break;case E.MoveToDownedGuard:this.makeBestAvailableMove(n,r),this.cardinallyAdjacentTo(this.goal)?n.guards.find((e=>e.pos.equals(this.goal)&&e.mode===E.Unconscious))?(this.mode=E.WakeGuard,this.modeTimeout=3):(this.modeTimeout=0,this.enterPatrolMode(n)):this.pos.equals(o)&&(this.modeTimeout-=1,this.modeTimeout<=0&&this.enterPatrolMode(n));break;case E.MoveToMissingTreasure:this.makeBestAvailableMove(n,r),this.cardinallyAdjacentTo(this.goal)?(this.mode=E.LookAtMissingTreasure,this.modeTimeout=4):this.pos.equals(o)?(this.modeTimeout-=1,this.modeTimeout<=0&&this.enterPatrolMode(n)):this.modeTimeout=3;break;case E.LookAtMissingTreasure:this.makeBestAvailableMove(n,r),this.pos.equals(o)&&this.cardinallyAdjacentTo(this.goal)&&N(this.dir,this.pos,this.goal),this.modeTimeout-=1,this.modeTimeout<=0&&this.enterPatrolMode(n);break;case E.WakeGuard:this.makeBestAvailableMove(n,r),this.pos.equals(o)&&N(this.dir,this.pos,this.goal),--this.modeTimeout;const i=n.guards.find((e=>e.pos.equals(this.goal)&&e.mode===E.Unconscious));void 0!==i?this.modeTimeout<=0&&(i.modeTimeout=0,this.enterPatrolMode(n)):(this.modeTimeout=0,this.enterPatrolMode(n));break;case E.MoveToTorch:this.makeBestAvailableMove(n,r),n.items.some((e=>e.pos.equals(this.goal)&&e.type===ne.TorchLit))?this.enterPatrolMode(n):this.cardinallyAdjacentTo(this.goal)?(this.mode=E.LightTorch,this.modeTimeout=5):this.pos.equals(o)?(this.modeTimeout-=1,this.modeTimeout<=0&&this.enterPatrolMode(n)):this.modeTimeout=3;break;case E.LightTorch:if(this.makeBestAvailableMove(n,r),--this.modeTimeout,N(this.dir,this.pos,this.goal),this.modeTimeout<=0){!function(e,t){for(const o of e.items)o.type===ne.TorchUnlit&&o.pos.equals(t)&&(o.type=ne.TorchLit)}(n,this.goal);const e=O(n,this.pos);void 0===e?this.enterPatrolMode(n):(a.copy(this.goal,e.pos),this.cardinallyAdjacentTo(this.goal)?(this.mode=E.LightTorch,this.modeTimeout=5):(this.mode=E.MoveToTorch,this.modeTimeout=3))}break;case E.Unconscious:this.modeTimeout<=0&&(this.modeTimeout=0,this.angry=!0,this.enterPatrolMode(n))}}postActSense(e,t,o,n,r){if(this.mode!==E.Unconscious){if(this.seesActor(e,t)?F(this.mode)&&!this.adjacentTo(t.pos)?(this.mode=E.Look,this.modeTimeout=2+x(4)):this.mode=E.ChaseVisibleTarget:this.mode===E.ChaseVisibleTarget&&this.modePrev===E.ChaseVisibleTarget&&(this.mode=E.MoveToLastSighting,this.modeTimeout=3),this.heardGuard&&this.mode!==E.Look&&this.mode!==E.ChaseVisibleTarget&&this.mode!==E.MoveToLastSighting&&this.mode!==E.InvestigateLastSighting&&this.mode!==E.MoveToLastSound&&this.mode!==E.MoveToDownedGuard&&this.mode!==E.WakeGuard&&(this.mode=E.MoveToGuardShout,this.modeTimeout=2+x(4),a.copy(this.goal,this.heardGuardPos)),this.mode!==E.ChaseVisibleTarget&&this.mode!==E.MoveToDownedGuard&&this.mode!==E.WakeGuard)for(let t of e.guards)if(t!==this&&t.mode===E.Unconscious&&this.seesActor(e,t)){a.copy(this.goal,t.pos),this.mode=E.MoveToDownedGuard,this.angry=!0,this.modeTimeout=3;break}if(!this.angry&&F(this.mode)){const t=e.treasures.find((t=>t.stolen&&this.seesPosition(e,t.posTreasure)));void 0!==t&&(this.mode=E.MoveToMissingTreasure,a.copy(this.goal,t.posTreasure),this.angry=!0,this.modeTimeout=3)}if(this.hasTorch&&this.mode===E.Patrol){const t=O(e,this.pos);void 0!==t&&(a.copy(this.goal,t.pos),this.cardinallyAdjacentTo(this.goal)?(this.mode=E.LightTorch,this.modeTimeout=5):(this.mode=E.MoveToTorch,this.modeTimeout=3))}!this.hasTorch&&F(this.mode)&&null!==t.itemUsed&&a.squaredDistance(this.pos,t.itemUsed.pos)<=H&&X(e,this.pos,t.itemUsed.pos)&&(t.itemUsed.type===ne.TorchLit?(a.copy(this.goal,t.itemUsed.pos),this.mode=E.LookAtTorch,this.modeTimeout=2+x(4)):t.itemUsed.type===ne.TorchUnlit&&n.push({speaker:this,speechType:S.GuardSeeTorchDoused})),this.mode===E.MoveToGuardShout&&B(e,this.pos,this.goal)&&e.guards.some((e=>e.pos.equals(this.goal)))&&a.copy(this.goal,this.pos)}this.heardThief=!1,this.heardThiefClosest=!1;const s=function(e,t,o){if(t==e)return;const n=o<=H;switch(t){case E.Patrol:switch(e){case E.Look:return S.GuardFinishLooking;case E.LookAtTorch:return S.GuardFinishLookingAtLitTorch;case E.Listen:return S.GuardFinishListening;case E.MoveToLastSound:return S.GuardFinishInvestigating;case E.MoveToGuardShout:case E.MoveToLastSighting:case E.InvestigateLastSighting:return S.GuardEndChase;case E.LightTorch:return n?S.GuardFinishLightingTorch:void 0;case E.Unconscious:return S.GuardAwakesWarning;case E.MoveToMissingTreasure:case E.LookAtMissingTreasure:default:return}case E.Look:return S.GuardSeeThief;case E.LookAtTorch:return S.GuardSeeTorchLit;case E.Listen:return S.GuardHearThief;case E.ChaseVisibleTarget:return e!=E.MoveToLastSighting&&e!==E.InvestigateLastSighting?S.GuardChase:void 0;case E.LightTorch:return e===E.Patrol&&n?S.GuardSeeUnlitTorch:void 0;case E.MoveToLastSighting:case E.InvestigateLastSighting:return;case E.MoveToLastSound:return S.GuardInvestigate;case E.MoveToGuardShout:return S.GuardHearGuard;case E.MoveToTorch:return e!==E.LightTorch&&n?S.GuardSeeUnlitTorch:void 0;case E.MoveToDownedGuard:return S.GuardSpotDownedGuard;case E.WakeGuard:return S.GuardDownWarning;case E.MoveToMissingTreasure:return S.GuardSpotStolenTreasure;case E.LookAtMissingTreasure:return S.GuardExamineStolenTreasure}return}(this.modePrev,this.mode,a.squaredDistance(this.pos,t.pos));if(void 0!==s&&n.push({speaker:this,speechType:s}),this.mode!==this.modePrev)switch(this.mode){case E.ChaseVisibleTarget:r.push({posShouter:a.clone(this.pos),posGoal:a.clone(t.pos),angry:!1}),++o.numSpottings;break;case E.WakeGuard:case E.LookAtMissingTreasure:r.push({posShouter:a.clone(this.pos),posGoal:a.clone(this.goal),angry:!0})}}tryStepGoalForward(e){const t=a.create();if(a.add(t,this.pos,this.dir),0===e.gameMap.guardMoveCost(this.pos,t))return void a.copy(this.goal,t);let o=[a.fromValues(this.pos[0]-this.dir[1],this.pos[1]+this.dir[0]),a.fromValues(this.pos[0]+this.dir[1],this.pos[1]-this.dir[0])];if(o=o.filter((t=>0===e.gameMap.guardMoveCost(this.pos,t))),o.length>0){const t=e.rng.randomInRange(o.length);a.copy(this.goal,o[t])}}cardinallyAdjacentTo(e){const t=Math.abs(e[0]-this.pos[0]),o=Math.abs(e[1]-this.pos[1]);return 1==t&&0==o||0==t&&1==o}adjacentTo(e){const t=e[0]-this.pos[0],o=e[1]-this.pos[1];return Math.abs(t)<2&&Math.abs(o)<2}seesActor(e,t,o=0){return this.seesPositionInternal(e,t.pos,t.hidden(e),B,o)}seesPosition(e,t){return this.seesPositionInternal(e,t,!1,X,0)}seesPositionInternal(e,t,o,n,r){const s=a.create();if(a.subtract(s,t,this.pos),this.mode!==E.ChaseVisibleTarget&&a.dot(this.dir,s)<r)return!1;const i=e.cells.atVec(t).lit>0;if(a.squaredLen(s)>=this.sightCutoff(i)&&(s[0]!==2*this.dir[0]||s[1]!==2*this.dir[1]))return!1;if(F(this.mode)&&!this.angry||Math.abs(s[0])>=2||Math.abs(s[1])>=2){if(o||!n(e,this.pos,t))return!1}else if(this.pos[0]!==t[0]&&this.pos[1]!==t[1]&&(e.cells.at(this.pos[0],t[1]).blocksSight||e.cells.at(t[0],this.pos[1]).blocksSight))return!1;return!0}hidden(e){return!!e.cells.atVec(this.pos).hidesPlayer}sightCutoff(e){return this.mode===E.ChaseVisibleTarget?e?75:33:!F(this.mode)||this.angry?e?75:15:e?40:3}enterPatrolMode(e){this.patrolPathIndex=e.patrolPathIndexForResume(this.patrolPath,this.patrolPathIndex,this.pos),this.mode=E.Patrol}choosePatrolStep(e){return this.pos.equals(this.patrolPath[this.patrolPathIndex])&&(this.patrolPathIndex=(this.patrolPathIndex+1)%this.patrolPath.length),this.chooseMoveTowardPosition(this.patrolPath[this.patrolPathIndex],e.gameMap)}makeBestAvailableMove(e,t){const[o,n]=this.bestAvailableMove(this.goals,e,t);if(!o.equals(this.pos)){N(this.dir,this.pos,o);const e=a.create();a.subtract(e,this.pos,o);const t=a.create();this.animation=new b([{pt0:e,pt1:t,duration:.2,fn:T.linear}],[]),a.copy(this.pos,o)}n&&(this.mode=E.ChaseVisibleTarget,N(this.dir,this.pos,t.pos))}updateDirInitial(){const e=(this.patrolPathIndex+1)%this.patrolPath.length;N(this.dir,this.pos,this.patrolPath[e])}chooseMoveTowardPosition(e,t){const o={posMin:a.fromValues(Math.max(0,this.pos[0]-1),Math.max(0,this.pos[1]-1)),posMax:a.fromValues(Math.min(t.cells.sizeX,this.pos[0]+2),Math.min(t.cells.sizeY,this.pos[1]+2))},n=t.computeDistancesToPosition(e,o);return t.nextPositions(n,this.pos)}chooseMoveTowardAdjacentToPosition(e,t){const o={posMin:a.fromValues(Math.max(0,this.pos[0]-1),Math.max(0,this.pos[1]-1)),posMax:a.fromValues(Math.min(t.cells.sizeX,this.pos[0]+2),Math.min(t.cells.sizeY,this.pos[1]+2))},n=t.computeDistancesToAdjacentToPosition(e,o);return t.nextPositions(n,this.pos)}}function F(e){return e===E.Patrol||e===E.MoveToTorch||e===E.LightTorch}function G(e){for(const t of e.gameMap.guards)t.chooseMoves(e)}function V(e){const t=e.gameMap,o=e.player;for(const e of t.guards)e.modePrev=e.mode,e.heardGuard=e.hearingGuard,e.hearingGuard=!1,e.speaking=!1,e.hasMoved=!1;t.guards.sort(((e,t)=>{const o=e.mode===E.ChaseVisibleTarget;return o!==(t.mode===E.ChaseVisibleTarget)?o?-1:1:t.patrolPath.length-e.patrolPath.length}));const n=[],r=[];for(const o of t.guards){const t=a.clone(o.pos);o.act(e,n),o.hasMoved=!0,t.equals(o.pos)||r.push([o.pos,t])}t.computeLighting(o);const s=[];for(const r of t.guards)r.postActSense(t,o,e.levelStats,n,s);if(n.length>0){n.sort(((e,t)=>{if(e.speechType<t.speechType)return-1;if(e.speechType>t.speechType)return 1;const n=e.speaker.pos,r=t.speaker.pos,s=a.squaredDistance(n,o.pos),i=a.squaredDistance(r,o.pos);return s<i?-1:s>i?1:0}));const t=n[0],r=function(e){switch(e){case S.Damage:return"guardDamage";case S.GuardChase:return"guardChase";case S.GuardSeeThief:return"guardSeeThief";case S.GuardHearThief:return"guardHearThief";case S.GuardHearGuard:return"guardHearGuard";case S.GuardSpotDownedGuard:return"guardSpotDownedGuard";case S.GuardSeeTorchLit:return"guardSeeTorchLit";case S.GuardSeeUnlitTorch:return"guardSeeUnlitTorch";case S.GuardDownWarning:return"guardDownWarning";case S.GuardAwakesWarning:return"guardAwakesWarning";case S.GuardWarningResponse:return"guardWarningResponse";case S.GuardInvestigate:return"guardInvestigate";case S.GuardEndChase:return"guardEndChase";case S.GuardFinishInvestigating:return"guardFinishInvestigating";case S.GuardFinishLooking:return"guardFinishLooking";case S.GuardFinishListening:return"guardFinishListening";case S.GuardFinishLightingTorch:return"guardFinishLightingTorch";case S.GuardFinishLookingAtLitTorch:return"guardFinishLookingAtLitTorch";case S.GuardStirring:return"guardStirring";case S.GuardSeeTorchDoused:return"guardSeeTorchDoused";case S.GuardSpotStolenTreasure:return"guardSpotStolenTreasure";case S.GuardExamineStolenTreasure:return"guardExamineStolenTreasure"}}(t.speechType);let s=Math.max(Math.min((t.speaker.pos[0]-o.pos[0])/12,1),0),i=Math.max(1-t.speaker.pos.distance(o.pos)/12,0);const l=e.subtitledSounds[r].play(.3+.3*i,s),u=n[0].speaker,c=u.pos[1]>=o.pos[1];e.popups.setSpeech(l.subtitle,u,c),u.speaking=!0}for(const e of s)U(t,e);null!==o.pickTarget&&o.pickTarget instanceof W&&(o.pickTarget.mode===E.ChaseVisibleTarget||!o.pickTarget.cardinallyAdjacentTo(o.pos))&&(o.pickTarget=null);const i=function(e,t,o){const n=o.cells,r=o.items.filter((e=>e.type>=ne.DoorNS&&e.type<=ne.PortcullisEW));let s;return function e(o,i,l,u){const c=[];for(let e of[[1,0],[0,1],[-1,0],[0,-1]]){const l=i.add(a.fromValues(e[0],e[1]));if(o.has(l[1]*n.sizeX+l[0]))continue;o.add(l[1]*n.sizeX+l[0]);const d=n.atVec(l);if(d.type===J.DoorEW||d.type===J.DoorNS||d.type===J.PortcullisEW||d.type===J.PortcullisNS){const e=r.find((e=>e.pos.equals(l))),a=t.find((e=>e[0].equals(l)));if(void 0!==e&&a){const t=a[1],r=t[1]*n.sizeX+t[0];if(!o.has(r))switch(e.type){case ne.DoorEW:case ne.DoorNS:s=["doorOpen",l];break;case ne.LockedDoorEW:case ne.LockedDoorNS:s=["doorOpenLocked",l];break;case ne.PortcullisEW:case ne.PortcullisNS:s=["gate",l]}}if(void 0!==s)return;if(e&&!u)return}(d.type<J.Wall0000||d.type>J.Wall1111)&&c.push(l)}if(l>0&&void 0===s)for(let t of c)e(o,t,l-1,!1)}(new Set,e,20,!0),s}(e.player.pos,r,e.gameMap);if(i){const[t,n]=i;let r=Math.max(Math.min((n[0]-o.pos[0])/12,1),0),s=Math.max(1-n.distance(o.pos)/12,0);e.sounds[t].play(.2+.3*s,r)}}function U(e,t){for(const o of e.guardsInEarshot(t.posShouter,25))o.mode!==E.Unconscious&&(o.pos.equals(t.posShouter)||(o.hearingGuard=!0,t.angry&&(o.angry=!0),a.copy(o.heardGuardPos,t.posGoal)))}function N(e,t,o){const n=a.create();a.subtract(n,o,t);const r=a.fromValues(-e[1],e[0]),s=a.dot(e,n),i=a.dot(r,n);s>=Math.abs(i)||(-s>Math.abs(i)?a.negate(e,e):i>=0?a.copy(e,r):a.negate(e,r))}function O(e,t){let o,n=H+1;for(const r of e.items)if(r.type===ne.TorchUnlit){const s=a.squaredDistance(r.pos,t);if(s>=n)continue;if(!X(e,t,r.pos))continue;n=s,o=r}return o}function B(e,t,o){let n=t[0],r=t[1];const s=o[0]-n,a=o[1]-r;let i=Math.abs(s),l=Math.abs(a);const u=s>0?1:-1,c=a>0?1:-1;let d=l-i;const p=i+l-1;let h=p;for(i*=2,l*=2;h>0;){if(d>0)r+=c,d-=i;else{if(0===d){const t=e.cells.at(n,r+c);if(t.blocksSight)return!1;if(t.isWindow&&h>1&&h<p-1)return!1}n+=u,d+=l}const t=e.cells.at(n,r);if(t.blocksSight)return!1;if(t.isWindow&&h>1&&h<p-1)return!1;--h}return!0}function z(e){return!!e.blocksSight||!!he(e.type)}function X(e,t,o){let n=t[0],r=t[1];const s=o[0]-n,a=o[1]-r;let i=Math.abs(s),l=Math.abs(a);const u=s>0?1:-1,c=a>0?1:-1;let d=l-i,p=i+l-1;for(i*=2,l*=2;p>0;){if(d>0)r+=c,d-=i;else{if(0===d&&z(e.cells.at(n,r+c)))return!1;n+=u,d+=l}const t=e.cells.at(n,r);if(t.blocksSight)return!1;if(he(t.type))return!1;--p}return!0}const q=[a.fromValues(-1,0),a.fromValues(1,0),a.fromValues(0,-1),a.fromValues(0,1)];class Y{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Uint8Array(e*t),this.fill(o)}fill(e){this.values.fill(e?1:0)}get(e,t){return 0!==this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o?1:0}}class j{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Int32Array(e*t),this.fill(o)}fill(e){this.values.fill(e)}get(e,t){return this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o}}class ${constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Float64Array(e*t),this.fill(o)}fill(e){this.values.fill(e)}get(e,t){return this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o}}let K;var Q;let J;var Z;(Q=K||(K={}))[Q.Manor=0]="Manor",Q[Q.ManorRed=1]="ManorRed",Q[Q.Mansion=2]="Mansion",Q[Q.Fortress=3]="Fortress",(Z=J||(J={}))[Z.GroundNormal=0]="GroundNormal",Z[Z.GroundGrass=1]="GroundGrass",Z[Z.GroundWater=2]="GroundWater",Z[Z.GroundMarble=3]="GroundMarble",Z[Z.GroundWood=4]="GroundWood",Z[Z.GroundWoodCreaky=5]="GroundWoodCreaky",Z[Z.GroundVault=6]="GroundVault",Z[Z.GroundTreasure=7]="GroundTreasure",Z[Z.Wall0000=8]="Wall0000",Z[Z.Wall0001=9]="Wall0001",Z[Z.Wall0010=10]="Wall0010",Z[Z.Wall0011=11]="Wall0011",Z[Z.Wall0100=12]="Wall0100",Z[Z.Wall0101=13]="Wall0101",Z[Z.Wall0110=14]="Wall0110",Z[Z.Wall0111=15]="Wall0111",Z[Z.Wall1000=16]="Wall1000",Z[Z.Wall1001=17]="Wall1001",Z[Z.Wall1010=18]="Wall1010",Z[Z.Wall1011=19]="Wall1011",Z[Z.Wall1100=20]="Wall1100",Z[Z.Wall1101=21]="Wall1101",Z[Z.Wall1110=22]="Wall1110",Z[Z.Wall1111=23]="Wall1111",Z[Z.OneWayWindowE=24]="OneWayWindowE",Z[Z.OneWayWindowW=25]="OneWayWindowW",Z[Z.OneWayWindowN=26]="OneWayWindowN",Z[Z.OneWayWindowS=27]="OneWayWindowS",Z[Z.PortcullisNS=28]="PortcullisNS",Z[Z.PortcullisEW=29]="PortcullisEW",Z[Z.DoorNS=30]="DoorNS",Z[Z.DoorEW=31]="DoorEW",Z[Z.GardenDoorNS=32]="GardenDoorNS",Z[Z.GardenDoorEW=33]="GardenDoorEW";class ee{constructor(e,t){this.sizeX=e,this.sizeY=t;const o=e*t;this.values=new Array(o);for(let e=0;e<o;++e)this.values[e]=this.emptyCell()}at(e,t){if(e<0||e>=this.sizeX||t<0||t>=this.sizeY)return this.emptyCell();const o=this.sizeX*t+e;return this.values[o]}atVec(e){return this.at(e[0],e[1])}index(e,t){return this.sizeX*t+e}indexVec(e){return this.index(e[0],e[1])}emptyCell(){return{type:J.GroundGrass,moveCost:1/0,blocksPlayerMove:!1,blocksPlayerSight:!1,blocksSight:!1,blocksSound:!1,hidesPlayer:!1,isWindow:!1,lit:0,litAnim:0,litSrc:new Set,seen:!1,identified:!1}}}let te;var oe;let ne;var re;function se(e){switch(e){case ne.Chair:return 32;case ne.Table:case ne.BedL:case ne.BedR:return 64;case ne.DrawersShort:case ne.DrawersTall:case ne.Bookshelf:case ne.Shelf:case ne.Stove:return 1/0;case ne.Bush:return 10;case ne.Coin:case ne.Health:case ne.DoorNS:case ne.DoorEW:case ne.LockedDoorNS:case ne.LockedDoorEW:case ne.PortcullisNS:case ne.PortcullisEW:return 0;case ne.TorchUnlit:case ne.TorchLit:return 1/0;case ne.TorchCarry:case ne.PurseCarry:case ne.Key:case ne.KeyCarry:case ne.Note:return 0;case ne.TreasureLock:case ne.TreasurePlinth:case ne.Treasure:return 1/0}}(oe=te||(te={}))[oe.Relaxed=0]="Relaxed",oe[oe.Angry=1]="Angry",oe[oe.Alerted=2]="Alerted",oe[oe.Chasing=3]="Chasing",oe[oe.Unconscious=4]="Unconscious",(re=ne||(ne={}))[re.Chair=0]="Chair",re[re.Table=1]="Table",re[re.BedL=2]="BedL",re[re.BedR=3]="BedR",re[re.DrawersShort=4]="DrawersShort",re[re.DrawersTall=5]="DrawersTall",re[re.Bookshelf=6]="Bookshelf",re[re.Shelf=7]="Shelf",re[re.Stove=8]="Stove",re[re.Bush=9]="Bush",re[re.Coin=10]="Coin",re[re.Health=11]="Health",re[re.DoorNS=12]="DoorNS",re[re.DoorEW=13]="DoorEW",re[re.LockedDoorNS=14]="LockedDoorNS",re[re.LockedDoorEW=15]="LockedDoorEW",re[re.PortcullisNS=16]="PortcullisNS",re[re.PortcullisEW=17]="PortcullisEW",re[re.TorchUnlit=18]="TorchUnlit",re[re.TorchLit=19]="TorchLit",re[re.TorchCarry=20]="TorchCarry",re[re.PurseCarry=21]="PurseCarry",re[re.Key=22]="Key",re[re.KeyCarry=23]="KeyCarry",re[re.Note=24]="Note",re[re.TreasureLock=25]="TreasureLock",re[re.TreasurePlinth=26]="TreasurePlinth",re[re.Treasure=27]="Treasure";const ae=7;class ie{itemUsed=null;animation=null;torchAnimation=null;pickTarget=null;lightActive=!1;idle=!1;idleCursorAnimation=null;idleCursorType="orbs";constructor(e,t){this.pos=a.clone(e),this.dir=a.fromValues(0,-1),this.healthMax=t?3:5,this.health=this.healthMax,this.loot=0,this.noisy=!1,this.preNoisy=!1,this.noiseOffset=a.fromValues(0,0),this.noisyAnim=0,this.hasVaultKey=!1,this.damagedLastTurn=!1,this.turnsRemainingUnderwater=ae}applyDamage(e){this.health-=Math.min(e,this.health),this.damagedLastTurn=!0}hidden(e){if(this.lightActive)return!1;if(void 0!==e.guards.find((e=>e.mode==E.ChaseVisibleTarget)))return!1;if(e.cells.atVec(this.pos).hidesPlayer)return!0;return e.cells.atVec(this.pos).type==J.GroundWater&&this.turnsRemainingUnderwater>0}}const le=[{lx:-1,ly:-1,rx:-1,ry:1,nx:-1,ny:0},{lx:-1,ly:1,rx:1,ry:1,nx:0,ny:1},{lx:1,ly:1,rx:1,ry:-1,nx:1,ny:0},{lx:1,ly:-1,rx:-1,ry:-1,nx:0,ny:-1}],ue=[{lx:-1,ly:-1,rx:-1,ry:-1,nx:-1,ny:-1},{lx:-1,ly:-1,rx:-1,ry:1,nx:-1,ny:0},{lx:-1,ly:1,rx:-1,ry:1,nx:-1,ny:1},{lx:-1,ly:1,rx:1,ry:1,nx:0,ny:1},{lx:1,ly:1,rx:1,ry:1,nx:1,ny:1},{lx:1,ly:1,rx:1,ry:-1,nx:1,ny:0},{lx:1,ly:-1,rx:1,ry:-1,nx:1,ny:-1},{lx:1,ly:-1,rx:-1,ry:-1,nx:0,ny:-1}];function ce(e,t,o,n){return e*n>t*o}const de=[{dx:1,dy:0,cost:2},{dx:-1,dy:0,cost:2},{dx:0,dy:1,cost:2},{dx:0,dy:-1,cost:2},{dx:-1,dy:-1,cost:3},{dx:1,dy:-1,cost:3},{dx:-1,dy:1,cost:3},{dx:1,dy:1,cost:3}];class pe{constructor(e){this.cells=e,this.patrolRegions=[],this.patrolRoutes=[],this.items=[],this.guards=[],this.playerStartPos=a.create(),this.lightCount=0,this.numPreRevealedCells=0,this.adjacencies=[],this.backtrackingCoefficient=1,this.bookTitle=new Map,this.treasures=[]}hasLootAt(e){return this.items.some((t=>t.pos.equals(e)&&(t.type===ne.Coin||t.type===ne.Treasure||t.type===ne.Health)))}collectLootAt(e){let t=[];const o=this.items.some((t=>t.type===ne.TreasureLock&&t.pos.equals(e)));return this.items=this.items.filter((n=>!n.pos.equals(e)||(n.type===ne.Coin||n.type===ne.Health?(t.push(n),!1):!(n.type===ne.Treasure&&!o)||(t.push(n),!1)))),t}collectAllLoot(){let e=0;this.items=this.items.filter((t=>t.type!=ne.Coin||(++e,!1)));for(let t of this.guards)t.hasPurse&&(++e,t.hasPurse=!1);return e}identifyAdjacentCells(e){const t=Math.max(e[0]-1,0),o=Math.max(e[1]-1,0),n=Math.min(e[0]+2,this.cells.sizeX),r=Math.min(e[1]+2,this.cells.sizeY);for(let e=t;e<n;++e)for(let t=o;t<r;++t)this.cells.at(e,t).identified=!0}allSeen(){return!this.cells.values.some((e=>!e.seen))}numCells(){return this.cells.values.length}numCellsSeen(){let e=0;for(const t of this.cells.values)t.seen&&++e;return e}fractionRevealed(){return(this.numCellsSeen()-this.numPreRevealedCells)/(this.numCells()-this.numPreRevealedCells)}markAllSeen(){for(const e of this.cells.values)e.seen=!0,e.identified=!0}markAllUnseen(){for(const e of this.cells.values)e.seen=!1,e.identified=!1}recomputeVisibility(e){this.recomputeVisibilityFromPos(e);const t=a.create();for(const o of q)this.playerCanSeeInDirection(e,o)&&(a.add(t,e,o),this.recomputeVisibilityFromPos(t))}recomputeVisibilityFromPos(e){for(const t of le)this.computeVisibility(e[0],e[1],e[0],e[1],t.lx,t.ly,t.rx,t.ry)}playerCanSeeInDirection(e,t){const o=a.create();if(a.add(o,e,t),o[0]<0||o[1]<0||o[0]>=this.cells.sizeX||o[1]>=this.cells.sizeY)return!1;return!this.cells.at(o[0],o[1]).blocksPlayerSight}computeVisibility(e,t,o,n,r,s,a,i){if(o<0||n<0||o>=this.cells.sizeX||n>=this.cells.sizeY)return;let l=o-e,u=n-t;if(l**2+u**2>400)return;l*=2,u*=2;const c=this.cells.at(o,n);if(c.seen=!0,!c.blocksPlayerSight){for(let e=0;e<2;++e)for(let t=0;t<2;++t){let c=o+2*e-1,d=n+2*t-1,p=l+2*e-1,h=u+2*t-1;c>=0&&d>=0&&c<this.cells.sizeX&&d<this.cells.sizeY&&!ce(r,s,p,h)&&!ce(p,h,a,i)&&(this.cells.at(c,d).seen=!0)}for(const c of le){const d=l+c.lx,p=u+c.ly,h=l+c.rx,m=u+c.ry,[f,g]=ce(r,s,d,p)?[r,s]:[d,p],[y,x]=ce(a,i,h,m)?[h,m]:[a,i];ce(y,x,f,g)&&this.computeVisibility(e,t,o+c.nx,n+c.ny,f,g,y,x)}}}computeLighting(e){const t=new Set;null!==e&&this.cells.atVec(e.pos).type>=J.Wall0000&&t.add(this.cells.atVec(e.pos));for(let e of this.guards){const o=this.cells.at(e.pos[0],e.pos[1]);o.type>=J.Wall0000&&t.add(o)}for(const e of this.cells.values)e.lit=0,e.litSrc.clear();let o=0;for(const e of this.items)e.type===ne.TorchLit&&(this.castLight(e.pos,45,o,t),o++),e.type===ne.Stove&&(this.castLight(e.pos,25,o,t),o++),e.type==ne.TorchUnlit&&o++;for(const e of this.guards)e.hasTorch&&(e.mode!==E.Unconscious&&this.castLight(e.pos,15,o,t),o++);null!==e&&e.lightActive&&this.castLight(e.pos,0,o,t),o++,this.lightCount=o}castLight(e,t,o,n){this.cells.at(e[0],e[1]).lit=1;for(const r of ue)this.castLightRecursive(e[0],e[1],e[0]+r.nx,e[1]+r.ny,r.lx,r.ly,r.rx,r.ry,t,o,n)}castLightRecursive(e,t,o,n,r,s,a,i,l,u,c){if(o<0||n<0||o>=this.cells.sizeX||n>=this.cells.sizeY)return;let d=o-e,p=n-t;if(d**2+p**2>l)return;const h=this.cells.at(o,n);if(!h.litSrc.has(u)){const e=d**2+p**2;h.lit+=1/(.5*e+1),h.lit=Math.min(h.lit,1),h.litSrc.add(u)}if((!h.blocksSight||c.has(h))&&ce(a,i,r,s)){d*=2,p*=2;for(const h of ue){const m=d+h.lx,f=p+h.ly,g=d+h.rx,y=p+h.ry,[x,v]=ce(r,s,m,f)?[r,s]:[m,f],[S,M]=ce(a,i,g,y)?[g,y]:[a,i];ce(x,v,S,M)||this.castLightRecursive(e,t,o+h.nx,n+h.ny,x,v,S,M,l,u,c)}}}allLootCollected(){return void 0===this.items.find((e=>e.type==ne.Coin))}isGuardAt(e,t){return null!=this.guards.find((o=>o.hasMoved&&o.pos.equalsValues(e,t)))}isGuardAtVec(e){return null!=this.guards.find((t=>t.hasMoved&&t.pos.equals(e)))}guardMoveCost(e,t){const o=this.cells.atVec(t).moveCost;return o===1/0?o:e[0]!=t[0]&&e[1]!=t[1]&&(this.cells.at(e[0],t[1]).moveCost>=64||this.cells.at(t[0],e[1]).moveCost>=64)?1/0:o}posNextBest(e,t){let o=1/0,n=a.clone(t);const r=a.fromValues(Math.max(0,t[0]-1),Math.max(0,t[1]-1)),s=a.fromValues(Math.min(this.cells.sizeX,t[0]+2),Math.min(this.cells.sizeY,t[1]+2));for(let i=r[0];i<s[0];++i)for(let l=r[1];l<s[1];++l){const r=e.get(i,l);if(r==1/0)continue;let s=a.fromValues(i,l);this.guardMoveCost(t,s)!=1/0&&(this.isGuardAtVec(s)||r<o&&(o=r,n=s))}return n}nextPositions(e,t){const o=a.fromValues(Math.max(0,t[0]-1),Math.max(0,t[1]-1)),n=a.fromValues(Math.min(this.cells.sizeX,t[0]+2),Math.min(this.cells.sizeY,t[1]+2)),r=[];for(let s=o[0];s<n[0];++s)for(let i=o[1];i<n[1];++i){const o=e.get(s,i);if(o===1/0)continue;let n=a.fromValues(s,i);if(this.guardMoveCost(t,n)===1/0)continue;const l=Math.abs(t[0]-n[0])+Math.abs(t[1]-n[1]);r.push([o,l,n])}return r.sort(((e,t)=>e[0]!==t[0]?e[0]-t[0]:e[1]-t[1])),r.map((e=>e[2]))}patrolPathIndexForResume(e,t,o){const n=this.computeDistancesToPosition(o,void 0);let r=t;for(let t=0;t<e.length;++t){const t=e[r],o=this.posNextBest(n,t),s=e[(r+e.length-1)%e.length],i=a.create();a.subtract(i,t,o);const l=a.create();if(a.subtract(l,t,s),a.dot(i,l)>0)break;r=(r+1)%e.length}return r}computeDistancesToPosition(e,t){return console.assert(e[0]>=0),console.assert(e[1]>=0),console.assert(e[0]<this.cells.sizeX),console.assert(e[1]<this.cells.sizeY),this.computeDistanceField([{priority:0,pos:a.clone(e)}],t)}computeDistancesToPositionSubrect(e,t,o,n,r){return console.assert(e[0]>=t),console.assert(e[1]>=o),console.assert(e[0]<n),console.assert(e[1]<r),this.computeDistanceFieldSubrect([{priority:0,pos:a.clone(e)}],t,o,n,r)}computeDistancesToAdjacentToPosition(e,t){const o=[];for(const t of q){const n=a.clone(e).add(t);if(n[0]<0||n[1]<0||n[0]>=this.cells.sizeX||n[1]>=this.cells.sizeY)continue;const r=this.cells.atVec(n);r.moveCost!==1/0&&o.push({priority:r.moveCost,pos:n})}return this.computeDistanceField(o,t)}computeDistanceField(e,t){let o=this.cells.sizeX,n=this.cells.sizeY;const r=[],s=new $(o,n,1/0);for(const t of e)ge(r,t);let i=void 0===t?1:this.numNavigableSquaresInRect(t);for(;r.length>0&&i>0;){const e=fe(r);if(!(e.priority>=s.get(e.pos[0],e.pos[1]))){s.set(e.pos[0],e.pos[1],e.priority),void 0!==t&&e.pos[0]>=t.posMin[0]&&e.pos[1]>=t.posMin[1]&&e.pos[0]<t.posMax[0]&&e.pos[1]<t.posMax[1]&&--i;for(const t of de){const i=a.fromValues(e.pos[0]+t.dx,e.pos[1]+t.dy);if(i[0]<0||i[1]<0||i[0]>=o||i[1]>=n)continue;const l=this.guardMoveCost(e.pos,i);if(l==1/0)continue;const u=e.priority+l+t.cost;u<s.get(i[0],i[1])&&ge(r,{priority:u,pos:i})}}}return s}numNavigableSquaresInRect(e){let t=0;for(let o=e.posMin[0];o<e.posMax[0];++o)for(let n=e.posMin[1];n<e.posMax[1];++n)this.cells.at(o,n).moveCost!==1/0&&++t;return t}computeDistanceFieldSubrect(e,t,o,n,r){console.assert(t>=0),console.assert(o>=0),console.assert(n<=this.cells.sizeX),console.assert(r<=this.cells.sizeY);const s=n-t,i=r-o,l=[],u=new $(s,i,1/0);for(const n of e)ge(l,{priority:n.priority,pos:[n.pos[0]-t,n.pos[1]-o]});for(;l.length>0;){const e=fe(l);if(e.priority>=u.get(e.pos[0],e.pos[1]))continue;u.set(e.pos[0],e.pos[1],e.priority);const n=a.fromValues(e.pos[0]+t,e.pos[1]+o);for(const r of de){const c=a.fromValues(e.pos[0]+r.dx,e.pos[1]+r.dy);if(c[0]<0||c[1]<0||c[0]>=s||c[1]>=i)continue;const d=a.fromValues(c[0]+t,c[1]+o),p=this.guardMoveCost(n,d);if(p==1/0)continue;const h=e.priority+p+r.cost;h<u.get(c[0],c[1])&&ge(l,{priority:h,pos:c})}}return u}guardsInEarshot(e,t){const o=this.cells.sizeX,n=this.cells.sizeY,r=new Map;for(const e of this.guards)e.mode!==E.Unconscious&&r.set(o*e.pos[1]+e.pos[0],e);const s=[],i=new $(o,n,1/0),l=[];for(ge(s,{priority:0,pos:e});s.length>0;){const e=fe(s);if(e.priority>=i.get(e.pos[0],e.pos[1]))continue;i.set(e.pos[0],e.pos[1],e.priority);const u=r.get(o*e.pos[1]+e.pos[0]);void 0!==u&&l.push(u);for(const r of de){const l=a.fromValues(e.pos[0]+r.dx,e.pos[1]+r.dy);if(l[0]<0||l[1]<0||l[0]>=o||l[1]>=n)continue;const u=e.priority+r.cost;u>t||(this.cells.at(l[0],l[1]).blocksSound||u>=i.get(l[0],l[1])||ge(s,{priority:u,pos:l}))}}return l}tryGetPosLookAt(e,t){const o=e[0],n=e[1];if(t){const e=this.items.filter((e=>Math.abs(e.pos[0]-o)<2&&Math.abs(e.pos[1]-n)<2&&(e.type===ne.LockedDoorEW||e.type===ne.LockedDoorNS)));if(e.find((e=>e.pos[0]===o-1&&e.pos[1]===n)))return a.fromValues(o+1,n);if(e.find((e=>e.pos[0]===o+1&&e.pos[1]===n)))return a.fromValues(o-1,n);if(e.find((e=>e.pos[0]===o&&e.pos[1]===n-1)))return a.fromValues(o,n+1);if(e.find((e=>e.pos[0]===o&&e.pos[1]===n+1)))return a.fromValues(o,n-1);if(o>0&&this.cells.at(o-1,n).type===J.DoorNS)return a.fromValues(o+1,n);if(o<this.cells.sizeX-1&&this.cells.at(o+1,n).type===J.DoorNS)return a.fromValues(o-1,n);if(n>0&&this.cells.at(o,n-1).type===J.DoorEW)return a.fromValues(o,n+1);if(n<this.cells.sizeY-1&&this.cells.at(o,n+1).type==J.DoorEW)return a.fromValues(o,n-1)}if(o>0&&this.cells.at(o-1,n).type==J.OneWayWindowW)return a.fromValues(o-1,n);if(o<this.cells.sizeX-1&&this.cells.at(o+1,n).type==J.OneWayWindowE)return a.fromValues(o+1,n);if(n>0&&this.cells.at(o,n-1).type==J.OneWayWindowS)return a.fromValues(o,n-1);if(n<this.cells.sizeY-1&&this.cells.at(o,n+1).type==J.OneWayWindowN)return a.fromValues(o,n+1);if(this.items.find((t=>t.pos.equals(e)&&t.type===ne.Chair))){const e=this.items.filter((e=>Math.abs(e.pos[0]-o)<2&&Math.abs(e.pos[1]-n)<2&&(e.type===ne.Table||e.type===ne.TorchLit||e.type===ne.TorchUnlit)));if(e.find((e=>e.pos[0]===o-1&&e.pos[1]===n)))return a.fromValues(o-1,n);if(e.find((e=>e.pos[0]===o+1&&e.pos[1]===n)))return a.fromValues(o+1,n);if(e.find((e=>e.pos[0]===o&&e.pos[1]===n-1)))return a.fromValues(o,n-1);if(e.find((e=>e.pos[0]===o&&e.pos[1]===n+1)))return a.fromValues(o,n+1)}}}function he(e){return e>=J.OneWayWindowE&&e<=J.OneWayWindowS}function me(e){return e>=ne.DoorNS&&e<=ne.PortcullisEW}function fe(e){const t=e[0];e[0]=e[e.length-1],e.pop();let o=0;const n=e.length;for(;;){let t=o;const r=2*o+1;r<n&&e[r].priority<e[t].priority&&(t=r);const s=r+1;if(s<n&&e[s].priority<e[t].priority&&(t=s),t==o)break;[e[o],e[t]]=[e[t],e[o]],o=t}return t}function ge(e,t){e.push(t);let o=e.length-1;for(;o>0;){const t=Math.floor((o-1)/2);if(e[o].priority>=e[t].priority)break;[e[o],e[t]]=[e[t],e[o]],o=t}}const ye=5,xe=5,ve=2,Se=3,Me=[[3,3,2,2,6,6],[3,5,2,5,6,12],[3,5,2,6,9,15],[3,5,2,6,12,18],[3,7,3,6,15,21],[3,7,3,6,18,24],[3,7,3,6,21,30],[5,7,4,6,24,36],[5,9,4,6,30,42],[7,9,7,9,36,49]];let _e;var Te;let we;var Le;function Ae(e){const t=be(10,100,e),o=3+e.randomInRange(2),n=5+e.randomInRange(2),r=7+e.randomInRange(3);return[t[o],t[n],t[r]]}function be(e,t,o){const n=[],r=4+o.randomInRange(3),s=r+2+o.randomInRange(7-r);for(let t=0;t<e;++t){const e=new y("lvl"+t+o.random());let a;a=t>=9?K.Fortress:t===r||t===s?K.Mansion:1===t||3===t||5===t||t>=8?K.ManorRed:K.Manor;const[i,l]=Re(t,a,e);n.push({levelType:a,level:t,numRoomsX:i,numRoomsY:l,totalLoot:0,rng:e,played:!1})}let a=0;for(const e of n){a+=e.numRoomsX*e.numRoomsY}let i=0;for(const e of n){const o=e.numRoomsX*e.numRoomsY,n=Math.floor(t*o/a);i+=n,e.totalLoot=n}return n[n.length-1].totalLoot+=t-i,n}function Re(e,t,o){let n,r,s,a,i,l;[n,r,s,a,i,l]=Me[e];let u=n+2*o.randomInRange(1+(r-n)/2),c=s+o.randomInRange(1+a-s);return c=Math.min(Math.floor(l/u),c),c=Math.max(c,Math.ceil(i/u)),t===K.Fortress?0==(1&c)&&(c<7?++c:--c):t===K.Mansion&&(u=Math.floor((u+1)/3+.5),c=Math.floor((c+1)/3+.5),u=Math.max(2,u),c=Math.max(2,c),u=Math.min(4,u),c=Math.min(4,c),u*=3,c*=3,u-=1,c-=1),[u,c]}function ke(e){const t=e.level,o=e.rng;o.reset();const n=e.levelType,r=new Y(e.numRoomsX,e.numRoomsY,!0);switch(n){case K.Manor:case K.ManorRed:!function(e,t){const o=e.sizeX,n=e.sizeY,r=Math.floor((o+1)/2);for(let o=Math.floor(n*r/4);o>0;--o){const o=t.randomInRange(r),s=t.randomInRange(n);e.set(o,s,!1)}for(let t=0;t<n;++t)for(let n=r;n<o;++n)e.set(n,t,e.get(o-1-n,t));1==(1&o)&&function(e){const t=e.sizeX,o=e.sizeY;console.assert(1==(1&t));for(let n=(t-1)/2+1;n<t;++n)for(let r=0;r<o;++r)e.set(n,r,e.get(t-1-n,r))}(e);1==(1&n)&&function(e){const t=e.sizeX,o=e.sizeY;console.assert(1==(1&o));const n=(o-1)/2;for(let r=0;r<t;++r)for(let t=n+1;t<o;++t)e.set(r,t,e.get(r,o-1-t))}(e)}(r,o);break;case K.Mansion:!function(e,t){const o=Math.floor((e.sizeX+1)/3),n=Math.floor((e.sizeY+1)/3);e.fill(!1);for(let t=0;t<o;++t)for(let o=0;o<n;++o)for(let n=0;n<2;++n)for(let r=0;r<2;++r)e.set(3*t+n,3*o+r,!0);const r=[];for(let e=0;e<o;++e)for(let t=0;t<n;++t)r.push(e*n+t);const s=[];for(let e=1;e<o;++e)for(let t=0;t<n;++t){const o=(e-1)*n+t,r=e*n+t;s.push([o,r])}for(let e=0;e<o;++e)for(let t=1;t<n;++t){const o=e*n+(t-1),r=e*n+t;s.push([o,r])}t.shuffleArray(s);for(const t of s){const o=t[0],s=t[1],a=r[o],i=r[s],l=o%n,u=Math.floor(o/n),c=s%n,d=Math.floor(s/n);if(a===i)continue;for(let e=0;e<r.length;++e)r[e]===i&&(r[e]=a);const p=3*Math.min(u,d),h=3*Math.max(u,d)+2,m=3*Math.min(l,c),f=3*Math.max(l,c)+2;for(let t=p;t<h;++t)for(let o=m;o<f;++o)e.set(t,o,!0)}}(r,o);break;case K.Fortress:const t=o.random()<.25;for(let o=0;o<e.numRoomsX;++o)for(let n=0;n<e.numRoomsY;++n){const s=Math.min(o,e.numRoomsX-1-o),a=Math.min(n,e.numRoomsY-1-n),i=Math.min(s,a);r.set(o,n,1!==i||!t&&n>1&&1!==s)}}const[s,i]=function(e,t,o){const n=new j(e+1,t,0),r=new j(e,t+1,0),s=o.random()<.25;if(s){let s=o.randomInRange(3)-1;for(let e=0;e<t;++e)n.set(0,e,s);s=o.randomInRange(3)-1;for(let o=0;o<t;++o)n.set(e,o,s);s=o.randomInRange(3)-1;for(let t=0;t<e;++t)r.set(t,0,s);s=o.randomInRange(3)-1;for(let o=0;o<e;++o)r.set(o,t,s);for(let r=1;r<e;++r)for(let e=0;e<t;++e)n.set(r,e,o.randomInRange(3)-1);for(let n=0;n<e;++n)for(let e=1;e<t;++e)r.set(n,e,o.randomInRange(3)-1)}else{for(let r=0;r<e+1;++r)for(let e=0;e<t;++e)n.set(r,e,o.randomInRange(3)-1);for(let n=0;n<e;++n)for(let e=0;e<t+1;++e)r.set(n,e,o.randomInRange(3)-1)}for(let s=1;s<e;++s)for(let e=1;e<t;++e)0===o.randomInRange(2)?n.set(s,e,n.get(s,e-1)):r.set(s,e,r.get(s-1,e));for(let o=0;o<e+1;++o)for(let e=0;e<t;++e)n.set(o,e,n.get(o,e)+o*ye);for(let o=0;o<e;++o)for(let e=0;e<t+1;++e)r.set(o,e,r.get(o,e)+e*xe);return[n,r]}(e.numRoomsX,e.numRoomsY,o),l=1==(1&e.numRoomsX)&&function(e){for(let t=0;t<e.sizeY;++t)for(let o=0;o<Math.floor(e.sizeX/2);++o)if(e.get(o,t)!==e.get(e.sizeX-1-o,t))return!1;return!0}(r);l&&function(e,t){const o=t.sizeX,n=e.sizeY;console.assert(e.sizeX=o+1),console.assert(t.sizeY=n+1),console.assert(1==(1&o));const r=(o-1)/2,s=Math.floor((r+.5)*ye+1);for(let t=r+1;t<o+1;++t)for(let r=0;r<n;++r)e.set(t,r,2*s-e.get(o-t,r));for(let e=r+1;e<o;++e)for(let r=0;r<n+1;++r)t.set(e,r,t.get(o-1-e,r))}(s,i);const u=1==(1&e.numRoomsY)&&n!==K.Manor&&n!==K.ManorRed&&function(e){for(let t=0;t<e.sizeX;++t)for(let o=0;o<Math.floor(e.sizeY/2);++o)if(e.get(t,o)!==e.get(t,e.sizeY-1-o))return!1;return!0}(r);u&&function(e,t){const o=t.sizeX,n=e.sizeY;console.assert(e.sizeX=o+1),console.assert(t.sizeY=n+1),console.assert(1==(1&n));const r=(n-1)/2,s=Math.floor((r+.5)*xe+1);for(let t=0;t<o+1;++t)for(let o=r+1;o<n;++o)e.set(t,o,e.get(t,n-1-o));for(let e=0;e<o;++e)for(let o=r+1;o<n+1;++o)t.set(e,o,2*s-t.get(e,n-o))}(s,i),function(e,t,o,n){const r=t.sizeX,s=e.sizeY;let a=Number.MIN_SAFE_INTEGER;for(let t=0;t<s;++t)a=Math.max(a,-e.get(0,t));a+=o;for(let t=0;t<r+1;++t)for(let o=0;o<s;++o)e.set(t,o,e.get(t,o)+a);let i=Number.MIN_SAFE_INTEGER;for(let e=0;e<r;++e)i=Math.max(i,-t.get(e,0));i+=n;for(let e=0;e<r;++e)for(let o=0;o<s+1;++o)t.set(e,o,t.get(e,o)+i)}(s,i,ve,Se);const[c,d]=function(e,t,o,n){const r=e.sizeX,s=e.sizeY,i=new j(r,s,0),l=[];l.push({roomType:_e.Exterior,group:0,depth:0,betweenness:0,privateRoom:!1,posMin:a.fromValues(0,0),posMax:a.fromValues(0,0),edges:[],gridX:-1,gridY:-1});const u=n===K.Mansion?_e.Exterior:_e.PublicCourtyard;for(let n=0;n<r;++n)for(let r=0;r<s;++r){let s=l.length;i.set(n,r,s),l.push({roomType:e.get(n,r)?_e.PublicRoom:u,group:s,depth:0,betweenness:0,privateRoom:!1,posMin:a.fromValues(t.get(n,r)+1,o.get(n,r)+1),posMax:a.fromValues(t.get(n+1,r),o.get(n,r+1)),edges:[],gridX:n,gridY:r})}return[l,i]}(r,s,i,n),p=o.randomInRange(24)>=t,h=function(e,t,o,n,r,s){let i=s.sizeX,l=s.sizeY;const u=[];{const d=[];{const p=[];let h=0;for(let m=0;m<i;++m){let f=o.get(m,h),g=o.get(m+1,h),y=n.get(m,h);const x={origin:a.fromValues(f,y),dir:a.fromValues(1,0),length:g-f,roomLeft:r[s.get(m,h)],roomRight:r[0],nextMatching:null,door:!1,doorType:we.Standard};p.push(x),u.push(x)}d.push(p)}for(let v=1;v<l;++v){const S=[];function c(e,t,o,n,s){if(o-t<=0)return;const i={origin:a.fromValues(t,e),dir:a.fromValues(1,0),length:o-t,roomLeft:r[n],roomRight:r[s],nextMatching:null,door:!1,doorType:we.Standard};S.push(i),u.push(i)}let M=0,_=0;for(;M<o.sizeX&&_<o.sizeX;){const T=M<o.sizeX?o.get(M,v):1/0,w=_<o.sizeX?o.get(_,v-1):1/0,L=n.get(Math.max(0,Math.max(M,_)-1),v);if(T<w){c(L,T,Math.min(w,M+1<o.sizeX?o.get(M+1,v):1/0),M>=s.sizeX?0:s.get(M,v),_<=0?0:s.get(_-1,v-1)),++M}else{c(L,w,Math.min(T,_+1<o.sizeX?o.get(_+1,v-1):1/0),M<=0?0:s.get(M-1,v),_>=s.sizeX?0:s.get(_,v-1)),++_}}d.push(S)}{const A=[];let b=l;for(let R=0;R<i;++R){let k=o.get(R,b-1),C=o.get(R+1,b-1),I=n.get(R,b);const P={origin:a.fromValues(k,I),dir:a.fromValues(1,0),length:C-k,roomLeft:r[0],roomRight:r[s.get(R,b-1)],nextMatching:null,door:!1,doorType:we.Standard};A.push(P),u.push(P)}d.push(A)}if(e)for(let H=0;H<d.length;++H){let E=d[H],D=0,W=E.length-1;for(;D<=W;){let F=E[D],G=E[W];F.nextMatching=G,G.nextMatching=F,D!==W&&(a.scaleAndAdd(G.origin,G.origin,G.dir,G.length),a.negate(G.dir,G.dir),[G.roomLeft,G.roomRight]=[G.roomRight,G.roomLeft]),D+=1,W-=1}}if(t){let V=0,U=d.length-1;for(;V<U;){let N=d[V],O=d[U];console.assert(N.length==O.length);for(let B=0;B<N.length;++B){let z=N[B],X=O[B];z.nextMatching=X,X.nextMatching=z}V+=1,U-=1}}}{let q=[];{const Y=[];let j=0;for(let $=0;$<l;++$){let K=n.get(j,$),Q=n.get(j,$+1),J=o.get(j,$);const Z={origin:a.fromValues(J,K),dir:a.fromValues(0,1),length:Q-K,roomLeft:r[0],roomRight:r[s.get(j,$)],nextMatching:null,door:!1,doorType:we.Standard};Y.push(Z),u.push(Z)}q.push(Y)}for(let ee=1;ee<i;++ee){const te=[];function c(e,t,o,n,s){if(o-t<=0)return;const i={origin:a.fromValues(e,t),dir:a.fromValues(0,1),length:o-t,roomLeft:r[n],roomRight:r[s],nextMatching:null,door:!1,doorType:we.Standard};te.push(i),u.push(i)}let oe=0,ne=0;for(;oe<n.sizeY&&ne<n.sizeY;){const re=oe<n.sizeY?n.get(ee-1,oe):1/0,se=ne<n.sizeY?n.get(ee,ne):1/0,ae=o.get(ee,Math.max(0,Math.max(oe,ne)-1));if(re<se){c(ae,re,Math.min(se,oe+1<n.sizeY?n.get(ee-1,oe+1):1/0),oe>=s.sizeY?0:s.get(ee-1,oe),ne<=0?0:s.get(ee,ne-1)),++oe}else{c(ae,se,Math.min(re,ne+1<n.sizeY?n.get(ee,ne+1):1/0),oe<=0?0:s.get(ee-1,oe-1),ne>=s.sizeY?0:s.get(ee,ne)),++ne}}q.push(te)}{const ie=[];let le=i;for(let ue=0;ue<l;++ue){let ce=n.get(le-1,ue),de=n.get(le-1,ue+1),pe=o.get(le,ue);const he={origin:a.fromValues(pe,ce),dir:a.fromValues(0,1),length:de-ce,roomLeft:r[s.get(le-1,ue)],roomRight:r[0],nextMatching:null,door:!1,doorType:we.Standard};ie.push(he),u.push(he)}q.push(ie)}if(t)for(let me=0;me<q.length;++me){let fe=q[me],ge=Math.floor(fe.length/2);for(let ye=0;ye<ge;++ye){let xe=fe[ye],ve=fe[fe.length-1-ye];xe.nextMatching=ve,ve.nextMatching=xe,a.scaleAndAdd(ve.origin,ve.origin,ve.dir,ve.length),a.negate(ve.dir,ve.dir),[ve.roomLeft,ve.roomRight]=[ve.roomRight,ve.roomLeft]}}if(e){let Se=0,Me=q.length-1;for(;Se<Me;){let _e=q[Se],Te=q[Me];for(let Le=0;Le<_e.length;++Le){let Ae=_e[Le],be=Te[Le];Ae.nextMatching=be,be.nextMatching=Ae}Se+=1,Me-=1}}}return u}(l&&p,u&&p,s,i,c,d);!function(e){for(const t of e)t.roomLeft.edges.push(t),t.roomRight.edges.push(t)}(h),function(e,t,o,n,r){for(const o of t){const t=o.roomLeft,n=o.roomRight;if(t.roomType!=_e.Exterior||n.roomType!=_e.Exterior)continue;if(o.length<2)continue;o.door=!0,o.doorType=we.Standard;Ie(e,t.group,n.group)}for(const o of t){const t=o.roomLeft,n=o.roomRight;if(t.roomType!=_e.PublicCourtyard||n.roomType!=_e.PublicCourtyard)continue;if(o.length<2)continue;o.door=!0,o.doorType=we.Standard;Ie(e,t.group,n.group)}const s=function(e,t){const o=[],n=new Set;for(const t of e){if(t.length<2)continue;if(n.has(t))continue;const e=t.nextMatching,r=new Set;r.add(t),n.add(t),null!==e&&(r.add(e),n.add(e)),o.push(r)}return t.shuffleArray(o),o}(t,r);if(n===K.Fortress)for(const t of s){let o=!1;for(const e of t){if(e.roomLeft.roomType===_e.Exterior)break;if(e.roomRight.roomType===_e.Exterior)break;e.roomLeft.group!==e.roomRight.group&&(o=!0);break}if(o)for(const o of t){const t=o.roomLeft,n=o.roomRight,r=t.group,s=n.group;o.door=!0,o.doorType=we.Standard,Ie(e,r,s)}}else{for(const t of s){let o=!1;for(const e of t){if(e.roomLeft.roomType!==_e.PublicRoom)break;if(e.roomRight.roomType!==_e.PublicRoom)break;(e.roomLeft.group!==e.roomRight.group||r.random()<.4)&&(o=!0);break}if(o)for(const o of t){const t=o.roomLeft,n=o.roomRight,r=t.group,s=n.group;o.door=!0,o.doorType=we.Standard,Ie(e,r,s)}}for(const t of s){let o=!1;for(const e of t){if(e.roomLeft.roomType===e.roomRight.roomType)break;if(e.roomLeft.roomType===_e.Exterior)break;if(e.roomRight.roomType===_e.Exterior)break;(e.roomLeft.group!==e.roomRight.group||r.random()<.4)&&(o=!0);break}if(o)for(const o of t){const t=o.roomLeft,n=o.roomRight,r=t.group,s=n.group;o.door=!0,o.doorType=we.Standard,Ie(e,r,s)}}}const a=function(e,t){const o=[];for(const n of e)for(const e of n)0!=e.dir[0]&&(e.roomLeft===t&&e.roomRight.roomType!==_e.Exterior&&e.dir[0]<0||e.roomLeft.roomType!==_e.Exterior&&e.roomRight===t&&e.dir[0]>0)&&o.push(e);return o.sort(((e,t)=>e.origin[0]+e.dir[0]*e.length/2-(t.origin[0]+t.dir[0]*t.length/2))),o.length<=0?void 0:o[Math.floor(o.length/2)]}(s,e[0]);if(void 0!==a){a.door=!0,a.doorType=we.GateFront;let e=a.nextMatching;null!==e&&e!==a&&(a.nextMatching=null,e.nextMatching=null)}if(r.randomInRange(n===K.Mansion?20:30)<e.length){const t=function(e,t){const o=[];for(const n of e)for(const e of n)0!=e.dir[0]&&(e.roomLeft===t&&e.roomRight.roomType!==_e.Exterior&&e.dir[0]>0||e.roomLeft.roomType!==_e.Exterior&&e.roomRight===t&&e.dir[0]<0)&&o.push(e);return o.sort(((e,t)=>e.origin[0]+e.dir[0]*e.length/2-(t.origin[0]+t.dir[0]*t.length/2))),o.length<=0?void 0:o[Math.floor(o.length/2)]}(s,e[0]);if(void 0!==t){t.door=!0,t.doorType=n!==K.Fortress&&(o<3||r.random()<.75)?we.GateBack:we.Locked;let e=t.nextMatching;null!==e&&e!==t&&(t.nextMatching=null,e.nextMatching=null)}}if(r.randomInRange(n===K.Mansion?20:30)<e.length){const t=function(e,t){const o=[];for(const n of e)for(const e of n){if(0==e.dir[1])continue;if(e.length<3)continue;if(0!=(1&e.length))continue;if(e.roomLeft===t==(e.roomRight===t))continue;const n=e.nextMatching;null!==n&&n!==e&&o.push(e)}return o.sort(((e,t)=>e.origin[1]+e.dir[1]*e.length/2-(t.origin[1]+t.dir[1]*t.length/2))),o.length<=0?void 0:o[Math.floor(o.length/2)]}(s,e[0]);if(void 0!==t){const e=n!==K.Fortress&&o<3?we.GateBack:we.Locked;t.door=!0,t.doorType=e;const r=t.nextMatching;null!==r&&r!==t&&(r.door=!0,r.doorType=e)}}}(c,h,t,n,o),function(e,t,o){o.shuffleArray(t);for(let n=2*Math.floor(e.length/12);n>0;--n){const n=Xe(t,e[0],o);if(void 0===n)return;qe(e,t,n)}}(c,h,o),n===K.Fortress&&(He(c),De(c,n,o),function(e,t){for(const o of e){if(o.door)continue;if(o.length<2)continue;const e=o.roomLeft,n=o.roomRight;if(e.roomType===_e.Exterior||e.roomType===_e.Vault)continue;if(n.roomType===_e.Exterior||n.roomType===_e.Vault)continue;if(Pe(e)>1&&Pe(n)>1)continue;if(t.random()>=.4)continue;const r=Math.abs(e.depth-n.depth);o.door=!0,eo(e.roomType)&&eo(n.roomType)?o.doorType=we.Standard:o.doorType=r<2?we.Standard:we.Locked}}(h,o)),He(c),function(e){for(const t of e)t.betweenness=0;for(const t of e){const o=new Map,n=new Map,r=new Map;for(const t of e)r.set(t,1/0),n.set(t,0),o.set(t,0);r.set(t,0),o.set(t,1);const s=[];s.push(t);const a=[];for(;;){const e=s.shift();if(void 0===e)break;a.push(e);const t=(r.get(e)??0)+1;for(const n of e.edges){if(!n.door)continue;const r=n.roomLeft===e?n.roomRight:n.roomLeft;r.roomType!==_e.Exterior&&(r.depth===1/0&&(r.depth=t,s.push(r)),r.depth===t&&o.set(r,(o.get(r)??0)+(o.get(e)??0)))}}const i=t.roomType===_e.Exterior?10:1;for(;;){const e=a.pop();if(void 0===e)break;const s=(r.get(e)??0)-1,l=o.get(e)??1,u=n.get(e)??0;for(const a of e.edges){if(!a.door)continue;const c=a.roomLeft===e?a.roomRight:a.roomLeft;if(r.get(c)!==s)continue;const d=(o.get(c)??0)/l*(1+u);n.set(c,d),e!==t&&(e.betweenness+=u*i)}}}}(c),function(e,t,o,n){let r=0;for(const t of e)r=Math.max(r,t.depth);const s=e.length-1,a=Math.floor(s/4);let i=0,l=r;for(;l>0;){for(const t of e)t.roomType!=_e.PublicRoom&&t.roomType!=_e.PublicCourtyard||t.depth==l&&(t.roomType=t.roomType==_e.PublicRoom?_e.PrivateRoom:_e.PrivateCourtyard,t.privateRoom=!0,t.roomType==_e.PrivateRoom&&(i+=1));if(i>=a)break;l-=1}for(;;){let t=!1;for(const o of e)if(o.roomType==_e.PrivateCourtyard)for(const e of o.edges){if((e.roomLeft!=o?e.roomLeft:e.roomRight).roomType==_e.PublicCourtyard){o.roomType=_e.PublicCourtyard,o.privateRoom=!0,t=!0;break}}if(!t)break}t>4&&o!==K.Fortress&&De(e,o,n);for(const t of e){if(t.roomType!==_e.PrivateRoom)continue;const e=t.posMax[0]-t.posMin[0],o=t.posMax[1]-t.posMin[1];if(e<3&&o<3)continue;if(e*o>25)continue;let n=0;for(const e of t.edges)e.door&&++n;n>2||(t.roomType=_e.Bedroom)}if(9===t)for(const t of Fe(e,Ne,1,n))t.roomType=_e.ThroneRoom;if(s>=8)for(const t of Fe(e,Ge,1,n))t.roomType=_e.Kitchen;for(const t of Fe(e,Oe,Math.ceil(e.length/21),n))t.roomType=_e.Dining;for(const t of Fe(e,Be,Math.ceil(e.length/42),n))t.roomType=_e.PublicLibrary;for(const t of Fe(e,ze,Math.ceil(e.length/42),n))t.roomType=_e.PrivateLibrary;let u=0;for(const t of e)t.roomType!==_e.PublicLibrary&&t.roomType!==_e.PrivateLibrary||(u+=(t.posMax[0]-t.posMin[0])*(t.posMax[1]-t.posMin[1]));if(u>=30||9===t){const o=u>=60,r=9===t?2:1;for(const t of Fe(e,Ue,r,n))eo(t.roomType)?t.roomType=o?_e.LockedTreasureCourtyard:_e.TreasureCourtyard:t.roomType=o?_e.LockedTreasure:_e.Treasure}}(c,t,n,o);const m=function(e){let t=0,o=0;for(const n of e)t=Math.max(t,n.posMax[0]),o=Math.max(o,n.posMax[1]);t+=ve+1,o+=ve+1;const n=new ee(t,o);return new pe(n)}(c);!function(e,t,o,n){for(const e of t){const t=e.roomLeft.roomType,n=e.roomRight.roomType;if((!eo(t)||!eo(n))&&(t!==_e.Exterior||n!==_e.Exterior))for(let t=0;t<e.length+1;++t){const n=a.create();a.scaleAndAdd(n,e.origin,e.dir,t),o.cells.atVec(n).type=J.Wall0000}}const r=new Set;for(const n of t){if(r.has(n))continue;r.add(n);const t=n.nextMatching;null!==t&&t!==n&&r.add(t);let s=[];s.push(n),null!==t&&t!==n&&s.push(t);for(const t of s){if(t.door)continue;const n=t.roomLeft.roomType,r=t.roomRight.roomType;if(n===_e.Vault||r===_e.Vault)continue;if(n===_e.Exterior&&r===_e.Exterior)continue;const s=a.clone(t.dir);if(n===_e.Exterior!=(r===_e.Exterior))r==_e.Exterior&&a.negate(s,s);else{if(eo(n)===eo(r))continue;if(eo(r)){if(e===K.Fortress&&t.roomLeft.depth+1<t.roomRight.depth)continue;a.negate(s,s)}else if(e===K.Fortress&&t.roomRight.depth+1<t.roomLeft.depth)continue}const i=xt(s);if(e!==K.Fortress||n!==_e.Exterior&&r!==_e.Exterior)if(5===t.length){const e=a.clone(t.origin).scaleAndAdd(t.dir,2+(t.origin[0]+t.origin[1]&1));o.cells.atVec(e).type=i}else{const e=1+Math.floor(t.length/2)-(1&t.length);for(let n=2;n<e;n+=2){const e=a.clone(t.origin).scaleAndAdd(t.dir,n),r=a.clone(t.origin).scaleAndAdd(t.dir,t.length-n);o.cells.atVec(e).type=i,o.cells.atVec(r).type=i}}else if(t.length>2&&0==(1&t.length)){const e=a.clone(t.origin).scaleAndAdd(t.dir,t.length/2);o.cells.atVec(e).type=i}}for(const e of s){if(!e.door)continue;const t=Math.floor(e.length/2),n=a.clone(e.origin).scaleAndAdd(e.dir,t);let r=0==e.dir[0],s=e.roomLeft.roomType,i=e.roomRight.roomType;s===_e.Exterior&&i===_e.Exterior||(e.doorType===we.GateFront||e.doorType===we.GateBack?(o.cells.atVec(n).type=r?J.PortcullisNS:J.PortcullisEW,zt(o,n,r?ne.PortcullisNS:ne.PortcullisEW)):e.doorType===we.Locked?(o.cells.atVec(n).type=r?J.DoorNS:J.DoorEW,zt(o,n,r?ne.LockedDoorNS:ne.LockedDoorEW)):eo(s)&&eo(i)?o.cells.atVec(n).type=r?J.GardenDoorNS:J.GardenDoorEW:eo(s)||eo(i)||!e.roomLeft.privateRoom||!e.roomRight.privateRoom||s===_e.Bedroom!=(i===_e.Bedroom)?(o.cells.atVec(n).type=r?J.DoorNS:J.DoorEW,zt(o,n,r?ne.DoorNS:ne.DoorEW)):o.cells.atVec(n).type=r?J.DoorNS:J.DoorEW)}}}(n,h,m),function(e,t,o,n){for(let r=1;r<t.length;++r){const s=t[r];let a;switch(s.roomType){case _e.Exterior:case _e.PublicCourtyard:a=J.GroundGrass;break;case _e.PublicRoom:a=J.GroundWood;break;case _e.PrivateCourtyard:a=J.GroundGrass;break;case _e.PrivateRoom:a=J.GroundMarble;break;case _e.Vault:a=J.GroundVault;break;case _e.Bedroom:a=J.GroundMarble;break;case _e.Dining:a=s.privateRoom?J.GroundMarble:J.GroundWood;break;case _e.PublicLibrary:a=J.GroundWood;break;case _e.PrivateLibrary:a=J.GroundMarble;break;case _e.Kitchen:a=J.GroundWood;break;case _e.Treasure:a=s.privateRoom?J.GroundMarble:J.GroundWood;break;case _e.TreasureCourtyard:a=J.GroundGrass;break;case _e.LockedTreasure:a=s.privateRoom?J.GroundMarble:J.GroundWood;break;case _e.LockedTreasureCourtyard:a=J.GroundGrass;break;case _e.ThroneRoom:a=J.GroundWood}Kt(o,s.posMin[0],s.posMin[1],s.posMax[0],s.posMax[1],a),s.roomType===_e.PublicCourtyard||s.roomType===_e.PrivateCourtyard?vt(o,s,e,n):s.roomType===_e.PublicRoom||s.roomType===_e.PrivateRoom?St(o,s,e,n):s.roomType===_e.Vault?Mt(o,s,n):s.roomType===_e.Bedroom?_t(o,s,e,n):s.roomType===_e.Dining?Ct(o,s,e,n):s.roomType===_e.Kitchen?At(o,s,e,n):s.roomType===_e.Treasure?bt(o,s,e,n):s.roomType===_e.TreasureCourtyard?Rt(o,s,e,n):s.roomType===_e.LockedTreasure?bt(o,s,e,n):s.roomType===_e.LockedTreasureCourtyard?Rt(o,s,e,n):s.roomType===_e.PublicLibrary||s.roomType===_e.PrivateLibrary?Et(o,s,e,n):s.roomType===_e.ThroneRoom&&Ht(o,s,e,n),a==J.GroundWood&&e>3&&Wt(o,s,n)}}(t,c,m,o),m.backtrackingCoefficient=function(e){const t=new Map;for(const o of e){t.set(o,new Map);for(const n of e)t.get(o).set(n,1/0)}for(const o of e){t.get(o).set(o,0);for(const e of o.edges){if(!e.door)continue;const n=e.roomLeft===o?e.roomRight:e.roomLeft;t.get(o).set(n,1)}}for(const o of e)for(const n of e)for(const r of e){const e=t.get(n).get(r),s=t.get(n).get(o),a=t.get(o).get(r);e>s+a&&t.get(n).set(r,s+a)}const o=new Set;let n=e[0],r=0;for(;o.size<e.length;){o.add(n);let s=n,a=1/0;for(const r of e)if(r!==n&&!o.has(r)){const e=t.get(n).get(r);e<a&&(s=r,a=e)}if(a===1/0)break;n=s,r+=a}return r/(e.length-1)}(c),m.playerStartPos=function(e,t,o){{const n=ht(t,o);return 0===e&&(n[0]-=Math.max(0,4-n[1]),n[1]=Math.max(0,n[1]-4)),n}}(t,h,m);const f={rooms:[c[0]],path:Jt(h,m),minRoomDepth:c[0].depth,maxRoomDepth:c[0].depth};let g;!function(e,t,o){const n=e.cells.sizeX,r=e.cells.sizeY;for(const o of t)e.cells.atVec(o).type=J.GroundNormal;Kt(e,0,0,n,Se,J.GroundNormal);const s=new Y(e.cells.sizeX,e.cells.sizeY,!1),i=[],l=[a.clone(e.playerStartPos)];for(let t=0;t<l.length;++t){const o=l[t];if(!s.get(o[0],o[1])&&(s.set(o[0],o[1],!0),!(e.cells.atVec(o).type>=J.Wall0000))){e.cells.atVec(o).type===J.GroundGrass&&i.push(o);for(let t=-1;t<=1;++t)for(let n=-1;n<=1;++n){const r=a.fromValues(o[0]+t,o[1]+n);r[0]>=0&&r[1]>=0&&r[0]<e.cells.sizeX&&r[1]<e.cells.sizeY&&!s.get(r[0],r[1])&&l.push(r)}}}o.shuffleArray(i),i.length=Math.floor(i.length/3),s.fill(!1);for(const t of i)if(!s.get(t[0],t[1])){zt(e,t,ne.Bush);for(let e=Math.max(0,t[0]-1);e<Math.min(n,t[0]+2);++e)for(let o=Math.max(0,t[1]-1);o<Math.min(r,t[1]+2);++o)s.set(e,o,!0)}}(m,f.path,o),function(e){let t=e.cells.sizeX-1,o=Math.floor(t/2);for(let n=ve;n<o;n+=5)e.cells.at(n,1).type=J.Wall0000,e.cells.at(t-n,1).type=J.Wall0000}(m),function(e){for(let t=0;t<e.sizeX;++t)for(let o=0;o<e.sizeY;++o){e.at(t,o).type==J.Wall0000&&(e.at(t,o).type=ao(lo(e,t,o)))}}(m.cells),function(e){let t=e.cells.sizeX,o=e.cells.sizeY;for(let n=0;n<t;++n)for(let t=0;t<o;++t){const o=e.cells.at(n,t),r=o.type,s=r>=J.Wall0000&&r<=J.Wall1111,a=he(r),i=r==J.GroundWater;o.moveCost=s||a?1/0:i?64:0,o.blocksPlayerMove=s,o.blocksPlayerSight=s&&r!==J.Wall0000,o.blocksSight=s,o.blocksSound=s,o.hidesPlayer=!1,o.isWindow=a}for(const t of e.items){let o=e.cells.atVec(t.pos),n=t.type;o.moveCost=Math.max(o.moveCost,se(n)),n!==ne.DoorNS&&n!==ne.DoorEW&&n!==ne.LockedDoorNS&&n!==ne.LockedDoorEW||(o.blocksPlayerSight=!0),n!==ne.DoorNS&&n!==ne.DoorEW&&n!==ne.LockedDoorNS&&n!==ne.LockedDoorEW&&n!==ne.PortcullisNS&&n!==ne.PortcullisEW&&n!==ne.Bush&&n!==ne.DrawersTall&&n!==ne.Bookshelf&&n!==ne.Shelf&&n!==ne.Stove||(o.blocksSight=!0),n!==ne.Table&&n!==ne.Bush&&n!==ne.BedL&&n!==ne.BedR||(o.hidesPlayer=!0),so(n)&&(o.blocksPlayerMove=!0)}}(m),g=t<1?[]:t<2?Qe(t,m,c,f,o):function(e,t,o,n,r,s){const a=n.filter((e=>e.door&&tt(e.roomLeft)&&tt(e.roomRight)));s.shuffleArray(a);let i=[];const l=new Map,u=26-2*e;for(const e of a){const t=e.roomLeft,o=e.roomRight;let n=l.get(t);void 0===n&&(n=[],l.set(t,n));let r=l.get(o);void 0===r&&(r=[],l.set(o,r));const a=Ze(n),c=Ze(r);if(a)if(c){if(!ot(a,c,u))continue;const e={room:t,nodeNext:null,nodePrev:null,visited:!1},d={room:o,nodeNext:null,nodePrev:null,visited:!1},p=a.nodeNext,h=c.nodeNext;a.nodeNext=d,d.nodePrev=a,d.nodeNext=h,null!==h&&(h.nodePrev=d),c.nodeNext=e,e.nodePrev=c,e.nodeNext=p,null!==p&&(p.nodePrev=e),n.push(e),r.push(d),i.push(e),i.push(d),lt(a,c)||(s.random()<.5?nt(a,i,l):nt(c,i,l))}else{if(ut(a)+2>u)continue;const e={room:t,nodeNext:null,nodePrev:null,visited:!1},s={room:o,nodeNext:null,nodePrev:null,visited:!1},l=a.nodeNext;a.nodeNext=s,s.nodePrev=a,s.nodeNext=e,e.nodePrev=s,e.nodeNext=l,null!==l&&(l.nodePrev=e),n.push(e),r.push(s),i.push(e),i.push(s)}else if(c){if(ut(c)+2>u)continue;const e={room:t,nodeNext:null,nodePrev:null,visited:!1},s={room:o,nodeNext:null,nodePrev:null,visited:!1},a=c.nodeNext;c.nodeNext=e,e.nodePrev=c,e.nodeNext=s,s.nodePrev=e,s.nodeNext=a,null!==a&&(a.nodePrev=s),n.push(e),r.push(s),i.push(e),i.push(s)}else{const e={room:t,nodeNext:null,nodePrev:null,visited:!1},s={room:o,nodeNext:null,nodePrev:null,visited:!1};e.nodeNext=s,e.nodePrev=s,s.nodeNext=e,s.nodePrev=e,n.push(e),r.push(s),i.push(e),i.push(s)}}for(const e of o){if(!tt(e))continue;{const t=l.get(e);if(void 0!==t&&t.length>0)continue}const t=e.edges.filter((e=>e.door&&tt(e.roomLeft)&&tt(e.roomRight)));if(0===t.length)continue;const o=t[s.randomInRange(t.length)],n=o.roomLeft,r=o.roomRight;let a=l.get(n);void 0===a&&(a=[],l.set(n,a));let u=l.get(r);void 0===u&&(u=[],l.set(r,u));const c={room:n,nodeNext:null,nodePrev:null,visited:!1},d={room:r,nodeNext:null,nodePrev:null,visited:!1};c.nodeNext=d,c.nodePrev=d,d.nodeNext=c,d.nodePrev=c,a.push(c),u.push(d),i.push(c),i.push(d)}for(const e of i)e.visited=!1;for(const e of i){if(e.visited)continue;if(ut(e)>2){ct(e);continue}let t=Number.MAX_SAFE_INTEGER;const o=[],n=e,r=e.nodeNext,a=n.room,i=r.room,u=l.get(a),c=l.get(i);for(const e of u){if(e===n)continue;const r=ut(e);r>t||(r<t&&(t=r,o.length=0),o.push([n,e]))}for(const e of c){if(e===r)continue;const n=ut(e);n>t||(n<t&&(t=n,o.length=0),o.push([r,e]))}if(0===o.length){ct(e);continue}const[d,p]=o[s.randomInRange(o.length)],h=d.nodePrev,m=p.nodePrev;h.nodeNext=p,p.nodePrev=h,m.nodeNext=d,d.nodePrev=m,ct(e)}for(const e of a){const t=e.roomLeft,o=e.roomRight;let n=l.get(t);void 0===n&&(n=[],l.set(t,n));let r=l.get(o);void 0===r&&(r=[],l.set(o,r));const s=et(n),a=et(r);if(void 0===s||void 0===a)continue;if(lt(s,a))continue;const u=ut(s),c=ut(a);if(u>2&&c>2)continue;const d={room:t,nodeNext:null,nodePrev:null,visited:!1},p={room:o,nodeNext:null,nodePrev:null,visited:!1},h=s.nodeNext,m=a.nodePrev;s.nodeNext=a,a.nodePrev=s,m.nodeNext=p,p.nodePrev=m,p.nodeNext=d,d.nodePrev=p,d.nodeNext=h,h.nodePrev=d,n.push(d),r.push(p),i.push(d),i.push(p)}e>=8&&(i=i.concat(Ke(o,s)));const c=st(i,e,t,r,s);return c}(t,m,c,h,f,o);const y=void 0!==m.items.find((e=>e.type===ne.LockedDoorNS||e.type===ne.LockedDoorEW));!function(e,t,o,n,r,s){if(e<2)return;if(e<8)return void Ce(e,t,o,n,r,s);const i=o.find((e=>e.roomType===_e.Vault));if(void 0===i)return void Ce(e,t,o,n,r,s);const l=[J.GroundGrass,J.GroundMarble,J.GroundWood];for(let e of i.edges)if(e.doorType===we.Locked){let o=e.origin;const n=e.roomLeft.roomType===_e.Vault?e.roomRight:e.roomLeft;for(let s=0;s<e.length;s++){if(t.cells.atVec(o).type===J.DoorEW||t.cells.atVec(o).type===J.DoorNS){if(0===e.dir[0])for(let e of[-1,1]){const s=o.add(new a(e,0));if(l.includes(t.cells.atVec(s).type))return void r.push({rooms:[n],path:[s],minRoomDepth:n.depth,maxRoomDepth:n.depth})}if(0===e.dir[1])for(let e of[-1,1]){const s=o.add(new a(0,e));if(l.includes(t.cells.atVec(s).type))return void r.push({rooms:[n],path:[s],minRoomDepth:n.depth,maxRoomDepth:n.depth})}}o=o.add(e.dir)}}}(t,m,c,y,g,o);const x=g.length-(y?1:0),v=Math.min(Math.floor(t/3),Math.min(x,e.totalLoot));return function(e,t,o,n,r,s){const a=function(e){const t=new Y(e.cells.sizeX,e.cells.sizeY,!1);for(const o of e.items)Xt(o.type)&&t.set(o.pos[0],o.pos[1],!0);return t}(o),i=function(e,t){const o=new Y(e.cells.sizeX,e.cells.sizeY,!1);for(let t=0;t<e.cells.sizeX;++t)for(let n=0;n<e.cells.sizeY;++n){const r=e.cells.at(t,n).type;(r===J.GroundWater||r>=J.Wall0000)&&o.set(t,n,!0)}for(const e of t)if(1===e.path.length)for(const t of e.path)o.set(t[0],t[1],!0);for(const t of e.items)Xt(t.type)||o.set(t.pos[0],t.pos[1],!0);return o}(o,n);let l=0;for(const n of t)if(n.roomType===_e.ThroneRoom){if(l>=e)break;qt(i,a,n.posMin,n.posMax,o,s)&&++l}for(const n of t){if(n.roomType!==_e.Vault)continue;let t=s.randomInRange(3)+s.randomInRange(3);for(r===K.Fortress&&(t+=2);t>0&&(--t,!(l>=e));)qt(i,a,n.posMin,n.posMax,o,s)&&++l}for(const n of t){if(l>=e)break;if(n.roomType===_e.Exterior||n.roomType===_e.Vault)continue;if((n.roomType===_e.PublicCourtyard||n.roomType===_e.PrivateCourtyard)&&s.random()<.75)continue;let t=0;for(const e of n.edges)e.door&&(t+=1);t<2&&qt(i,a,n.posMin,n.posMax,o,s)&&++l}for(const n of t){if(l>=e)break;to(n.roomType)&&(s.random()<.5||qt(i,a,n.posMin,n.posMax,o,s)&&++l)}const u=t.filter((e=>e.roomType!==_e.Exterior&&!eo(e.roomType)));s.shuffleArray(u);for(let t=0;t<1e3&&l<e;++t){const e=u[t%u.length];qt(i,a,e.posMin,e.posMax,o,s)&&++l}console.assert(l===e)}(e.totalLoot-v,c,m,g,n,o),function(e,t,o,n){n.shuffleArray(ro);let r=0;n.shuffleArray(oo);let s=0;const i=new Map;for(const e of t){const t=[];for(const n of o)n.pos[0]>=e.posMin[0]&&n.pos[1]>=e.posMin[1]&&n.pos[0]<e.posMax[0]&&n.pos[1]<e.posMax[1]&&t.push(n);t.length>0&&i.set(e,t)}for(const t of i){const o=t[0],i=t[1],l=a.create(),u=a.create();o.posMax[0]-o.posMin[0]>=o.posMax[1]-o.posMin[1]?(a.set(l,1,0),a.set(u,0,-1)):(a.set(l,0,-1),a.set(u,1,0)),i.sort(((e,t)=>{let o=a.dot(l,e.pos),n=a.dot(l,t.pos);return o<n?-1:o>n?1:(o=a.dot(u,e.pos),n=a.dot(u,t.pos),o<n?-1:o>n?1:0)}));const c=[];for(let e=0;e<i.length;++e){let e;if(o.privateRoom){const t=oo[s];s=(s+1)%oo.length;e=t+" of "+no[n.randomInRange(no.length)]}else e=ro[r],r=(r+1)%ro.length;c.push(e)}c.sort(((e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"})));for(let t=0;t<i.length;++t)e.set(i[t],c[t])}}(m.bookTitle,c,m.items.filter((e=>e.type===ne.Bookshelf)),o),function(e,t,o){const n=e.items.filter((e=>e.type===ne.Bookshelf));o.shuffleArray(n);const r=new Map;for(const e of t){const t=[];for(const o of n)o.pos[0]>=e.posMin[0]&&o.pos[1]>=e.posMin[1]&&o.pos[0]<e.posMax[0]&&o.pos[1]<e.posMax[1]&&t.push(o);t.length>0&&r.set(e,t)}for(const n of e.items.filter((e=>e.type===ne.TreasurePlinth))){zt(e,n.pos,ne.Treasure);const s={switches:[],numSwitchesUsed:0,posTreasure:a.clone(n.pos),stolen:!1};if(e.treasures.push(s),!e.items.some((e=>e.type===ne.TreasureLock&&e.pos.equals(n.pos))))continue;const i=[];for(let e=3;e>0&&0===i.length;--e)for(const o of t){const t=r.get(o);void 0!==t&&t.length>=e&&i.push(t)}if(0===i.length){e.items=e.items.filter((e=>!(e.type===ne.TreasureLock&&e.pos.equals(n.pos)))),e.cells.atVec(n.pos).blocksPlayerMove=!1;continue}const l=i[o.randomInRange(i.length)];let u="";for(let t=Math.min(l.length,3);t>0;--t){const t=l.pop();u.length>0&&(u+="\n");let o=e.bookTitle.get(t).split(" ")[0];o.endsWith(",")&&(o=o.substring(0,o.length-1)),u+=o,s.switches.push(a.clone(t.pos))}const c=new Set;for(const t of e.items)t.type!==ne.Coin&&t.type!==ne.Health&&t.type!==ne.Note||c.add(t.pos[0]*e.cells.sizeY+t.pos[1]);let d=e.items.filter((t=>(t.type===ne.DrawersShort||t.type===ne.DrawersTall||t.type===ne.Shelf)&&!c.has(t.pos[0]*e.cells.sizeY+t.pos[1])));if(d.length>0){const t=d[o.randomInRange(d.length)].pos,n={pos:a.clone(t),type:ne.Note};e.items.push(n),e.bookTitle.set(n,u)}}e.items.sort(((e,t)=>e.type===ne.TreasureLock&&t.type!==ne.TreasureLock?1:e.type!==ne.TreasureLock&&t.type===ne.TreasureLock?-1:0))}(m,c,o),function(e,t,o,n){if(e<1)return;let r=1+Math.floor((9-e)/4);Yt([_e.Kitchen],t,o,n)&&--r;r>0&&Yt([_e.Kitchen,_e.Dining],t,o,n)&&--r;for(let e=10;e>0&&r>0;--e)Yt([_e.Kitchen,_e.Dining,_e.Bedroom],t,o,n)&&--r}(t,m,c,o),function(e,t,o,n,r,s){if(e<=0)return;if(r&&o.length>0){let n=o.filter((e=>e.path.length>1&&e.minRoomDepth>0));0===n.length&&(n=[...o]),n.sort(((e,t)=>e.minRoomDepth-t.minRoomDepth));const r=n[Math.floor(n.length/2)];o=o.filter((e=>e!==r));const a=0,i=new W(r.path,a);e>1&&s.randomInRange(5+e)<e&&(i.hasTorch=!0),i.hasVaultKey=!0,t.guards.push(i)}if(n>0&&e<4){const r=o.findIndex((e=>e.path.length<=1));if(r>=0){const a=o[r];o.splice(r,1);const i=0,l=new W(a.path,i);e>1&&s.randomInRange(5+e)<e&&(l.hasTorch=!0),l.hasPurse=!0,n--,t.guards.push(l)}}for(const r of o){const o=0,a=new W(r.path,o);e>1&&s.randomInRange(5+e)<e&&(a.hasTorch=!0),n>0&&(a.hasPurse=!0,n--),t.guards.push(a)}if(1===e){const e=t.items.filter((e=>e.type===ne.PortcullisEW)).sort(((e,t)=>e.pos[1]-t.pos[1]));if(e.length>=1){const o=e[0].pos,n=t.guards[0];a.set(n.pos,o[0],o[1]+1),a.set(n.dir,0,-1),n.enterPatrolMode(t)}}console.assert(0===n)}(t,m,g,v,y,o),function(e){const t=new Y(e.cells.sizeX,e.cells.sizeY,!1),o=[e.playerStartPos];for(let n=0;n<o.length;++n){const r=o[n];if(!t.get(r[0],r[1])&&(t.set(r[0],r[1],!0),e.cells.atVec(r).seen=!0,++e.numPreRevealedCells,!(e.cells.atVec(r).type>=J.Wall0000)))for(let n=-1;n<=1;++n)for(let s=-1;s<=1;++s){const i=a.fromValues(r[0]+n,r[1]+s);i[0]>=0&&i[1]>=0&&i[0]<e.cells.sizeX&&i[1]<e.cells.sizeY&&!t.get(i[0],i[1])&&o.push(i)}}}(m),m.computeLighting(null),m.recomputeVisibility(m.playerStartPos),m.adjacencies=h,m}function Ce(e,t,o,n,r,s){const i=new Y(t.cells.sizeX,t.cells.sizeY,!1);for(const e of r)for(const t of e.path)i.set(t[0],t[1],!0);for(const e of t.items)e.type!==ne.Coin&&e.type!==ne.Health&&e.type!==ne.Treasure&&e.type!==ne.Note||i.set(e.pos[0],e.pos[1],!0);const l=[];if(e>=4)for(const e of t.items){if(e.type!==ne.Chair)continue;if(i.get(e.pos[0],e.pos[1]))continue;let o=!1;for(const n of t.items){if(n.type!==ne.Table)continue;const t=n.pos[0]-e.pos[0],r=n.pos[1]-e.pos[1];if(Math.abs(t)+Math.abs(r)===1){o=!0;break}}o&&l.push(e.pos)}for(const e of o){for(let o=e.posMin[0];o<e.posMax[0];++o){if(e.posMin[1]>0){t.cells.at(o,e.posMin[1]-1).type!=J.OneWayWindowS||0!==t.cells.at(o,e.posMin[1]).moveCost||t.cells.at(o,e.posMin[1]+1).moveCost===1/0||i.get(o,e.posMin[1])||l.push(a.fromValues(o,e.posMin[1]))}if(e.posMax[1]<t.cells.sizeY){t.cells.at(o,e.posMax[1]).type!=J.OneWayWindowN||0!==t.cells.at(o,e.posMax[1]-1).moveCost||t.cells.at(o,e.posMax[1]-2).moveCost===1/0||i.get(o,e.posMax[1]-1)||l.push(a.fromValues(o,e.posMax[1]-1))}}for(let o=e.posMin[1];o<e.posMax[1];++o){if(e.posMin[0]>0){t.cells.at(e.posMin[0]-1,o).type!=J.OneWayWindowW||0!==t.cells.at(e.posMin[0],o).moveCost||t.cells.at(e.posMin[0]+1,o).moveCost===1/0||i.get(e.posMin[0],o)||l.push(a.fromValues(e.posMin[0],o))}if(e.posMax[0]<t.cells.sizeX){t.cells.at(e.posMax[0],o).type!=J.OneWayWindowE||0!==t.cells.at(e.posMax[0]-1,o).moveCost||t.cells.at(e.posMax[0]-2,o).moveCost===1/0||i.get(e.posMax[0]-1,o)||l.push(a.fromValues(e.posMax[0]-1,o))}}}if(l.length>0){const e=l[s.randomInRange(l.length)];for(const t of o)if(e[0]>=t.posMin[0]&&e[1]>=t.posMin[1]&&e[0]<t.posMax[0]&&e[1]<t.posMax[1]){const o=s.randomInRange(r.length+1);return void r.splice(o,0,{rooms:[t],path:[a.clone(e)],minRoomDepth:t.depth,maxRoomDepth:t.depth})}}}function Ie(e,t,o){if(t!=o)for(const n of e)n.group==t&&(n.group=o)}function Pe(e){return e.edges.reduce(((e,t)=>e+(t.door?1:0)),0)}function He(e){let t=e.length;const o=[];for(const n of e)n.roomType===_e.Exterior?n.depth=0:Ee(n)?(n.depth=1,o.push(n)):n.depth=t;for(let e=0;e<o.length;++e){const t=o[e],n=t.depth+1;for(const e of t.edges){if(!e.door)continue;const r=e.roomLeft==t?e.roomRight:e.roomLeft;r.depth>n&&(r.depth=n,o.push(r))}}}function Ee(e){for(const t of e.edges)if(t.door&&t.doorType!==we.Locked)if(t.roomLeft===e){if(t.roomRight.roomType===_e.Exterior)return!0}else if(t.roomLeft.roomType===_e.Exterior)return!0;return!1}function De(e,t,o){const n=[];for(const o of e){if(o.roomType===_e.Exterior)continue;if(t===K.Fortress&&eo(o.roomType))continue;let e=0;for(const t of o.edges)t.door&&++e;e<=1&&n.push(o)}if(n.length>0){o.shuffleArray(n),n.sort(((e,t)=>We(e)-We(t)));const e=n[0];e.roomType=_e.Vault;for(const t of e.edges)t.door&&(t.doorType=we.Locked)}}function We(e){return(e.posMax[0]-e.posMin[0])*(e.posMax[1]-e.posMin[1])}function Fe(e,t,o,n){const r=e.filter(t);return n.shuffleArray(r),r.slice(0,o)}function Ge(e){if(e.roomType!==_e.PublicRoom&&e.roomType!==_e.PrivateRoom)return!1;const t=e.posMax[0]-e.posMin[0],o=e.posMax[1]-e.posMin[1];return!(Math.min(t,o)<3)&&(!(Math.max(t,o)>7)&&!Ve(e))}function Ve(e){for(const t of e.edges)if(t.door){if(t.roomLeft===e&&t.roomRight.roomType===_e.Exterior)return!0;if(t.roomRight===e&&t.roomLeft.roomType===_e.Exterior)return!0}return!1}function Ue(e){if(e.roomType!==_e.PublicRoom&&e.roomType!==_e.PrivateRoom&&e.roomType!==_e.PublicCourtyard&&e.roomType!==_e.PrivateCourtyard&&e.roomType!==_e.Bedroom)return!1;const t=e.posMax[0]-e.posMin[0];if(0==(1&t))return!1;if(t<3)return!1;if(t>7)return!1;const o=e.posMax[1]-e.posMin[1];return 0!=(1&o)&&(!(o<3)&&!(o>7))}function Ne(e){if(e.roomType!==_e.PublicRoom&&e.roomType!==_e.PrivateRoom)return!1;if(e.depth<2)return!1;if(Ve(e))return!1;const t=e.posMax[0]-e.posMin[0];if(t<3)return!1;const o=e.posMax[1]-e.posMin[1];if(o<3)return!1;if(t<4&&o<5)return!1;if(t<5&&o<4)return!1;if(t<o){if(It(e,0,-1)>0&&It(e,0,1)>0)return!1}else if(o<t){if(It(e,-1,0)>0&&It(e,1,0)>0)return!1}else if(It(e,0,-1)>0&&It(e,0,1)>0&&It(e,-1,0)>0&&It(e,1,0)>0)return!1;return!0}function Oe(e){if(e.roomType!==_e.PublicRoom&&e.roomType!==_e.PrivateRoom)return!1;if(e.posMax[0]-e.posMin[0]<5)return!1;return!(e.posMax[1]-e.posMin[1]<5)}function Be(e){if(e.roomType!==_e.PublicRoom)return!1;const t=e.posMax[0]-e.posMin[0],o=e.posMax[1]-e.posMin[1];return!(Math.min(t,o)<4)&&!(Math.max(t,o)<5)}function ze(e){if(e.roomType!==_e.PrivateRoom)return!1;const t=e.posMax[0]-e.posMin[0],o=e.posMax[1]-e.posMin[1];return!(Math.min(t,o)<4)&&!(Math.max(t,o)<5)}function Xe(e,t,o){const n=[];for(const o of e){const e=o.roomLeft,r=o.roomRight;if(!o.door)continue;if(e.roomType!==r.roomType)continue;if(e===t)continue;if(r===t)continue;if(0===o.dir[1]){if(o.length!==e.posMax[0]-e.posMin[0]+1)continue;if(o.length!==r.posMax[0]-r.posMin[0]+1)continue}else{if(o.length!==e.posMax[1]-e.posMin[1]+1)continue;if(o.length!==r.posMax[1]-r.posMin[1]+1)continue}const s=Math.min(e.posMin[0],r.posMin[0]),a=Math.min(e.posMin[1],r.posMin[1]),i=Math.max(e.posMax[0],r.posMax[0])-s,l=Math.max(e.posMax[1],r.posMax[1])-a;if(i*l>ye*xe*30)continue;const u=Math.max(i,l)/Math.min(i,l);n.push([o,u])}if(!(n.length<=0))return o.shuffleArray(n),n.sort(((e,t)=>e[1]-t[1])),n[0][0]}function qe(e,t,o){const n=o.roomLeft,r=o.roomRight;for(const e of r.edges)e!==o&&(n.edges.push(e),e.roomLeft===r?e.roomLeft=n:(console.assert(e.roomRight===r),e.roomRight=n));const s=a.fromValues(Math.min(n.posMin[0],r.posMin[0]),Math.min(n.posMin[1],r.posMin[1])),i=a.fromValues(Math.max(n.posMax[0],r.posMax[0]),Math.max(n.posMax[1],r.posMax[1]));a.copy(n.posMin,s),a.copy(n.posMax,i),n.depth=Math.min(n.depth,r.depth);const l=o.nextMatching;for(null!==l&&(l.nextMatching=null),$e(t,o),$e(n.edges,o),$e(e,r);Ye(t,n););}function Ye(e,t){for(const o of t.edges)for(const n of t.edges){if(o===n)continue;if(!je(o,n))continue;const r=o.dir[0]>=0?Math.min(o.origin[0],n.origin[0]):Math.max(o.origin[0],n.origin[0]),s=o.dir[1]>=0?Math.min(o.origin[1],n.origin[1]):Math.max(o.origin[1],n.origin[1]),a=o.length+n.length;o.origin[0]=r,o.origin[1]=s,o.length=a,null!==o.nextMatching&&(o.nextMatching.nextMatching=null),null!==n.nextMatching&&(n.nextMatching.nextMatching=null),o.nextMatching=null,o.door=o.door||n.door,o.doorType=Math.max(o.doorType,n.doorType);const i=o.roomLeft===t?o.roomRight:o.roomLeft;return $e(t.edges,n),$e(i.edges,n),$e(e,n),!0}return!1}function je(e,t){if(1!==Math.abs(e.dir.dot(t.dir)))return!1;const o=a.create();a.scaleAndAdd(o,e.origin,e.dir,e.length);const n=a.create();if(a.scaleAndAdd(n,t.origin,t.dir,t.length),t.roomLeft===e.roomLeft&&t.roomRight===e.roomRight){if(o.equals(t.origin))return!0;if(n.equals(e.origin))return!0}else if(t.roomLeft===e.roomRight&&t.roomRight===e.roomLeft){if(o.equals(n))return!0;if(e.origin.equals(t.origin))return!0}return!1}function $e(e,t){const o=e.indexOf(t);e.splice(o,1)}function Ke(e,t){const o=new Set;for(const t of e)t.roomType!==_e.Exterior&&t.roomType!==_e.Vault&&o.add(t);const n=new Set,r=[];const s=Array.from(o);!function e(s){r.push(s),n.add(s);const a=[...s.edges];t.shuffleArray(a);for(const t of a){if(!t.door)continue;const a=t.roomLeft===s?t.roomRight:t.roomLeft;n.has(a)||o.has(a)&&(e(a),r.push(s))}}(s[t.randomInRange(s.length)]),--r.length;return Je(r)}function Qe(e,t,o,n,r){const s=st(Ke(o,r),e,t,n,r);return console.assert(1===s.length),s}function Je(e){const t=[];for(const o of e)t.push({room:o,nodeNext:null,nodePrev:null,visited:!1});for(let o=0;o<e.length;++o)t[o].nodeNext=t[(o+1)%t.length],t[o].nodePrev=t[(o+t.length-1)%t.length];return t}function Ze(e){for(const t of e)if(null!==t.nodeNext&&null!==t.nodePrev&&t.nodeNext.room===t.nodePrev.room)return t}function et(e){if(void 0===e)return;let t,o=Number.MAX_SAFE_INTEGER;for(const n of e){const e=ut(n);e<o&&(o=e,t=n)}return t}function tt(e){return e.roomType!==_e.Exterior&&e.roomType!==_e.Vault}function ot(e,t,o){if(lt(e,t)){if(!function(e,t){let o=e.nodePrev,n=e.nodeNext;for(;;){if(o===n)return o===t;if(null===o||null===n)return!1;if(o===e||n===e)return!1;if(o.room!==n.room)return!1;o=o.nodePrev,n=n.nodeNext}}(e,t))return!1;if(ut(e)<=4)return!1}else{if(ut(e)+ut(t)+2>o)return!1}return!0}function nt(e,t,o){if(null!==e.nodePrev)for(e.nodePrev.nodeNext=null;;){const n=e.nodeNext;e.nodePrev=null,e.nodeNext=null,$e(t,e);const r=o.get(e.room);if(void 0!==r&&$e(r,e),null===n)break;e=n}}function rt(e,t){const o=a.create();for(let n=t.length-1;n>0;--n){if(a.subtract(o,t[n],t[n-1]),o.equals(e))return!1;if(a.dot(o,e)<=0)return!0}return!1}function st(e,t,o,n,r){for(const t of e)t.visited=!1;const s=[];for(const t of e){if(t.visited)continue;if(null==t.nodeNext&&null==t.nodePrev){t.visited=!0;continue}const e=it(t),n=[],i=new Set;for(let t=e;null!=t&&!t.visited;t=t.nodeNext){t.visited=!0;const e=t.nodeNext,s=t.nodePrev;if(null==e)continue;if(null==s)continue;const l=t.room,u=e.room,c=s.room;i.add(l);const d=a.create();if(dt(d,l,c,o),u===c){const e=mt(o,l),t=a.create();e.length>0?a.copy(t,e[r.randomInRange(e.length)]):pt(t,l,c,o);for(const e of ft(o,l,d,t))n.push(e);n.push(a.clone(t));const s=!1,i=o.tryGetPosLookAt(t,s);if(void 0!==i){const e=a.create();a.subtract(e,i,t),rt(e,n)&&n.push(a.clone(t))}n.push(a.clone(t)),n.push(a.clone(t)),a.copy(d,t)}const p=a.create();dt(p,l,u,o);const h=ft(o,l,d,p);for(const e of h)n.push(e)}const l=at(n,r.randomInRange(n.length)),u=Array.from(i),c=u.reduce(((e,t)=>Math.min(e,t.depth)),1/0),d=u.reduce(((e,t)=>Math.max(e,t.depth)),0);s.push({rooms:u,path:l,minRoomDepth:c,maxRoomDepth:d})}if(r.shuffleArray(s),t>5){const e=n.path.length;s.push({rooms:n.rooms,path:at(n.path,Math.floor(.25*e)),minRoomDepth:n.minRoomDepth,maxRoomDepth:n.maxRoomDepth}),s.push({rooms:n.rooms,path:at(n.path,Math.floor(.75*e)),minRoomDepth:n.minRoomDepth,maxRoomDepth:n.maxRoomDepth})}return s}function at(e,t){const o=[];for(let n=t;n<e.length;++n)o.push(e[n]);for(let n=0;n<t;++n)o.push(e[n]);return o}function it(e){let t=e;for(;null!=t.nodePrev&&(t=t.nodePrev,t!=e););return t}function lt(e,t){let o=e;for(;;){if(o===t)return!0;if(null===o.nodeNext)break;if(o=o.nodeNext,o===e)break}return!1}function ut(e){let t=0,o=e;for(;++t,null!==o.nodeNext&&(o=o.nodeNext,o!==e););return t}function ct(e){let t=e;for(;t.visited=!0,null!==t.nodeNext&&(t=t.nodeNext,t!==e););}function dt(e,t,o,n){for(const r of t.edges)if(r.roomLeft===t&&r.roomRight===o||r.roomLeft===o&&r.roomRight===t){const t=a.create();for(let o=1;o<r.length;++o){a.scaleAndAdd(t,r.origin,r.dir,o);const s=n.cells.atVec(t).type;if(s>=J.PortcullisNS&&s<=J.GardenDoorEW)return void a.copy(e,t)}}a.zero(e)}function pt(e,t,o,n){for(const r of t.edges){if(r.roomLeft===t&&r.roomRight===o){const s=a.create();dt(s,t,o,n);const i=a.fromValues(-r.dir[1],r.dir[0]);return a.scaleAndAdd(e,s,i,2),void(0!=n.cells.at(e[0],e[1]).moveCost&&a.scaleAndAdd(e,s,i,1))}if(r.roomLeft===o&&r.roomRight===t){const s=a.create();dt(s,t,o,n);const i=a.fromValues(r.dir[1],-r.dir[0]);return a.scaleAndAdd(e,s,i,2),void(0!=n.cells.at(e[0],e[1]).moveCost&&a.scaleAndAdd(e,s,i,1))}}a.zero(e)}function ht(e,t){let o,n,r,s=0;for(const t of e){if(!t.door)continue;if(t.roomLeft.roomType===_e.Exterior==(t.roomRight.roomType===_e.Exterior))continue;const e=t.origin[1]+Math.max(0,t.dir[1])*t.length;(void 0===o||e<s)&&(o=t,s=e)}if(void 0===o)return a.fromValues(0,0);o.roomLeft.roomType===_e.Exterior?(n=o.roomRight,r=o.roomLeft):(n=o.roomLeft,r=o.roomRight);const i=a.create();return pt(i,r,n,t),i}function mt(e,t){const o=[];for(let n=t.posMin[0];n<t.posMax[0];++n){if(t.posMin[1]>0){e.cells.at(n,t.posMin[1]-1).type==J.OneWayWindowS&&0===e.cells.at(n,t.posMin[1]).moveCost&&o.push(a.fromValues(n,t.posMin[1]))}if(t.posMax[1]<e.cells.sizeY){e.cells.at(n,t.posMax[1]).type==J.OneWayWindowN&&0===e.cells.at(n,t.posMax[1]-1).moveCost&&o.push(a.fromValues(n,t.posMax[1]-1))}}for(let n=t.posMin[1];n<t.posMax[1];++n){if(t.posMin[0]>0){e.cells.at(t.posMin[0]-1,n).type==J.OneWayWindowW&&0===e.cells.at(t.posMin[0],n).moveCost&&o.push(a.fromValues(t.posMin[0],n))}if(t.posMax[0]<e.cells.sizeX){e.cells.at(t.posMax[0],n).type==J.OneWayWindowE&&0===e.cells.at(t.posMax[0]-1,n).moveCost&&o.push(a.fromValues(t.posMax[0]-1,n))}}if(o.length>0)return o;for(const n of e.items)n.type==ne.Chair&&n.pos[0]>=t.posMin[0]&&n.pos[1]>=t.posMin[1]&&n.pos[0]<t.posMax[0]&&n.pos[1]<t.posMax[1]&&o.push(a.clone(n.pos));return o}function ft(e,t,o,n){const r=Math.max(0,t.posMin[0]-1),s=Math.max(0,t.posMin[1]-1),i=Math.min(e.cells.sizeX,t.posMax[0]+1),l=Math.min(e.cells.sizeY,t.posMax[1]+1),u=e.computeDistancesToPositionSubrect(n,r,s,i,l),c=a.clone(o),d=[];for(;!c.equals(n);){d.push(a.clone(c));const o=gt(e,t,u,c);if(o.equals(c))break;a.copy(c,o)}return d}function gt(e,t,o,n){let r=1/0,s=a.clone(n);const i=Math.max(0,t.posMin[0]-1),l=Math.max(0,t.posMin[1]-1),u=Math.min(e.cells.sizeX,t.posMax[0]+1),c=Math.min(e.cells.sizeY,t.posMax[1]+1),d=a.fromValues(Math.max(i,n[0]-1),Math.max(l,n[1]-1)),p=a.fromValues(Math.min(u,n[0]+2),Math.min(c,n[1]+2));for(let t=d[0];t<p[0];++t)for(let u=d[1];u<p[1];++u){const c=o.get(t-i,u-l);if(c==1/0)continue;let d=a.fromValues(t,u);e.guardMoveCost(n,d)!=1/0&&(c<r&&(r=c,s=d))}if(s.equals(n)){console.log("failed to proceed");for(let e=d[0];e<p[0];++e)for(let t=d[1];t<p[1];++t){const n=o.get(e-i,t-l);console.log(e,t,n)}}return s}(Te=_e||(_e={}))[Te.Exterior=0]="Exterior",Te[Te.PublicCourtyard=1]="PublicCourtyard",Te[Te.PublicRoom=2]="PublicRoom",Te[Te.PrivateCourtyard=3]="PrivateCourtyard",Te[Te.PrivateRoom=4]="PrivateRoom",Te[Te.Vault=5]="Vault",Te[Te.Bedroom=6]="Bedroom",Te[Te.Dining=7]="Dining",Te[Te.PublicLibrary=8]="PublicLibrary",Te[Te.PrivateLibrary=9]="PrivateLibrary",Te[Te.Kitchen=10]="Kitchen",Te[Te.Treasure=11]="Treasure",Te[Te.TreasureCourtyard=12]="TreasureCourtyard",Te[Te.LockedTreasure=13]="LockedTreasure",Te[Te.LockedTreasureCourtyard=14]="LockedTreasureCourtyard",Te[Te.ThroneRoom=15]="ThroneRoom",(Le=we||(we={}))[Le.Standard=0]="Standard",Le[Le.GateFront=1]="GateFront",Le[Le.GateBack=2]="GateBack",Le[Le.Locked=3]="Locked";const yt=[J.OneWayWindowS,J.OneWayWindowE,J.OneWayWindowN,J.OneWayWindowW];function xt(e){return yt[e[0]+2*Math.max(0,e[1])+1]}function vt(e,t,o,n){const r=t.posMax[0]-t.posMin[0],s=t.posMax[1]-t.posMin[1];if(r>=5&&s>=5)Kt(e,t.posMin[0]+1,t.posMin[1]+1,t.posMax[0]-1,t.posMax[1]-1,J.GroundWater);else if(r>=2&&s>=2){const i=[ne.Bush,ne.Bush,ne.Bush,ne.Bush];r>2&&s>2&&i.push(Ft(o,n)),n.shuffleArray(i);const l=[a.fromValues(t.posMin[0],t.posMin[1]),a.fromValues(t.posMax[0]-1,t.posMin[1]),a.fromValues(t.posMin[0],t.posMax[1]-1),a.fromValues(t.posMax[0]-1,t.posMax[1]-1)];for(let t=0;t<l.length;++t){const o=l[t];e.cells.atVec(o).type===J.GroundGrass&&Gt(e,o,i[t])}}}function St(e,t,o,n){const r=t.posMax[0]-t.posMin[0],s=t.posMax[1]-t.posMin[1];if(r>=5&&s>=5){if(t.roomType===_e.PrivateRoom)r>s?r>7&&Kt(e,t.posMin[0]+3,t.posMin[1]+1,t.posMax[0]-3,t.posMax[1]-1,J.GroundWater):s>r?s>7&&Kt(e,t.posMin[0]+1,t.posMin[1]+3,t.posMax[0]-1,t.posMax[1]-3,J.GroundWater):r>=7?(Kt(e,t.posMin[0]+3,t.posMin[1]+1,t.posMax[0]-3,t.posMax[1]-1,J.GroundWater),Kt(e,t.posMin[0]+1,t.posMin[1]+3,t.posMax[0]-1,t.posMax[1]-3,J.GroundWater)):Kt(e,t.posMin[0]+1,t.posMin[1]+1,t.posMax[0]-1,t.posMax[1]-1,J.GroundWater);else if(r>s)for(let o=t.posMin[0]+3;o<t.posMax[0]-3;++o)zt(e,a.fromValues(o,t.posMin[1]+1),ne.Chair),zt(e,a.fromValues(o,t.posMax[1]-2),ne.Chair);else if(s>r)for(let o=t.posMin[1]+3;o<t.posMax[1]-3;++o)zt(e,a.fromValues(t.posMin[0]+1,o),ne.Chair),zt(e,a.fromValues(t.posMax[0]-2,o),ne.Chair);else 5===r&&5===s&&(zt(e,a.fromValues(t.posMin[0]+1,t.posMin[1]+1),ne.Table),zt(e,a.fromValues(t.posMin[0]+2,t.posMin[1]+1),ne.Chair),zt(e,a.fromValues(t.posMin[0]+1,t.posMin[1]+2),ne.Chair),zt(e,a.fromValues(t.posMax[0]-2,t.posMax[1]-2),Ft(o,n)));if(r>5||s>5)if(e.cells.at(t.posMin[0]+1,t.posMin[1]+1).type=J.Wall0000,e.cells.at(t.posMax[0]-2,t.posMin[1]+1).type=J.Wall0000,e.cells.at(t.posMin[0]+1,t.posMax[1]-2).type=J.Wall0000,e.cells.at(t.posMax[0]-2,t.posMax[1]-2).type=J.Wall0000,r>s){const r=Math.floor(s/2);zt(e,a.fromValues(t.posMin[0]+1,t.posMin[1]+r),Ft(o,n)),zt(e,a.fromValues(t.posMax[0]-2,t.posMax[1]-(r+1)),Ft(o,n))}else if(s>r){const s=Math.floor(r/2);zt(e,a.fromValues(t.posMin[0]+s,t.posMin[1]+1),Ft(o,n)),zt(e,a.fromValues(t.posMax[0]-(s+1),t.posMax[1]-2),Ft(o,n))}}else if(5==r&&s>=3&&(t.roomType==_e.PublicRoom||n.random()<.33333)){const r=new Array(s-2).fill(ne.Table);r.push(Ft(o,n)),n.shuffleArray(r);for(let o=1;o<s-1;++o)zt(e,a.fromValues(t.posMin[0]+1,t.posMin[1]+o),ne.Chair),zt(e,a.fromValues(t.posMin[0]+2,t.posMin[1]+o),r[o-1]),zt(e,a.fromValues(t.posMin[0]+3,t.posMin[1]+o),ne.Chair)}else if(5==s&&r>=3&&(t.roomType==_e.PublicRoom||n.random()<.33333)){const s=new Array(r-2).fill(ne.Table);s.push(Ft(o,n)),n.shuffleArray(s);for(let o=1;o<r-1;++o)zt(e,a.fromValues(t.posMin[0]+o,t.posMin[1]+1),ne.Chair),zt(e,a.fromValues(t.posMin[0]+o,t.posMin[1]+2),s[o-1]),zt(e,a.fromValues(t.posMin[0]+o,t.posMin[1]+3),ne.Chair)}else if(r>s&&1==(1&s)&&n.random()<.66667){let r=Math.floor(t.posMin[1]+s/2);const i=t.roomType==_e.PublicRoom?ne.Table:ne.Chair,l=[Ft(o,n),i];n.shuffleArray(l),Gt(e,a.fromValues(t.posMin[0]+1,r),l[0]),Gt(e,a.fromValues(t.posMax[0]-2,r),l[1])}else if(s>r&&1==(1&r)&&n.random()<.66667){let s=Math.floor(t.posMin[0]+r/2);const i=t.roomType==_e.PublicRoom?ne.Table:ne.Chair,l=[Ft(o,n),i];n.shuffleArray(l),Gt(e,a.fromValues(s,t.posMin[1]+1),l[0]),Gt(e,a.fromValues(s,t.posMax[1]-2),l[1])}else if(r>=5&&3===s){let r=Math.floor(t.posMin[1]+s/2);Gt(e,a.fromValues(t.posMin[0]+1,r),Ft(o,n)),Gt(e,a.fromValues(t.posMax[0]-2,r),Ft(o,n))}else if(s>=5&&3===r){let s=Math.floor(t.posMin[0]+r/2);Gt(e,a.fromValues(s,t.posMin[1]+1),Ft(o,n)),Gt(e,a.fromValues(s,t.posMax[1]-2),Ft(o,n))}else if(r>=3&&s>=3){const r=t.roomType==_e.PublicRoom?ne.Table:ne.Chair,s=[Ft(o,n),r,r,r];n.shuffleArray(s),Gt(e,a.fromValues(t.posMin[0],t.posMin[1]),s[0]),Gt(e,a.fromValues(t.posMax[0]-1,t.posMin[1]),s[1]),Gt(e,a.fromValues(t.posMin[0],t.posMax[1]-1),s[2]),Gt(e,a.fromValues(t.posMax[0]-1,t.posMax[1]-1),s[3])}}function Mt(e,t,o){const n=t.posMax[0]-t.posMin[0],r=t.posMax[1]-t.posMin[1];n>=5&&r>=5&&(e.cells.at(t.posMin[0]+1,t.posMin[1]+1).type=J.Wall0000,e.cells.at(t.posMax[0]-2,t.posMin[1]+1).type=J.Wall0000,e.cells.at(t.posMin[0]+1,t.posMax[1]-2).type=J.Wall0000,e.cells.at(t.posMax[0]-2,t.posMax[1]-2).type=J.Wall0000);const s=[ne.DrawersTall,ne.DrawersShort,ne.Chair,ne.Table,ne.Bookshelf,ne.Shelf,ne.TorchUnlit];o.shuffleArray(s);const i=t.posMax[0]-t.posMin[0],l=t.posMax[1]-t.posMin[1],u=new Y(i,l,!0),c=new Y(i,l,!1),d=new Y(i,l,!1);let p,h;for(let o=0;o<i;++o)for(let n=0;n<l;++n)Ot(e.cells.at(o+t.posMin[0],n+t.posMin[1]).type)?Vt(e.cells,a.fromValues(o+t.posMin[0],n+t.posMin[1]))&&(c.set(o,n,!0),p=o,h=n):(d.set(o,n,!0),c.set(o,n,!0));if(void 0===p||void 0===h)return;const m=[];for(let n=0;;n=(n+1)%s.length){for(let e=0;e<u.values.length;++e)u.values[e]=c.values[e]?0:1;Lt(u,d,p,h),wt(u,d,m,t);const r=Dt(u);if(0===r.length)break;const i=r[o.randomInRange(r.length)];console.assert(u.get(i[0],i[1])),console.assert(!d.get(i[0],i[1]));const l={pos:a.fromValues(i[0]+t.posMin[0],i[1]+t.posMin[1]),type:s[n]};e.items.push(l),m.push(l),d.set(i[0],i[1],!0),c.set(i[0],i[1],!0)}}function _t(e,t,o,n){const r=t.posMax[0]-t.posMin[0],s=t.posMax[1]-t.posMin[1],i=new Y(r,s,!0),l=new Y(r,s,!1),u=new Y(r,s,!1),c=new Y(r,s,!1);let d,p;const h=a.create();for(let o=0;o<r;++o)for(let n=0;n<s;++n)h.set(o+t.posMin[0],n+t.posMin[1]),Ot(e.cells.atVec(h).type)?Vt(e.cells,h)&&(l.set(o,n,!0),u.set(o,n,!0),d=o,p=n):(c.set(o,n,!0),l.set(o,n,!0),u.set(o,n,!0)),!Ut(e.cells,h)&&Qt(e,h)||u.set(o,n,!0);if(void 0===d||void 0===p)return;const m=[];for(let o=t.posMin[0];o<t.posMax[0]-1;++o)for(let n=t.posMin[1];n<t.posMax[1];++n){const s=a.fromValues(o,n),i=a.fromValues(o+1,n);(Nt(e.cells,s)||Nt(e.cells,i))&&(Zt(e,s)||Zt(e,i)||Vt(e.cells,s)||Vt(e.cells,i)||2===r&&n!==t.posMin[1]&&n!==t.posMax[1]-1||m.push(s))}const f=[];if(m.length>0){const o=m[n.randomInRange(m.length)],r=a.fromValues(o[0]+1,o[1]),s={pos:a.clone(o),type:ne.BedL},i={pos:a.clone(r),type:ne.BedR};e.items.push(s),e.items.push(i),f.push(s);const d=o[0]-t.posMin[0],p=o[1]-t.posMin[1];c.set(d,p,!0),c.set(d+1,p,!0),l.set(d,p,!0),l.set(d+1,p,!0),u.set(d,p,!0),u.set(d+1,p,!0)}const g=[ne.DrawersTall,ne.DrawersShort,ne.Chair,ne.Chair,ne.Table,ne.Bookshelf,Ft(o,n)];n.shuffleArray(g);for(const o of g){const r=Tt(o)?u:l;for(let e=0;e<i.values.length;++e)i.values[e]=r.values[e]?0:1;Lt(i,c,d,p),wt(i,c,f,t);const s=Dt(i);if(0===s.length)break;const h=s[n.randomInRange(s.length)];console.assert(i.get(h[0],h[1])),console.assert(!c.get(h[0],h[1]));const m={pos:a.fromValues(h[0]+t.posMin[0],h[1]+t.posMin[1]),type:o};e.items.push(m),f.push(m),c.set(h[0],h[1],!0),l.set(h[0],h[1],!0),u.set(h[0],h[1],!0)}}function Tt(e){switch(e){case ne.Bookshelf:case ne.DrawersShort:case ne.DrawersTall:case ne.Shelf:case ne.TorchUnlit:case ne.TorchLit:case ne.Stove:return!0;default:return!1}}function wt(e,t,o,n){const r=e.sizeX,s=e.sizeY;for(const a of o){const o=a.pos[0]-n.posMin[0],i=a.pos[1]-n.posMin[1],l=[];for(const[e,n]of[[1,0],[0,1],[-1,0],[0,-1]]){const a=o+e,u=i+n;a<0||u<0||a>=r||u>=s||(t.get(a,u)||l.push([a,u]))}if(a.type===ne.BedL)for(const[e,n]of[[1,0],[0,1],[0,-1]]){const a=o+e+1,u=i+n;a<0||u<0||a>=r||u>=s||(t.get(a,u)||l.push([a,u]))}if(1===l.length){const[t,o]=l[0];e.set(t,o,!1)}}}function Lt(e,t,o,n){const r=t.sizeX,s=t.sizeY;console.assert(e.sizeX===r),console.assert(e.sizeY===s),console.assert(o>=0),console.assert(n>=0),console.assert(o<r),console.assert(n<s),console.assert(!t.get(o,n));const a=new Y(r,s,!1),i=new j(r,s,0),l=new j(r,s,0);!function o(n,u,c,d,p){a.set(n,u,!0),i.set(n,u,c),l.set(n,u,c);let h=0,m=!1;for(const[e,f]of[[1,0],[0,1],[-1,0],[0,-1]]){const g=n+e,y=u+f;g<0||g>=r||y<0||y>=s||(t.get(g,y)||(a.get(g,y)?g===d&&y===p||l.set(n,u,Math.min(l.get(n,u),i.get(g,y))):(o(g,y,c+1,n,u),++h,l.get(g,y)>=c&&(m=!0),l.set(n,u,Math.min(l.get(n,u),l.get(g,y))))))}d>=0?m&&e.set(n,u,!1):h>1&&e.set(n,u,!1)}(o,n,0,-1,-1)}function At(e,t,o,n){const r=t.posMax[0]-t.posMin[0],s=t.posMax[1]-t.posMin[1];let i=[];const l=r>s||r===s&&function(e){let t=0;for(const o of e.edges)0===o.dir[1]&&o.door&&++t;return t}(t)<=function(e){let t=0;for(const o of e.edges)0===o.dir[0]&&o.door&&++t;return t}(t);if(l){for(let e=0;e<r;++e)i.push(a.fromValues(e+t.posMin[0],t.posMin[1])),i.push(a.fromValues(e+t.posMin[0],t.posMax[1]-1));const e=(t.posMin[0]+t.posMax[0])/2;i.sort(((t,o)=>Math.abs(t[0]-e)-Math.abs(o[0]-e)))}else{for(let e=0;e<s;++e)i.push(a.fromValues(t.posMin[0],e+t.posMin[1])),i.push(a.fromValues(t.posMax[0]-1,e+t.posMin[1]));const e=(t.posMin[1]+t.posMax[1])/2;i.sort(((t,o)=>Math.abs(t[1]-e)-Math.abs(o[1]-e)))}i=i.filter((t=>!Vt(e.cells,t)&&Nt(e.cells,t)));let u=kt(r*s/10,n),c=kt(i.length/3,n),d=kt(i.length/2,n);for(const t of i)Ut(e.cells,t)?d>0&&(zt(e,t,ne.Table),--d):u>0?(zt(e,t,ne.Stove),--u):d>0?(zt(e,t,ne.Table),--d):c>0&&(zt(e,t,ne.Shelf),--c);if(l){if(s>=5)for(let o=t.posMin[0]+1;o<t.posMax[0]-1;o+=2)for(let n=t.posMin[1]+2;n<t.posMax[1]-2;++n)zt(e,a.fromValues(o,n),ne.Table)}else if(r>=5)for(let o=t.posMin[1]+1;o<t.posMax[1]-1;o+=2)for(let n=t.posMin[0]+2;n<t.posMax[0]-2;++n)zt(e,a.fromValues(n,o),ne.Table)}function bt(e,t,o,n){const r=t.posMax[0]-t.posMin[0],s=t.posMax[1]-t.posMin[1],i=t.posMin[0]+Math.floor((r-1)/2),l=t.posMin[1]+Math.floor((s-1)/2);Kt(e,i,l,i+1,l+1,J.GroundTreasure),zt(e,a.fromValues(i,l),ne.TreasurePlinth),t.roomType===_e.LockedTreasure&&zt(e,a.fromValues(i,l),ne.TreasureLock),(r>=5||s>=5)&&(Gt(e,a.fromValues(t.posMin[0],t.posMin[1]),Ft(o,n)),Gt(e,a.fromValues(t.posMax[0]-1,t.posMin[1]),Ft(o,n)),Gt(e,a.fromValues(t.posMin[0],t.posMax[1]-1),Ft(o,n)),Gt(e,a.fromValues(t.posMax[0]-1,t.posMax[1]-1),Ft(o,n)))}function Rt(e,t,o,n){const r=t.posMax[0]-t.posMin[0],s=t.posMax[1]-t.posMin[1],i=t.posMin[0]+Math.floor((r-1)/2),l=t.posMin[1]+Math.floor((s-1)/2);r>3&&s>3?Kt(e,Math.max(t.posMin[0]+1,i-1),Math.max(t.posMin[1]+1,l-1),Math.min(t.posMax[0]-1,i+2),Math.min(t.posMax[1]-1,l+2),J.GroundVault):Kt(e,i,l,i+1,l+1,J.GroundTreasure),zt(e,a.fromValues(i,l),ne.TreasurePlinth),t.roomType===_e.LockedTreasureCourtyard&&zt(e,a.fromValues(i,l),ne.TreasureLock),(r>=5||s>=5)&&(Gt(e,a.fromValues(t.posMin[0],t.posMin[1]),Ft(o,n)),Gt(e,a.fromValues(t.posMax[0]-1,t.posMin[1]),Ft(o,n)),Gt(e,a.fromValues(t.posMin[0],t.posMax[1]-1),Ft(o,n)),Gt(e,a.fromValues(t.posMax[0]-1,t.posMax[1]-1),Ft(o,n)))}function kt(e,t){const o=e-Math.floor(e);return e=Math.floor(e),t.random()<o&&++e,e}function Ct(e,t,o,n){const r=t.posMin[0],s=t.posMin[1],i=t.posMax[0]-t.posMin[0],l=t.posMax[1]-t.posMin[1];if(i>=l){const t=s+Math.floor(l/2);if(0==(1&i)){Gt(e,a.fromValues(r+1,t),Ft(o,n)),Gt(e,a.fromValues(r+i-2,t),Ft(o,n));for(let o=r+2;o<r+i-2;++o)zt(e,a.fromValues(o,t-1),ne.Chair),zt(e,a.fromValues(o,t),ne.Table),zt(e,a.fromValues(o,t+1),ne.Chair)}else{const s=r+(i-1)/2;Gt(e,a.fromValues(s,t),Ft(o,n));for(let o=r+1;o<s;++o)zt(e,a.fromValues(o,t-1),ne.Chair),zt(e,a.fromValues(o,t),ne.Table),zt(e,a.fromValues(o,t+1),ne.Chair);for(let o=s+1;o<r+i-1;++o)zt(e,a.fromValues(o,t-1),ne.Chair),zt(e,a.fromValues(o,t),ne.Table),zt(e,a.fromValues(o,t+1),ne.Chair)}}else{const t=r+Math.floor(i/2);if(0==(1&l)){Gt(e,a.fromValues(t,s+1),Ft(o,n)),Gt(e,a.fromValues(t,s+l-2),Ft(o,n));for(let o=s+2;o<s+l-2;++o)zt(e,a.fromValues(t-1,o),ne.Chair),zt(e,a.fromValues(t,o),ne.Table),zt(e,a.fromValues(t+1,o),ne.Chair)}else{const r=s+(l-1)/2;Gt(e,a.fromValues(t,r),Ft(o,n));for(let o=s+1;o<r;++o)zt(e,a.fromValues(t-1,o),ne.Chair),zt(e,a.fromValues(t,o),ne.Table),zt(e,a.fromValues(t+1,o),ne.Chair);for(let o=r+1;o<s+l-1;++o)zt(e,a.fromValues(t-1,o),ne.Chair),zt(e,a.fromValues(t,o),ne.Table),zt(e,a.fromValues(t+1,o),ne.Chair)}}}function It(e,t,o){let n=0;for(const r of e.edges){if(!r.door)continue;let s=-r.dir[1],a=r.dir[0];r.roomLeft===e&&(s=-s,a=-a),s===t&&a===o&&++n}return n}function Pt(e,t,o){t=-t,o=-o;const n=a.fromValues(t,o),r=a.create(),s=a.create();t>0?a.set(s,e.posMin[0]-1,0):t<0?a.set(s,e.posMax[0],0):o>0?a.set(s,0,e.posMin[1]-1):a.set(s,0,e.posMax[1]);let i=1/0;for(const t of e.edges){if(!t.door)continue;a.scaleAndAdd(r,t.origin,t.dir,Math.floor(t.length/2)),a.subtract(r,r,s);const e=a.dot(n,r);i=Math.min(i,e)}return console.assert(i>=0),i}function Ht(e,t,o,n){let r,s,i,l,u,c;t.posMax[1]-t.posMin[1]<t.posMax[0]-t.posMin[0]||0!==It(t,0,-1)&&0!==It(t,0,1)?(u=t.posMax[1]-t.posMin[1],c=t.posMax[0]-t.posMin[0],i=0,Pt(t,-1,0)>Pt(t,1,0)?(r=t.posMin[0],s=t.posMin[1],l=1):(r=t.posMax[0]-1,s=t.posMax[1]-1,l=-1)):(u=t.posMax[0]-t.posMin[0],c=t.posMax[1]-t.posMin[1],l=0,Pt(t,0,-1)>Pt(t,0,1)?(r=t.posMax[0]-1,s=t.posMin[1],i=-1):(r=t.posMin[0],s=t.posMax[1]-1,i=1));const d=a.fromValues(i,l),p=a.fromValues(l,-i),h=a.fromValues(r,s),m=a.create(),f=0!=(1&u)?1:2,g=Math.floor((u-f)/2);for(let t=0;t<c-1;++t)for(let o=0;o<f;++o)a.scaleAndAdd(m,h,d,g+o),a.scaleAndAdd(m,m,p,t),e.cells.atVec(m).type=J.GroundMarble;for(let t=0;t<f;++t)a.scaleAndAdd(m,h,d,g+t),zt(e,m,ne.Chair);if(a.scaleAndAdd(m,h,d,g-1),Gt(e,m,ne.DrawersShort),a.scaleAndAdd(m,h,d,g+f),Gt(e,m,ne.DrawersShort),u>4&&(a.scaleAndAdd(m,h,d,0),Gt(e,m,ne.TorchLit),a.scaleAndAdd(m,h,d,u-1),Gt(e,m,ne.TorchLit)),c>6)if(u>=5)for(let t=2;t<c-2;++t)a.scaleAndAdd(m,h,d,1),a.scaleAndAdd(m,m,p,t),Gt(e,m,ne.Chair),a.scaleAndAdd(m,h,d,u-2),a.scaleAndAdd(m,m,p,t),Gt(e,m,ne.Chair);else{if(0===It(t,-d[0],-d[1]))for(let t=2;t<c-2;++t)a.scaleAndAdd(m,h,d,0),a.scaleAndAdd(m,m,p,t),Gt(e,m,ne.Chair);if(0===It(t,d[0],d[1]))for(let t=2;t<c-2;++t)a.scaleAndAdd(m,h,d,u-1),a.scaleAndAdd(m,m,p,t),Gt(e,m,ne.Chair)}a.scaleAndAdd(m,h,d,0),a.scaleAndAdd(m,m,p,c-1),Gt(e,m,ne.TorchLit),a.scaleAndAdd(m,h,d,u-1),a.scaleAndAdd(m,m,p,c-1),Gt(e,m,ne.TorchLit)}function Et(e,t,o,n){const r=t.posMin[0],s=t.posMin[1],i=t.posMax[0]-t.posMin[0],l=t.posMax[1]-t.posMin[1];if(i>=l)if(1==(1&i))for(let t=1;t<i;t+=2)for(let o=1;o<l-1;++o)zt(e,a.fromValues(r+t,s+o),ne.Bookshelf);else{const t=i/2-1;for(let o=1;o<t;o+=2)for(let t=1;t<l-1;++t)zt(e,a.fromValues(r+o,s+t),ne.Bookshelf),zt(e,a.fromValues(r+i-(o+1),s+t),ne.Bookshelf);if(1==(1&t))for(let i=s+1;i<s+l-1;++i){let u=[void 0,void 0];u=i>s+1&&(i<s+l-2||4===l)?[ne.Table,ne.Chair]:[Ft(o,n),void 0],n.shuffleArray(u),void 0!==u[0]&&zt(e,a.fromValues(r+t,i),u[0]),void 0!==u[1]&&zt(e,a.fromValues(r+t+1,i),u[1])}}else if(1==(1&l))for(let t=1;t<l;t+=2)for(let o=1;o<i-1;++o)zt(e,a.fromValues(r+o,s+t),ne.Bookshelf);else{const t=l/2-1;for(let o=1;o<t;o+=2)for(let t=1;t<i-1;++t)zt(e,a.fromValues(r+t,s+o),ne.Bookshelf),zt(e,a.fromValues(r+t,s+l-(o+1)),ne.Bookshelf);if(1==(1&t))for(let l=r+1;l<r+i-1;++l){let u=[void 0,void 0];u=l>r+1&&(l<r+i-2||4===i)?[ne.Table,ne.Chair]:[Ft(o,n),void 0],n.shuffleArray(u),void 0!==u[0]&&zt(e,a.fromValues(l,s+t),u[0]),void 0!==u[1]&&zt(e,a.fromValues(l,s+t+1),u[1])}}}function Dt(e){const t=[];for(let o=0;o<e.sizeX;++o)for(let n=0;n<e.sizeY;++n)e.get(o,n)&&t.push(a.fromValues(o,n));return t}function Wt(e,t,o){for(let n=t.posMin[0];n<t.posMax[0];++n)for(let r=t.posMin[1];r<t.posMax[1];++r){if(e.cells.at(n,r).type!=J.GroundWood)continue;if(e.items.some((e=>e.pos[0]===n&&e.pos[1]===r&&e.type!==ne.Coin)))continue;if(Vt(e.cells,a.fromValues(n,r)))continue;if(o.random()>=.02)continue;const s=n>t.posMin[0]&&n<t.posMax[0]-1&&e.cells.at(n-1,r).type===J.GroundWood&&e.cells.at(n+1,r).type===J.GroundWood&&!e.items.some((e=>e.pos[0]===n-1&&e.pos[1]===r&&so(e.type)))&&!e.items.some((e=>e.pos[0]===n+1&&e.pos[1]===r&&so(e.type))),i=r>t.posMin[1]&&r<t.posMax[1]-1&&e.cells.at(n,r-1).type===J.GroundWood&&e.cells.at(n,r+1).type===J.GroundWood&&!e.items.some((e=>e.pos[0]===n&&e.pos[1]===r-1&&so(e.type)))&&!e.items.some((e=>e.pos[0]===n&&e.pos[1]===r+1&&so(e.type)));(s||i)&&(e.cells.at(n,r).type=J.GroundWoodCreaky)}}function Ft(e,t){return 0===e||t.random()<.05?ne.TorchUnlit:ne.TorchLit}function Gt(e,t,o){Vt(e.cells,t)||(o!=ne.TorchUnlit&&o!=ne.TorchLit||!Ut(e.cells,t))&&zt(e,t,o)}function Vt(e,t){let[o,n]=t;return e.at(o-1,n).type>=J.PortcullisNS||(e.at(o+1,n).type>=J.PortcullisNS||(e.at(o,n-1).type>=J.PortcullisNS||e.at(o,n+1).type>=J.PortcullisNS))}function Ut(e,t){let[o,n]=t;return!!he(e.at(o-1,n).type)||(!!he(e.at(o+1,n).type)||(!!he(e.at(o,n-1).type)||!!he(e.at(o,n+1).type)))}function Nt(e,t){let[o,n]=t;return!!Bt(e.at(o-1,n).type)||(!!Bt(e.at(o+1,n).type)||(!!Bt(e.at(o,n-1).type)||!!Bt(e.at(o,n+1).type)))}function Ot(e){return e<J.Wall0000&&e!==J.GroundWater}function Bt(e){return e>=J.Wall0000&&e<=J.OneWayWindowS}function zt(e,t,o){e.items.push({pos:a.clone(t),type:o})}function Xt(e){switch(e){case ne.Chair:case ne.Table:case ne.DrawersShort:case ne.DrawersTall:case ne.Bookshelf:case ne.Shelf:case ne.Bush:return!0;default:return!1}}function qt(e,t,o,n,r,s){const i=[];for(let r=o[0];r<n[0];++r)for(let s=o[1];s<n[1];++s)!e.get(r,s)&&t.get(r,s)&&i.push(a.fromValues(r,s));if(0===i.length){for(let t=o[0];t<n[0];++t)for(let r=o[1];r<n[1];++r)e.get(t,r)||i.push(a.fromValues(t,r));if(0===i.length)return!1}const l=i[s.randomInRange(i.length)];return zt(r,l,ne.Coin),e.set(l[0],l[1],!0),!0}function Yt(e,t,o,n){const r=o.filter((t=>e.includes(t.roomType)));if(0===r.length)return!1;for(let e=0;e<10;++e){const e=r[n.randomInRange(r.length)];if(jt(e.posMin,e.posMax,t,n))return!0}return!1}function jt(e,t,o,n){const r=[];for(let n=e[0];n<t[0];++n)for(let s=e[1];s<t[1];++s){const e=a.fromValues(n,s);$t(e,o)&&r.push(e)}return 0!==r.length&&(zt(o,r[n.randomInRange(r.length)],ne.Health),!0)}function $t(e,t){let o=t.cells.atVec(e).type;if(o===J.GroundWater||o>=J.Wall0000)return!1;let n=!1;for(const o of t.items)if(o.pos.equals(e)){if(o.type!==ne.Table)return!1;n=!0}return n}function Kt(e,t,o,n,r,s){for(let a=t;a<n;++a)for(let t=o;t<r;++t)e.cells.at(a,t).type=s}function Qt(e,t){return!(e.cells.atVec(t).type>=J.Wall0000)&&(t[0]>=0&&e.cells.at(t[0]-1,t[1]).type>=J.Wall0000||(t[1]>=0&&e.cells.at(t[0],t[1]-1).type>=J.Wall0000||(t[0]+1<e.cells.sizeX&&e.cells.at(t[0]+1,t[1]).type>=J.Wall0000||t[1]+1<e.cells.sizeY&&e.cells.at(t[0],t[1]+1).type>=J.Wall0000)))}function Jt(e,t){const o=[],n=ht(e,t),r=a.clone(n),s=a.fromValues(1,0);for(let e=t.cells.sizeX*t.cells.sizeY;e>0;--e){o.push(a.clone(r));const e=a.fromValues(-s[1],s[0]),i=a.fromValues(s[1],-s[0]);if(t.cells.at(r[0]+s[0],r[1]+s[1]).type>=J.Wall0000)if(t.cells.at(r[0]+e[0],r[1]+e[1]).type<J.Wall0000)a.copy(s,e);else{if(!(t.cells.at(r[0]+i[0],r[1]+i[1]).type<J.Wall0000))break;a.copy(s,i)}else if(!Qt(t,r))if(Qt(t,a.fromValues(r[0]+e[0],r[1]+e[1])))a.copy(s,e);else{if(!Qt(t,a.fromValues(r[0]+i[0],r[1]+i[1])))break;a.copy(s,i)}if(r.set(r[0]+s[0],r[1]+s[1]),r.equals(n))break;if(r[0]<0||r[1]<0||r[0]>=t.cells.sizeX||r[1]>=t.cells.sizeY)break}return o}function Zt(e,t){for(const o of e.items)if(o.pos.equals(t))return!0;for(const o of e.guards)if(o.pos.equals(t))return!0;return!1}function eo(e){switch(e){case _e.PublicCourtyard:case _e.PrivateCourtyard:case _e.TreasureCourtyard:case _e.LockedTreasureCourtyard:return!0;case _e.Exterior:case _e.PublicRoom:case _e.PrivateRoom:case _e.Vault:case _e.Bedroom:case _e.Dining:case _e.PublicLibrary:case _e.PrivateLibrary:case _e.Kitchen:case _e.Treasure:case _e.LockedTreasure:case _e.ThroneRoom:return!1}}function to(e){return e===_e.PrivateRoom||e===_e.Bedroom}const oo=["Alien","Aliens","Amulet","Amulets","Arm","Arms","Armor","Armor","Arrow","Arrows","Attack","Attacks","Aura","Aurae","Awakening","Awakenings","Axe","Axes","Bane","Banes","Battle-Axe","Battle-Axes","Blood","Bloods","Breath","Breaths","Captive","Captives","Castle","Castles","Catacomb","Catacombs","Cave","Caves","Chamber","Chambers","Champion","Champions","Child","Children","Citadel","Citadels","City","Cities","Claw","Claws","Cow","Cows","Crown","Crowns","Crusade","Crusades","Crystal","Crystals","Curse","Curses","Dagger","Daggers","Daughter","Daughters","Dawn","Dawn","Day","Days","Dungeon","Dungeons","Dragon","Dragons","Eye","Eyes","Field","Fields","Fire","Fires","Fist","Fists","Forest","Forests","Fortress","Fortresses","Fugitive","Fugitives","Game","Games","Gem","Gems","Guardian","Guardians","Hand","Hands","Helm","Helms","Horde","Hordes","Hour","Hours","Keep","Keeps","Key","Keys","Knight","Knights","Land","Lands","Legend","Legends","Lord","Lords","Master","Masters","Mercenary","Mercenaries","Mind","Minds","Mine","Mines","Minion","Minions","Mirror","Mirrors","Night","Nights","Moon","Moons","Omen","Omens","Orb","Orbs","Path","Paths","Pit","Pits","Plague","Plagues","Pool","Pools","Potion","Potions","Prince","Princes","Princess","Princesses","Prison","Prisons","Prisoner","Prisoners","Prophecy","Prophecies","Quest","Quests","Rampage","Rampages","Realm","Realms","Reaper","Reapers","Rebirth","Rebirths","Return","Returns","Revenge","Revenges","Ring","Rings","Rise","Rise","River","Rivers","Scroll","Scrolls","Serpent","Serpents","Servant","Servants","Shadow","Shadows","Shield","Shields","Sign","Signs","Siren","Sirens","Slave","Slaves","Son","Sons","Spawn","Spawn","Spear","Spears","Spell","Spells","Sphere","Spheres","Staff","Staves","Stronghold","Strongholds","Sword","Swords","Thief","Thieves","Threat","Threats","Throne","Thrones","Tower","Towers","Trail","Trails","Trial","Trials","Valley","Valleys","Wand","Wands","Warrior","Warriors","Weapon","Weapons","Wind","Winds","Witch","Witches","Wizard","Wizards"],no=["Adventure","Agony","the Ancients","Anger","Avenging","Battle","Beholding","Brilliance","Danger","Darkness","Death","Deception","Despair","Destiny","Destruction","Disease","Ecstacy","Enchantment","Enlightenment","Eternity","Evil","Falsehood","Famine","Fantasy","Fate","Fear","Flame","Foretelling","Forewarning","Fortune","Fury","Gallantry","Gingivitis","the Gods","Intrigue","Keeping","Legend","the Living Dead","Lore","Madness","Magic","Menace","Midnight","Might","Murder","Mystery","Power","Prophecy","Radiance","Rebellion","Reckoning","Remembrance","Shadow","Sickness","Strength","Suffering","Terror","Time","Truth","the Undead","the Universe","Unraveling","Valor","Vengeance","Venom","War"],ro=["Administrative Law","Arbitrage","Attorney-Client Privilege","Attractive Nuisances","Bankruptcy","Civil Procedure","Community Property","Comparative Legal Traditions","Contract Law","Consideration","Corporate Finance","Corporate Taxation","Criminal Law","Cross-Examination","Damages","Discovery","Economics","Embezzlement","Estate Planning","Estoppel","Homicide","Income Taxation","Intangible Property","International Transactions","Intestate Succession","Probate","Promissory Estoppel","Property","Quid Pro Quo","Reckless Disregard","Regulatory Policy","Securities Regulation","Security Interests","Statutory Law","Torts","Trial Procedure","Wills, Trusts, and Estates"];function so(e){return e===ne.DrawersTall||e===ne.Bookshelf||e===ne.Shelf||e===ne.Stove||e===ne.TreasureLock}function ao(e){return J.Wall0000+e}function io(e){return e>=J.Wall0000&&e<=J.DoorEW}function lo(e,t,o){const n=e.sizeX;let r=0;return o<e.sizeY-1&&io(e.at(t,o+1).type)&&(r|=8),o>0&&io(e.at(t,o-1).type)&&(r|=4),t<n-1&&io(e.at(t+1,o).type)&&(r|=2),t>0&&io(e.at(t-1,o).type)&&(r|=1),r}class uo{beginFrame=e=>{};start(e,t){}addGlyph(e,t,o,n,r){}addGlyphLit(e,t,o,n,r,s){}addGlyphLit4(e,t,o,n,r,s){}flush(){}constructor(e,t,o,n){const r=e.getContext("webgl2",{alpha:!1,depth:!1}),s=[n.image,t.image,o.image].map((e=>function(e,t){const o=16,n=16,r=o*n,s=t.naturalWidth/o,a=t.naturalHeight/n,i=4,l=s*i,u=a*i,c=document.createElement("canvas");c.width=l,c.height=u*r;const d=c.getContext("2d");d.imageSmoothingEnabled=!1;for(let e=0;e<n;++e)for(let n=0;n<o;++n){const r=n*s,i=e*a,c=0,p=(o*e+n)*u;d.drawImage(t,r,i,s,a,c,p,l,u)}const p=d.getImageData(0,0,c.width,c.height),h=new Uint8Array(p.data.buffer),m=e.createTexture();return e.bindTexture(e.TEXTURE_2D_ARRAY,m),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.RGBA,l,u,r,0,e.RGBA,e.UNSIGNED_BYTE,h),e.generateMipmap(e.TEXTURE_2D_ARRAY),m}(r,e)));this.renderVignette=function(e){const t="#version 300 es\n        in vec2 vPositionScreen;\n\n        uniform mat4 uMatDiscFromScreen;\n\n        out highp vec2 fPositionDisc;\n\n        void main() {\n            highp vec4 posScreen = vec4(vPositionScreen.xy, 0, 1);\n            fPositionDisc = (uMatDiscFromScreen * posScreen).xy;\n            gl_Position = posScreen;\n        }\n    ",o="#version 300 es\n        in highp vec2 fPositionDisc;\n\n        uniform highp vec4 uColorInner;\n        uniform highp vec4 uColorOuter;\n        uniform highp float uRadiusInner;\n\n        out lowp vec4 fragColor;\n\n        void main() {\n            highp float r = length(fPositionDisc);\n            highp float u = smoothstep(uRadiusInner, 1.0, r);\n            fragColor = mix(uColorInner, uColorOuter, u);\n        }\n    ",n={vPositionScreen:0},r=po(e,t,o,n),s=e.getUniformLocation(r,"uMatDiscFromScreen"),a=e.getUniformLocation(r,"uColorInner"),i=e.getUniformLocation(r,"uColorOuter"),l=e.getUniformLocation(r,"uRadiusInner"),u=new Float32Array(12);{let p=0;function h(e,t){u[p++]=e,u[p++]=t}h(-1,-1),h(1,-1),h(1,1),h(1,1),h(-1,1),h(-1,-1)}const c=e.createBuffer(),d=e.createVertexArray();return e.bindVertexArray(d),e.enableVertexAttribArray(n.vPositionScreen),e.bindBuffer(e.ARRAY_BUFFER,c),e.vertexAttribPointer(n.vPositionScreen,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,u,e.STATIC_DRAW),e.bindVertexArray(null),(t,o,n,u)=>{e.useProgram(r),e.uniformMatrix4fv(s,!1,t),e.uniform1f(l,o),e.uniform4fv(a,n),e.uniform4fv(i,u),e.bindVertexArray(d),e.drawArrays(e.TRIANGLES,0,6),e.bindVertexArray(null)}}(r),this.terrainTileSet=t,this.entityTileSet=o,this.fontTileSet=n;const a={vPosition:0,vTexcoord:1,vColor:2};function l(e,t,o){const n=255&e,r=e>>8&255,s=e>>16&255,a=e>>24&255,i=255&t,l=t>>8&255,u=t>>16&255,c=t>>24&255;return Math.max(0,Math.min(255,Math.trunc(n+(i-n)*o)))+(Math.max(0,Math.min(255,Math.trunc(r+(l-r)*o)))<<8)+(Math.max(0,Math.min(255,Math.trunc(s+(u-s)*o)))<<16)+(Math.max(0,Math.min(255,Math.trunc(a+(c-a)*o)))<<24)}const u=po(r,"#version 300 es\n            in vec2 vPosition;\n            in vec3 vTexcoord;\n            in vec4 vColor;\n\n            uniform mat4 uMatScreenFromWorld;\n\n            out highp vec3 fTexcoord;\n            out highp vec4 fColor;\n\n            void main() {\n                fTexcoord = vTexcoord;\n                fColor = vColor;\n                gl_Position = uMatScreenFromWorld * vec4(vPosition, 0, 1);\n            }\n        ","#version 300 es\n            in highp vec3 fTexcoord;\n            in highp vec4 fColor;\n\n            uniform highp sampler2DArray uOpacity;\n\n            out lowp vec4 fragColor;\n\n            void main() {\n                fragColor = fColor * texture(uOpacity, fTexcoord);\n            }\n        ",a),c=r.getUniformLocation(u,"uMatScreenFromWorld"),d=r.getUniformLocation(u,"uOpacity"),p=2*Float32Array.BYTES_PER_ELEMENT+2*Uint32Array.BYTES_PER_ELEMENT,h=p,m=new ArrayBuffer(256*p),f=new Float32Array(m),g=new Uint32Array(m),y=[1,1],x=r.createBuffer();let v=0;const S=i.create(),M=r.createVertexArray();r.bindVertexArray(M),r.enableVertexAttribArray(a.vPosition),r.enableVertexAttribArray(a.vTexcoord),r.enableVertexAttribArray(a.vColor),r.bindBuffer(r.ARRAY_BUFFER,x),r.vertexAttribPointer(a.vPosition,2,r.FLOAT,!1,p,0),r.vertexAttribPointer(a.vTexcoord,3,r.UNSIGNED_BYTE,!1,p,8),r.vertexAttribPointer(a.vColor,4,r.UNSIGNED_BYTE,!0,p,12),r.bufferData(r.ARRAY_BUFFER,m,r.DYNAMIC_DRAW);!function(e,t){const o=new Uint16Array(6*t);for(let e=0;e<t;++e){let t=6*e,n=4*e;o[t+0]=n+0,o[t+1]=n+1,o[t+2]=n+2,o[t+3]=n+2,o[t+4]=n+1,o[t+5]=n+3}const n=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW)}(r,64);r.bindVertexArray(null),this.start=(e,t)=>{i.copy(S,e),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D_ARRAY,s[t])},this.addGlyph=(e,t,o,n,r)=>{if(void 0===r.textureIndex)return;v>=64&&this.flush(),o=e+(o-e)*y[0],n=t+(n-t)*y[1];const s=r.color?r.color:4294967295,a=v*h,i=r.textureIndex<<16;f[a+0]=e,f[a+1]=t,g[a+2]=i+256,g[a+3]=s,f[a+4]=o,f[a+5]=t,g[a+6]=i+257,g[a+7]=s,f[a+8]=e,f[a+9]=n,g[a+10]=i,g[a+11]=s,f[a+12]=o,f[a+13]=n,g[a+14]=i+1,g[a+15]=s,++v},this.addGlyphLit=(e,t,o,n,r,s)=>{if(void 0===r.textureIndex)return;v>=64&&this.flush(),o=e+(o-e)*y[0],n=t+(n-t)*y[1];const a=r.color?r.color:4294967295,i=l(r.unlitColor?r.unlitColor:4283453520,a,s**.25),u=v*h,c=r.textureIndex<<16;f[u+0]=e,f[u+1]=t,g[u+2]=c+256,g[u+3]=i,f[u+4]=o,f[u+5]=t,g[u+6]=c+257,g[u+7]=i,f[u+8]=e,f[u+9]=n,g[u+10]=c,g[u+11]=i,f[u+12]=o,f[u+13]=n,g[u+14]=c+1,g[u+15]=i,++v},this.addGlyphLit4=(e,t,o,n,r,s)=>{if(void 0===r.textureIndex)return;v>=64&&this.flush();const a=r.color?r.color:4294967295,i=r.unlitColor?r.unlitColor:4283453520;function u(e){return l(i,a,e**.25)}o=e+(o-e)*y[0],n=t+(n-t)*y[1];const c=v*h,d=r.textureIndex<<16;f[c+0]=e,f[c+1]=t,g[c+2]=d+256,g[c+3]=u(s[0]),f[c+4]=o,f[c+5]=t,g[c+6]=d+257,g[c+7]=u(s[1]),f[c+8]=e,f[c+9]=n,g[c+10]=d,g[c+11]=u(s[2]),f[c+12]=o,f[c+13]=n,g[c+14]=d+1,g[c+15]=u(s[3]),++v},this.flush=()=>{v<=0||(r.useProgram(u),r.bindVertexArray(M),r.uniform1i(d,0),r.uniformMatrix4fv(c,!1,S),r.bindBuffer(r.ARRAY_BUFFER,x),r.bufferSubData(r.ARRAY_BUFFER,0,f,0),r.drawElements(r.TRIANGLES,6*v,r.UNSIGNED_SHORT,0),r.bindVertexArray(null),v=0)},this.beginFrame=e=>{r.viewport(0,0,e[0],e[1]),r.clear(r.COLOR_BUFFER_BIT)},r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND),r.clearColor(0,0,0,1)}}function co(e,t,o){const n=e.createShader(t);return e.shaderSource(n,o),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(n)),e.deleteShader(n)),n}function po(e,t,o,n){const r=co(e,e.VERTEX_SHADER,t),s=co(e,e.FRAGMENT_SHADER,o),a=e.createProgram();e.attachShader(a,r),e.attachShader(a,s);for(const t in n)e.bindAttribLocation(a,n[t],t);return e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||alert("Unable to initialize the shader program: "+e.getProgramInfoLog(a)),a}const ho=4278190248,mo=4289243304,fo=4287660160,go=4285550672,yo=4284497984,xo=4283760212,vo=4294901332,So=4283716862,Mo=4283760382,_o=4291886846,To=4294967295;var wo;wo=new URL(s("27Lyk").resolve("ilsm8"),import.meta.url).toString();var Lo;Lo=new URL(s("27Lyk").resolve("1e9sp"),import.meta.url).toString();var Ao;let bo;var Ro;function ko(){return Uo}function Co(){return No}function Io(){return Ho}function Po(e){return 16*e[1]+e[0]}Ao=new URL(s("27Lyk").resolve("kDrfW"),import.meta.url).toString(),(Ro=bo||(bo={}))[Ro.Font=0]="Font",Ro[Ro.Terrain=1]="Terrain",Ro[Ro.Entity=2]="Entity";const Ho={name:"Basic Font",imageSrc:Ao,image:new Image,tileSize:[16,16],offset:[0,0],letterMap:[],background:{textureIndex:219,color:4279242768},heart:{textureIndex:3},air:{textureIndex:9}},Eo=4290816682,Do=4291887103,Wo=4285876810,Fo=4291884031,Go=4290962414,Vo=4290023568,Uo={name:"31 Color Terrain Tileset",imageSrc:Lo,image:new Image,tileSize:[16,16],cellSize:[16,16],tileRatios:[1,1],offset:[0,0],flattenTexture:!0,terrainTiles:[{textureIndex:Po([4,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([8,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([10,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([2,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([11,14]),color:Go,unlitColor:Wo},{textureIndex:Po([11,15]),color:Go,unlitColor:Wo},{textureIndex:Po([4,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([4,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([4,0]),color:Do,unlitColor:Eo},{textureIndex:Po([4,0]),color:Do,unlitColor:Eo},{textureIndex:Po([4,0]),color:Do,unlitColor:Eo},{textureIndex:Po([6,0]),color:Do,unlitColor:Eo},{textureIndex:Po([4,0]),color:Do,unlitColor:Eo},{textureIndex:Po([9,0]),color:Do,unlitColor:Eo},{textureIndex:Po([8,0]),color:Do,unlitColor:Eo},{textureIndex:Po([12,0]),color:Do,unlitColor:Eo},{textureIndex:Po([4,0]),color:Do,unlitColor:Eo},{textureIndex:Po([10,0]),color:Do,unlitColor:Eo},{textureIndex:Po([7,0]),color:Do,unlitColor:Eo},{textureIndex:Po([14,0]),color:Do,unlitColor:Eo},{textureIndex:Po([5,0]),color:Do,unlitColor:Eo},{textureIndex:Po([13,0]),color:Do,unlitColor:Eo},{textureIndex:Po([11,0]),color:Do,unlitColor:Eo},{textureIndex:Po([15,0]),color:Do,unlitColor:Eo},{textureIndex:Po([0,1]),color:Do,unlitColor:Eo},{textureIndex:Po([2,1]),color:Do,unlitColor:Eo},{textureIndex:Po([3,1]),color:Do,unlitColor:Eo},{textureIndex:Po([1,1]),color:Do,unlitColor:Eo},{textureIndex:Po([13,1]),color:Do,unlitColor:Eo},{textureIndex:Po([11,1]),color:Do,unlitColor:Eo},{textureIndex:Po([8,1]),color:Do,unlitColor:Eo},{textureIndex:Po([5,1]),color:Do,unlitColor:Eo},{textureIndex:Po([8,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([8,14]),color:Fo,unlitColor:Wo}],redWallTerrainTiles:[{textureIndex:Po([4,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([8,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([10,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([2,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([10,14]),color:Go,unlitColor:Wo},{textureIndex:Po([10,15]),color:Go,unlitColor:Wo},{textureIndex:Po([4,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([4,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([4,2]),color:Do,unlitColor:Eo},{textureIndex:Po([4,2]),color:Do,unlitColor:Eo},{textureIndex:Po([4,2]),color:Do,unlitColor:Eo},{textureIndex:Po([6,2]),color:Do,unlitColor:Eo},{textureIndex:Po([4,2]),color:Do,unlitColor:Eo},{textureIndex:Po([9,2]),color:Do,unlitColor:Eo},{textureIndex:Po([8,2]),color:Do,unlitColor:Eo},{textureIndex:Po([12,2]),color:Do,unlitColor:Eo},{textureIndex:Po([4,2]),color:Do,unlitColor:Eo},{textureIndex:Po([10,2]),color:Do,unlitColor:Eo},{textureIndex:Po([7,2]),color:Do,unlitColor:Eo},{textureIndex:Po([14,2]),color:Do,unlitColor:Eo},{textureIndex:Po([5,2]),color:Do,unlitColor:Eo},{textureIndex:Po([13,2]),color:Do,unlitColor:Eo},{textureIndex:Po([11,2]),color:Do,unlitColor:Eo},{textureIndex:Po([15,2]),color:Do,unlitColor:Eo},{textureIndex:Po([0,3]),color:Do,unlitColor:Eo},{textureIndex:Po([2,3]),color:Do,unlitColor:Eo},{textureIndex:Po([3,3]),color:Do,unlitColor:Eo},{textureIndex:Po([1,3]),color:Do,unlitColor:Eo},{textureIndex:Po([13,3]),color:Do,unlitColor:Eo},{textureIndex:Po([11,3]),color:Do,unlitColor:Eo},{textureIndex:Po([8,3]),color:Do,unlitColor:Eo},{textureIndex:Po([5,3]),color:Do,unlitColor:Eo},{textureIndex:Po([8,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([8,14]),color:Fo,unlitColor:Wo}],manseTerrainTiles:[{textureIndex:Po([5,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([9,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([10,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([0,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([7,14]),color:Go,unlitColor:Wo},{textureIndex:Po([7,15]),color:Go,unlitColor:Wo},{textureIndex:Po([4,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([3,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([4,4]),color:Do,unlitColor:Eo},{textureIndex:Po([4,4]),color:Do,unlitColor:Eo},{textureIndex:Po([4,4]),color:Do,unlitColor:Eo},{textureIndex:Po([6,4]),color:Do,unlitColor:Eo},{textureIndex:Po([4,4]),color:Do,unlitColor:Eo},{textureIndex:Po([9,4]),color:Do,unlitColor:Eo},{textureIndex:Po([8,4]),color:Do,unlitColor:Eo},{textureIndex:Po([12,4]),color:Do,unlitColor:Eo},{textureIndex:Po([4,4]),color:Do,unlitColor:Eo},{textureIndex:Po([10,4]),color:Do,unlitColor:Eo},{textureIndex:Po([7,4]),color:Do,unlitColor:Eo},{textureIndex:Po([14,4]),color:Do,unlitColor:Eo},{textureIndex:Po([5,4]),color:Do,unlitColor:Eo},{textureIndex:Po([13,4]),color:Do,unlitColor:Eo},{textureIndex:Po([11,4]),color:Do,unlitColor:Eo},{textureIndex:Po([15,4]),color:Do,unlitColor:Eo},{textureIndex:Po([0,5]),color:Do,unlitColor:Eo},{textureIndex:Po([2,5]),color:Do,unlitColor:Eo},{textureIndex:Po([3,5]),color:Do,unlitColor:Eo},{textureIndex:Po([1,5]),color:Do,unlitColor:Eo},{textureIndex:Po([13,5]),color:Do,unlitColor:Eo},{textureIndex:Po([11,5]),color:Do,unlitColor:Eo},{textureIndex:Po([8,5]),color:Do,unlitColor:Eo},{textureIndex:Po([5,5]),color:Do,unlitColor:Eo},{textureIndex:Po([9,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([9,15]),color:Fo,unlitColor:Wo}],fortressTerrainTiles:[{textureIndex:Po([5,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([8,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([10,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([0,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([6,14]),color:Go,unlitColor:Wo},{textureIndex:Po([6,15]),color:Go,unlitColor:Wo},{textureIndex:Po([5,14]),color:Fo,unlitColor:Wo},{textureIndex:Po([3,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([4,6]),color:Do,unlitColor:Eo},{textureIndex:Po([4,6]),color:Do,unlitColor:Eo},{textureIndex:Po([4,6]),color:Do,unlitColor:Eo},{textureIndex:Po([6,6]),color:Do,unlitColor:Eo},{textureIndex:Po([4,6]),color:Do,unlitColor:Eo},{textureIndex:Po([9,6]),color:Do,unlitColor:Eo},{textureIndex:Po([8,6]),color:Do,unlitColor:Eo},{textureIndex:Po([12,6]),color:Do,unlitColor:Eo},{textureIndex:Po([4,6]),color:Do,unlitColor:Eo},{textureIndex:Po([10,6]),color:Do,unlitColor:Eo},{textureIndex:Po([7,6]),color:Do,unlitColor:Eo},{textureIndex:Po([14,6]),color:Do,unlitColor:Eo},{textureIndex:Po([5,6]),color:Do,unlitColor:Eo},{textureIndex:Po([13,6]),color:Do,unlitColor:Eo},{textureIndex:Po([11,6]),color:Do,unlitColor:Eo},{textureIndex:Po([15,6]),color:Do,unlitColor:Eo},{textureIndex:Po([0,7]),color:Do,unlitColor:Eo},{textureIndex:Po([2,7]),color:Do,unlitColor:Eo},{textureIndex:Po([3,7]),color:Do,unlitColor:Eo},{textureIndex:Po([1,7]),color:Do,unlitColor:Eo},{textureIndex:Po([13,7]),color:Do,unlitColor:Eo},{textureIndex:Po([11,7]),color:Do,unlitColor:Eo},{textureIndex:Po([8,7]),color:Do,unlitColor:Eo},{textureIndex:Po([5,7]),color:Do,unlitColor:Eo},{textureIndex:Po([8,15]),color:Fo,unlitColor:Wo},{textureIndex:Po([8,15]),color:Fo,unlitColor:Wo}],ledgeTiles:[{textureIndex:Po([0,11]),color:4285753415,unlitColor:4282922024},{textureIndex:Po([1,11]),color:4285753415,unlitColor:4282922024},{textureIndex:Po([2,11]),color:4285753415,unlitColor:4282922024},{textureIndex:Po([3,11]),color:4285753415,unlitColor:4282922024}],waterAnimation:[{textureIndex:128,color:_o,unlitColor:fo},{textureIndex:129,color:_o,unlitColor:fo},{textureIndex:130,color:_o,unlitColor:fo},{textureIndex:131,color:_o,unlitColor:fo}],manseWaterAnimation:[{textureIndex:144,color:_o,unlitColor:fo},{textureIndex:145,color:_o,unlitColor:fo},{textureIndex:146,color:_o,unlitColor:fo},{textureIndex:147,color:_o,unlitColor:fo}],fortressWaterAnimation:[{textureIndex:160,color:fo,unlitColor:yo},{textureIndex:161,color:fo,unlitColor:yo},{textureIndex:162,color:fo,unlitColor:yo},{textureIndex:163,color:fo,unlitColor:yo}]},No={name:"31 Color Entity Tileset",imageSrc:wo,image:new Image,tileSize:[16,16],cellSize:[16,16],tileRatios:[1,1],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:Po([0,0])},namedTiles:{pickTarget:{textureIndex:188,color:4294967295},noise:{textureIndex:187,color:2164260863},crossHatch:{textureIndex:3,color:4294967295},patrolRoute:{textureIndex:31,color:4286644096},speechBubbleR:{textureIndex:183,color:4294967295},speechBubbleL:{textureIndex:184,color:4294967295},idleIndicator:{textureIndex:188,color:4294967295},playerHint:{textureIndex:185,color:4294967295},uiWindowTile:{textureIndex:32,color:4294967295},uiCreakyTile:{textureIndex:33,color:4294967295}},touchButtons:{menu:{textureIndex:Po([11,1]),color:2701131775,unlitColor:822083583},up:{textureIndex:Po([2,1]),color:2701131775,unlitColor:822083583},down:{textureIndex:Po([3,1]),color:2701131775,unlitColor:822083583},left:{textureIndex:Po([0,1]),color:2701131775,unlitColor:822083583},right:{textureIndex:Po([1,1]),color:2701131775,unlitColor:822083583},wait:{textureIndex:Po([4,1]),color:2701131775,unlitColor:822083583},jump:{textureIndex:Po([5,1]),color:2701131775,unlitColor:822083583},bang:{textureIndex:Po([13,1]),color:2701131775,unlitColor:822083583},menuAccept:{textureIndex:Po([4,1]),color:2701131775,unlitColor:822083583},zoomOut:{textureIndex:Po([6,1]),color:2701131775,unlitColor:822083583},zoomIn:{textureIndex:Po([7,1]),color:2701131775,unlitColor:822083583},heal:{textureIndex:Po([8,1]),color:2701131775,unlitColor:822083583},startLevel:{textureIndex:Po([9,1]),color:2701131775,unlitColor:822083583},nextLevel:{textureIndex:Po([9,1]),color:2701131775,unlitColor:822083583},forceRestart:{textureIndex:Po([10,1]),color:2701131775,unlitColor:822083583},fullscreen:{textureIndex:Po([14,1]),color:2701131775,unlitColor:822083583}},itemTiles:[{textureIndex:Po([3,13]),color:To,unlitColor:Vo},{textureIndex:Po([4,13]),color:To,unlitColor:Vo},{textureIndex:Po([7,14]),color:To,unlitColor:Vo},{textureIndex:Po([8,14]),color:To,unlitColor:Vo},{textureIndex:Po([10,14]),color:To,unlitColor:Vo},{textureIndex:Po([9,14]),color:To,unlitColor:Vo},{textureIndex:Po([7,12]),color:To,unlitColor:Vo},{textureIndex:Po([5,12]),color:To,unlitColor:Vo},{textureIndex:Po([14,14]),color:To,unlitColor:Vo},{textureIndex:Po([6,15]),color:To,unlitColor:Vo},{textureIndex:Po([5,13]),color:To,unlitColor:To},{textureIndex:Po([15,11]),color:To,unlitColor:To},{textureIndex:Po([2,4]),color:Do,unlitColor:Eo},{textureIndex:Po([0,4]),color:Do,unlitColor:Eo},{textureIndex:Po([3,4]),color:Do,unlitColor:Eo},{textureIndex:Po([1,4]),color:Do,unlitColor:Eo},{textureIndex:Po([6,4]),color:Do,unlitColor:Eo},{textureIndex:Po([4,4]),color:Do,unlitColor:Eo},{textureIndex:Po([0,13]),color:To,unlitColor:To},{textureIndex:Po([1,13]),color:To,unlitColor:To},{textureIndex:Po([15,13]),color:_o,unlitColor:_o},{textureIndex:Po([0,15]),color:To,unlitColor:To},{textureIndex:Po([6,13]),color:To,unlitColor:To},{textureIndex:Po([1,15]),color:To,unlitColor:To},{textureIndex:Po([15,7]),color:To,unlitColor:Vo},{textureIndex:Po([8,13]),color:To,unlitColor:Vo},{textureIndex:Po([7,13]),color:To,unlitColor:Vo},{textureIndex:Po([0,12]),color:To,unlitColor:To}],redWallItemTiles:[{textureIndex:Po([3,13]),color:To,unlitColor:Vo},{textureIndex:Po([4,13]),color:To,unlitColor:Vo},{textureIndex:Po([7,14]),color:To,unlitColor:Vo},{textureIndex:Po([8,14]),color:To,unlitColor:Vo},{textureIndex:Po([10,14]),color:To,unlitColor:Vo},{textureIndex:Po([9,14]),color:To,unlitColor:Vo},{textureIndex:Po([7,12]),color:To,unlitColor:Vo},{textureIndex:Po([5,12]),color:To,unlitColor:Vo},{textureIndex:Po([14,14]),color:To,unlitColor:Vo},{textureIndex:Po([6,15]),color:To,unlitColor:Vo},{textureIndex:Po([5,13]),color:To,unlitColor:To},{textureIndex:Po([15,11]),color:To,unlitColor:To},{textureIndex:Po([2,5]),color:Do,unlitColor:Eo},{textureIndex:Po([0,5]),color:Do,unlitColor:Eo},{textureIndex:Po([3,5]),color:Do,unlitColor:Eo},{textureIndex:Po([1,5]),color:Do,unlitColor:Eo},{textureIndex:Po([6,5]),color:Do,unlitColor:Eo},{textureIndex:Po([4,5]),color:Do,unlitColor:Eo},{textureIndex:Po([0,13]),color:To,unlitColor:To},{textureIndex:Po([1,13]),color:To,unlitColor:To},{textureIndex:Po([15,13]),color:_o,unlitColor:_o},{textureIndex:Po([0,15]),color:To,unlitColor:To},{textureIndex:Po([6,13]),color:To,unlitColor:To},{textureIndex:Po([1,15]),color:To,unlitColor:To},{textureIndex:Po([15,7]),color:To,unlitColor:Vo},{textureIndex:Po([8,13]),color:To,unlitColor:Vo},{textureIndex:Po([7,13]),color:To,unlitColor:Vo},{textureIndex:Po([0,12]),color:To,unlitColor:To}],manseItemTiles:[{textureIndex:Po([3,13]),color:To,unlitColor:Vo},{textureIndex:Po([4,13]),color:To,unlitColor:Vo},{textureIndex:Po([7,14]),color:To,unlitColor:Vo},{textureIndex:Po([8,14]),color:To,unlitColor:Vo},{textureIndex:Po([10,14]),color:To,unlitColor:Vo},{textureIndex:Po([9,14]),color:To,unlitColor:Vo},{textureIndex:Po([7,12]),color:To,unlitColor:Vo},{textureIndex:Po([5,12]),color:To,unlitColor:Vo},{textureIndex:Po([14,14]),color:To,unlitColor:Vo},{textureIndex:Po([7,15]),color:To,unlitColor:Vo},{textureIndex:Po([5,13]),color:To,unlitColor:To},{textureIndex:Po([15,11]),color:To,unlitColor:To},{textureIndex:Po([2,6]),color:Do,unlitColor:Eo},{textureIndex:Po([0,6]),color:Do,unlitColor:Eo},{textureIndex:Po([3,6]),color:Do,unlitColor:Eo},{textureIndex:Po([1,6]),color:Do,unlitColor:Eo},{textureIndex:Po([6,6]),color:Do,unlitColor:Eo},{textureIndex:Po([4,6]),color:Do,unlitColor:Eo},{textureIndex:Po([0,13]),color:To,unlitColor:To},{textureIndex:Po([1,13]),color:To,unlitColor:To},{textureIndex:Po([15,13]),color:_o,unlitColor:_o},{textureIndex:Po([0,15]),color:To,unlitColor:To},{textureIndex:Po([6,13]),color:To,unlitColor:To},{textureIndex:Po([1,15]),color:To,unlitColor:To},{textureIndex:Po([15,7]),color:To,unlitColor:Vo},{textureIndex:Po([8,13]),color:To,unlitColor:Vo},{textureIndex:Po([7,13]),color:To,unlitColor:Vo},{textureIndex:Po([0,12]),color:To,unlitColor:To}],fortressItemTiles:[{textureIndex:Po([3,13]),color:To,unlitColor:Vo},{textureIndex:Po([4,13]),color:To,unlitColor:Vo},{textureIndex:Po([7,14]),color:To,unlitColor:Vo},{textureIndex:Po([8,14]),color:To,unlitColor:Vo},{textureIndex:Po([10,14]),color:To,unlitColor:Vo},{textureIndex:Po([9,14]),color:To,unlitColor:Vo},{textureIndex:Po([7,12]),color:To,unlitColor:Vo},{textureIndex:Po([5,12]),color:To,unlitColor:Vo},{textureIndex:Po([14,14]),color:To,unlitColor:Vo},{textureIndex:Po([8,15]),color:To,unlitColor:Vo},{textureIndex:Po([5,13]),color:To,unlitColor:To},{textureIndex:Po([15,11]),color:To,unlitColor:To},{textureIndex:Po([2,7]),color:Do,unlitColor:Eo},{textureIndex:Po([0,7]),color:Do,unlitColor:Eo},{textureIndex:Po([3,7]),color:Do,unlitColor:Eo},{textureIndex:Po([1,7]),color:Do,unlitColor:Eo},{textureIndex:Po([6,7]),color:Do,unlitColor:Eo},{textureIndex:Po([4,7]),color:Do,unlitColor:Eo},{textureIndex:Po([0,13]),color:To,unlitColor:To},{textureIndex:Po([1,13]),color:To,unlitColor:To},{textureIndex:Po([12,13]),color:_o,unlitColor:_o},{textureIndex:Po([0,15]),color:To,unlitColor:To},{textureIndex:Po([6,13]),color:To,unlitColor:To},{textureIndex:Po([1,15]),color:To,unlitColor:To},{textureIndex:Po([15,7]),color:To,unlitColor:Vo},{textureIndex:Po([8,13]),color:To,unlitColor:Vo},{textureIndex:Po([7,13]),color:To,unlitColor:Vo},{textureIndex:Po([0,12]),color:To,unlitColor:To}],npcTiles:[{textureIndex:Po([9,8]),color:To,unlitColor:go},{textureIndex:Po([8,8]),color:To,unlitColor:go},{textureIndex:Po([10,8]),color:To,unlitColor:go},{textureIndex:Po([7,8]),color:To,unlitColor:go},{textureIndex:Po([9,8]),color:go},{textureIndex:Po([8,8]),color:go},{textureIndex:Po([10,8]),color:go},{textureIndex:Po([7,8]),color:go},{textureIndex:Po([9,8]),color:To,unlitColor:go},{textureIndex:Po([8,8]),color:To,unlitColor:go},{textureIndex:Po([10,8]),color:To,unlitColor:go},{textureIndex:Po([7,8]),color:To,unlitColor:go},{textureIndex:Po([6,8]),color:To,unlitColor:go},{textureIndex:Po([6,8]),color:To,unlitColor:go},{textureIndex:Po([6,8]),color:To,unlitColor:go},{textureIndex:Po([6,8]),color:To,unlitColor:go}],playerTiles:{normal:{textureIndex:Po([1,8]),color:To,unlitColor:mo},hidden:{textureIndex:Po([0,8]),color:To,unlitColor:mo},right:{textureIndex:Po([2,8]),color:To,unlitColor:mo},left:{textureIndex:Po([3,8]),color:To,unlitColor:mo},down:{textureIndex:Po([1,8]),color:To,unlitColor:mo},up:{textureIndex:Po([4,8]),color:To,unlitColor:mo},dead:{textureIndex:Po([5,8]),color:To,unlitColor:mo},litFace:{textureIndex:176,color:4294967295}},guardStateTiles:[{textureIndex:Po([0,11])},{textureIndex:Po([1,11])},{textureIndex:Po([2,11])},{textureIndex:Po([3,11])},{textureIndex:Po([4,11])}],stoveAnimation:[{textureIndex:238,color:To,unlitColor:fo},{textureIndex:239,color:To,unlitColor:fo}],candleAnimation:[{textureIndex:224,color:_o,unlitColor:fo},{textureIndex:225,color:_o,unlitColor:fo},{textureIndex:226,color:_o,unlitColor:fo},{textureIndex:227,color:_o,unlitColor:fo},{textureIndex:208,color:_o,unlitColor:fo}],torchAnimation:[{textureIndex:220},{textureIndex:221},{textureIndex:222},{textureIndex:223},{textureIndex:223}],treasureGateAnimation:[{textureIndex:216},{textureIndex:200},{textureIndex:201},{textureIndex:202},{textureIndex:203}],playerTorchAnimation:[{textureIndex:217},{textureIndex:218},{textureIndex:219},{textureIndex:219}],achievementIcons:{achievementVictory:{textureIndex:75},achievementGhosty:{textureIndex:110},achievementZippy:{textureIndex:77},achievementHungry:{textureIndex:78},achievementThumpy:{textureIndex:79},achievementSofty:{textureIndex:91},achievementSteppy:{textureIndex:94},achievementHealthy:{textureIndex:107},achievementTreasure:{textureIndex:108},achievementMapping:{textureIndex:109},achievementFaceless:{textureIndex:76}},achievementIncompleteIcon:{textureIndex:63},achievementFailedIcon:{textureIndex:0}};var Oo,Bo;
/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var o=this||t;if(e=parseFloat(e),o.ctx||c(),void 0!==e&&e>=0&&e<=1){if(o._volume=e,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var n=0;n<o._howls.length;n++)if(!o._howls[n]._webAudio)for(var r=o._howls[n]._getSoundIds(),s=0;s<r.length;s++){var a=o._howls[n]._soundById(r[s]);a&&a._node&&(a._node.volume=a._volume*e)}return o}return o._volume},mute:function(e){var o=this||t;o.ctx||c(),o._muted=e,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e?0:o._volume,t.ctx.currentTime);for(var n=0;n<o._howls.length;n++)if(!o._howls[n]._webAudio)for(var r=o._howls[n]._getSoundIds(),s=0;s<r.length;s++){var a=o._howls[n]._soundById(r[s]);a&&a._node&&(a._node.muted=!!e||a._muted)}return o},stop:function(){for(var e=this||t,o=0;o<e._howls.length;o++)e._howls[o].stop();return e},unload:function(){for(var e=this||t,o=e._howls.length-1;o>=0;o--)e._howls[o].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,o=null;try{o="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!o||"function"!=typeof o.canPlayType)return e;var n=o.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator?e._navigator.userAgent:"",s=r.match(/OPR\/([0-6].)/g),a=s&&parseInt(s[0].split("/")[1],10)<33,i=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),l=r.match(/Version\/(.*?) /),u=i&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(a||!n&&!o.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(u||!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(u||!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var o=function(t){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(t){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var s=e._howls[r]._getSoundIds(),a=0;a<s.length;a++){var i=e._howls[r]._soundById(s[a]);i&&i._node&&!i._node._unlocked&&(i._node._unlocked=!0,i._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",o,!0);for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var o=(new Audio).play();return o&&"undefined"!=typeof Promise&&(o instanceof Promise||"function"==typeof o.then)&&o.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var o=this||t;return e._unlocked&&o._html5AudioPool.push(e),o},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&t.usingWebAudio){for(var o=0;o<e._howls.length;o++)if(e._howls[o]._webAudio)for(var n=0;n<e._howls[o]._sounds.length;n++)if(!e._howls[o]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,n=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var o=this;return t.ctx||c(),o._autoplay=e.autoplay||!1,o._format="string"!=typeof e.format?e.format:[e.format],o._html5=e.html5||!1,o._muted=e.mute||!1,o._loop=e.loop||!1,o._pool=e.pool||5,o._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,o._rate=e.rate||1,o._sprite=e.sprite||{},o._src="string"!=typeof e.src?e.src:[e.src],o._volume=void 0!==e.volume?e.volume:1,o._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=e.onend?[{fn:e.onend}]:[],o._onfade=e.onfade?[{fn:e.onfade}]:[],o._onload=e.onload?[{fn:e.onload}]:[],o._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],o._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],o._onpause=e.onpause?[{fn:e.onpause}]:[],o._onplay=e.onplay?[{fn:e.onplay}]:[],o._onstop=e.onstop?[{fn:e.onstop}]:[],o._onmute=e.onmute?[{fn:e.onmute}]:[],o._onvolume=e.onvolume?[{fn:e.onvolume}]:[],o._onrate=e.onrate?[{fn:e.onrate}]:[],o._onseek=e.onseek?[{fn:e.onseek}]:[],o._onunlock=e.onunlock?[{fn:e.onunlock}]:[],o._onresume=[],o._webAudio=t.usingWebAudio&&!o._html5,void 0!==t.ctx&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&"none"!==o._preload&&o.load(),o},load:function(){var e=this,o=null;if(t.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var s,i;if(e._format&&e._format[n])s=e._format[n];else{if("string"!=typeof(i=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(s=/^data:audio\/([^;,]+);/i.exec(i))||(s=/\.([^.]+)$/.exec(i.split("?",1)[0])),s&&(s=s[1].toLowerCase())}if(s||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),s&&t.codecs(s)){o=e._src[n];break}}if(o)return e._src=o,e._state="loading","https:"===window.location.protocol&&"http:"===o.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new r(e),e._webAudio&&a(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,o){var n=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var s=0,a=0;a<n._sounds.length;a++)n._sounds[a]._paused&&!n._sounds[a]._ended&&(s++,r=n._sounds[a]._id);1===s?e=null:r=null}}var i=r?n._soundById(r):n._inactiveSound();if(!i)return null;if(r&&!e&&(e=i._sprite||"__default"),"loaded"!==n._state){i._sprite=e,i._ended=!1;var l=i._id;return n._queue.push({event:"play",action:function(){n.play(l)}}),l}if(r&&!i._paused)return o||n._loadQueue("play"),i._id;n._webAudio&&t._autoResume();var u=Math.max(0,i._seek>0?i._seek:n._sprite[e][0]/1e3),c=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-u),d=1e3*c/Math.abs(i._rate),p=n._sprite[e][0]/1e3,h=(n._sprite[e][0]+n._sprite[e][1])/1e3;i._sprite=e,i._ended=!1;var m=function(){i._paused=!1,i._seek=u,i._start=p,i._stop=h,i._loop=!(!i._loop&&!n._sprite[e][2])};if(!(u>=h)){var f=i._node;if(n._webAudio){var g=function(){n._playLock=!1,m(),n._refreshBuffer(i);var e=i._muted||n._muted?0:i._volume;f.gain.setValueAtTime(e,t.ctx.currentTime),i._playStart=t.ctx.currentTime,void 0===f.bufferSource.start?i._loop?f.bufferSource.noteGrainOn(0,u,86400):f.bufferSource.noteGrainOn(0,u,c):i._loop?f.bufferSource.start(0,u,86400):f.bufferSource.start(0,u,c),d!==1/0&&(n._endTimers[i._id]=setTimeout(n._ended.bind(n,i),d)),o||setTimeout((function(){n._emit("play",i._id),n._loadQueue()}),0)};"running"===t.state&&"interrupted"!==t.ctx.state?g():(n._playLock=!0,n.once("resume",g),n._clearTimer(i._id))}else{var y=function(){f.currentTime=u,f.muted=i._muted||n._muted||t._muted||f.muted,f.volume=i._volume*t.volume(),f.playbackRate=i._rate;try{var r=f.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,m(),r.then((function(){n._playLock=!1,f._unlocked=!0,o?n._loadQueue():n._emit("play",i._id)})).catch((function(){n._playLock=!1,n._emit("playerror",i._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),i._ended=!0,i._paused=!0}))):o||(n._playLock=!1,m(),n._emit("play",i._id)),f.playbackRate=i._rate,f.paused)return void n._emit("playerror",i._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||i._loop?n._endTimers[i._id]=setTimeout(n._ended.bind(n,i),d):(n._endTimers[i._id]=function(){n._ended(i),f.removeEventListener("ended",n._endTimers[i._id],!1)},f.addEventListener("ended",n._endTimers[i._id],!1))}catch(e){n._emit("playerror",i._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===f.src&&(f.src=n._src,f.load());var x=window&&window.ejecta||!f.readyState&&t._navigator.isCocoonJS;if(f.readyState>=3||x)y();else{n._playLock=!0,n._state="loading";var v=function(){n._state="loaded",y(),f.removeEventListener(t._canPlayEvent,v,!1)};f.addEventListener(t._canPlayEvent,v,!1),n._clearTimer(i._id)}}return i._id}n._ended(i)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var o=t._getSoundIds(e),n=0;n<o.length;n++){t._clearTimer(o[n]);var r=t._soundById(o[n]);if(r&&!r._paused&&(r._seek=t.seek(o[n]),r._rateSeek=0,r._paused=!0,t._stopFade(o[n]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"stop",action:function(){o.stop(e)}}),o;for(var n=o._getSoundIds(e),r=0;r<n.length;r++){o._clearTimer(n[r]);var s=o._soundById(n[r]);s&&(s._seek=s._start||0,s._rateSeek=0,s._paused=!0,s._ended=!0,o._stopFade(n[r]),s._node&&(o._webAudio?s._node.bufferSource&&(void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),o._cleanBuffer(s._node)):isNaN(s._node.duration)&&s._node.duration!==1/0||(s._node.currentTime=s._start||0,s._node.pause(),s._node.duration===1/0&&o._clearSound(s._node))),t||o._emit("stop",s._id))}return o},mute:function(e,o){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,o)}}),n;if(void 0===o){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var r=n._getSoundIds(o),s=0;s<r.length;s++){var a=n._soundById(r[s]);a&&(a._muted=e,a._interval&&n._stopFade(a._id),n._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,t.ctx.currentTime):a._node&&(a._node.muted=!!t._muted||e),n._emit("mute",a._id))}return n},volume:function(){var e,o,n,r=this,s=arguments;if(0===s.length)return r._volume;if(1===s.length||2===s.length&&void 0===s[1]?r._getSoundIds().indexOf(s[0])>=0?o=parseInt(s[0],10):e=parseFloat(s[0]):s.length>=2&&(e=parseFloat(s[0]),o=parseInt(s[1],10)),!(void 0!==e&&e>=0&&e<=1))return(n=o?r._soundById(o):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,s)}}),r;void 0===o&&(r._volume=e),o=r._getSoundIds(o);for(var a=0;a<o.length;a++)(n=r._soundById(o[a]))&&(n._volume=e,s[2]||r._stopFade(o[a]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,t.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*t.volume()),r._emit("volume",n._id));return r},fade:function(e,o,n,r){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"fade",action:function(){s.fade(e,o,n,r)}}),s;e=Math.min(Math.max(0,parseFloat(e)),1),o=Math.min(Math.max(0,parseFloat(o)),1),n=parseFloat(n),s.volume(e,r);for(var a=s._getSoundIds(r),i=0;i<a.length;i++){var l=s._soundById(a[i]);if(l){if(r||s._stopFade(a[i]),s._webAudio&&!l._muted){var u=t.ctx.currentTime,c=u+n/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(o,c)}s._startFadeInterval(l,e,o,n,a[i],void 0===r)}}return s},_startFadeInterval:function(e,t,o,n,r,s){var a=this,i=t,l=o-t,u=Math.abs(l/.01),c=Math.max(4,u>0?n/u:n),d=Date.now();e._fadeTo=o,e._interval=setInterval((function(){var r=(Date.now()-d)/n;d=Date.now(),i+=l*r,i=Math.round(100*i)/100,i=l<0?Math.max(o,i):Math.min(o,i),a._webAudio?e._volume=i:a.volume(i,e._id,!0),s&&(a._volume=i),(o<t&&i<=o||o>t&&i>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(o,e._id),a._emit("fade",e._id))}),c)},_stopFade:function(e){var o=this,n=o._soundById(e);return n&&n._interval&&(o._webAudio&&n._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(n._interval),n._interval=null,o.volume(n._fadeTo,e),n._fadeTo=null,o._emit("fade",e)),o},loop:function(){var e,t,o,n=this,r=arguments;if(0===r.length)return n._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(o=n._soundById(parseInt(r[0],10)))&&o._loop;e=r[0],n._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var s=n._getSoundIds(t),a=0;a<s.length;a++)(o=n._soundById(s[a]))&&(o._loop=e,n._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=e,e&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,n.playing(s[a])&&(n.pause(s[a],!0),n.play(s[a],!0)))));return n},rate:function(){var e,o,n,r=this,s=arguments;if(0===s.length)o=r._sounds[0]._id;else if(1===s.length){r._getSoundIds().indexOf(s[0])>=0?o=parseInt(s[0],10):e=parseFloat(s[0])}else 2===s.length&&(e=parseFloat(s[0]),o=parseInt(s[1],10));if("number"!=typeof e)return(n=r._soundById(o))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,s)}}),r;void 0===o&&(r._rate=e),o=r._getSoundIds(o);for(var a=0;a<o.length;a++)if(n=r._soundById(o[a])){r.playing(o[a])&&(n._rateSeek=r.seek(o[a]),n._playStart=r._webAudio?t.ctx.currentTime:n._playStart),n._rate=e,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,t.ctx.currentTime):n._node&&(n._node.playbackRate=e);var i=r.seek(o[a]),l=1e3*((r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-i)/Math.abs(n._rate);!r._endTimers[o[a]]&&n._paused||(r._clearTimer(o[a]),r._endTimers[o[a]]=setTimeout(r._ended.bind(r,n),l)),r._emit("rate",n._id)}return r},seek:function(){var e,o,n=this,r=arguments;if(0===r.length)n._sounds.length&&(o=n._sounds[0]._id);else if(1===r.length){n._getSoundIds().indexOf(r[0])>=0?o=parseInt(r[0],10):n._sounds.length&&(o=n._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),o=parseInt(r[1],10));if(void 0===o)return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var s=n._soundById(o);if(s){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var a=n.playing(o)?t.ctx.currentTime-s._playStart:0,i=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(i+a*Math.abs(s._rate))}return s._node.currentTime}var l=n.playing(o);l&&n.pause(o,!0),s._seek=e,s._ended=!1,n._clearTimer(o),n._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=e);var u=function(){l&&n.play(o,!0),n._emit("seek",o)};if(l&&!n._webAudio){var c=function(){n._playLock?setTimeout(c,0):u()};setTimeout(c,0)}else u()}return n},playing:function(e){var t=this;if("number"==typeof e){var o=t._soundById(e);return!!o&&!o._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,o=t._duration,n=t._soundById(e);return n&&(o=t._sprite[n._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,o=e._sounds,n=0;n<o.length;n++)o[n]._paused||e.stop(o[n]._id),e._webAudio||(e._clearSound(o[n]._node),o[n]._node.removeEventListener("error",o[n]._errorFn,!1),o[n]._node.removeEventListener(t._canPlayEvent,o[n]._loadFn,!1),o[n]._node.removeEventListener("ended",o[n]._endFn,!1),t._releaseHtml5Audio(o[n]._node)),delete o[n]._node,e._clearTimer(o[n]._id);var r=t._howls.indexOf(e);r>=0&&t._howls.splice(r,1);var a=!0;for(n=0;n<t._howls.length;n++)if(t._howls[n]._src===e._src||e._src.indexOf(t._howls[n]._src)>=0){a=!1;break}return s&&a&&delete s[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,o,n){var r=this["_on"+e];return"function"==typeof t&&r.push(n?{id:o,fn:t,once:n}:{id:o,fn:t}),this},off:function(e,t,o){var n=this,r=n["_on"+e],s=0;if("number"==typeof t&&(o=t,t=null),t||o)for(s=0;s<r.length;s++){var a=o===r[s].id;if(t===r[s].fn&&a||!t&&a){r.splice(s,1);break}}else if(e)n["_on"+e]=[];else{var i=Object.keys(n);for(s=0;s<i.length;s++)0===i[s].indexOf("_on")&&Array.isArray(n[i[s]])&&(n[i[s]]=[])}return n},once:function(e,t,o){return this.on(e,t,o,1),this},_emit:function(e,t,o){for(var n=this,r=n["_on"+e],s=r.length-1;s>=0;s--)r[s].id&&r[s].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,o)}.bind(n,r[s].fn),0),r[s].once&&n.off(e,r[s].fn,r[s].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var o=t._queue[0];o.event===e&&(t._queue.shift(),t._loadQueue()),e||o.action()}return t},_ended:function(e){var o=this,n=e._sprite;if(!o._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(o._ended.bind(o,e),100),o;var r=!(!e._loop&&!o._sprite[n][2]);if(o._emit("end",e._id),!o._webAudio&&r&&o.stop(e._id,!0).play(e._id),o._webAudio&&r){o._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var s=1e3*(e._stop-e._start)/Math.abs(e._rate);o._endTimers[e._id]=setTimeout(o._ended.bind(o,e),s)}return o._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,o._clearTimer(e._id),o._cleanBuffer(e._node),t._autoSuspend()),o._webAudio||r||o.stop(e._id,!0),o},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var o=t._soundById(e);o&&o._node&&o._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,o=0;o<t._sounds.length;o++)if(e===t._sounds[o]._id)return t._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new r(e)},_drain:function(){var e=this,t=e._pool,o=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&o++;for(n=e._sounds.length-1;n>=0;n--){if(o<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),o--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],o=0;o<this._sounds.length;o++)t.push(this._sounds[o]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=s[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),this},_cleanBuffer:function(e){var o=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),o))try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(e){this._parent=e,this.init()};r.prototype={init:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,o._sounds.push(e),e.create(),e},create:function(){var e=this,o=e._parent,n=t._muted||e._muted||e._parent._muted?0:e._volume;return o._webAudio?(e._node=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(n,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=o._src,e._node.preload=!0===o._preload?"auto":o._preload,e._node.volume=n*t.volume(),e._node.load()),e},reset:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,o=e._parent;o._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(o._sprite).length&&(o._sprite={__default:[0,1e3*o._duration]}),"loaded"!==o._state&&(o._state="loaded",o._emit("load"),o._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var s={},a=function(e){var t=e._src;if(s[t])return e._duration=s[t].duration,void u(e);if(/^data:[^;]+;base64,/.test(t)){for(var o=atob(t.split(",")[1]),n=new Uint8Array(o.length),r=0;r<o.length;++r)n[r]=o.charCodeAt(r);l(n.buffer,e)}else{var a=new XMLHttpRequest;a.open(e._xhr.method,t,!0),a.withCredentials=e._xhr.withCredentials,a.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){a.setRequestHeader(t,e._xhr.headers[t])})),a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?l(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete s[t],e.load())},i(a)}},i=function(e){try{e.send()}catch(t){e.onerror()}},l=function(e,o){var n=function(){o._emit("loaderror",null,"Decoding audio data failed.")},r=function(e){e&&o._sounds.length>0?(s[o._src]=e,u(o,e)):n()};"undefined"!=typeof Promise&&1===t.ctx.decodeAudioData.length?t.ctx.decodeAudioData(e).then(r).catch(n):t.ctx.decodeAudioData(e,r,n)},u=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){if(t.usingWebAudio){try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),o=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=o?parseInt(o[1],10):null;if(e&&n&&n<9){var r=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!r&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};"function"==typeof define&&define.amd&&define([],(function(){return{Howler:t,Howl:n}})),Oo=t,Bo=n,void 0!==o?(o.HowlerGlobal=e,o.Howler=t,o.Howl=n,o.Sound=r):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=r)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var o=t._howls.length-1;o>=0;o--)t._howls[o].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,o){var n=this;return n.ctx&&n.ctx.listener?(t="number"!=typeof t?n._pos[1]:t,o="number"!=typeof o?n._pos[2]:o,"number"!=typeof e?n._pos:(n._pos=[e,t,o],void 0!==n.ctx.listener.positionX?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]),n)):n},HowlerGlobal.prototype.orientation=function(e,t,o,n,r,s){var a=this;if(!a.ctx||!a.ctx.listener)return a;var i=a._orientation;return t="number"!=typeof t?i[1]:t,o="number"!=typeof o?i[2]:o,n="number"!=typeof n?i[3]:n,r="number"!=typeof r?i[4]:r,s="number"!=typeof s?i[5]:s,"number"!=typeof e?i:(a._orientation=[e,t,o,n,r,s],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(o,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(s,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,t,o,n,r,s),a)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var o=this;return o._orientation=t.orientation||[1,0,0],o._stereo=t.stereo||null,o._pos=t.pos||null,o._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},o._onstereo=t.onstereo?[{fn:t.onstereo}]:[],o._onpos=t.onpos?[{fn:t.onpos}]:[],o._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,o){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,o)}}),n;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===o){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var s=n._getSoundIds(o),a=0;a<s.length;a++){var i=n._soundById(s[a]);if(i){if("number"!=typeof e)return i._stereo;i._stereo=e,i._pos=[e,0,0],i._node&&(i._pannerAttr.panningModel="equalpower",i._panner&&i._panner.pan||t(i,r),"spatial"===r?void 0!==i._panner.positionX?(i._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):i._panner.setPosition(e,0,0):i._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",i._id)}}return n},Howl.prototype.pos=function(e,o,n,r){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"pos",action:function(){s.pos(e,o,n,r)}}),s;if(o="number"!=typeof o?0:o,n="number"!=typeof n?-.5:n,void 0===r){if("number"!=typeof e)return s._pos;s._pos=[e,o,n]}for(var a=s._getSoundIds(r),i=0;i<a.length;i++){var l=s._soundById(a[i]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,o,n],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setPosition(e,o,n)),s._emit("pos",l._id)}}return s},Howl.prototype.orientation=function(e,o,n,r){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"orientation",action:function(){s.orientation(e,o,n,r)}}),s;if(o="number"!=typeof o?s._orientation[1]:o,n="number"!=typeof n?s._orientation[2]:n,void 0===r){if("number"!=typeof e)return s._orientation;s._orientation=[e,o,n]}for(var a=s._getSoundIds(r),i=0;i<a.length;i++){var l=s._soundById(a[i]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,o,n],l._node&&(l._panner||(l._pos||(l._pos=s._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setOrientation(e,o,n)),s._emit("orientation",l._id)}}return s},Howl.prototype.pannerAttr=function(){var e,o,n,r=this,s=arguments;if(!r._webAudio)return r;if(0===s.length)return r._pannerAttr;if(1===s.length){if("object"!=typeof s[0])return(n=r._soundById(parseInt(s[0],10)))?n._pannerAttr:r._pannerAttr;e=s[0],void 0===o&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:r._panningModel})}else 2===s.length&&(e=s[0],o=parseInt(s[1],10));for(var a=r._getSoundIds(o),i=0;i<a.length;i++)if(n=r._soundById(a[i])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=n._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(n._pos||(n._pos=r._pos||[0,0,-.5]),t(n,"spatial"))}return r},Sound.prototype.init=function(e){return function(){var t=this,o=t._parent;t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,e.call(this),t._stereo?o.stereo(t._stereo):t._pos&&o.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,o=t._parent;return t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,t._stereo?o.stereo(t._stereo):t._pos?o.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,o._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();var zo={};zo=new URL(s("27Lyk").resolve("8Qic0"),import.meta.url).toString();var Xo={};Xo=new URL(s("27Lyk").resolve("aSqJ5"),import.meta.url).toString();var qo={};qo=new URL(s("27Lyk").resolve("hMICc"),import.meta.url).toString();var Yo={};Yo=new URL(s("27Lyk").resolve("cFOzA"),import.meta.url).toString();var jo={};jo=new URL(s("27Lyk").resolve("iP5rH"),import.meta.url).toString();var $o={};$o=new URL(s("27Lyk").resolve("4cgQm"),import.meta.url).toString();var Ko={};Ko=new URL(s("27Lyk").resolve("5uP20"),import.meta.url).toString();var Qo={};Qo=new URL(s("27Lyk").resolve("koWqL"),import.meta.url).toString();var Jo={};Jo=new URL(s("27Lyk").resolve("drQCs"),import.meta.url).toString();var Zo={};Zo=new URL(s("27Lyk").resolve("aKQuT"),import.meta.url).toString();const en=[s("btQCe"),s("lSuTm"),s("dq9sn"),s("5htDn"),s("afRm3"),s("haUAw")],tn=[s("kBrAM"),s("k6Tdk"),s("vDQ5G"),s("7DVvx"),s("al4v1"),s("fO2Fk"),s("kaxMC")],on=[s("fO2Fk")],nn=[s("lsnFy"),s("iSQf2"),s("9W6vc"),s("h5cAV"),s("71dbC")],rn=[s("iOIx8"),s("5HSVp"),s("gjhQR"),s("9yWXC"),s("8wZYi"),s("lLaFn"),s("91Ssr"),s("iPqLJ")],sn=[s("aYURT"),s("28SI0"),s("2v7tx"),s("2ab9R")],an=[s("5mxOT"),s("6zU4W")],ln=[s("c5gUn"),s("pgODr"),s("2CXE7"),s("6IDgr"),s("sYECX"),s("5SG7D")],un=[s("b3a1B"),s("hNZg3"),s("f54Wu"),s("lLVHT"),s("4n1uh")],cn=[s("4SRyK")],dn=[s("lflvk"),s("5v2Gn")],pn=[s("6Coqa"),s("blkyS")],hn=[s("jI2pj"),s("anpZd")],mn=[s("edgVx"),s("3Gcwe"),s("2iFWu"),s("7lSO8")],fn=[s("38hOr")],gn=[s("iE0tY")],yn=[s("dCjg8")],xn=[s("g0SDf")],vn=[s("8BSZm")],Sn=[s("gfCsy")],Mn=[s("iCaDa")],_n=[s("LEh2P")],Tn=[s("26zq3")],wn=[s("dWD01")],Ln=[s("9h7xU"),s("jiU0R")],An=[s("jMkd8")],bn=[s("1wRMv")],Rn=[s("8lgeg")],kn=[s("l8xp9")],Cn=[s("alx6Z"),s("ijwXJ")],In=[[s("a2kyU"),"Hmm..."],[s("5d0DW"),"What?"],[s("dxMYB"),"Hey!"],[s("baOJW"),"Hey!"],[s("k2iei"),"Hey!"],[s("3x4yY"),"What was that?"],[s("egNqT"),"What was that?"],[s("QVkvm"),"What was that?"],[s("ggzCL"),"What was that?"],[s("h8bVj"),"What was that?"],[s("1NOTS"),"Who goes there?"],[s("6wdzE"),"Huh?"],[s("5d0DW"),"What?"],[s("7Bgvb"),"Wha..."],[s("cc8Co"),"Wait!"],[s("3Vwq5"),"Who's there?"],[s("bk6h6"),"What moved?"],[s("7Du7Q"),"What's that\nin the shadows?"],[s("aTKjT"),"Did that\nshadow move?"],[s("8P0kg"),"I see\nsomething!"],[s("fyl73"),"Hello?"],[s("j5ffj"),"Uhh..."]],Pn=[[s("9L8Sg"),"Ahh..."],[s("5Fjgc"),"Aww..."],[s("40XLk"),"Quiet out..."],[s("7jABT"),"Rest me old\nbones..."]],Hn=[[s("a2kyU"),"Hmm..."],[s("5d0DW"),"What?"],[s("3x4yY"),"What was that?"],[s("40XLk"),"Quiet out\nthere..."],[s("k4RLX"),"Jumpy tonight..."],[s("34gKi"),"Jumpin' at\nshadows!"],[s("a2kyU"),"Hmm..."],[s("fgE4t"),"Oh well..."],[s("gGzmW"),"I've got myself\na case of the\njitters..."],[s("aUMGA"),"I must be\nseein' things..."],[s("hAB2v"),"What'd they put\nin my coffee?"],[s("j1q3e"),"Coffee must be\ntoo strong!"],[s("cp5Da"),"Hmm!\nNothing..."],[s("k9vCo"),"Well, I thought\nI saw something."],[s("fzAkK"),"Nothing..."],[s("2mcEF"),"Hopefully\nnothing."],[s("2lUVX"),"Seein' things,\nI guess."],[s("2lUVX"),"Seein' things,\nI guess."]],En=[[s("a2kyU"),"Hmm..."],[s("5d0DW"),"What?"],[s("3x4yY"),"What was that?"],[s("k4RLX"),"Jumpy tonight..."],[s("a2kyU"),"Hmm..."],[s("fgE4t"),"Oh well..."],[s("gGzmW"),"I've got myself\na case of the\njitters..."],[s("aUMGA"),"I must be\nseein' things..."],[s("hAB2v"),"What'd they put\nin my coffee?"],[s("j1q3e"),"Coffee must be\ntoo strong!"],[s("cp5Da"),"Hmm!\nNothing..."],[s("fzAkK"),"Nothing..."],[s("2mcEF"),"Hopefully\nnothing."],[s("2lUVX"),"Seein' things,\nI guess."],[s("2lUVX"),"Seein' things,\nI guess."]],Dn=[[s("a2kyU"),"Hmm..."],[s("5d0DW"),"What?"],[s("bR2Qq"),"What?"],[s("dxMYB"),"Hey!"],[s("baOJW"),"Hey!"],[s("k2iei"),"Hey!"],[s("3x4yY"),"What was that?"],[s("egNqT"),"What was that?"],[s("QVkvm"),"What was that?"],[s("ggzCL"),"What was that?"],[s("h8bVj"),"What was that?"],[s("6wdzE"),"Huh?"],[s("5d0DW"),"What?"],[s("7Bgvb"),"Wha..."],[s("cc8Co"),"Wait!"],[s("3Vwq5"),"Who's there?"],[s("fyl73"),"Hello?"],[s("j5ffj"),"Uhh..."],[s("4tABs"),"Hark?"],[s("4eWcK"),"What was that noise?"],[s("4eWcK"),"What was that noise?"],[s("2IlHA"),"I heard something..."],[s("2IlHA"),"I heard something..."]],Wn=[[s("a2kyU"),"Hmm..."],[s("k4RLX"),"Jumpy tonight..."],[s("fgE4t"),"Oh well..."],[s("gGzmW"),"I've got myself\na case of the\njitters..."],[s("hAB2v"),"What's in my\ncoffee today?"],[s("j1q3e"),"Coffee must be\ntoo strong!"],[s("cp5Da"),"Hmm!\nNothing..."],[s("b4oBR"),"Well, I can't\nhear it now."],[s("fzAkK"),"Nothing..."],[s("2mcEF"),"Hopefully\nnothing."],[s("bEpX3"),"I must be\nhearing things."]],Fn=[[s("a2kyU"),"Hmm..."],[s("dxMYB"),"Hey!"],[s("baOJW"),"Hey!"],[s("k2iei"),"Hey!"],[s("5d0DW"),"What?"],[s("zO13n"),"That noise\nagain?"],[s("hPTSL"),"Someone's there!"],[s("5TQSa"),"Who could\nthat be?"],[s("iXaO0"),"Better check\nit out."],[s("fBP7x"),"That better\nbe rats!"],[s("aQaIJ"),"Who is that?"],[s("jI1w6"),"Come out, come out\nwherever you are!"]],Gn=[[s("a2kyU"),"Hmm..."],[s("34gKi"),"Jumpin' at\nshadows!"],[s("k4RLX"),"Jumpy!"],[s("fgE4t"),"Oh, well."],[s("7OaPU"),"Guess it was\nnothing."],[s("eAAPp"),"Wonder what it was."],[s("Z94uH"),"Back to my post."],[s("2GAEF"),"All quiet now."],[s("bl9NP"),"I'm sure I\nheard something."],[s("avnp8"),"Not there anymore."],[s("2mxOl"),"Probably nothing."],[s("cp5Da"),"Hmm!\nNothing."],[s("bvdYU"),"I don't know why\nI work here."],[s("f5YJN"),"Waste of my time."],[s("h733p"),"Why do I\neven try?"],[s("5iRGH"),"At least I'm not\non cleaning duty."],[s("bodaa"),"At least my\nshift ends soon."],[s("jnTTO"),"What do you\nwant me to\ndo about it?"]],Vn=[[s("k2iei"),"Hey!"],[s("5d0DW"),"What?"],[s("4bkfm"),"Coming!"],[s("1ZzuO"),"To arms!"]],Un=[[s("5d0DW"),"That torch is out!"],[s("5d0DW"),"It's too dark\nin here."],[s("5d0DW"),"Let's have more light."]],Nn=[[s("a2kyU"),"That's better."],[s("a2kyU"),"There we go."],[s("a2kyU"),"Now where was I?"]],On=[[s("iCpSW"),"(Whistle)"],[s("9upNV"),"(Whistle)"],[s("yZG5v"),"(Whistle)"],[s("f1guA"),"Get 'em!"],[s("83TDO"),"Intruder!"],[s("frVxF"),"Oh no...\nIt's a thief!"],[s("hCPR7"),"We're coming\nfor you!"],[s("4Za6U"),"Coming for you!"],[s("3Xk6I"),"Halt!"],[s("dosUm"),"We see you!"],[s("4gdwQ"),"I'll get you!"],[s("aLkfr"),"You're a goner!"],[s("kSLiP"),"Just you wait!"],[s("2IENo"),"You won't get away!"],[s("1CFiH"),"No you don't!"],[s("llhgm"),"Thief!"],[s("2eW7L"),"Thief!"],[s("kZcsz"),"Thief!"],[s("2qpAR"),"After them!"],[s("cAyqi"),"What is thy business\nwith this gold?"],[s("aEQTO"),"No mercy for\nthe wicked!"]],Bn=[[s("ijfWN"),"Lost 'im!"],[s("7sWca"),"Must have\nrun off..."],[s("fgE4t"),"Oh, well..."],[s("fevkE"),"Where did they go?"],[s("1B1JN"),"His Holiness would\nnot be pleased!"],[s("jnuCJ"),"The boss will\nnot be pleased!"],[s("cmvWY"),"I give up!"],[s("hMHBo"),"Where did he go!?"],[s("9Nz7S"),"Drats!\nLost him!"],[s("9tCyg"),"Gone!"],[s("7ryfo"),"Come back here!"],[s("eLXb8"),"Rotten scoundrel!"],[s("8uLuu"),"Aargh!!"],[s("io7hj"),"He's not coming back!"],[s("8Mr4t"),"Blast!"],[s("3gcK8"),"Don't come back!"],[s("3N27a"),"You won't\nget away\nnext time!"],[s("i8RlJ"),"For His Holiness!"],[s("4vw0X"),"What a lousy day\nat work!"],[s("6aNdh"),"I give up..."],[s("i6vQ5"),"What do I do?\nHelp me, help me..."],[s("5PMpx"),"Oh no,\nhe got away!"],[s("2DFDi"),"(Guard rant)"]],zn=[[s("9L8Sg"),"Someone smacked me!"],[s("9L8Sg"),"Someone hit me!"],[s("9L8Sg"),"Who hit me!?"]],Xn=[[s("9L8Sg"),"We have a guard down!"],[s("9L8Sg"),"Man down!"],[s("9L8Sg"),"Guard down!"]],qn=[[s("9L8Sg"),"Ahh..."]],Yn=[[s("83TDO"),"We must have\nan intruder!"],[s("83TDO"),"I will keep\nan eye out!"]],jn=[[s("527nu"),"Take that!!"],[s("54HwM"),"Oof!!"],[s("4e6QO"),"Ugg!!"],[s("7k3tw"),"Ahh!!"],[s("fcDaw"),"Ahh!!"],[s("fty2x"),"Hi-yah!"],[s("jFsow"),"Hi-yah!"],[s("cMmoo"),"Hi-yah!"]],$n=[[s("a2kyU"),"Hmm..."],[s("5d0DW"),"What?"],[s("dxMYB"),"Hey!"],[s("baOJW"),"Hey!"],[s("k2iei"),"Hey!"],[s("3x4yY"),"What was that?"],[s("egNqT"),"What was that?"],[s("QVkvm"),"What was that?"],[s("ggzCL"),"What was that?"],[s("h8bVj"),"What was that?"],[s("1NOTS"),"Who goes there?"],[s("6wdzE"),"Huh?"],[s("5d0DW"),"What?"],[s("7Bgvb"),"Wha..."],[s("cc8Co"),"Wait!"],[s("3Vwq5"),"Who's there?"],[s("fyl73"),"Hello?"],[s("j5ffj"),"Uhh..."]],Kn=[[s("9L8Sg"),"They don't\nstay lit!"],[s("9L8Sg"),"Somebody should\nrelight that."],[s("9L8Sg"),"That torch\nburned out."],[s("9L8Sg"),"It got dark!"],[s("9L8Sg"),"Wish I had\na torch..."],[s("9L8Sg"),"Why did that\nhappen?"]],Qn=[[s("6wdzE"),"Huh?"],[s("5d0DW"),"What?"],[s("dxMYB"),"Hey!"],[s("baOJW"),"Hey!"],[s("k2iei"),"Hey!"]],Jn=[[s("llhgm"),"Someone stole\nthe Treasure!"],[s("2eW7L"),"It's missing!"],[s("kZcsz"),"Who took that?"]],Zn=[[s("6wdzE"),"Huh?"],[s("5d0DW"),"What?"],[s("dxMYB"),"Hey!"],[s("baOJW"),"Hey!"],[s("k2iei"),"Hey!"]];class er{constructor(){this.activeHowls=[],this.activeLimit=2,this.fadeTime=1e3}setFadetime(e=1e3){return this.fadeTime=e,this}fade(e,t){return this.fadeTime>0?(e.fade(1,0,this.fadeTime,t),setTimeout((()=>e.stop(t)),this.fadeTime)):e.stop(t),this}empty(){for(let e of this.activeHowls)this.fade(...e);return this.activeHowls=[],this}queue(e,t){if(this.activeHowls.unshift([e,t]),this.activeHowls.length>this.activeLimit){const e=this.activeHowls.pop();this.fade(...e)}return this.activeHowls=this.activeHowls.slice(0,this.activeLimit),this}}class tr{constructor(e,t=null){this.howls=e.map((e=>new Bo({src:[e]}))),this.howlNum=0,this.soundPool=t,v(this.howls)}play(e,t=0,o=!1){const n=this.next();n.loop(o),n.volume(e),n.stereo(t);try{const e=n.play();return null!==this.soundPool&&this.soundPool.queue(n,e),e}catch(e){console.log(`Audio playback error ${n}`,e)}return-1}next(){return this.howlNum++,this.howlNum==this.howls.length&&(this.howlNum=0,v(this.howls)),this.howls[this.howlNum]}}class or{constructor(e,t=null){this.sounds=e.map(nr),this.soundNum=0,this.soundPool=t,this.mute=!1,v(this.sounds)}play(e,t=0){const o=this.next();if(!this.mute){o.sound.volume(e),o.sound.stereo(t);const n=o.sound.play();null!==this.soundPool&&this.soundPool.queue(o.sound,n)}return o}next(){const e=this.sounds[this.soundNum];return++this.soundNum,this.soundNum===this.sounds.length&&(this.soundNum=0,v(this.sounds)),e}}function nr(e){return{sound:new Bo({src:[e[0]]}),subtitle:e[1]}}function rr(e,t,o,n){e.footstepWood=new tr([$o]),e.footstepTile=new tr([Ko]),e.footstepWater=new tr([Qo]),e.footstepGravel=new tr([Jo]),e.footstepGrass=new tr([Zo]),e.footstepCreaky=new tr(en),e.victorySong=new tr([zo]),e.levelRequirementJingle=new tr([Xo],o),e.levelCompleteJingle=new tr([qo],o),e.gameOverJingle=new tr([Yo],o),e.easterEgg=new tr([jo],o),e.hitPlayer=new tr(tn),e.hitGuard=new tr(on),e.coin=new tr(nn),e.doorOpen=new tr(fn),e.doorClose=new tr(gn),e.doorOpenLocked=new tr(yn),e.doorCloseLocked=new tr(xn),e.playerDoorOpen=new tr(vn),e.playerDoorClose=new tr(Sn),e.playerDoorOpenLocked=new tr(Mn),e.playerDoorCloseLocked=new tr(_n),e.grunt=new tr(rn),e.douse=new tr(sn),e.ignite=new tr(an),e.hide=new tr(ln),e.gate=new tr(un),e.thump=new tr(cn),e.splash=new tr(dn),e.waterEnter=new tr(Tn),e.waterExit=new tr(wn),e.jump=new tr(Ln),e.tooHigh=new tr(Cn),e.treasureAlarm=new tr(An),e.switchProgress=new tr(bn),e.switchReset=new tr(Rn),e.switchSuccess=new tr(kn),e.ambienceWater=new tr(pn,n),e.ambienceKitchen=new tr(hn,n),e.ambienceOutdoor=new tr(mn,n),t.guardInvestigate=new or(Fn,o),t.guardFinishInvestigating=new or(Gn,o),t.guardSeeThief=new or(In),t.guardFinishLooking=new or(Hn,o),t.guardFinishLookingAtLitTorch=new or(En,o),t.guardChase=new or(On,o),t.guardEndChase=new or(Bn,o),t.guardHearGuard=new or(Vn,o),t.guardSpotDownedGuard=new or(Zn,o),t.guardSeeUnlitTorch=new or(Un,o),t.guardHearThief=new or(Dn,o),t.guardAwakesWarning=new or(zn,o),t.guardDownWarning=new or(Xn,o),t.guardWarningResponse=new or(Yn,o),t.guardFinishListening=new or(Wn,o),t.guardFinishLightingTorch=new or(Nn,o),t.guardDamage=new or(jn,o),t.guardStirring=new or(qn,o),t.guardRest=new or(Pn,o),t.guardSeeTorchLit=new or($n,o),t.guardSeeTorchDoused=new or(Kn,o),t.guardSpotStolenTreasure=new or(Qn,o),t.guardExamineStolenTreasure=new or(Jn,o)}const sr={left:!1,right:!1,up:!1,down:!1,wait:!1,jump:!1,zoomIn:!1,zoomOut:!1,snapToPlayer:!1,menuAccept:!1,panUp:!1,panDown:!1,panLeft:!1,panRight:!1,menu:!1,menuBack:!1,homePlay:!1,homeDaily:!1,homeStats:!1,homeAchievements:!1,homeOptions:!1,jumpToggle:!1,startLevel:!1,guardMute:!1,volumeMute:!1,volumeDown:!1,volumeUp:!1,forceRestart:!1,resetState:!1,seeAll:!1,collectLoot:!1,markSeen:!1,guardSight:!1,guardPatrols:!1,nextLevel:!1,prevLevel:!1,fullscreen:!1,showSpeech:!1,idleCursorToggle:!1,showFPS:!1,devMenu:!1};var ar=null;const ir={"Alt+Comma":["prevLevel"],"Alt+KeyA":["seeAll"],"Alt+KeyC":["collectLoot"],"Alt+KeyP":["guardPatrols"],"Alt+KeyR":["resetState"],"Alt+KeyS":["markSeen"],"Alt+KeyV":["guardSight"],"Alt+Period":["nextLevel"],"Alt+KeyF":["showFPS"],ArrowDown:["down"],ArrowLeft:["left"],ArrowRight:["right"],ArrowUp:["up"],BracketLeft:["zoomOut"],BracketRight:["zoomIn"],Digit0:["volumeMute"],Digit9:["guardMute"],Enter:["wait","menuAccept"],Equal:["volumeUp"],Escape:["menu","menuBack"],KeyA:["left","homeAchievements"],KeyC:["copyScore","credits"],KeyD:["right","homeDaily","keyRepeatDelay"],KeyF:["jumpToggle","fullscreen"],KeyG:["guardMute"],KeyI:["idleCursorToggle"],KeyJ:["down","screenShakeEnabled"],KeyK:["up","keyRepeatRate"],KeyH:["left","helpControls"],KeyL:["right"],KeyM:["helpKey"],KeyN:["homeRestart","startLevel"],KeyO:["homeOptions"],KeyP:["homePlay"],KeyR:["homePlay"],KeyS:["down","homeStats"],KeyW:["up"],KeyX:["devMenu"],KeyZ:["wait","menuAccept"],Period:["wait","menuAccept"],Shift:["jump"],Slash:["menu"],Space:["wait","menuAccept"],Minus:["volumeDown"],Numpad2:["down"],Numpad4:["left","menu"],Numpad6:["right","menuAccept"],Numpad8:["up"],Numpad5:["wait"],NumpadAdd:["jumpToggle"],NumpadEnter:["menuAccept"],Tab:["showSpeech"],"Control+ArrowDown":["panDown"],"Control+ArrowLeft":["panLeft"],"Control+ArrowRight":["panRight"],"Control+ArrowUp":["panUp"],"Control+KeyA":["panLeft"],"Control+KeyC":["copyScore"],"Control+KeyD":["panRight"],"Control+KeyH":["panLeft"],"Control+KeyJ":["panUp"],"Control+KeyK":["panDown"],"Control+KeyL":["panRight"],"Control+KeyR":["forceRestart"],"Control+KeyS":["panDown"],"Control+KeyW":["panUp"],"Control+Numpad2":["panDown"],"Control+Numpad4":["panLeft"],"Control+Numpad6":["panRight"],"Control+Numpad8":["panUp"],"Control+Z":["snapToPlayer"],"Control+Numpad5":["snapToPlayer"],"Control+Period":["snapToPlayer"],"Control+Space":["snapToPlayer"]};class lr extends Array{constructor(e=0,t=0,o=0,n=0){super(e,t,o,n)}collide(e,t,o=0,n=0){return!(e+o<this[0])&&(!(t+n<this[1])&&(!(e>=this[0]+this[2])&&!(t>=this[1]+this[3])))}}class ur{currentFramePresses=new Set;constructor(){this.controlStates={...sr},this.controlTimes={};for(const e in this.controlStates)this.controlTimes[e]=Date.now();window.addEventListener("blur",(e=>{this.clearPressedAll()}))}setPressed(e,t,o=!0){this.controlStates[e]=t,this.controlTimes[e]=Date.now(),o&&t&&this.currentFramePresses.add(e),ar=this}clearPressedAll(){for(const e in this.controlStates)this.controlStates[e]=!1}endFrame(){this.currentFramePresses.clear()}}class cr extends ur{constructor(e=null){super(),null==e&&(e=ir),this.keyMap=e;let t=this;document.onkeydown=function(e){t.keyDownHandler(e)},document.onkeyup=function(e){t.keyUpHandler(e)}}getCode(e){let t=e.code;return e.altKey&&"AltLeft"!==e.code&&"AltRight"!==e.code&&(t="Alt+"+t),e.ctrlKey&&"ControlLeft"!==e.code&&"ControlRight"!==e.code&&(t="Control+"+t),"AltLeft"!=e.code&&"AltRight"!=e.code||(t="Alt"),"ShiftLeft"!=e.code&&"ShiftRight"!=e.code||(t="Shift"),"ControlLeft"!=e.code&&"ControlRight"!=e.code||(t="Control"),t}updateModifierDown(e){for(let t in this.keyMap){const o=this.keyMap[t];for(let n of o)!t.includes(e)&&this.controlStates[n]&&(this.controlStates[n]=!1)}}updateModifierUp(e){for(let t in this.keyMap){const o=this.keyMap[t];for(let n of o)t.includes(e)&&this.controlStates[n]&&(this.controlStates[n]=!1)}}keyDownHandler(e){ar=this;const t=this.getCode(e);if(["Alt","Control"].includes(t)&&this.updateModifierDown(t),t in this.keyMap){e.preventDefault();const o=this.keyMap[t];for(let e of o)this.controlStates[e]||this.setPressed(e,!0)}}keyUpHandler(e){const t=this.getCode(e);if(["Alt","Control"].includes(t)&&this.updateModifierUp(t),t in this.keyMap){e.preventDefault();const o=this.keyMap[t];for(let e of o)this.setPressed(e,!1)}}}class dr extends ur{constructor(e){super(),this.gamepad=e,this.thresh=.4,this.internalStates={...this.controlStates}}setPressed(e,t){this.internalStates[e]!=t&&(this.internalStates[e]=t,super.setPressed(e,t))}}class pr{constructor(){window.addEventListener("gamepadconnected",(e=>this.connected(e))),window.addEventListener("gamepaddisconnected",(e=>this.disconnected(e))),this.gamepads={}}connected(e){this.gamepads[e.gamepad.index]=new dr(e.gamepad)}disconnected(e){this.gamepads[e.gamepad.index];delete this.gamepads[e.gamepad.index]}updateGamepadStates(){let e=navigator.getGamepads();if(null!=e)for(const t of e){if(null==t)continue;let e=this.gamepads[t.index];e.gamepad=t,e.setPressed("jump",hr(t,0)),e.setPressed("wait",hr(t,2)),e.setPressed("menuAccept",hr(t,0)||hr(t,2)),e.setPressed("zoomOut",hr(t,6)&&!hr(t,7)),e.setPressed("zoomIn",hr(t,7)&&!hr(t,6)),e.setPressed("menu",hr(t,9)),e.setPressed("left",hr(t,14)&&!hr(t,12)&&!hr(t,13)||t.axes[0]<-e.thresh&&Math.abs(t.axes[1])<.5*Math.abs(t.axes[0])),e.setPressed("right",hr(t,15)&&!hr(t,12)&&!hr(t,13)||t.axes[0]>e.thresh&&Math.abs(t.axes[1])<.5*Math.abs(t.axes[0])),e.setPressed("up",hr(t,12)&&!hr(t,14)&&!hr(t,15)||t.axes[1]<-e.thresh&&Math.abs(t.axes[0])<.5*Math.abs(t.axes[1])),e.setPressed("down",hr(t,13)&&!hr(t,14)&&!hr(t,15)||t.axes[1]>e.thresh&&Math.abs(t.axes[0])<.5*Math.abs(t.axes[1])),e.setPressed("panLeft",t.axes[2]<-e.thresh),e.setPressed("panRight",t.axes[2]>e.thresh),e.setPressed("panUp",t.axes[3]<-e.thresh),e.setPressed("panDown",t.axes[3]>e.thresh),e.setPressed("snapToPlayer",hr(t,5)),e.setPressed("showSpeech",hr(t,4))}}}function hr(e,t){return t<e.buttons.length&&e.buttons[t].pressed}class mr extends ur{mouseActive=!1;targetOnTouchDown=null;constructor(e){super(),this.canvas=e,e.addEventListener("touchstart",(e=>this.process_touchstart(e)),!0),e.addEventListener("touchmove",(e=>this.process_touchmove(e)),!0),e.addEventListener("touchcancel",(e=>this.process_touchend(e)),!0),e.addEventListener("touchend",(e=>this.process_touchend(e)),!0),e.addEventListener("mousedown",(e=>this.process_mousedown(e)),!0),e.addEventListener("mouseup",(e=>this.process_mouseup(e)),!0),e.addEventListener("mousemove",(e=>this.process_mousemove(e)),!0),this.lastMotion={id:-1,active:!1,x0:0,y0:0,x:0,y:0},this.coreTouchTargets={up:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!1},down:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!1},left:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!1},right:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!1},wait:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!1},jump:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!1},menuAccept:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!1},pan:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!0},zoomIn:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!0},zoomOut:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!0},forceRestart:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!0},menu:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!0},fullscreen:{id:-1,rect:new lr,touchXY:[0,0],tileInfo:null,mouseable:!0}},this.touchTargets=this.coreTouchTargets}clearMotion(){this.lastMotion.active=!1,this.lastMotion.id=-1,this.lastMotion.x0=0,this.lastMotion.y0=0,this.lastMotion.x=0,this.lastMotion.y=0,this.targetOnTouchDown=null}updateCoreTouchTarget(e,t,o){const n=this.coreTouchTargets[e];n.rect=t,n.tileInfo=o;const r=n.touchXY[0],s=this.canvas.clientHeight-(n.touchXY[1]+1);n.rect.collide(r,s)||this.controlStates[e]&&-1!=n.id&&(this.setPressed(e,!1,!1),n.id=-1)}activateTouchTargets(e){let t;t=void 0===e?this.coreTouchTargets:{...this.coreTouchTargets,...e};for(const[e,o]of Object.entries(this.touchTargets))Object.hasOwn(t,e)||(this.controlStates[e]=!1);this.touchTargets=t}process_mousedown(e){ar=this;const t=e.clientX,o=this.canvas.clientHeight-(e.clientY+1);this.mouseActive=!0,this.lastMotion.id=-2,this.lastMotion.active=!1,this.lastMotion.x0=t,this.lastMotion.y0=o,this.lastMotion.x=t,this.lastMotion.y=o,this.targetOnTouchDown=null;for(const[n,r]of Object.entries(this.touchTargets)){if(!r.mouseable)continue;r.rect.collide(t,o)&&(r.touchXY=[e.clientX,e.clientY],r.id=-2,this.setPressed(n,!0),this.targetOnTouchDown=n)}e.preventDefault()}process_mousemove(e){ar=this,this.mouseActive=!0;const t=e.clientX,o=this.canvas.clientHeight-(e.clientY+1);-2==this.lastMotion.id&&(this.lastMotion.active=!0,this.lastMotion.x=t,this.lastMotion.y=o);for(const[n,r]of Object.entries(this.touchTargets))if(r.mouseable&&-2===r.id){r.rect.collide(t,o)?r.touchXY=[e.clientX,e.clientY]:(this.setPressed(n,!1,!1),r.id=-1)}e.preventDefault()}process_mouseup(e){for(const[e,t]of Object.entries(this.touchTargets))t.mouseable&&this.controlStates[e]&&(t.id=-1,this.setPressed(e,!1,!0),this.controlTimes[e]=0);this.clearMotion(),e.preventDefault()}process_touchstart(e){ar=this,this.mouseActive=!1,this.targetOnTouchDown=null;for(let t of e.changedTouches){const e=t.clientX,o=this.canvas.clientHeight-(t.clientY+1);this.lastMotion.id=t.identifier,this.lastMotion.active=!1,this.lastMotion.x0=e,this.lastMotion.y0=o,this.lastMotion.x=e,this.lastMotion.y=o;for(const[n,r]of Object.entries(this.touchTargets)){r.rect.collide(e,o)&&(r.touchXY=[t.clientX,t.clientY],r.id=t.identifier,this.targetOnTouchDown=n,this.setPressed(n,!0))}}e.preventDefault()}process_touchmove(e){this.mouseActive=!1;for(let t of e.changedTouches){const e=t.clientX,o=this.canvas.clientHeight-(t.clientY+1);this.lastMotion.id==t.identifier&&(this.lastMotion.active=!0,this.lastMotion.x=e,this.lastMotion.y=o);for(const[n,r]of Object.entries(this.touchTargets))if(r.id==t.identifier){r.rect.collide(e,o)?r.touchXY=[t.clientX,t.clientY]:(r.id=-1,this.setPressed(n,!1,!1))}}e.preventDefault()}process_touchend(e){this.mouseActive=!1;for(let t of e.changedTouches){for(const[e,o]of Object.entries(this.touchTargets))o.id==t.identifier&&(o.id=-1,this.setPressed(e,!1,!0),this.controlTimes[e]=0);this.lastMotion.id==t.identifier&&this.clearMotion()}e.preventDefault()}}let fr;var gr;let yr;var xr;function vr(e,t){const o=e.numGhostedLevels,n=e.totalScore,r=e.turns,s=e.numCompletedLevels,a=e.numLevels,i=s>=a,l=e.daily,u=null!==l?" Daily run for "+l:" Random game",c=i?"Completed mission in "+r+" turns.":" Died in mansion "+(s+1)+" after "+r+" turns.";let d="";if(i){let e;for(e in t)t[e].failed||(d+=t[e].unicodeBadge);d.length>0&&(d="Achievements: "+d+"\n")}navigator.clipboard.writeText(` LLLOOOT! \n${u}\n${c}\nCompleted:   ${s} of ${a}\nGhosted:     ${o}\nTotal score: ${n}\n${d}`)}(gr=fr||(fr={}))[gr.HomeScreen=0]="HomeScreen",gr[gr.StatsScreen=1]="StatsScreen",gr[gr.AchievementsScreen=2]="AchievementsScreen",gr[gr.OptionsScreen=3]="OptionsScreen",gr[gr.HelpControls=4]="HelpControls",gr[gr.HelpKey=5]="HelpKey",gr[gr.Mansion=6]="Mansion",gr[gr.MansionComplete=7]="MansionComplete",gr[gr.Dead=8]="Dead",gr[gr.Win=9]="Win",gr[gr.DailyHub=10]="DailyHub",gr[gr.CreditsScreen=11]="CreditsScreen",gr[gr.DevScreen=12]="DevScreen",(xr=yr||(yr={}))[xr.Indoor=0]="Indoor",xr[xr.Outdoor=1]="Outdoor",xr[xr.OutdoorWater=2]="OutdoorWater",xr[xr.Water=3]="Water",xr[xr.Kitchen=4]="Kitchen";class Sr{pages=[];activePage=0;activePageData=[];highlightedAction=0;actionSequence=[];cachedPageText="";screenSize=a.create();state=new Map;glyphs=[];maxLineLength=0;pixelsPerCharX=0;pixelsPerCharY=0;offsetX=0;offsetY=0;textW=8;textH=16;constructor(){this.mat=i.create(),this.touchTargets={}}initAction(e){this.touchTargets[e]={id:-1,rect:new lr(0,0,0,0),tileInfo:{},touchXY:[-1,-1],mouseable:!0}}parseImage(e,t,o,n){const r=e.slice(t+2).indexOf("#");if(r<0)return[e,t];const s=Number(e.slice(t+1,t+2+r));return Number.isNaN(s)?[e,t]:(this.glyphs.push([s,new lr(t,n-o-.875,2,1)]),[e=e.slice(0,t)+"  "+e.slice(t+3+r),t+1])}parseButton(e,t,o,n){const r=t;let s,a;for(;;){if(s=e.slice(t).indexOf("|"),s<0)return[e,t];if(s+=t,a=e.slice(s+1).indexOf("]"),a<0)return[e,t];if(a+=s+1,t===s)break;"#"===e[t]&&([e,t]=this.parseImage(e,t,o,n)),t+=1}const i=e.slice(s+1,a);if(void 0!==i&&""!==i){i in this.touchTargets||this.initAction(i);const e=[r,t+1,o],[s,a]=[e[0],e[2]-1/8],[l,u]=[e[1],e[2]+1];this.touchTargets[i].rect=new lr(s,n-u,l-s,u-a),this.actionSequence.push(i)}return[e=e.slice(0,s)+e.slice(a),t=s]}parseUI(e){let t=this.pages[this.activePage];for(const[e,o]of this.state)t=t.replace("$"+e+"$",o);if(t===this.cachedPageText&&this.screenSize.equals(e))return;this.cachedPageText=t,a.copy(this.screenSize,e),this.activePageData=t.split("\n");const o=this.activePageData;this.glyphs.length=0,this.actionSequence=[],this.touchTargets={};for(let e=0;e<o.length;++e){let t=o[e],n=0;for(;n<t.length;){switch(t[n]){case"#":[t,n]=this.parseImage(t,n,e,o.length);break;case"[":[t,n]=this.parseButton(t,n,e,o.length)}n+=1}o[e]=t}this.highlightedAction=Math.max(0,Math.min(this.actionSequence.length-1,this.highlightedAction)),this.maxLineLength=0;for(const e of this.activePageData)this.maxLineLength=Math.max(this.maxLineLength,e.length);this.updateScreenSize(e);for(let e in this.touchTargets){const t=this.touchTargets[e];t.rect[0]-=this.offsetX,t.rect[1]-=this.offsetY,t.rect[0]*=this.pixelsPerCharX,t.rect[1]*=this.pixelsPerCharY,t.rect[2]*=this.pixelsPerCharX,t.rect[3]*=this.pixelsPerCharY}}updateScreenSize(e){const t=Ta(e);this.pixelsPerCharX=this.textW*t,this.pixelsPerCharY=this.textH*t;const o=this.maxLineLength*this.pixelsPerCharX,n=this.activePageData.length*this.pixelsPerCharY,r=e[0]/this.pixelsPerCharX,s=e[1]/this.pixelsPerCharY;this.offsetX=Math.floor((e[0]-o)/-2)/this.pixelsPerCharX,this.offsetY=Math.floor((e[1]-n)/-2)/this.pixelsPerCharY,i.ortho(this.mat,this.offsetX,this.offsetX+r,this.offsetY,this.offsetY+s,1,-1)}render(e){const t=this.activePageData,o=this.mat,n=this.maxLineLength,r=Io().background.textureIndex;e.start(o,bo.Font),e.addGlyph(-1.5,-.75,n+1.5,t.length+.75,{textureIndex:r,color:4291829936}),e.addGlyph(-1,-.5,n+1,t.length+.5,{textureIndex:r,color:4279895062}),e.flush();const s=i.create();i.ortho(s,0,this.screenSize[0],0,this.screenSize[1],1,-1),e.start(s,bo.Font);for(let t in this.touchTargets){ar?.controlStates[t]&&(this.highlightedAction=this.actionSequence.indexOf(t));const o=this.touchTargets[t].rect,n=this.highlightedAction<this.actionSequence.length&&this.actionSequence[this.highlightedAction]===t?4291829936:4286586976;e.addGlyph(o[0],o[1],o[0]+o[2],o[1]+o[3],{textureIndex:r,color:n})}e.flush(),e.start(o,bo.Entity);for(const t of this.glyphs){const o=t[1];e.addGlyph(o[0],o[1],o[2]+o[0],o[3]+o[1],{textureIndex:t[0],color:To})}e.flush(),e.start(o,bo.Font);for(let o=0;o<t.length;++o){const n=t.length-(1+o);for(let r=0;r<t[o].length;++r){const s=r;if(" "===t[o])continue;const a=t[o].charCodeAt(r);e.addGlyph(s,n,s+1,n+1,{textureIndex:a,color:4293849343})}}e.flush()}updateData(e){}update(e){}navigateUI(e){let t="";return e("up")?(this.highlightedAction--,this.highlightedAction<0&&(this.highlightedAction=this.actionSequence.length-1)):e("down")?(this.highlightedAction++,this.highlightedAction>=this.actionSequence.length&&(this.highlightedAction=0)):this.highlightedAction<this.actionSequence.length&&e("menuAccept")&&(t=this.actionSequence[this.highlightedAction]),t}onControls(e,t){}}class Mr extends Sr{pages=["LLLOOOT!\n\n$playRestartOrResume$\n[H|helpControls]: Controls help\n[M|helpKey]: Map key\n[D|homeDaily]: Daily challenge\n[O|homeOptions]: Options\n[S|homeStats]: Statistics\n[A|homeAchievements]: Achievements\n[C|credits]: Credits$devMode$"];devSequence="LRLRUD";devSequenceCursor=0;constructor(){super()}update(e){const t=e.hasStartedGame?null!==e.dailyRun?"[R|homePlay]: Resume daily game\n[N|homeRestart]: New game":"[R|homePlay]: Resume game\n[N|homeRestart]: New game":"[P|homePlay]: Play game\n";this.state.set("playRestartOrResume",t),this.state.set("devMode",e.devMode?"\n[X|devMenu]: Developer menu":"")}onControls(e,t){const o=this.navigateUI(t);t("homePlay")||"homePlay"==o||t("menu")||"menu"==o?(ya(e),this.devSequenceCursor=0):t("devMenu")||"devMenu"==o?e.gameMode=fr.DevScreen:t("homeRestart")||"homeRestart"==o?(e.rng=new y,e.dailyRun=null,xa(e)):t("homeDaily")||"homeDaily"==o?e.gameMode=fr.DailyHub:t("homeStats")||"homeStats"==o?e.gameMode=fr.StatsScreen:t("homeAchievements")||"homeAchievements"==o?e.gameMode=fr.AchievementsScreen:t("homeOptions")||"homeOptions"==o?e.gameMode=fr.OptionsScreen:t("helpControls")||"helpControls"==o?e.gameMode=fr.HelpControls:t("helpKey")||"helpKey"==o?e.gameMode=fr.HelpKey:(t("credits")||"credits"==o)&&(e.gameMode=fr.CreditsScreen),t("left")&&this.updateCheatCode("L",e),t("right")&&this.updateCheatCode("R",e),t("up")&&this.updateCheatCode("U",e),t("down")&&this.updateCheatCode("D",e)}updateCheatCode(e,t){this.devSequence[this.devSequenceCursor]!==e&&(this.devSequenceCursor=0),this.devSequence[this.devSequenceCursor]===e&&++this.devSequenceCursor,this.devSequenceCursor>=this.devSequence.length&&(t.devMode=!t.devMode,this.devSequenceCursor=0)}}class _r extends Sr{pages=["Developer Menu\n\n[Alt+<|prevLevel]  Previous level\n[Alt+>|nextLevel]  Next level\n[Alt+C|collectLoot]  Collect loot \n[Alt+S|markSeen]  Mark mansion seen\n[Alt+A|seeAll]  See entire map: $seeAll$\n[Alt+P|guardPatrols]  See guard patrols: $guardPatrols$\n[Alt+V|guardSight]  See guard sight: $guardSight$\n[Alt+F|showFPS]  Show FPS: $showFPS$\n\n$message$\n\n[Esc|menuBack]    Back to menu"];constructor(){super(),this.state.set("message","")}update(e){this.state.set("showFPS",e.fpsInfo.enabled?"Yes":"No"),this.state.set("seeAll",e.seeAll?"Yes":"No"),this.state.set("guardPatrols",e.seeGuardPatrols?"Yes":"No"),this.state.set("guardSight",e.seeGuardSight?"Yes":"No"),this.state.set("showFPS",e.fpsInfo.enabled?"Yes":"No")}onControls(e,t){const o=this.navigateUI(t);if(t("menu")||"menu"==o)ya(e);else if(t("menuBack")||"menuBack"==o)e.gameMode=fr.HomeScreen,this.state.set("message","");else if(t("prevLevel")||"prevLevel"==o)e.hasStartedGame?e.level>0&&(xs(e),Ms(e,e.level-1)):this.state.set("message","START GAME FIRST");else if(t("nextLevel")||"nextLevel"==o)e.hasStartedGame?e.level<e.gameMapRoughPlans.length-1&&(xs(e),Ms(e,e.level+1)):this.state.set("message","START GAME FIRST");else if(t("collectLoot")||"collectLoot"==o)if(e.hasStartedGame){const t=e.gameMap.collectAllLoot();e.player.loot+=t,e.lootStolen+=t,Ys(e)}else this.state.set("message","START GAME FIRST");else t("markSeen")||"markSeen"==o?e.hasStartedGame?(e.gameMap.markAllSeen(),Ys(e)):this.state.set("message","START GAME FIRST"):t("seeAll")||"seeAll"==o?(e.seeAll=!e.seeAll,this.state.set("message","")):t("guardSight")||"guardSight"==o?(e.seeGuardSight=!e.seeGuardSight,this.state.set("message","")):t("guardPatrols")||"guardPatrols"==o?(e.seeGuardPatrols=!e.seeGuardPatrols,this.state.set("message","")):(t("showFPS")||"showFPS"==o)&&(e.fpsInfo.enabled=!e.fpsInfo.enabled,this.state.set("message",""))}}class Tr extends Sr{pages=["Options\n\n         Sound volume: $volumeLevel$%\n[=|volumeUp]      Volume up\n[-|volumeDown]      Volume down\n[0|volumeMute]      Volume mute: $volumeMute$\n[9|guardMute]      Guard mute: $guardMute$\n[J|screenShakeEnabled]      Jolt screen: $screenShakeEnabled$\n[K|keyRepeatRate]      Key repeat rate $keyRepeatRate$ms\n[D|keyRepeatDelay]      Key repeat delay $keyRepeatDelay$ms\n[Ctrl+R|forceRestart] Reset data\n\n[Esc|menuBack]    Back to menu"];update(e){this.state.set("volumeLevel",(100*e.soundVolume).toFixed(0)),this.state.set("volumeMute",e.volumeMute?"Yes":"No"),this.state.set("guardMute",e.guardMute?"Yes":"No"),this.state.set("screenShakeEnabled",e.screenShakeEnabled?"Yes":"No"),this.state.set("keyRepeatRate",e.keyRepeatRate.toString()),this.state.set("keyRepeatDelay",e.keyRepeatDelay.toString())}onControls(e,t){const o=this.navigateUI(t);if(t("menu")||"menu"==o)ya(e);else if(t("menuBack")||"menuBack"==o)e.gameMode=fr.HomeScreen;else if(t("volumeUp")||"volumeUp"==o){ia(e,Math.min(1,e.soundVolume+.1))}else if(t("volumeDown")||"volumeDown"==o){ia(e,Math.max(.1,e.soundVolume-.1))}else t("volumeMute")||"volumeMute"==o?ua(e,!e.volumeMute):t("guardMute")||"guardMute"==o?ca(e,!e.guardMute):t("screenShakeEnabled")||"screenShakeEnabled"===o?function(e,t){e.screenShakeEnabled=t,window.localStorage.setItem("LLL/screenShakeEnabled",t?"true":"false")}(e,!e.screenShakeEnabled):t("keyRepeatRate")||"keyRepeatRate"==o?(e.keyRepeatRate-=50,e.keyRepeatRate<100&&(e.keyRepeatRate=400),window.localStorage.setItem("LLL/keyRepeatRate",e.keyRepeatRate.toString())):t("keyRepeatDelay")||"keyRepeatDelay"==o?(e.keyRepeatDelay-=50,e.keyRepeatDelay<100&&(e.keyRepeatDelay=500),window.localStorage.setItem("LLL/keyRepeatDelay",e.keyRepeatDelay.toString())):(t("forceRestart")||"forceRestart"==o)&&(window.localStorage.clear(),e.persistedStats=ha(),e.gameMode=fr.HomeScreen,ia(e,1),ua(e,!1),ca(e,!1))}}class wr extends Sr{pages=["Help: Keyboard Controls\n\n  Move: Arrows / WASD / HJKL\n  Wait: Space / Z / Period / Numpad5\n  Leap/Run: Shift + move (unlimited!)\n  Leap/Run (Toggle): F / Numpad+\n  Zoom View: [ / ]\n  Scroll View: Control + move\n  Recenter View: Control + wait\n  Volume: (Mute/Down/Up) 0 / - / =\n  Guard Mute (Toggle): 9\n  Show last speech: Tab\n\nDisable NumLock if using numpad\nTouch and gamepad also supported\n\n[Esc|menuBack] Back to menu","Help: Touch Controls\n\n  Move: #016# / #017# / #018# / #019#\n  Wait: #020#\n  Leap/Run: #21# + move (unlimited!)\n  Zoom View: #22# / #23#\n  Scroll View: Touch and drag\n  Menu: #27#\n  Navigate menu: #018# / #019# / #20#\n\nKeyboard and gamepad also supported\n\n[Esc|menuBack] Back to menu","Help: Gamepad Controls\n\n  Move: Left Stick/Pad\n  Wait: Button2\n  Leap/Run: Button1 + move\n  Zoom View: Left / Right trigger\n  Scroll View: Right stick\n  Recenter View: Right bumper\n  Show last speech: Left bumper\n\nKeyboard and touch also supported\n\n[Esc|menuBack] Back to menu"];update(e){this.activePage=ar===e.keyboardController?0:ar===e.touchController?1:2}onControls(e,t){const o=this.navigateUI(t);t("menu")||"menu"==o?ya(e):(t("menuBack")||"menuBack"==o)&&(e.gameMode=fr.HomeScreen)}}class Lr extends Sr{pages=[`Map Key\n\n#${Co().playerTiles.normal.textureIndex}# Thief: You!\n#${Co().npcTiles[3].textureIndex}# Guard: Avoid them!\n#${Co().itemTiles[ne.Coin].textureIndex}# Loot: Steal it!\n#${Co().itemTiles[ne.Treasure].textureIndex}# Bonus loot: Steal it?\n#${Co().itemTiles[ne.Bush].textureIndex}# Tree: Hiding place\n#${Co().itemTiles[ne.Table].textureIndex}# Table: Hiding place\n#${Co().itemTiles[ne.Chair].textureIndex}# Stool: Guards sit here\n#${Co().itemTiles[ne.TorchLit].textureIndex}# Torch: Douse it\n#${Co().namedTiles.uiWindowTile.textureIndex}# Window: One-way escape\n#${Co().namedTiles.uiCreakyTile.textureIndex}# Creaky floor: Alerts guards\n\n[Esc|menuBack] Back to menu`];update(e){}onControls(e,t){const o=this.navigateUI(t);t("menu")||"menu"==o?ya(e):(t("menuBack")||"menuBack"==o)&&(e.gameMode=fr.HomeScreen)}}class Ar extends Sr{pages=["Credits\n\nMade for 2023 Seven-Day Roguelike Challenge\nExpanded Post-Jam Edition\n\nby James McNeill and Damien Moore\n\nAdditional voices by Evan Moore\nAdditional assistance by Mike Gaffney\nTesting by Mendi Carroll and Tom Elmer\nSpecial thanks to Mendi Carroll\n\n[Esc|menuBack] Back to menu"];update(e){}onControls(e,t){const o=this.navigateUI(t);t("menu")||"menu"==o?ya(e):(t("menuBack")||"menuBack"==o)&&(e.gameMode=fr.HomeScreen)}}class br extends Sr{pages=["The Daily Challenge\n\nPlay a new seeded game each day and \ncompare results with your rivals.\n\n$dailyStatus$\nPlays:             $plays$\nWins:              $wins$\nBest score:        $bestScore$\n\n$playMode$\n$timeLeft$\n\nLast game played:  $lastPlayed$\nLast score:        $lastScore$\n[C|copyScore] Copy last game to clipboard\n$copyState$\n\n[Esc|menuBack] Back to menu"];stateCopied=!1;prevDay(e){const t=new Date(e);return t.setDate(t.getDate()-1),t}nextDay(e){const t=new Date(e);t.setDate(t.getDate()+1);const o=new Date;return o.setUTCHours(24,0,0,0),t>o?e:t}timeToMidnightUTC(){const e=new Date,t=new Date(e);t.setUTCHours(24,0,0,0);const o=t.getTime()-e.getTime(),n=Math.floor(o/1e3%60),r=Math.floor(o/6e4%60);return Math.floor(o/36e5%24).toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")}update(e){const t=e.persistedStats.lastPlayedDailyGame;if(e.persistedStats.currentDailyGameId!==Aa()&&(e.persistedStats.currentDailyGameId=Aa(),e.persistedStats.currentDailyPlays=0,e.persistedStats.currentDailyWins=0,e.persistedStats.currentDailyWinFirstTry=0,e.persistedStats.currentDailyBestScore=0,ma(e.persistedStats)),null!==t&&e.persistedStats.currentDailyPlays>0){if(0===e.persistedStats.currentDailyWins)this.state.set("dailyStatus",e.persistedStats.currentDailyGameId+" game played");else if(0===e.persistedStats.currentDailyWinFirstTry)this.state.set("dailyStatus",e.persistedStats.currentDailyGameId+" game won");else{const t=Co().itemTiles[ne.TorchLit].textureIndex;this.state.set("dailyStatus",e.persistedStats.currentDailyGameId+` game won first try #${t}#`)}this.state.set("timeLeft","Time to next game: "+this.timeToMidnightUTC()),this.state.set("playMode","[P|homePlay] Play it again")}else this.state.set("dailyStatus",e.persistedStats.currentDailyGameId+" game ready"),this.state.set("timeLeft","Time left to play: "+this.timeToMidnightUTC()),this.state.set("playMode","[P|homePlay] Play now");const o=t?.daily??"None",n=t?.totalScore??0;this.state.set("plays",e.persistedStats.currentDailyPlays.toString()),this.state.set("wins",e.persistedStats.currentDailyWins.toString()),this.state.set("lastPlayed",o),this.state.set("lastScore",n.toString()),this.state.set("bestScore",e.persistedStats.currentDailyBestScore.toString()),this.state.set("copyState",this.stateCopied?"    COPIED!":"")}onControls(e,t){const o=this.navigateUI(t);if(t("menu")||"menu"==o)ya(e);else if(t("menuBack")||"menuBack"==o)this.stateCopied=!1,e.gameMode=fr.HomeScreen;else if(t("homePlay")||"homePlay"==o)this.stateCopied=!1,va(e),e.hasStartedGame=!0;else if(t("copyScore")||"copyScore"==o){vr(e.persistedStats.lastPlayedDailyGame??{totalScore:0,turns:0,numLevels:0,numCompletedLevels:0,numGhostedLevels:0,daily:null,timeStarted:Date.now(),timeEnded:0},e.achievements),this.stateCopied=!0}}}class Rr extends Sr{pages=["Play Statistics\n\nAll games\nTotal plays:             $totalPlays$\nTotal wins:              $totalWins$\nTotal mansions ghosted:  $totalGhosts$\nBest score:              $bestScore$\n\nDaily games\nTotal plays:             $allDailyPlays$\nTotal wins:              $allDailyWins$\nTotal wins first try:    $allDailyWinsFirstTry$\n\n[Esc|menuBack] Back to menu"];update(e){this.state.set("totalPlays",e.persistedStats.totalPlays.toString()),this.state.set("totalWins",e.persistedStats.totalWins.toString()),this.state.set("totalGhosts",e.persistedStats.totalGhosts.toString()),this.state.set("bestScore",e.persistedStats.bestScore.toString()),this.state.set("allDailyPlays",e.persistedStats.allDailyPlays.toString()),this.state.set("allDailyWins",e.persistedStats.allDailyWins.toString()),this.state.set("allDailyWinsFirstTry",e.persistedStats.allDailyWinsFirstTry.toString())}onControls(e,t){const o=this.navigateUI(t);t("menu")||"menu"==o?ya(e):(t("menuBack")||"menuBack"==o)&&(e.gameMode=fr.HomeScreen)}}class kr extends Sr{pages=["Achievements\n\nEarn achievements by meeting certain\nrequirements when you complete a game.\n\n $victoryAchieved$ Victory: winning is enough...\n $hungryAchieved$ Hungry: collect all food\n $treasureAchieved$ Looty: steal all bonus loot\n $healthyAchieved$ Healthy: take no damage\n $steppyAchieved$ Steppy: no leap where a step works\n $thumpyAchieved$ Thumpy: knock out all guards\n $softyAchieved$ Softy: no knockouts\n $mappingAchieved$ Looky: map 100% before looting anything\n $facelessAchieved$ Ghosty: ghost every level\n $zippyAchieved$ Zippy: under par time on every level\n $ghostyAchieved$ Mosty Ghosty: ghost with no knockouts\n\n[Esc|menuBack] Back to menu"];update(e){const t=Co().achievementIcons,o=`#${Co().achievementIncompleteIcon.textureIndex}#`,n=`#${Co().achievementFailedIcon.textureIndex}#`,r=null!==e.dailyRun;function s(e,t,s,a,i){const l=s>0?`#${i.textureIndex}#`:a.failed||r?n:o;e.state.set(t,l)}s(this,"victoryAchieved",e.persistedStats.achievementVictory,e.achievements.achievementVictory,t.achievementVictory),s(this,"ghostyAchieved",e.persistedStats.achievementGhosty,e.achievements.achievementGhosty,t.achievementGhosty),s(this,"zippyAchieved",e.persistedStats.achievementZippy,e.achievements.achievementZippy,t.achievementZippy),s(this,"hungryAchieved",e.persistedStats.achievementHungry,e.achievements.achievementHungry,t.achievementHungry),s(this,"thumpyAchieved",e.persistedStats.achievementThumpy,e.achievements.achievementThumpy,t.achievementThumpy),s(this,"softyAchieved",e.persistedStats.achievementSofty,e.achievements.achievementSofty,t.achievementSofty),s(this,"steppyAchieved",e.persistedStats.achievementSteppy,e.achievements.achievementSteppy,t.achievementSteppy),s(this,"healthyAchieved",e.persistedStats.achievementHealthy,e.achievements.achievementHealthy,t.achievementHealthy),s(this,"treasureAchieved",e.persistedStats.achievementTreasure,e.achievements.achievementTreasure,t.achievementTreasure),s(this,"mappingAchieved",e.persistedStats.achievementMapping,e.achievements.achievementMapping,t.achievementMapping),s(this,"facelessAchieved",e.persistedStats.achievementFaceless,e.achievements.achievementFaceless,t.achievementFaceless)}onControls(e,t){const o=this.navigateUI(t);t("menu")||"menu"==o?ya(e):(t("menuBack")||"menuBack"==o)&&(e.gameMode=fr.HomeScreen)}}class Cr extends Sr{pages=["$levelType$ Looted! ($level$/$numLevels$)\n\n$levelStats$Loot:        $lootScore$$treasureScore$$foodScore$\nGhost:       $ghostBonus$\nSpeed:       $timeBonus$\nTotal:       $levelScore$\n\nCumulative:  $totalScore$\n\n[N|startLevel]: Next"];update(e){const t=_s(e),o=Math.max(0,t-e.turns),n=10*e.lootStolen,r=Ts(e),s=5*e.levelStats.extraFoodCollected,a=0===e.levelStats.numSpottings?n:0,i=n+r+s+o+a;let l="Turns:       "+e.turns+"\n";e.levelStats.numSpottings>0&&(l+="Spottings:   "+e.levelStats.numSpottings+"\n"),e.levelStats.damageTaken>0&&(l+="Injuries:    "+e.levelStats.damageTaken+"\n"),e.levelStats.numKnockouts>0&&(l+="Knockouts:   "+e.levelStats.numKnockouts+"\n"),l.length>0&&(l+="\n"),this.state.set("levelType",function(e){switch(e){case K.Manor:case K.ManorRed:return"Manor";case K.Mansion:return"Mansion";case K.Fortress:return"Fortress"}}(e.gameMapRoughPlans[e.level].levelType)),this.state.set("level",(e.level+1).toString()),this.state.set("numLevels",e.gameMapRoughPlans.length.toString()),this.state.set("levelStats",l),this.state.set("lootScore",(10*e.lootStolen).toString()),this.state.set("treasureScore",e.gameMap.treasures.length>0?"\nBonus Loot:  "+r:""),this.state.set("foodScore",s>0?"\nFood:        "+s:""),this.state.set("timeBonus",o.toString()),this.state.set("ghostBonus",a.toString()),this.state.set("levelScore",i.toString()),this.state.set("totalScore",e.gameStats.totalScore.toString())}onControls(e,t){const o=this.navigateUI(t);(t("startLevel")||"startLevel"==o)&&(e.level>=e.gameMapRoughPlans.length-1?function(e){const t=Math.random()<.1?"easterEgg":"victorySong";e.sounds[t].play(.5),e.persistedStats.totalWins++;const o=e.gameStats.totalScore;e.persistedStats.bestScore=Math.max(e.persistedStats.bestScore,o);const n={score:o,date:Aa(),turns:e.totalTurns,level:e.level+1};Ss(e,"gameEnd"),e.persistedStats.scores.push(n),e.dailyRun&&(e.persistedStats.currentDailyBestScore=Math.max(e.persistedStats.currentDailyBestScore,o),e.persistedStats.currentDailyWins++,e.persistedStats.currentDailyWinFirstTry=1===e.persistedStats.currentDailyPlays?1:e.persistedStats.currentDailyWinFirstTry,e.persistedStats.lastPlayedDailyGame=structuredClone(e.gameStats),e.persistedStats.allDailyWins++,e.persistedStats.allDailyWinsFirstTry+=1===e.persistedStats.currentDailyPlays?1:0);ma(e.persistedStats),e.dailyRun||function(e){let t,o;for(t in e.achievements)t in e.persistedStats&&(o=t,e.achievements[t].failed||(e.persistedStats[o]++,pa(o,e.persistedStats[o])))}(e);e.gameMode=fr.Win}(e):Ms(e,e.level+1))}}class Ir extends Sr{pages=["         You are dead!\n\nStatistics\nCompleted:     $level$ of $numLevels$\nGhosted:       $numGhostedLevels$\nTotal Score:   $totalScore$\n\n[N|homeRestart]:   New game\n[C|copyScore]:   Copy score to clipboard\n$copyState$\n[Esc|menuBack]: Exit to home screen"];stateCopied=!1;update(e){this.state.set("level",e.level.toString()),this.state.set("numLevels",e.gameMapRoughPlans.length.toString()),this.state.set("numGhostedLevels",e.gameStats.numGhostedLevels.toString()),this.state.set("totalScore",e.gameStats.totalScore.toString()),this.state.set("copyState",this.stateCopied?"       COPIED!":"")}onControls(e,t){const o=this.navigateUI(t);t("homeRestart")||"homeRestart"==o?(this.stateCopied=!1,e.rng=new y,e.dailyRun=null,xa(e)):t("menuBack")||"menuBack"==o?(this.stateCopied=!1,e.rng=new y,e.dailyRun=null,xa(e),e.gameMode=fr.HomeScreen,e.hasStartedGame=!1):(t("copyScore")||"copyScore"==o)&&(vr(e.gameStats,e.achievements),this.stateCopied=!0)}}class Pr extends Sr{pages=["Mission Complete!\n\nStatistics\nGhosted:       $numGhostedLevels$ of $numLevels$\nTotal Score:   $totalScore$$achievements$\n\n[N|homeRestart]:   New game\n[C|copyScore]:   Copy score to clipboard\n$copyState$\n[Esc|menuBack]: Exit to home screen"];stateCopied=!1;achievementsLine=void 0;update(e){if(this.state.set("numLevels",e.gameMapRoughPlans.length.toString()),this.state.set("numGhostedLevels",e.gameStats.numGhostedLevels.toString()),this.state.set("totalScore",e.gameStats.totalScore.toString()),this.state.set("copyState",this.stateCopied?"       COPIED!":""),void 0===this.achievementsLine){let t;for(t in this.achievementsLine="",e.achievements)e.achievements[t].failed||e.dailyRun||(this.achievementsLine+=`#${Co().achievementIcons[t].textureIndex}#`);this.achievementsLine.length>0&&(this.achievementsLine="\nAchievements:  "+this.achievementsLine),this.state.set("achievements",this.achievementsLine)}}onControls(e,t){const o=this.navigateUI(t);t("homeRestart")||"homeRestart"==o?(this.stateCopied=!1,e.rng=new y,e.dailyRun=null,this.achievementsLine=void 0,xa(e)):t("menuBack")||"menuBack"==o?(this.stateCopied=!1,e.rng=new y,e.dailyRun=null,xa(e),e.gameMode=fr.HomeScreen,this.achievementsLine=void 0,e.hasStartedGame=!1):(t("copyScore")||"copyScore"==o)&&(vr(e.gameStats,e.achievements),this.stateCopied=!0)}}function Hr(){return{achievementVictory:new Dr,achievementHungry:new Nr,achievementTreasure:new Br,achievementHealthy:new Or,achievementSteppy:new Gr,achievementThumpy:new Vr,achievementSofty:new Ur,achievementMapping:new zr,achievementFaceless:new Xr,achievementZippy:new Fr,achievementGhosty:new Wr}}class Er{failed=!1;unicodeBadge="";update(e,t){"gameStart"===t&&(this.failed=!1)}}class Dr extends Er{unicodeBadge="";update(e,t){super.update(e,t)}}class Wr extends Er{unicodeBadge="";update(e,t){super.update(e,t),"turnEnd"===t&&(e.levelStats.numSpottings>0||e.levelStats.numKnockouts>0)&&(this.failed=!0)}}class Fr extends Er{unicodeBadge="";update(e,t){super.update(e,t),"turnEnd"===t&&e.turns>_s(e)&&(this.failed=!0)}}class Gr extends Er{unicodeBadge="";update(e,t){super.update(e,t),"turnEnd"===t&&e.levelStats.steppableLeaps>0&&(this.failed=!0)}}class Vr extends Er{unicodeBadge="";update(e,t){super.update(e,t),"levelEnd"===t&&e.gameMap.guards.some((e=>e.mode!==E.Unconscious))&&(this.failed=!0)}}class Ur extends Er{unicodeBadge="";update(e,t){super.update(e,t),"levelEnd"===t&&e.levelStats.numKnockouts>0&&(this.failed=!0)}}class Nr extends Er{unicodeBadge="";update(e,t){super.update(e,t),"levelEnd"===t&&e.gameMap.items.some((e=>e.type===ne.Health))&&(this.failed=!0)}}class Or extends Er{unicodeBadge="";update(e,t){super.update(e,t),"turnEnd"===t&&e.player.health<e.player.healthMax&&(this.failed=!0)}}class Br extends Er{unicodeBadge="";update(e,t){super.update(e,t),"levelEnd"===t&&e.gameMap.items.some((e=>e.type===ne.Treasure))&&(this.failed=!0)}}class zr extends Er{unicodeBadge="";update(e,t){super.update(e,t),"turnEnd"===t&&(this.failed||!(e.lootStolen>0||e.treasureStolen>0||e.levelStats.extraFoodCollected>0)||e.gameMap.allSeen()||(this.failed=!0))}}class Xr extends Er{unicodeBadge="";update(e,t){super.update(e,t),"turnEnd"===t&&e.levelStats.numSpottings>0&&(this.failed=!0)}}const qr={numGameMaps:10,totalGameLoot:100};let Yr;var jr;let $r;var Kr;(jr=Yr||(Yr={}))[jr.Creak=0]="Creak",jr[jr.Splash=1]="Splash",jr[jr.Thud=2]="Thud",jr[jr.Alarm=3]="Alarm",jr[jr.BangDoor=4]="BangDoor",jr[jr.BangChair=5]="BangChair",(Kr=$r||($r={}))[Kr.Normal=0]="Normal",Kr[Kr.AttemptedLeap=1]="AttemptedLeap",Kr[Kr.AttemptedLeapBounceBack=2]="AttemptedLeapBounceBack";const Qr=0,Jr=!1,Zr=ko(),es=Co(),ts=Io(),os=document.querySelector("canvas");let ns=os.clientWidth,rs=os.clientHeight;window.onload=function(){Promise.all([Zs(ts.imageSrc,ts.image),Zs(Zr.imageSrc,Zr.image),Zs(es.imageSrc,es.image)]).then(gs)};const ss=8,as=16,is=16,ls=16,us=1.1892,cs=4,ds=-4,ps=16,hs=.5,ms="New Game: Ctrl+R\nMenu: Esc/Slash",fs="Retry: Ctrl+R\nMenu: Esc/Slash";function gs(e){document.body.addEventListener("keydown",(e=>n())),os.addEventListener("mousedown",(e=>n())),os.addEventListener("touchstart",(e=>n())),window.addEventListener("gamepadconnected",(e=>n()));const t=new uo(os,Zr,es,ts),o=function(e,t,o,n,r){const s=new y,i=Qr,l=be(qr.numGameMaps,qr.totalGameLoot,s),u=ke(l[i]),c=ha();let d=parseInt(window.localStorage.getItem("LLL/keyRepeatRate")??"175");isNaN(d)&&(d=175);let p=parseInt(window.localStorage.getItem("LLL/keyRepeatDelay")??"250");isNaN(p)&&(p=250);let h=parseFloat(window.localStorage.getItem("LLL/soundVolume")??"1.0");isNaN(h)&&(h=1);let m=window.localStorage.getItem("LLL/volumeMute");const f=null!==m&&"true"===m;let g=window.localStorage.getItem("LLL/guardMute");const x=null!==g&&"true"===g;let v=window.localStorage.getItem("LLL/screenShakeEnabled");const S=null===v||"true"===v,M=new ie(u.playerStartPos,!1),T={gameStats:{totalScore:0,turns:0,numLevels:0,numCompletedLevels:0,numGhostedLevels:0,daily:null,timeStarted:0,timeEnded:0},persistedStats:c,levelStats:{numKnockouts:0,numSpottings:0,damageTaken:0,extraFoodCollected:0,steppableLeaps:0},achievements:Hr(),lightStates:Array(u.lightCount).fill(0),particles:[],tLast:void 0,dt:0,idleTimer:5,rng:s,fpsInfo:{enabled:!1,msgFPS:"FPS: --",frames:0,cumulativeTime:0,worstFrame:0,drops:0},devMode:!1,dailyRun:null,leapToggleActive:!1,healthBarState:{damageDisplayTimer:0,healing:!1,size:1,enlargeTimeRemaining:0,heartFlashRemaining:Array(M.healthMax).fill(0)},gameMode:fr.HomeScreen,textWindows:{[fr.HomeScreen]:new Mr,[fr.OptionsScreen]:new Tr,[fr.StatsScreen]:new Rr,[fr.AchievementsScreen]:new kr,[fr.DailyHub]:new br,[fr.HelpControls]:new wr,[fr.HelpKey]:new Lr,[fr.MansionComplete]:new Cr,[fr.Dead]:new Ir,[fr.Win]:new Pr,[fr.CreditsScreen]:new Ar,[fr.DevScreen]:new _r},player:M,ambience:yr.Outdoor,ambientSoundPool:n,oldPlayerPos:a.clone(u.playerStartPos),hintMessage:"",numStepMoves:0,numLeapMoves:0,numWaitMoves:0,numZoomMoves:0,hasEnteredMansion:!1,experiencedPlayer:!1,finishedLevel:!1,hasStartedGame:!1,zoomLevel:cs,seeAll:Jr,seeGuardSight:!1,seeGuardPatrols:!1,camera:aa(u.playerStartPos,cs),level:i,turns:0,totalTurns:0,lootStolen:0,lootAvailable:l[i].totalLoot,treasureStolen:0,gameMapRoughPlans:l,gameMap:u,sounds:e,subtitledSounds:t,activeSoundPool:o,soundVolume:h,guardMute:x,volumeMute:f,screenShakeEnabled:S,keyRepeatActive:void 0,keyRepeatRate:d,keyRepeatDelay:p,touchController:r,gamepadManager:new pr,keyboardController:new cr,popups:new _};return ga(u,T),fa(u,T),G(T),Ys(T),Vs(T,T.player.pos),T}({},{},new er,new er,new mr(os));function n(){if(0==Object.keys(o.sounds).length){rr(o.sounds,o.subtitledSounds,o.activeSoundPool,o.ambientSoundPool),Oo.volume(o.soundVolume),Oo.mute(la(o));for(const e in o.subtitledSounds)o.subtitledSounds[e].mute=o.guardMute}}window.addEventListener("blur",(e=>{Oo.mute(la(o))})),window.addEventListener("focus",(e=>{Oo.mute(la(o))}));new ResizeObserver((e=>{ns=os.clientWidth,rs=os.clientHeight,o.camera.snapped=!1,screen.orientation.unlock()})).observe(os),requestAnimationFrame((e=>Sa(e,t,o)))}function ys(e){if(e.gamepadManager.updateGamepadStates(),null!==ar){e.gameMode===fr.Mansion?function(o){o.controlStates.panLeft&&(e.camera.panning=!0,e.camera.position[0]-=1/e.camera.zoom);o.controlStates.panRight&&(e.camera.panning=!0,e.camera.position[0]+=1/e.camera.zoom);o.controlStates.panUp&&(e.camera.panning=!0,e.camera.position[1]+=1/e.camera.zoom);o.controlStates.panDown&&(e.camera.panning=!0,e.camera.position[1]-=1/e.camera.zoom);o.controlStates.snapToPlayer&&(e.camera.panning=!1);if(t("left"))e.leapToggleActive!==o.controlStates.jump?Ns(e,-1,0):Fs(e,-1,0,$r.Normal);else if(t("right"))e.leapToggleActive!==o.controlStates.jump?Ns(e,1,0):Fs(e,1,0,$r.Normal);else if(t("down"))e.leapToggleActive!==o.controlStates.jump?Ns(e,0,-1):Fs(e,0,-1,$r.Normal);else if(t("up"))e.leapToggleActive!==o.controlStates.jump?Ns(e,0,1):Fs(e,0,1,$r.Normal);else if(t("wait"))!function(e){const t=e.player;if(t.health<=0)return void Us(e);t.idle=!1,e.idleTimer=5,e.camera.panning=!1,e.touchController.clearMotion(),Xs(e),e.gameMap.identifyAdjacentCells(t.pos),t.pickTarget=null,t.preNoisy=!1,++e.numWaitMoves,qs(e),Vs(e,e.player.pos)}(e);else if(t("menu"))e.player.health>0?e.gameMode=fr.HomeScreen:e.gameMode=fr.Dead;else if(t("jumpToggle"))e.leapToggleActive=!e.leapToggleActive;else if(t("seeAll"))e.devMode&&(e.seeAll=!e.seeAll);else if(t("collectLoot")){if(e.devMode){const t=e.gameMap.collectAllLoot();e.player.loot+=t,e.lootStolen+=t,Ys(e)}}else if(t("forceRestart"))e.dailyRun?va(e):(e.rng=new y,e.dailyRun=null,xa(e));else if(t("nextLevel"))e.devMode&&e.level<e.gameMapRoughPlans.length-1&&(xs(e),Ms(e,e.level+1));else if(t("resetState"))e.devMode&&function(e){const t=ke(e.gameMapRoughPlans[e.level]);e.player=new ie(t.playerStartPos,null!==e.dailyRun),e.lightStates=Array(t.lightCount).fill(0),ga(t,e),fa(t,e),e.turns=0,e.totalTurns=0,e.lootStolen=0,e.lootAvailable=e.gameMapRoughPlans[e.level].totalLoot,e.treasureStolen=0,vs(e.levelStats),Ss(e,"gameStart"),e.hintMessage="",Js(e),e.finishedLevel=!1,e.ambience=yr.Outdoor,e.camera=aa(t.playerStartPos,e.zoomLevel),e.gameMap=t,e.popups.reset(),e.activeSoundPool.empty(),e.ambientSoundPool.empty(),G(e),Ys(e),Vs(e,e.player.pos),Oo.stop(),ks(e),null===e.player.torchAnimation&&console.log("WARNING: No player torch added")}(e);else if(t("prevLevel"))e.devMode&&e.level>0&&(xs(e),Ms(e,e.level-1));else if(t("showFPS"))e.devMode&&(e.fpsInfo.enabled=!e.fpsInfo.enabled);else if(t("guardSight"))e.devMode&&(e.seeGuardSight=!e.seeGuardSight);else if(t("guardPatrols"))e.devMode&&(e.seeGuardPatrols=!e.seeGuardPatrols);else if(t("markSeen"))e.devMode&&(e.gameMap.markAllSeen(),Ys(e));else if(t("zoomIn"))!function(e){e.zoomLevel=Math.min(ps,e.zoomLevel+1),e.camera.panning=!1,++e.numZoomMoves,Ys(e)}(e);else if(t("zoomOut"))!function(e){e.zoomLevel=Math.max(ds,e.zoomLevel-1),e.camera.panning=!1,++e.numZoomMoves,Ys(e)}(e);else if(t("guardMute"))ca(e,!e.guardMute),e.popups.setNotification("Guard speech: "+(e.guardMute?"disabled":"enabled"),e.player.pos);else if(t("idleCursorToggle")){switch(e.player.idleCursorType){case"orbs":e.player.idleCursorType="off";break;case"off":e.player.idleCursorType="orbs"}e.player.idle=!1,e.idleTimer=2,e.popups.setNotification("Player idle cursor: "+e.player.idleCursorType,e.player.pos)}else if(t("volumeMute"))ua(e,!e.volumeMute),e.popups.setNotification("Sound: "+(e.volumeMute?"disabled":"enabled"),e.player.pos);else if(t("volumeDown")){const t=Math.max(.1,e.soundVolume-.1);ia(e,t),e.popups.setNotification("Sound volume: "+Math.floor(100*e.soundVolume+.5)+"%",e.player.pos)}else if(t("volumeUp")){const t=Math.min(1,e.soundVolume+.1);ia(e,t),e.popups.setNotification("Sound volume: "+Math.floor(100*e.soundVolume+.5)+"%",e.player.pos)}else t("showSpeech")&&e.popups.toggleShow(e.player.pos)}(ar):e.textWindows[e.gameMode]?.onControls(e,(function(e){let t=!1;if(null===ar)return!1;const o=ar.controlStates;if(!(e in o))return!1;t=ar.currentFramePresses.has(e),t&&(ar.controlTimes[e],Date.now());return t})),e.touchController.endFrame(),e.keyboardController.endFrame();for(const t in e.gamepadManager.gamepads)e.gamepadManager.gamepads[t].endFrame()}function t(t){const o=Date.now();let n=!1;if(null===ar)return!1;const r=ar.controlStates;if(!(t in r))return!1;const s=e.keyRepeatActive===t?e.keyRepeatRate:e.keyRepeatDelay;return n=ar.currentFramePresses.has(t)||r[t]&&o-ar.controlTimes[t]>s,n&&(r[t]&&o-ar.controlTimes[t]>s&&(e.keyRepeatActive=t),ar.controlTimes[t]=o),r[t]||e.keyRepeatActive!==t||(e.keyRepeatActive=void 0),n}}function xs(e){if(e.gameMapRoughPlans[e.level].played)return;e.gameMapRoughPlans[e.level].played=!0;const t=0===e.levelStats.numSpottings,o=_s(e),n=Math.max(0,o-e.turns),r=10*e.lootStolen,s=r+Ts(e)+5*e.levelStats.extraFoodCollected+n+(t?r:0);e.gameStats.totalScore+=s,e.gameStats.turns+=e.totalTurns,e.gameStats.numLevels=e.gameMapRoughPlans.length,e.gameStats.numCompletedLevels=e.level+1,e.gameStats.numGhostedLevels+=t?1:0,e.gameStats.daily=e.dailyRun,e.gameStats.timeEnded=Date.now()}function vs(e){e.numKnockouts=0,e.numSpottings=0,e.damageTaken=0,e.extraFoodCollected=0,e.steppableLeaps=0}function Ss(e,t){let o;for(o in e.achievements)e.achievements[o].update(e,t)}function Ms(e,t){e.level=t,e.level>=e.gameMapRoughPlans.length?xa(e):(e.activeSoundPool.empty(),e.ambientSoundPool.empty(),e.gameMap=ke(e.gameMapRoughPlans[e.level]),e.lightStates=new Array(e.gameMap.lightCount).fill(0),ga(e.gameMap,e),fa(e.gameMap,e),e.hintMessage="",Js(e),e.finishedLevel=!1,e.turns=0,e.lootStolen=0,e.treasureStolen=0,e.lootAvailable=e.gameMapRoughPlans[e.level].totalLoot,vs(e.levelStats),a.copy(e.player.pos,e.gameMap.playerStartPos),e.player.dir=a.fromValues(0,-1),e.player.noisy=!1,e.player.preNoisy=!1,e.player.hasVaultKey=!1,e.player.damagedLastTurn=!1,e.player.turnsRemainingUnderwater=ae,e.player.animation=null,e.popups.reset(),e.camera=aa(e.gameMap.playerStartPos,e.zoomLevel),e.camera.zoomed=0!==t,e.gameMode=fr.Mansion,e.hasEnteredMansion=!1,G(e),Ys(e),Vs(e,e.player.pos),ks(e))}function _s(e){const t=(e.gameMap.numCells()-e.gameMap.numPreRevealedCells)*e.gameMap.backtrackingCoefficient,o=e.gameMap.guards.length,n=t/3.5,r=8*o+1e3*(o/t);return 10*Math.ceil((n+r)/10)}function Ts(e){const t=10*e.lootStolen;return e.gameMap.treasures.reduce(((e,o)=>e+(o.stolen?o.switches.length>0?t:20:0)),0)}const ws=["Use darkness or hiding places to avoid guards","Escape out windows with Shift+Dir","Knock out adjacent, unaware guards with Shift+Dir","Pickpocket by following exactly for two turns","Zoom view with [ and ]","Bang walls to make noise with Dir, then Shift+Dir","'Ghost' by never being fully seen","Knock out spotting guard by leaping onto them"];function Ls(e){xs(e),Ss(e,"levelEnd"),e.activeSoundPool.empty(),e.ambientSoundPool.empty(),e.sounds.levelCompleteJingle.play(.35),0===e.levelStats.numSpottings&&(e.persistedStats.totalGhosts++,pa("totalGhosts",e.persistedStats.totalGhosts)),e.level<ws.length?e.hintMessage="Hint: "+ws[e.level]:e.hintMessage="",e.gameMode=fr.MansionComplete}function As(e,t){return e.gameMap.hasLootAt(t)&&!e.gameMap.items.find((e=>e.type===ne.TreasureLock&&e.pos.equals(t)))}function bs(e,t,o){const n=e.gameMap.collectLootAt(t);if(0===n.length)return!1;let r=!1,s=!1;for(const i of n){let n=0;if(i.type===ne.Coin)++e.player.loot,++e.lootStolen,r=!0;else if(i.type===ne.Treasure){r=!0,++e.treasureStolen;for(const o of e.gameMap.treasures)if(o.posTreasure.equals(i.pos)&&(o.stolen=!0,e.gameMapRoughPlans[e.level].levelType===K.Fortress)){for(const t of e.gameMap.guards)t.angry=!0,t.mode===E.Unconscious&&(t.modeTimeout=0);zs(e.gameMap,e.player,e.popups,Yr.Alarm,t[0]-e.player.pos[0],t[1]-e.player.pos[1],e.sounds)}n=.5}else i.type===ne.Health&&(Ks(e),e.player.health>=e.player.healthMax?++e.levelStats.extraFoodCollected:(++e.player.health,Qs(e,e.player.health-1)),s=!0);const l=a.create(),u=a.fromValues(o[0]-i.pos[0],o[1]-i.pos[1]+n),c=u.scale(.3333).add(a.fromValues(0,.5+n/2)),d=na(e.gameMapRoughPlans[e.level].levelType,es),p=new b([{pt0:l,pt1:c,duration:.1,fn:T.easeOutQuad},{pt0:c,pt1:u,duration:.1,fn:T.easeInQuad}],[d[i.type],d[i.type]]);p.removeOnFinish=!0,i.animation=p,e.particles.push(i)}return r&&e.sounds.coin.play(1),s&&e.sounds.coin.play(1),!0}function Rs(e,t){if((t[0]<0||t[0]>=e.gameMap.cells.sizeX||t[1]<0||t[1]>=e.gameMap.cells.sizeY)&&!e.finishedLevel)return!1;const o=e.gameMap.cells.atVec(t);return!o.blocksPlayerMove&&(!Bs(o.type)&&(o.type!==J.PortcullisNS&&o.type!==J.PortcullisEW&&((o.type!==J.DoorNS&&o.type!==J.DoorEW||!e.gameMap.items.some((e=>e.pos.equals(t)&&me(e.type))))&&(!e.gameMap.items.some((e=>e.pos.equals(t)&&!function(e){switch(e){case ne.DrawersShort:case ne.TorchUnlit:case ne.TorchLit:case ne.TreasureLock:case ne.TreasurePlinth:case ne.Treasure:return!1;default:return!0}}(e.type)))&&!e.gameMap.guards.some((o=>o.pos.equals(t)&&!o.allowsMoveOntoFrom(e.player.pos)))))))}function ks(e){switch(e.ambientSoundPool.empty(),e.ambience){case yr.Indoor:break;case yr.Outdoor:e.sounds.ambienceOutdoor.play(1,0,!0);break;case yr.Kitchen:e.sounds.ambienceKitchen.play(1,0,!0);break;case yr.Water:e.sounds.ambienceWater.play(.5,0,!0);break;case yr.OutdoorWater:e.sounds.ambienceWater.play(.5,0,!0),e.sounds.ambienceOutdoor.play(1,0,!0)}}function Cs(e,t,o){let n=t;if(e.player.pos.distance(e.oldPlayerPos)>1){const t=e.oldPlayerPos.add(e.player.pos).scale(.5);n=e.gameMap.cells.atVec(t)}if(function(e){let t=1/0,o=1/0,n=1/0;const r=e.gameMap.items.filter((e=>e.type===ne.Stove)),s=10;!function e(i,l,u,c){const d=[];for(let e of[[1,0],[0,1],[-1,0],[0,-1]]){const p=u.add(a.fromValues(e[0],e[1]));if(l.has(p[1]*i.sizeX+p[0]))continue;const h=i.atVec(p);h.type<=J.Wall0000&&(d.push(p),l.add(p[1]*i.sizeX+p[0]),h.type===J.GroundGrass&&t===1/0&&(t=s-c),h.type===J.GroundWater&&o===1/0&&(o=s-c),n===1/0)&&r.find((e=>e.pos.equals(p)))&&(n=s-c)}if(c>0&&n===1/0&&(t===1/0||o===1/0))for(let t of d)e(i,l,t,c-1)}(e.gameMap.cells,new Set,e.player.pos,s);const i=Math.min(t,n,o),l=i===1/0?yr.Indoor:o<1/0&&t<1/0?yr.OutdoorWater:o<1/0?yr.Water:n<1/0?yr.Kitchen:i===t?yr.Outdoor:yr.Indoor;l!==e.ambience&&(e.ambience=l,ks(e))}(e),o.hidesPlayer&&!t.hidesPlayer)return void e.sounds.hide.play(.2);const r=.5+Math.random()/2,s=t.type!==o.type;if(s){if(t.type===J.GroundWater)return void e.sounds.waterExit.play(.5*r);if(o.type===J.GroundWater)return void e.sounds.waterEnter.play(.5*r)}if(o.type===J.DoorEW||o.type===J.DoorNS){const t=e.gameMap.items.find((t=>t.pos.equals(e.player.pos)));t&&(t.type===ne.DoorEW||t.type===ne.DoorNS?e.sounds.playerDoorOpen.play(r):t.type!==ne.LockedDoorEW&&t.type!==ne.LockedDoorNS||e.sounds.playerDoorOpenLocked.play(r))}if(t.type===J.DoorEW||t.type===J.DoorNS){const t=e.gameMap.items.find((t=>t.pos.equals(e.oldPlayerPos)));t&&(t.type===ne.DoorEW||t.type===ne.DoorNS?e.sounds.playerDoorClose.play(r):t.type!==ne.LockedDoorEW&&t.type!==ne.LockedDoorNS||e.sounds.playerDoorCloseLocked.play(r))}switch(o.type){case J.GroundWoodCreaky:e.sounds.footstepCreaky.play(.15*r);break;case J.GroundWood:(s||Math.random()>.9)&&e.sounds.footstepWood.play(.15*r);break;case J.GroundNormal:(s||Math.random()>.5)&&e.sounds.footstepGravel.play(.03*r);break;case J.GroundGrass:(s||Math.random()>.75)&&e.sounds.footstepGrass.play(.05*r);break;case J.GroundWater:(s||Math.random()>.6)&&e.sounds.footstepWater.play(.02*r);break;case J.GroundMarble:case J.GroundVault:(s||Math.random()>.8)&&e.sounds.footstepTile.play(.05*r);break;default:(s||Math.random()>.8)&&e.sounds.footstepTile.play(.02*r)}}function Is(e,t,o){const n=a.create(),r=a.fromValues(t/4,o/4);e.player.animation=new b([{pt0:n,pt1:r,duration:.05,fn:T.linear},{pt0:r,pt1:n,duration:.05,fn:T.linear}],[es.playerTiles.normal])}function Ps(e,t,o){e.sounds.footstepTile.play(.1),Is(e,t,o)}function Hs(e,t,o,n,r=0){let s=null;t.pickTarget=null,o.hasPurse&&(o.hasPurse=!1,t.loot+=1,e.lootStolen+=1,s={pos:a.clone(o.pos),type:ne.Coin}),o.hasVaultKey&&(o.hasVaultKey=!1,t.hasVaultKey=!0,s={pos:a.clone(o.pos),type:ne.Key});const i=na(e.gameMapRoughPlans[e.level].levelType,es);if(s){const t=a.create(),o=n.subtract(s.pos),l=o.scale(.3333).add(a.fromValues(0,.5)),u=r>0?new b([{pt0:t,pt1:t,duration:.1,fn:T.easeOutQuad},{pt0:t,pt1:l,duration:.1,fn:T.easeOutQuad},{pt0:l,pt1:o,duration:.1,fn:T.easeInQuad}],[i[s.type],i[s.type],i[s.type]]):new b([{pt0:t,pt1:l,duration:.1,fn:T.easeOutQuad},{pt0:l,pt1:o,duration:.1,fn:T.easeInQuad}],[i[s.type],i[s.type]]);u.removeOnFinish=!0,s.animation=u,e.particles.push(s),e.sounds.coin.play(1)}}function Es(e,t){const o=a.clone(t.pos),n=a.clone(e.player.pos),r=a.create();a.subtract(r,o,n),a.add(r,r,o);let s=!1;(function(e,t){if(t[0]<0||t[1]<0||t[0]>=e.gameMap.cells.sizeX||t[1]>=e.gameMap.cells.sizeY)return!0;if(e.gameMap.cells.atVec(t).moveCost===1/0)return!0;if(e.gameMap.guards.find((e=>e.pos.equals(t))))return!0;for(const o of e.gameMap.items.filter((e=>e.pos.equals(t))))switch(o.type){case ne.PortcullisEW:case ne.PortcullisNS:return!0;case ne.LockedDoorEW:case ne.LockedDoorNS:if(!e.player.hasVaultKey)return!0}return!1})(e,r)&&(a.copy(r,n),s=!0),a.copy(t.pos,r),e.gameMap.cells.atVec(t.pos).type===J.GroundWater&&(t.modeTimeout=0);const i=a.clone(o).subtract(t.pos),l=a.create();let u;if(s)u=[{pt0:i,pt1:l,duration:.2,fn:T.easeOutQuad}];else{const e=a.fromValues(.5*(o[0]-t.pos[0]),.5*(o[1]-t.pos[1]));u=[{pt0:i,pt1:e,duration:.2,fn:T.easeInQuad},{pt0:e,pt1:l,duration:.1,fn:T.easeOutQuad}]}t.animation=new b(u,[])}function Ds(e,t,o){e.screenShakeEnabled&&a.scaleAndAdd(e.camera.joltVelocity,e.camera.joltVelocity,a.fromValues(t,o),-8)}function Ws(e,t,o,n){if(n===$r.AttemptedLeap)return void(e.player.preNoisy&&t===e.player.noiseOffset[0]&&o===e.player.noiseOffset[1]?(Xs(e),e.player.pickTarget=null,Is(e,1.25*t,1.25*o),Ds(e,t,o),zs(e.gameMap,e.player,e.popups,Yr.BangDoor,t,o,e.sounds),qs(e),0===e.gameMapRoughPlans[e.level].level&&e.popups.setNotification("Noise\nattracts\npeople",e.player.pos)):(e.player.preNoisy=!1,Ps(e,t,o)));const r=e.player.pos[0]+t,s=e.player.pos[1]+o,a=e.gameMap.items.find((e=>e.pos[0]===r&&e.pos[1]===s&&(e.type===ne.Bookshelf||e.type===ne.Note)));if(void 0===a)return e.player.preNoisy=!0,e.player.noiseOffset[0]=t,e.player.noiseOffset[1]=o,e.player.pickTarget=null,0!==e.gameMapRoughPlans[e.level].level||e.experiencedPlayer||he(e.gameMap.cells.at(r,s).type)||e.popups.setNotification("Make Noise:\nShift+"+$s(t,o),e.player.pos),void Ps(e,t,o);Xs(e);const i=e.player.pickTarget!==a;if(e.player.pickTarget=i&&e.gameMap.treasures.some((e=>e.switches.some((e=>e.equals(a.pos)))))?a:null,e.gameMap.cells.at(r,s).lit||(e.player.lightActive=!0),Is(e,t,o),qs(e),e.player.preNoisy=!0,e.player.noiseOffset[0]=t,e.player.noiseOffset[1]=o,i){let t=e.gameMap.bookTitle.get(a);return void 0===t&&(t="Untitled"),a.type===ne.Bookshelf&&(t='"'+t+'"'),void e.popups.setNotification(t,e.player.pos)}let l;!function(e){e[e.None=0]="None",e[e.Completed=1]="Completed",e[e.Reset=2]="Reset",e[e.Advance=3]="Advance",e[e.Complete=4]="Complete"}(l||(l={}));let u=l.None;for(const t of e.gameMap.treasures){const o=t.switches.findIndex((e=>e.equals(a.pos)));if(!(o<0))if(t.numSwitchesUsed>=t.switches.length)u=Math.max(u,l.Completed);else if(o===t.numSwitchesUsed)if(++t.numSwitchesUsed,t.numSwitchesUsed>=t.switches.length){const o=e.gameMap.items.filter((e=>e.type===ne.TreasureLock&&e.pos.equals(t.posTreasure)));e.gameMap.items=e.gameMap.items.filter((e=>!(e.type===ne.TreasureLock&&e.pos.equals(t.posTreasure)))),e.gameMap.cells.atVec(t.posTreasure).blocksPlayerMove=!1;for(let t of o){const o=new A(es.treasureGateAnimation,.3,0,1);o.removeOnFinish=!0,t.animation=o,e.particles.push(t)}u=Math.max(u,l.Complete)}else u=Math.max(u,l.Advance);else 0===o?(t.numSwitchesUsed=1,u=Math.max(u,l.Advance)):(t.numSwitchesUsed=0,u=Math.max(u,l.Reset))}switch(u){case l.None:break;case l.Completed:case l.Reset:e.sounds.switchReset.play(.5),e.popups.setNotification("(clunk)",e.player.pos);break;case l.Advance:e.sounds.switchProgress.play(.5),e.popups.setNotification("(click)",e.player.pos);break;case l.Complete:e.sounds.switchSuccess.play(.5),e.popups.setNotification("(rumble)",e.player.pos),Ds(e,t,o)}}function Fs(e,t,o,n){const r=e.player;if(r.health<=0)return void Us(e);n!==$r.AttemptedLeap&&(r.preNoisy=!1),r.idle=!1,e.idleTimer=5,e.camera.panning=!1,e.touchController.clearMotion();const s=a.clone(r.pos),i=a.fromValues(r.pos[0]+t,r.pos[1]+o);if(i[0]<0||i[0]>=e.gameMap.cells.sizeX||i[1]<0||i[1]>=e.gameMap.cells.sizeY){if(e.finishedLevel){Xs(e),Ls(e);const n=a.create(),l=a.clone(i).subtract(s);let u=n.add(l).scale(.5).add(a.fromValues(0,.0625));const c=[{pt0:n,pt1:u,duration:.1,fn:T.easeInQuad},{pt0:u,pt1:l,duration:.1,fn:T.easeOutQuad},{pt0:l,pt1:l,duration:o>0?.5:.1,fn:T.easeOutQuad}],d=t<0?es.playerTiles.left:t>0?es.playerTiles.right:o>0?es.playerTiles.up:es.playerTiles.down;r.animation=new b(c,[d,d,d,d])}else e.popups.setNotification("Collect all loot\nbefore leaving",e.player.pos),Ps(e,t,o);return}const l=e.gameMap.cells.atVec(i);if(l.blocksPlayerMove)return void(As(e,i)?(Xs(e),bs(e,i,r.pos),r.pickTarget=null,Is(e,t,o),qs(e)):(n===$r.Normal&&e.gameMap.items.some((e=>e.type===ne.TreasureLock&&e.pos.equals(i)))&&e.popups.setNotification("Locked!",e.player.pos),Ws(e,t,o,n)));if(l.type==J.OneWayWindowE&&i[0]<=s[0]||l.type==J.OneWayWindowW&&i[0]>=s[0]||l.type==J.OneWayWindowN&&i[1]<=s[1]||l.type==J.OneWayWindowS&&i[1]>=s[1])return e.popups.setNotification("Window is\nimpassable\nfrom here",e.player.pos),0===e.gameMapRoughPlans[e.level].level&&setTimeout((()=>e.sounds.tooHigh.play(.3)),250),void Ws(e,t,o,n);if(Bs(l.type))return js(e,t,o),0===e.gameMapRoughPlans[e.level].level&&setTimeout((()=>e.sounds.jump.play(.3)),250),void Ps(e,t,o);for(const l of e.gameMap.items.filter((e=>e.pos.equals(i))))switch(l.type){case ne.DrawersShort:case ne.TreasurePlinth:return void(As(e,i)?(Xs(e),bs(e,i,r.pos),r.pickTarget=null,Is(e,t,o),qs(e)):Rs(e,a.fromValues(s[0]+2*t,s[1]+2*o))?js(e,t,o):Ws(e,t,o,n));case ne.TorchUnlit:return Xs(e),e.sounds.ignite.play(.08),l.type=ne.TorchLit,r.pickTarget=null,r.itemUsed=l,Is(e,t,o),void qs(e);case ne.TorchLit:return Xs(e),e.sounds.douse.play(.05),l.type=ne.TorchUnlit,r.pickTarget=null,r.itemUsed=l,Is(e,t,o),void qs(e);case ne.PortcullisEW:case ne.PortcullisNS:return n!==$r.AttemptedLeap&&js(e,t,o),e.sounds.gate.play(.3),0===e.gameMapRoughPlans[e.level].level&&setTimeout((()=>e.sounds.jump.play(.3)),1e3),void Is(e,t,o);case ne.LockedDoorEW:case ne.LockedDoorNS:if(!r.hasVaultKey)return n===$r.Normal&&e.popups.setNotification("Locked!",e.player.pos),void Ws(e,t,o,n)}const u=e.gameMap.guards.find((e=>e.pos.equals(i)));if(void 0===u)Xs(e),r.pickTarget=null;else if(u.mode===E.Unconscious)Xs(e),r.pickTarget=null,Es(e,u);else{if(u.mode===E.ChaseVisibleTarget)return void Ps(e,t,o);{Xs(e);let t=!1;if((u.hasPurse||u.hasVaultKey)&&(r.pickTarget===u?t=!0:r.pickTarget=u),!u.allowsMoveOntoFrom(r.pos))return t&&Hs(e,r,u,s),qs(e),void Vs(e,s);t&&Hs(e,r,u,i)}}const c=r.hidden(e.gameMap)||e.gameMap.cells.atVec(r.pos).type===J.GroundWater;a.copy(r.pos,i),++e.numStepMoves,e.gameMap.identifyAdjacentCells(r.pos);const d=a.clone(s).subtract(i),p=a.create(),h=d.add(p).scale(.5).add(a.fromValues(0,.0625)),m=r.hidden(e.gameMap)||l.type===J.GroundWater;let f;if(void 0!==u&&u.mode===E.Unconscious){const e=a.fromValues(.5*(s[0]-i[0]),.5*(s[1]-i[1]));f=[{pt0:d,pt1:e,duration:.2,fn:T.easeInQuad},{pt0:e,pt1:p,duration:.1,fn:T.easeOutQuad}]}else{const e=n===$r.AttemptedLeapBounceBack?.05:.1;f=[{pt0:d,pt1:h,duration:e,fn:T.easeInQuad},{pt0:h,pt1:p,duration:e,fn:T.easeOutQuad},{pt0:p,pt1:p,duration:o>0&&!m?.5:.1,fn:T.easeOutQuad}],o>0&&!m&&f.push({pt0:p,pt1:p,duration:.1,fn:T.easeOutQuad})}const g=t<0?es.playerTiles.left:t>0?es.playerTiles.right:o>0?es.playerTiles.up:es.playerTiles.down,y=c?es.playerTiles.hidden:g,x=m?es.playerTiles.hidden:g,v=m?es.playerTiles.hidden:es.playerTiles.left;r.animation=new b(f,[y,x,x,v]),bs(e,r.pos,i),l.type===J.GroundWoodCreaky&&zs(e.gameMap,r,e.popups,Yr.Creak,0,-1,e.sounds),qs(e),Vs(e,s),Cs(e,e.gameMap.cells.atVec(s),l)}function Gs(e,t){const o=t[0]-e[0],n=t[1]-e[1];return Math.abs(o)+Math.abs(n)===1}function Vs(e,t){if(e.popups.isNotificationVisible())return;const o=e.gameMapRoughPlans[e.level].level;if(3===o)return void function(e){if(e.lootStolen>=e.lootAvailable)return;const t=e.gameMap.allSeen(),o=function(e){const t=e.gameMap.items.reduce(((e,t)=>e+(t.type===ne.Coin?1:0)),0),o=e.gameMap.guards.reduce(((e,t)=>e+(t.hasPurse?1:0)),0);return 0===t&&o>0}(e);if(e.experiencedPlayer){if(!t)return;if(!o)return}if(function(e){return e.gameMap.guards.some((e=>!F(e.mode)&&e.mode!==E.Unconscious))}(e))return;const n=e.gameMap.guards.filter((e=>e.hasPurse));if(0===n.length)return;n.sort(((t,o)=>a.squaredDistance(e.player.pos,t.pos)-a.squaredDistance(e.player.pos,o.pos)));const r=n[0];if(F(r.mode)&&Gs(e.player.pos,r.pos)){const t=r.pos[0]-e.player.pos[0],o=r.pos[1]-e.player.pos[1],n=a.fromValues(r.pos[0],Math.max(r.pos[1],e.player.pos[1])),s=e.player.pickTarget===r?"Loot: ":"Loot (1/2): ";return void e.popups.setNotificationHold(s+$s(t,o)+"\nKnockout: Shift+"+$s(t,o),n)}if(function(e,t){const o=t.pos[0]-e.player.pos[0],n=t.pos[1]-e.player.pos[1];if(!(2===Math.abs(o)&&0===n||0===o&&2===Math.abs(n)))return!1;if(e.gameMap.cells.atVec(e.player.pos).type===J.GroundWater)return!1;const r=a.fromValues(e.player.pos[0]+o/2,e.player.pos[1]+n/2),s=e.gameMap.cells.atVec(r);return!s.blocksPlayerMove&&((s.type!==J.DoorNS&&s.type!==J.DoorEW||!e.gameMap.items.some((e=>e.pos.equals(r)&&me(e.type))))&&(!(s.type==J.OneWayWindowE&&o<=0||s.type==J.OneWayWindowW&&o>=0||s.type==J.OneWayWindowN&&n<=0||s.type==J.OneWayWindowS&&n>=0)&&!!Rs(e,t.pos)))}(e,r)){const t=r.pos[0]-e.player.pos[0],o=r.pos[1]-e.player.pos[1],n=a.fromValues(r.pos[0],Math.max(r.pos[1],e.player.pos[1]));return void e.popups.setNotificationHold("Leap: Shift+"+$s(t,o),n)}t&&o&&e.popups.setNotificationHold("Loot",r.pos)}(e);if(e.experiencedPlayer)return;if(2===o&&!e.hasEnteredMansion&&e.player.pos.equals(e.gameMap.playerStartPos)){const t=a.create();return a.copy(t,e.player.pos),t[1]+=1,void e.popups.setNotificationHold("Zoom view: [ or ]",t)}if(1===o&&!e.hasEnteredMansion){let t,o=1/0;for(const n of e.gameMap.guards){const r=a.squaredDistance(n.pos,e.player.pos);r<o&&(o=r,t=n)}return void(void 0!==t&&o<16&&e.popups.setNotificationHold("Wait: Z\nor Period/Space",t.pos))}if(0!==o)return;const n=e.gameMap.items.find((t=>t.type===ne.Coin&&Gs(t.pos,e.player.pos)));if(void 0!==n)return void e.popups.setNotificationHold("Loot: "+$s(n.pos[0]-e.player.pos[0],n.pos[1]-e.player.pos[1]),n.pos);const r=e.gameMap.allSeen(),s=e.lootStolen>=e.lootAvailable;if(r&&s){if(0===e.player.pos[0]&&0!==t[0])return void e.popups.setNotificationHold("Exit: "+$s(-1,0),e.player.pos);if(e.player.pos[0]===e.gameMap.cells.sizeX-1&&t[0]!==e.gameMap.cells.sizeX-1)return void e.popups.setNotificationHold("Exit: "+$s(1,0),e.player.pos);if(0===e.player.pos[1]&&0!==t[1])return void e.popups.setNotificationHold("Exit: "+$s(0,-1),e.player.pos);if(e.player.pos[1]===e.gameMap.cells.sizeY-1&&t[1]!==e.gameMap.cells.sizeY-1)return void e.popups.setNotificationHold("Exit: "+$s(0,1),e.player.pos);for(const[t,o,n]of[[1,0,J.OneWayWindowE],[-1,0,J.OneWayWindowW],[0,1,J.OneWayWindowN],[0,-1,J.OneWayWindowS]])if(e.gameMap.cells.at(e.player.pos[0]+t,e.player.pos[1]+o).type===n)return void js(e,t,o)}if(e.gameMap.cells.atVec(e.player.pos).type==J.GroundWater){if(e.gameMap.cells.atVec(t).type!==J.GroundWater)return void e.popups.setNotification("Hide underwater",e.player.pos);if(1===e.player.turnsRemainingUnderwater)return void e.popups.setNotification("Out of breath;\nsurfacing",e.player.pos)}if(!e.player.pos.equals(t)){const t=e.gameMap.items.filter((t=>t.pos.equals(e.player.pos)));if(t.some((e=>e.type===ne.Bush)))return void e.popups.setNotification("Hide in bushes",e.player.pos);if(t.some((e=>e.type===ne.Table)))return void e.popups.setNotification("Hide under tables",e.player.pos);if(t.some((e=>e.type===ne.BedL||e.type===ne.BedR)))return void e.popups.setNotification("Hide under beds",e.player.pos)}if(0===e.numLeapMoves&&!e.hasEnteredMansion){const t=e.gameMap.items.find((t=>(t.type===ne.PortcullisEW||t.type===ne.PortcullisNS)&&a.squaredDistance(e.player.pos,t.pos)<2));if(void 0!==t){const o=t.pos[0]-e.player.pos[0],n=t.pos[1]-e.player.pos[1];return void function(e,t,o){e.popups.setNotificationHold("Leap: Shift+"+$s(t,o),e.player.pos)}(e,o,n)}let o;for(const t of e.gameMap.items)t.type!==ne.PortcullisEW&&t.type!==ne.PortcullisNS||(void 0===o||o.pos[1]>t.pos[1])&&(o=t);if(void 0!==o)return void e.popups.setNotificationHold("Move: ",o.pos)}if((!r||!s)&&e.numLeapMoves<=1){const o=a.fromValues(Math.floor((e.player.pos[0]+t[0])/2),Math.floor((e.player.pos[1]+t[1])/2));if(e.gameMap.items.some((e=>e.pos.equals(o)&&e.type===ne.PortcullisEW)))return void e.popups.setNotificationHold("Leap over open\nground or low\nfurniture too",e.player.pos)}}function Us(e){e.popups.setNotification(e.dailyRun?fs:ms,e.player.pos)}function Ns(e,t,o){const n=e.player;if(n.health<=0)return void Us(e);n.idle=!1,e.idleTimer=5,e.camera.panning=!1,e.touchController.clearMotion();const r=a.clone(n.pos),s=a.fromValues(n.pos[0]+t,n.pos[1]+o),i=a.fromValues(n.pos[0]+2*t,n.pos[1]+2*o),l=e.gameMap.cells.atVec(r),u=e.gameMap.cells.atVec(s),c=e.gameMap.cells.atVec(i),d=e.gameMap.guards.find((e=>e.pos.equals(s)&&e.mode!==E.Unconscious));if(d)return u.type===J.PortcullisEW||u.type===J.PortcullisNS||!n.hasVaultKey&&Os(e.gameMap,s)?void Fs(e,t,o,$r.AttemptedLeap):void(d.mode===E.ChaseVisibleTarget?(!function(e,t){const o=a.clone(t.pos);a.copy(t.pos,e.player.pos);const n=[{pt0:a.clone(o).subtract(e.player.pos),pt1:a.create(),duration:.2,fn:T.easeOutQuad}];t.animation=new b(n,[])}(e,d),Fs(e,t,o,$r.AttemptedLeap)):(Xs(e),d.mode=E.Unconscious,d.modeTimeout=Math.max(1,40-2*e.level)+x(20),(d.hasPurse||d.hasVaultKey)&&Hs(e,n,d,r),n.pickTarget=null,++e.levelStats.numKnockouts,e.sounds.hitGuard.play(.25),qs(e),Is(e,t,o),Ds(e,t,o)));if(l.type===J.GroundWater)return void Fs(e,t,o,$r.AttemptedLeap);if(i[0]<0||i[1]<0||i[0]>=e.gameMap.cells.sizeX||i[1]>=e.gameMap.cells.sizeY)return void Fs(e,t,o,$r.AttemptedLeap);if(u.blocksPlayerMove)return void Fs(e,t,o,$r.AttemptedLeap);if((u.type===J.DoorNS||u.type===J.DoorEW)&&e.gameMap.items.find((e=>e.pos.equals(s)&&me(e.type))))return void Fs(e,t,o,$r.AttemptedLeap);if(u.type==J.OneWayWindowE&&i[0]<=r[0]||u.type==J.OneWayWindowW&&i[0]>=r[0]||u.type==J.OneWayWindowN&&i[1]<=r[1]||u.type==J.OneWayWindowS&&i[1]>=r[1])return void Fs(e,t,o,$r.AttemptedLeap);const p=function(e,t){if((t[0]<0||t[0]>=e.gameMap.cells.sizeX||t[1]<0||t[1]>=e.gameMap.cells.sizeY)&&!e.finishedLevel)return!1;const o=e.gameMap.cells.atVec(t);if(o.blocksPlayerMove)return!1;if(Bs(o.type))return!1;for(const o of e.gameMap.items.filter((e=>e.pos.equals(t))))switch(o.type){case ne.DrawersShort:case ne.TorchUnlit:case ne.TorchLit:case ne.PortcullisEW:case ne.PortcullisNS:case ne.TreasureLock:case ne.TreasurePlinth:case ne.Treasure:return!1}return!e.gameMap.guards.find((e=>e.pos.equals(t)))}(e,s),h=e.gameMap.guards.find((e=>e.pos.equals(i)));if(!Rs(e,i))return void(p?void 0===h||h.overheadIcon()!==te.Alerted||c.type===J.PortcullisEW||c.type===J.PortcullisNS||!n.hasVaultKey&&Os(e.gameMap,i)?Fs(e,t,o,$r.AttemptedLeapBounceBack):function(e,t,o,n,r,s,i,l){Xs(e),bs(e,i,l),a.copy(t.pos,i),++e.numLeapMoves,o.mode=E.Unconscious,o.modeTimeout=Math.max(1,40-2*e.level)+x(20),(o.hasPurse||o.hasVaultKey)&&Hs(e,t,o,i,.15);t.pickTarget=null,++e.levelStats.numKnockouts,e.sounds.hitGuard.play(.25);const u=e.gameMap.cells.atVec(i);u.identified=!0;const c=a.clone(s).subtract(i),d=a.clone(l).subtract(i).scale(.5).add(a.fromValues(0,.25)),p=a.create(),h=n<0?es.playerTiles.left:n>0?es.playerTiles.right:r>0?es.playerTiles.up:es.playerTiles.down,m=t.hidden(e.gameMap),f=[{pt0:c,pt1:d,duration:.15,fn:T.easeInQuad},{pt0:d,pt1:p,duration:.1,fn:T.easeOutQuad},{pt0:p,pt1:p,duration:r>0&&!m?.5:.1,fn:T.easeOutQuad}];r>0&&!m&&f.push({pt0:p,pt1:p,duration:.1,fn:T.easeOutQuad});const g=m?es.playerTiles.hidden:h;t.animation=new b(f,[h,g,g,es.playerTiles.left]),u.type===J.GroundWoodCreaky?zs(e.gameMap,t,e.popups,Yr.Creak,0,-1,e.sounds):u.type===J.GroundWater&&zs(e.gameMap,t,e.popups,Yr.Splash,0,0,e.sounds);Ds(e,n,r),zs(e.gameMap,t,e.popups,Yr.Thud,n,r,e.sounds),qs(e),Cs(e,e.gameMap.cells.atVec(s),u)}(e,n,h,t,o,r,s,i):Fs(e,t,o,$r.AttemptedLeap));void 0===h||!h.hasPurse&&!h.hasVaultKey?n.pickTarget=null:n.pickTarget=h,Xs(e),bs(e,s,i);const m=e.gameMap.items.find((e=>e.pos.equals(s)&&e.type===ne.TorchLit));if(void 0!==m?(e.sounds.douse.play(.05),m.type=ne.TorchUnlit,n.itemUsed=m):p&&u.type!==J.GroundWoodCreaky&&++e.levelStats.steppableLeaps,i[0]<0||i[1]<0||i[0]>=e.gameMap.cells.sizeX||i[1]>=e.gameMap.cells.sizeY){Ls(e);const s=a.create(),l=a.clone(i).subtract(r);let u=s.add(l).scale(.5).add(a.fromValues(0,.25));const c=t<0?es.playerTiles.left:t>0?es.playerTiles.right:o>0?es.playerTiles.up:es.playerTiles.down,d=[{pt0:s,pt1:u,duration:.1,fn:T.easeInQuad},{pt0:u,pt1:l,duration:.1,fn:T.easeOutQuad},{pt0:l,pt1:l,duration:o>0?.5:.1,fn:T.easeOutQuad}];return void(n.animation=new b(d,[c,c,c]))}a.copy(n.pos,i),++e.numLeapMoves,c.identified=!0;const f=a.clone(r).subtract(i),g=a.create();let y=f.add(g).scale(.5).add(a.fromValues(0,.25));const v=t<0?es.playerTiles.left:t>0?es.playerTiles.right:o>0?es.playerTiles.up:es.playerTiles.down,S=n.hidden(e.gameMap),M=[{pt0:f,pt1:y,duration:.1,fn:T.easeInQuad},{pt0:y,pt1:g,duration:.1,fn:T.easeOutQuad},{pt0:g,pt1:g,duration:o>0&&!S?.5:.1,fn:T.easeOutQuad}];o>0&&!S&&M.push({pt0:g,pt1:g,duration:.1,fn:T.easeOutQuad});const _=S?es.playerTiles.hidden:v;n.animation=new b(M,[v,_,_,es.playerTiles.left]);const w=u.type===J.PortcullisNS||u.type===J.PortcullisEW;w?e.hasEnteredMansion=!0:0!==e.gameMapRoughPlans[e.level].level||e.hasEnteredMansion||(e.experiencedPlayer=!0),bs(e,i,i),c.type===J.GroundWoodCreaky?zs(e.gameMap,n,e.popups,Yr.Creak,0,-1,e.sounds):c.type===J.GroundWater&&zs(e.gameMap,n,e.popups,Yr.Splash,0,0,e.sounds),qs(e),Vs(e,r),Cs(e,e.gameMap.cells.atVec(r),c),w&&e.sounds.gate.play(.3)}function Os(e,t){return e.items.some((e=>e.pos.equals(t)&&(e.type===ne.LockedDoorEW||e.type===ne.LockedDoorNS)))}function Bs(e){switch(e){case J.OneWayWindowE:case J.OneWayWindowW:case J.OneWayWindowN:case J.OneWayWindowS:return!0;default:return!1}}function zs(e,t,o,n,r,s,i){t.noisy=!0,t.noiseOffset[0]=r,t.noiseOffset[1]=s;switch(n){case Yr.Creak:i.footstepCreaky.play(.6),o.setNotification("Creak!",t.pos);break;case Yr.Splash:i.splash.play(.5),o.setNotification("Splash!",t.pos);break;case Yr.Thud:o.setNotification("Thud!",t.pos);break;case Yr.Alarm:i.treasureAlarm.play(1);const e=a.fromValues(t.pos[0]+r,t.pos[1]+s);o.setNotificationHold("ALARM! ALARM! ALARM!",e);break;case Yr.BangDoor:i.thump.play(.5),o.setNotification("Thud!",t.pos);case Yr.BangChair:}let l=!1;for(const o of e.guardsInEarshot(t.pos,23))o.heardThief=!0,l||(l=!0,o.heardThiefClosest=!0)}function Xs(e){e.player.noisy=!1,e.player.damagedLastTurn=!1,e.player.itemUsed=null,e.player.lightActive=!1,e.popups.clearNotification()}function qs(e){const t=e.player.health;if(e.player.preNoisy=!1,++e.turns,++e.totalTurns,e.gameMap.cells.atVec(e.player.pos).type==J.GroundWater?e.player.turnsRemainingUnderwater>0&&(--e.player.turnsRemainingUnderwater,e.player.turnsRemainingUnderwater<=0&&e.sounds.waterExit.play(.25)):e.player.turnsRemainingUnderwater=ae,e.gameMap.computeLighting(e.player),V(e),e.gameMap.recomputeVisibility(e.player.pos),G(e),Ys(e),t>e.player.health&&(e.sounds.hitPlayer.play(.5),e.player.health<=0)){setTimeout((()=>e.sounds.gameOverJingle.play(.5)),1e3),function(e){if(e.gameMapRoughPlans[e.level].played)return;e.gameMapRoughPlans[e.level].played=!0;const t=10*e.lootStolen+5*e.levelStats.extraFoodCollected;e.gameStats.totalScore+=t,e.gameStats.turns+=e.totalTurns,e.gameStats.numLevels=e.gameMapRoughPlans.length,e.gameStats.numCompletedLevels=e.level,e.gameStats.daily=e.dailyRun,e.gameStats.timeEnded=Date.now()}(e),e.persistedStats.bestScore=Math.max(e.persistedStats.bestScore,e.gameStats.totalScore);const t={score:e.gameStats.totalScore,date:Aa(),turns:e.totalTurns,level:e.level+1};e.persistedStats.scores.push(t),e.dailyRun&&(e.persistedStats.currentDailyBestScore=Math.max(e.persistedStats.currentDailyBestScore,e.gameStats.totalScore),e.persistedStats.lastPlayedDailyGame=structuredClone(e.gameStats)),ma(e.persistedStats)}Ss(e,"turnEnd")}function Ys(e){const t=e.gameMap.allSeen(),o=e.lootStolen>=e.lootAvailable;t&&o&&(e.finishedLevel||(e.sounds.levelRequirementJingle.play(.5),e.popups.setNotification("Escape!",e.player.pos)),e.finishedLevel=!0)}function js(e,t,o){e.popups.setNotification("Leap: Shift+"+$s(t,o),e.player.pos)}function $s(e,t){return e>0?"":e<0?"":t>0?"":t<0?"":""}function Ks(e){e.healthBarState.enlargeTimeRemaining=1}function Qs(e,t){t<0||t>=e.healthBarState.heartFlashRemaining.length||(e.healthBarState.heartFlashRemaining[t]=1,e.healthBarState.damageDisplayTimer=hs,e.healthBarState.healing=t<e.player.health)}function Js(e){e.healthBarState.damageDisplayTimer=0,e.healthBarState.healing=!1,e.healthBarState.enlargeTimeRemaining=0,e.healthBarState.size=1,e.healthBarState.heartFlashRemaining.length=e.player.healthMax,e.healthBarState.heartFlashRemaining.fill(0)}function Zs(e,t){return new Promise(((o,n)=>{t.onload=()=>o(t),t.onerror=n,t.src=e}))}function ea(e,t,o,n){if(0==o.size)return e;if(!n)return 0;let r=0;for(let e of[...o])r+=t[e];return e**(1+r/o.size)}function ta(e,t,o){const n=(o.at(e,t).lit?1:.1)/4,r=o.at(e-1,t-1).litAnim,s=o.at(e,t-1).litAnim,a=o.at(e+1,t-1).litAnim,i=o.at(e-1,t).litAnim,l=o.at(e,t).litAnim,u=o.at(e+1,t).litAnim,c=o.at(e-1,t+1).litAnim,d=o.at(e,t+1).litAnim;return[n*(r+s+i+l),n*(a+s+u+l),n*(c+d+i+l),n*(o.at(e+1,t+1).litAnim+d+u+l)]}function oa(e,t){switch(e){case K.Manor:case K.ManorRed:return t.waterAnimation;case K.Mansion:return t.manseWaterAnimation;case K.Fortress:return t.fortressWaterAnimation}}function na(e,t){switch(e){case K.Manor:return t.itemTiles;case K.ManorRed:return t.redWallItemTiles;case K.Mansion:return t.manseItemTiles;case K.Fortress:return t.fortressItemTiles}}function ra(e,t){const o=function(e,t){switch(e){case K.Manor:return t.terrainTiles;case K.ManorRed:return t.redWallTerrainTiles;case K.Mansion:return t.manseTerrainTiles;case K.Fortress:return t.fortressTerrainTiles}}(e.gameMapRoughPlans[e.level].levelType,t.terrainTileSet);for(let n=0;n<e.gameMap.cells.sizeX;++n)for(let r=e.gameMap.cells.sizeY-1;r>=0;--r){const s=e.gameMap.cells.at(n,r);if(!s.seen&&!e.seeAll)continue;let a=s.type;a==J.GroundWoodCreaky&&(s.lit||s.identified||e.seeAll||(a=J.GroundWood));const i=ta(n,r,e.gameMap.cells);let l=s.animation?s.animation.currentTile():o[a];if(a!==J.DoorEW&&a!==J.DoorNS||s.blocksSight||void 0===l.textureIndex||(l={textureIndex:l.textureIndex+1,color:l.color,unlitColor:l.unlitColor}),t.addGlyphLit4(n,r,n+1,r+1,l,i),a===J.GroundWater){const o=t.terrainTileSet.ledgeTiles;let s=0;for(let a of[[0,1],[0,-1],[-1,0],[1,0]]){e.gameMap.cells.at(n+a[0],r+a[1]).type!==J.GroundWater&&t.addGlyphLit4(n,r,n+1,r+1,o[s],i),s++}}}}function sa(e){return e[1]>0?1:e[1]<0?3:e[0]>0?0:e[0]<0?2:3}function aa(e,t){const o={position:a.create(),velocity:a.create(),joltOffset:a.create(),joltVelocity:a.create(),zoom:t,zoomVelocity:0,scale:Math.pow(us,t),anchor:a.create(),snapped:!1,zoomed:!1,panning:!1};return a.copy(o.position,e),a.zero(o.velocity),o}function ia(e,t){e.soundVolume=t,Oo.volume(t),window.localStorage.setItem("LLL/soundVolume",t.toString())}function la(e){return e.volumeMute||!document.hasFocus()}function ua(e,t){e.volumeMute=t,Oo.mute(la(e)),window.localStorage.setItem("LLL/volumeMute",t?"true":"false")}function ca(e,t){e.guardMute=t,window.localStorage.setItem("LLL/guardMute",t?"true":"false");for(const o in e.subtitledSounds)e.subtitledSounds[o].mute=t}function da(e){const t=window.localStorage.getItem("LLL/stat/"+e);if(null!=t&&"undefined"!==t)return JSON.parse(String(t))}function pa(e,t){const o=JSON.stringify(t);window.localStorage.setItem("LLL/stat/"+e,o)}function ha(){return{scores:da("highScores")??[],lastPlayedDailyGame:da("lastPlayedDailyGame")??null,currentDailyGameId:da("currentDailyGameId")??"",currentDailyPlays:da("currentDailyPlays")??0,currentDailyWins:da("currentDailyWins")??0,currentDailyBestScore:da("currentDailyBestScore")??0,currentDailyWinFirstTry:da("currentDailyWinFirstTry")??0,bestScore:da("bestScore")??0,totalPlays:da("totalPlays")??0,totalWins:da("totalWins")??0,totalGhosts:da("totalGhosts")??0,allDailyPlays:da("allDailyPlays")??0,allDailyWins:da("allDailyWins")??0,allDailyWinsFirstTry:da("allDailyWinsFirstTry")??0,achievementGhosty:da("achievementGhosty")??0,achievementZippy:da("achievementZippy")??0,achievementHungry:da("achievementHungry")??0,achievementThumpy:da("achievementThumpy")??0,achievementSofty:da("achievementSofty")??0,achievementNoisy:da("achievementNoisy")??0,achievementLeapy:da("achievementLeapy")??0,achievementSteppy:da("achievementSteppy")??0,achievementHurty:da("achievementHurty")??0,achievementVictory:da("achievementVictory")??0,achievementHealthy:da("achievementHealthy")??0,achievementTreasure:da("achievementTreasure")??0,achievementMapping:da("achievementMapping")??0,achievementFaceless:da("achievementFaceless")??0}}function ma(e){pa("currentDailyGameId",e.currentDailyGameId),pa("currentDailyPlays",e.currentDailyPlays),pa("currentDailyWins",e.currentDailyWins),pa("currentDailyBestScore",e.currentDailyBestScore),pa("currentDailyWinFirstTry",e.currentDailyWinFirstTry),pa("lastPlayedDailyGame",e.lastPlayedDailyGame),pa("allDailyPlays",e.allDailyPlays),pa("allDailyWins",e.allDailyWins),pa("allDailyWinsFirstTry",e.allDailyWinsFirstTry),pa("scores",e.scores),pa("bestScore",e.bestScore),pa("totalPlays",e.totalPlays),pa("totalWins",e.totalWins),pa("totalGhosts",e.totalGhosts),pa("achievementGhosty",e.achievementGhosty),pa("achievementZippy",e.achievementZippy),pa("achievementHungry",e.achievementHungry),pa("achievementThumpy",e.achievementThumpy),pa("achievementSofty",e.achievementSofty),pa("achievementNoisy",e.achievementNoisy),pa("achievementLeapy",e.achievementLeapy),pa("achievementSteppy",e.achievementSteppy),pa("achievementHurty",e.achievementHurty),pa("achievementHealthy",e.achievementHealthy),pa("achievementTreasure",e.achievementTreasure),pa("achievementMapping",e.achievementMapping),pa("achievementFaceless",e.achievementFaceless)}function fa(e,t){const o=t.gameMapRoughPlans[t.level].levelType,n=ko();let r=1;for(let t of e.cells.values)t.type===J.GroundWater&&(t.animation=new A(oa(o,n),1,1369*r%4),r++)}function ga(e,t){let o=0;const n=Co();if(n.candleAnimation.length>=3){const r=n.stoveAnimation.slice(0,2).map((e=>[e,.5])),s=r[0][0],a=r[0][0],i=n.candleAnimation.slice(0,3).map((e=>[e,.5])),l=n.candleAnimation.at(-2),u=n.candleAnimation.at(-1);for(let n of e.items)n.type===ne.Stove?(n.animation=new P(C.idle,o,t.lightStates,n,r,s,a),o++):n.type===ne.TorchLit?(n.animation=new P(C.idle,o,t.lightStates,n,i,l,u),o++):n.type===ne.TorchUnlit&&(n.animation=new P(C.off,o,t.lightStates,n,i,l,u),o++)}if(n.torchAnimation.length>=3){const r=n.torchAnimation.slice(0,3).map((e=>[e,.5])),s=n.torchAnimation.at(-2),a=n.torchAnimation.at(-1);for(let n of e.guards)n.hasTorch&&(n.torchAnimation=new P(C.idle,o,t.lightStates,null,r,s,a),o++)}if(n.playerTorchAnimation.length>=2){const e=n.playerTorchAnimation.slice(0,2).map((e=>[e,.5])),r=n.playerTorchAnimation.at(-2),s=n.playerTorchAnimation.at(-1);t.player.torchAnimation=new P(C.idle,o,t.lightStates,null,e,r,s),o++}}function ya(e){e.gameMode=fr.Mansion,e.hasStartedGame||(e.persistedStats.totalPlays++,pa("totalPlays",e.persistedStats.totalPlays),e.hasStartedGame=!0),ks(e)}function xa(e){const t=null!==e.dailyRun;e.gameMapRoughPlans=t?Ae(e.rng):be(qr.numGameMaps,qr.totalGameLoot,e.rng),e.level=Math.min(e.gameMapRoughPlans.length-1,Qr),e.persistedStats.totalPlays++,pa("totalPlays",e.persistedStats.totalPlays),t&&(e.persistedStats.currentDailyPlays++,pa("currentDailyPlays",e.persistedStats.currentDailyPlays),e.persistedStats.allDailyPlays++,pa("allDailyPlays",e.persistedStats.allDailyPlays)),e.gameStats={totalScore:0,turns:0,numLevels:0,numCompletedLevels:0,numGhostedLevels:0,daily:e.dailyRun,timeStarted:Date.now(),timeEnded:0};const o=ke(e.gameMapRoughPlans[e.level]);e.player=new ie(o.playerStartPos,t),e.lightStates=Array(o.lightCount).fill(0),ga(o,e),fa(o,e),e.gameMode=fr.Mansion,e.hintMessage="",Js(e),e.numStepMoves=0,e.numLeapMoves=0,e.numWaitMoves=0,e.numZoomMoves=0,e.hasEnteredMansion=!1,e.experiencedPlayer=t,e.finishedLevel=!1,e.turns=0,e.totalTurns=0,e.lootStolen=0,e.lootAvailable=e.gameMapRoughPlans[e.level].totalLoot,e.treasureStolen=0,vs(e.levelStats),Ss(e,"gameStart"),e.ambience=yr.Outdoor,e.camera=aa(o.playerStartPos,e.zoomLevel),e.gameMap=o,e.activeSoundPool.empty(),e.ambientSoundPool.empty(),e.popups.reset(),G(e),Ys(e),Vs(e,e.player.pos),Oo.stop(),ks(e)}function va(e){let t=Aa();e.rng=new y("Daily "+t),e.dailyRun=t,xa(e)}function Sa(e,t,o){const n=e/1e3,r=void 0===o.tLast?0:Math.min(1/30,n-o.tLast);o.dt=r,o.tLast=n,o.fpsInfo.enabled&&(o.fpsInfo.frames++,o.fpsInfo.cumulativeTime+=r,o.fpsInfo.worstFrame<r&&(o.fpsInfo.worstFrame=r),r>.017&&o.fpsInfo.drops++,o.fpsInfo.cumulativeTime>1&&(o.fpsInfo.msgFPS="FPS: "+Math.round(o.fpsInfo.frames/o.fpsInfo.cumulativeTime*10)/10+` (worst: ${Math.round(1e3*o.fpsInfo.worstFrame)}ms,`+` # drops: ${o.fpsInfo.drops})`,o.fpsInfo.cumulativeTime=0,o.fpsInfo.frames=0,o.fpsInfo.worstFrame=0,o.fpsInfo.drops=0)),os.width=ns,os.height=rs;const s=a.fromValues(ns,rs);o.oldPlayerPos=a.clone(o.player.pos),ys(o),o.camera.zoomed||(o.camera.zoomed=!0,function(e,t){const o=as*Ta(t),n=t[0]/is,r=(t[1]-2*o)/ls,s=e.gameMap.cells.sizeX,a=e.gameMap.cells.sizeY;e.zoomLevel=n*a<r*s?Math.log(n/s)/Math.log(us):Math.log(r/a)/Math.log(us);e.zoomLevel=Math.max(0,Math.floor(e.zoomLevel))}(o,s)),o.camera.snapped||(o.camera.panning=!1,o.camera.snapped=!0,function(e,t){e.camera.zoom=e.zoomLevel,e.camera.zoomVelocity=0,e.camera.scale=Math.pow(us,e.camera.zoom),Ma(a.fromValues(e.gameMap.cells.sizeX,e.gameMap.cells.sizeY),t,e.camera.scale,ar===e.touchController&&!e.touchController.mouseActive,e.camera.position,e.player.pos),a.zero(e.camera.velocity),a.zero(e.camera.joltOffset),a.zero(e.camera.joltVelocity)}(o,s)),r>0&&function(e,t,o){(function(e,t,o){const n=8,r=e.zoomLevel-e.camera.zoom,s=-e.camera.zoomVelocity,i=(2*s+r*n)*n,l=e.camera.zoomVelocity+i*o;e.camera.zoom+=(e.camera.zoomVelocity+l)*(.5*o),e.camera.zoomVelocity=l,e.camera.scale=Math.pow(us,e.camera.zoom);const u=a.create();if(!e.camera.panning){const r=a.create(),s=Math.pow(us,e.zoomLevel);Ma(a.fromValues(e.gameMap.cells.sizeX,e.gameMap.cells.sizeY),t,s,ar===e.touchController&&!e.touchController.mouseActive,r,e.player.pos);const i=a.create();a.subtract(i,r,e.camera.position);const l=a.create();a.negate(l,e.camera.velocity);const c=a.create();a.scale(c,i,n**2),a.scaleAndAdd(c,c,l,2*n),a.scaleAndAdd(u,e.camera.velocity,c,o)}a.scaleAndAdd(e.camera.position,e.camera.position,e.camera.velocity,.5*o),a.scaleAndAdd(e.camera.position,e.camera.position,u,.5*o),a.copy(e.camera.velocity,u);const c=24,d=a.create();a.scale(d,e.camera.joltOffset,-(c**2)),a.scaleAndAdd(d,d,e.camera.joltVelocity,-2*c);const p=a.create();a.scaleAndAdd(p,e.camera.joltVelocity,d,o),a.scaleAndAdd(e.camera.joltOffset,e.camera.joltOffset,e.camera.joltVelocity,.5*o),a.scaleAndAdd(e.camera.joltOffset,e.camera.joltOffset,p,.5*o),a.copy(e.camera.joltVelocity,p)})(e,t,o),function(e,t){const o=e.player;if(e.player.health<=0)return;if(e.gameMode!==fr.Mansion)return;if(null!==e.player.animation)return;if(e.idleTimer-=t,e.idleTimer>0)return;const n=a.create(),r=a.fromValues(-.125,0),s=a.fromValues(.125,0),i=a.fromValues(0,.125),l=o.hidden(e.gameMap),u=Co(),c=u.playerTiles;let d,p;l||Math.random()>.5?(d=[{pt0:n,pt1:i,duration:.1,fn:T.easeInQuad},{pt0:i,pt1:n,duration:.05,fn:T.easeOutQuad},{pt0:n,pt1:n,duration:.1,fn:T.easeOutQuad},{pt0:n,pt1:i,duration:.1,fn:T.easeInQuad},{pt0:i,pt1:n,duration:.05,fn:T.easeOutQuad}],p=l?[c.hidden]:[c.normal]):(d=[{pt0:n,pt1:r,duration:.1,fn:T.easeOutQuad},{pt0:r,pt1:r,duration:.5,fn:T.easeOutQuad},{pt0:r,pt1:n,duration:.1,fn:T.easeInQuad},{pt0:n,pt1:s,duration:.1,fn:T.easeOutQuad},{pt0:s,pt1:s,duration:.5,fn:T.easeOutQuad},{pt0:s,pt1:n,duration:.1,fn:T.easeInQuad}],p=[c.left,c.left,c.normal,c.right,c.right,c.normal]),o.animation=new b(d,p),o.idle||("orbs"===o.idleCursorType?o.idleCursorAnimation=[new k(u.namedTiles.idleIndicator,.6,Math.PI,0,0),new k(u.namedTiles.idleIndicator,.6,Math.PI,2*Math.PI/3,0),new k(u.namedTiles.idleIndicator,.6,Math.PI,4*Math.PI/3,0)]:o.idleCursorAnimation=[]),o.idle=!0,e.idleTimer=5}(e,o),function(e,t){e.healthBarState.damageDisplayTimer=Math.max(0,e.healthBarState.damageDisplayTimer-t),e.healthBarState.enlargeTimeRemaining=Math.max(0,e.healthBarState.enlargeTimeRemaining-1.5*t);let o=1;const n=.85;e.healthBarState.enlargeTimeRemaining>n?o=1-((e.healthBarState.enlargeTimeRemaining-n)/(1-n))**2:(o=e.healthBarState.enlargeTimeRemaining/n,o=o*o*(3-2*o)),e.healthBarState.size=1+o/2,o=t/1;for(let t=0;t<e.healthBarState.heartFlashRemaining.length;++t)e.healthBarState.heartFlashRemaining[t]=Math.max(0,e.healthBarState.heartFlashRemaining[t]-o)}(e,o),e.popups.animate(o),void 0!==e.popups.currentSpeaker&&(e.popups.currentSpeechAbove?e.player.pos[1]>e.popups.currentSpeaker.pos[1]&&(e.popups.currentSpeechAbove=!1):e.player.pos[1]<e.popups.currentSpeaker.pos[1]&&(e.popups.currentSpeechAbove=!0));e.player.noisyAnim+=2*o,e.player.noisyAnim-=Math.floor(e.player.noisyAnim),e.player.animation&&e.player.animation.update(o)&&(e.player.animation=null);e.player.lightActive&&e.player.torchAnimation?.update(o)&&(e.player.torchAnimation=null);e.player.idle&&e.player.idleCursorAnimation&&(e.player.idleCursorAnimation=e.player.idleCursorAnimation.filter((e=>!e.update(o))));for(let t of e.gameMap.cells.values)t.animation?.update(o);for(let t of e.gameMap.guards)t.animation?.update(o)&&(t.animation=null),t.torchAnimation?.update(o)&&(t.torchAnimation=null);if(e.gameMapRoughPlans[e.level].levelType===K.Fortress&&!e.oldPlayerPos.equals(e.player.pos)){const t=e.gameMap.items.find((t=>t.pos.equals(e.oldPlayerPos)));if(t&&t.type===ne.Bush){const e=na(K.Fortress,Co())[t.type],o={...e},n={...e},r={...e};o.textureIndex=e.textureIndex?e.textureIndex+1:0,n.textureIndex=e.textureIndex?e.textureIndex+2:0,r.textureIndex=e.textureIndex?e.textureIndex+3:0,t.animation=new A([e,o,n,r,r,r,n,o,e],1,0,1)}}e.gameMap.items=e.gameMap.items.filter((e=>{const t=e.animation?.update(o);return!0===t&&(e.animation=void 0),!(e instanceof b||e instanceof A)||!e.removeOnFinish||!0!==t})),e.particles=e.particles.filter((e=>{const t=e.animation?.update(o);return!(e.animation instanceof b||e.animation instanceof A)||!e.animation.removeOnFinish||!0!==t}))}(o,s,r);const l=o.textWindows[o.gameMode];void 0!==l&&(l.update(o),l.parseUI(s)),function(e,t,o,n){if(ar!==e)return;const r=n.textWindows[n.gameMode];if(-1!==e.lastMotion.id&&void 0===r&&null===e.targetOnTouchDown&&e.lastMotion.active){const t=e.lastMotion.x-e.lastMotion.x0,o=e.lastMotion.y-e.lastMotion.y0,r=t/(is*n.camera.scale),s=o/(ls*n.camera.scale);n.camera.panning=!0,n.camera.position[0]-=r-n.camera.anchor[0],n.camera.position[1]-=s-n.camera.anchor[1],n.camera.anchor[0]=r,n.camera.anchor[1]=s}else n.camera.anchor[0]=0,n.camera.anchor[1]=0;(function(e,t,o,n){const r=void 0!==t.entityTileSet.touchButtons?t.entityTileSet.touchButtons:{},s=as*Ta(o),a=0,i=s,l=o[0],u=o[1]-s,c=Math.min(80,Math.floor(Math.min(l,u)/5)),d=c,p=c,h=0,m=n.gameMode===fr.Mansion,f=[{action:"menu",rect:new lr(a+h,i+u-p-h,d,p),tileInfo:r.menu,visible:!0},{action:"zoomIn",rect:new lr(a+l-d-h,i+u-p-h,d,p),tileInfo:r.zoomIn,visible:m},{action:"zoomOut",rect:new lr(a+l-d-h,i+u-2*p-h,d,p),tileInfo:r.zoomOut,visible:m},{action:"left",rect:new lr(a+h,i+p+h,d,p),tileInfo:r.left,visible:!0},{action:"right",rect:new lr(a+2*d+h,i+p+h,d,p),tileInfo:r.right,visible:!0},{action:"up",rect:new lr(a+d+h,i+2*p+h,d,p),tileInfo:r.up,visible:!0},{action:"down",rect:new lr(a+d+h,i+h,d,p),tileInfo:r.down,visible:!0},{action:"wait",rect:new lr(a+d+h,i+p+h,d,p),tileInfo:r.wait,visible:m},{action:"jump",rect:new lr(a+l-1.5*d-h,i+h,1.5*d,1.5*p),tileInfo:r.jump,visible:m},{action:"menuAccept",rect:new lr(a+l-1.5*d-h,i+h,1.5*d,1.5*p),tileInfo:r.menuAccept,visible:!m}],g=new lr;for(const t of f)e.updateCoreTouchTarget(t.action,t.visible?t.rect:g,t.tileInfo)})(e,t,o,n),e.activateTouchTargets(r?r.touchTargets:void 0)}(o.touchController,t,s,o),function(e,t,o){e.beginFrame(t);const n=i.create();(function(e,t,o){const n=as*Ta(t),r=a.fromValues(t[0],t[1]-n),[s,l]=_a(r,e.camera.scale),u=e.camera.position[0]+e.camera.joltOffset[0],c=e.camera.position[1]+e.camera.joltOffset[1],d=n/(ls*e.camera.scale),p=u-s/2,h=c-l/2;i.ortho(o,p,p+s,h-d,h+l,1,-1)})(o,t,n),function(e,t,o){for(let n=0;n<e.sizeX;n++)for(let r=0;r<e.sizeY;r++){const s=e.at(n,r);s.type<J.Wall0000||s.type>J.DoorEW?e.at(n,r).litAnim=ea(s.lit,t,s.litSrc,o||s.seen):e.at(n,r).litAnim=0}}(o.gameMap.cells,o.lightStates,o.seeAll),e.start(n,bo.Terrain),ra(o,e),e.flush(),e.start(n,bo.Entity),function(e,t){const o=na(e.gameMapRoughPlans[e.level].levelType,t.entityTileSet);for(const n of e.gameMap.items){let r=n.pos[0],s=n.pos[1];const a=e.gameMap.cells.at(r,s);if(!a.seen&&!e.seeAll)continue;const i=a.type,l=ta(r,s,e.gameMap.cells);if(i===J.PortcullisEW||i===J.PortcullisNS)if(e.gameMap.guards.find((e=>e.pos[0]===r&&e.pos[1]===s))){let e=o[n.type];void 0!==e.textureIndex&&(e={textureIndex:e.textureIndex+1,color:e.color,unlitColor:e.unlitColor}),t.addGlyphLit4(r,s,r+1,s+1,e,l)}else t.addGlyphLit4(r,s,r+1,s+1,o[n.type],l);else if(i===J.DoorEW||i===J.DoorNS)e.gameMap.guards.find((e=>e.pos[0]===r&&e.pos[1]===s))||e.player.pos[0]===r&&e.player.pos[1]===s||t.addGlyphLit4(r,s,r+1,s+1,o[n.type],l);else if(n.type===ne.Treasure){const e=n.animation?n.animation.currentTile():o[n.type];t.addGlyphLit4(r,s+.5,r+1,s+1.5,e,l)}else{const e=n.animation?n.animation.currentTile():o[n.type];if(n.animation instanceof b){const e=n.animation.offset;r+=e[0],s+=e[1]}t.addGlyphLit4(r,s,r+1,s+1,e,l)}}}(o,e),o.gameMode===fr.Mansion&&(function(e,t){if(!e.seeGuardSight)return;const o=e.gameMap.cells.sizeX,n=e.gameMap.cells.sizeY,r=new Y(o,n,!1),s=a.create(),i=a.create();for(const t of e.gameMap.guards){const l=10,u=Math.max(0,Math.floor(t.pos[0]-l)),c=Math.min(o,Math.floor(t.pos[0]+l)+1),d=Math.max(0,Math.floor(t.pos[1]-l)),p=Math.min(n,Math.floor(t.pos[1]+l)+1);for(let o=d;o<p;++o)for(let n=u;n<c;++n){if(r.get(n,o))continue;a.set(s,n,o),a.subtract(i,s,t.pos);const l=e.gameMap.cells.atVec(s);(e.seeAll||l.seen)&&(l.blocksPlayerMove||t.mode!==E.ChaseVisibleTarget&&a.dot(t.dir,i)<0||a.squaredLen(i)>=t.sightCutoff(l.lit>0)&&(i[0]!==2*t.dir[0]||i[1]!==2*t.dir[1])||l.hidesPlayer&&(Math.abs(i[0])>1||Math.abs(i[1])>1||F(t.mode))||B(e.gameMap,t.pos,s)&&r.set(n,o,!0))}}for(let o=0;o<e.gameMap.cells.sizeY;++o)for(let n=0;n<e.gameMap.cells.sizeX;++n)r.get(n,o)&&t.addGlyph(n,o,n+1,o+1,es.namedTiles.crossHatch)}(o,e),function(e,t){if(e.seeGuardPatrols)for(const o of e.gameMap.guards)for(const e of o.patrolPath)t.addGlyph(e[0],e[1],e[0]+1,e[1]+1,es.namedTiles.patrolRoute)}(o,e));(function(e,t){for(const o of e.gameMap.guards){let n=0+sa(o.dir);const r=e.gameMap.cells.atVec(o.pos);let s=ea(r.lit,e.lightStates,r.litSrc,e.seeAll||r.seen);const i=e.seeAll||r.seen||o.speaking;if(!i&&a.squaredDistance(e.player.pos,o.pos)>36)continue;i||o.mode===E.Unconscious?o.mode!==E.Patrol||o.speaking||0!=r.lit?o.mode===E.Unconscious?n+=12:n+=8:s=0:n+=4;const l=structuredClone(t.entityTileSet.npcTiles[n]);o.mode===E.Unconscious&&o.hidden(e.gameMap)&&(l.color=go,l.unlitColor=yo);const u=e.gameMap.items.find((e=>[ne.PortcullisEW,ne.PortcullisNS].includes(e.type))),c=void 0!==u&&u.pos.equals(o.pos)?.25:0;let d=o.animation?.offset??a.create();const p=o.pos[0]+d[0]+c,h=o.pos[1]+d[1];if(o.hasTorch||o.hasPurse||o.hasVaultKey){let e=p+.375*o.dir[0]+.375*o.dir[1],n=h-.125;const r=o.mode!==E.Unconscious&&o.torchAnimation?o.torchAnimation.currentTile():t.entityTileSet.itemTiles[ne.TorchCarry];let a=p-.25*o.dir[0]+(o.dir[1]<0?.375:0),i=h-.125;const u=o.hasVaultKey?es.itemTiles[ne.KeyCarry]:t.entityTileSet.itemTiles[ne.PurseCarry];o.dir[1]>0?(o.hasTorch&&t.addGlyphLit(e,n,e+1,n+1,r,s),t.addGlyphLit(p,h,p+1,h+1,l,s),(o.hasPurse||o.hasVaultKey)&&t.addGlyphLit(a,i,a+1,i+1,u,s)):o.dir[1]<0?((o.hasPurse||o.hasVaultKey)&&t.addGlyphLit(a,i,a+1,i+1,u,s),t.addGlyphLit(p,h,p+1,h+1,l,s),o.hasTorch&&t.addGlyphLit(e,n,e+1,n+1,r,s)):(t.addGlyphLit(p,h,p+1,h+1,l,s),o.hasTorch&&t.addGlyphLit(e,n,e+1,n+1,r,s),(o.hasPurse||o.hasVaultKey)&&t.addGlyphLit(a,i,a+1,i+1,u,s))}else t.addGlyphLit(p,h,p+1,h+1,l,s)}})(o,e),(o.gameMode!==fr.MansionComplete&&o.gameMode!==fr.Win||o.player.animation)&&function(e,t){const o=e.player,n=o.animation,r=n&&n instanceof b?n.offset:a.create(),s=o.pos[0]+r[0],i=o.pos[1]+r[1],l=o.pos[0],u=o.pos[1],c=e.gameMap.cells.at(l,u),d=ea(c.lit,e.lightStates,c.litSrc,e.seeAll||c.seen),p=o.hidden(e.gameMap),h=o.health<=0;let m;if(n)m=n.currentTile();else{const e=t.entityTileSet.playerTiles;m=h?e.dead:p||c.type===J.GroundWater?e.hidden:e.normal}const f=[],g=structuredClone(m);if(!h){if(o.idle){if(null!==o.idleCursorAnimation&&1===o.idleCursorAnimation.length&&o.idleCursorAnimation[0]instanceof R){const e=o.idleCursorAnimation[0].currentTile();t.addGlyphLit(l,u,l+1,u+1,e,1)}if(null!==o.idleCursorAnimation&&o.idleCursorAnimation.length>1)for(let e of o.idleCursorAnimation)if(e instanceof k){const o=e.currentTile(),n=e.offset;n[1]>0?t.addGlyphLit(l+n[0],u+n[1]/4-.125,l+n[0]+1,u+n[1]/4+1-.125,o,1):f.push([l+n[0],u+n[1]/4-.125,l+n[0]+1,u+n[1]/4+1-.125,o,1])}}o.damagedLastTurn?(g.color=So,g.unlitColor=ho):p&&(g.color=go,g.unlitColor=yo)}if(t.addGlyphLit(s,i,s+1,i+1,g,d),p&&o.idle&&t.addGlyphLit(s,i,s+1,i+1,t.entityTileSet.playerTiles.litFace,.15),o.lightActive){const e=null!==o.torchAnimation?o.torchAnimation.currentTile():t.entityTileSet.itemTiles[ne.TorchCarry];t.addGlyphLit(s,i,s+1,i+1,e,d)}for(let e of f)t.addGlyphLit(...e)}(o,e);(function(e,t){for(let o of e.particles)if(o.animation){const e=o.animation,n=e instanceof b||e instanceof k?e.offset:a.create(),r=o.pos[0]+n[0],s=o.pos[1]+n[1],i=e.currentTile();t.addGlyph(r,s,r+1,s+1,i)}})(o,e),o.gameMode===fr.Mansion&&function(e,t){const o=e.player,n=t.entityTileSet.namedTiles.speechBubbleR,r=t.entityTileSet.namedTiles.speechBubbleL;for(const s of e.gameMap.guards){const i=e.gameMap.cells.atVec(s.pos);if(!(e.seeAll||i.seen||s.speaking)&&a.squaredDistance(e.player.pos,s.pos)>36)continue;let l=s.animation?.offset??a.create();const u=s.pos[0]+l[0],c=s.pos[1]+l[1];s.speaking&&!e.popups.isSpeechBubbleVisible()&&(s.dir[0]>=0?t.addGlyph(u+1,c,u+2,c+1,n):t.addGlyph(u-1,c,u,c+1,r));const d=s.overheadIcon();if(d!==te.Relaxed){const e=t.entityTileSet.guardStateTiles[d];t.addGlyph(u,c+.625,u+1,c+1.625,e)}if(s===o.pickTarget){const e=es.namedTiles.pickTarget;t.addGlyph(u,c+.625,u+1,c+1.625,e)}}if(o.preNoisy||o.noisy){const e=o.animation,n=e&&e instanceof b?e.offset:a.create();if(Math.abs(n[0])<.5&&Math.abs(n[1])<.5){const e=o.pos[0]+o.noiseOffset[0]/2,n=o.pos[1]+o.noiseOffset[1]/2;if(o.preNoisy)t.addGlyph(e,n,e+1,n+1,es.namedTiles.pickTarget);else{const r=.0625*Math.sin(o.noisyAnim*Math.PI*2);t.addGlyph(e-r,n-r,e+1+r,n+1+r,es.namedTiles.noise)}}}}(o,e);(function(e,t){const o=e.gameMap.cells.sizeX,n=e.gameMap.cells.sizeY,r={textureIndex:0,color:To,unlitColor:To};t.addGlyph(-1,0,0,n,r),t.addGlyph(o,0,o+1,n,r),t.addGlyph(-1,-1,o+1,0,r),t.addGlyph(-1,n,o+1,n+1,r)})(o,e),e.flush(),function(e,t,o,n,r,s){const a=Math.max(1,t-e)*Math.max(0,n)/hs;if(a<=0)return;const l=o?0:1,u=o?1:0,c=o?1:0,d=[l,u,c,Math.min(1,.05*a)],p=[l,u,c,Math.min(1,.5*a)],h=.8,m=1.5,f=i.create();s[0]<s[1]?(f[0]=s[0]/s[1],f[5]=1):(f[0]=1,f[5]=s[1]/s[0]);f[0]/=m,f[5]/=m,f[10]=1,f[15]=1,r.renderVignette(f,h/m,d,p)}(o.player.health,o.player.healthMax,o.healthBarState.healing,o.healthBarState.damageDisplayTimer,e,t),(o.gameMode===fr.Mansion||o.gameMode===fr.MansionComplete)&&(function(e,t,o){if(!o.popups.isSpeechBubbleVisible())return;if(void 0===o.popups.currentSpeaker)return;const n=o.popups.currentSpeech;if(0===n.length)return;const r=Ta(t),s=r*ss,l=r*as,u=is*o.camera.scale,c=ls*o.camera.scale,d=a.fromValues(t[0],t[1]-l),[p,h]=_a(d,o.camera.scale),m=o.camera.position[0]+o.camera.joltOffset[0],f=o.camera.position[1]+o.camera.joltOffset[1],g=o.popups.currentSpeaker.posAnimated(),y=Math.floor((g[0]+.5-m+p/2)*u),x=Math.floor((g[1]+.5-f+h/2)*c)+l,v=n.split("\n"),S=v.reduce(((e,t)=>Math.max(e,t.length)),0),M=v.length,_=i.create();i.ortho(_,0,t[0],0,t[1],1,-1);const T=4*r,w=2*r,L=2*r,A=S*s+2*(T+L),b=M*l+2*(w+L),R=.625*c;let k=y-A/2,C=o.popups.currentSpeechAbove?1:-1,I=(b/2+R)*C+x-b/2;k=Math.max(k,0),k=Math.min(k,t[0]-A),I=Math.max(I,l),I=Math.min(I,t[1]-b),e.start(_,bo.Font),e.addGlyph(k,I,k+S*s+2*(T+L),I+M*l+2*(w+L),{textureIndex:219,color:4278716424}),e.addGlyph(k+L,I+L,k+S*s+2*T+L,I+M*l+2*w+L,{textureIndex:219,color:4291875024});let P=I+(M-1)*l+w+L;for(const t of v){let o=Math.floor(k+T+L+(S-t.length)*s/2);for(let n=0;n<t.length;++n){const r=t.charCodeAt(n);e.addGlyph(o,P,o+s,P+l,{textureIndex:r,color:4278716424}),o+=s}P-=l}e.flush()}(e,t,o),function(e,t,o){if(!o.popups.isNotificationVisible())return;const n=o.popups.notification;if(0===n.length)return;const r=Ta(t),s=r*ss,l=r*as,u=is*o.camera.scale,c=ls*o.camera.scale,d=a.fromValues(t[0],t[1]-l),[p,h]=_a(d,o.camera.scale),m=o.camera.position[0]+o.camera.joltOffset[0],f=o.camera.position[1]+o.camera.joltOffset[1],g=o.popups.notificationWorldPos,y=(g[0]+.5-m+p/2)*u,x=(g[1]+.5-f+h/2)*c+l,v=n.split("\n"),S=v.reduce(((e,t)=>Math.max(e,t.length)),0),M=v.length,_=i.create();i.ortho(_,0,t[0],0,t[1],1,-1);const T=8*r,w=4*r,L=S*s+2*T,A=M*l+2*w;let b=y-L/2;let R=.5*(A+.875*c*2)+x-A/2;const k=8*r;b=Math.max(b,k),b=Math.min(b,t[0]-(L+k)),R=Math.max(R,l+k),R=Math.min(R,t[1]-(A+k)),e.start(_,bo.Font);const C=2953316360,I=4294967295;e.addGlyph(b,R,b+S*s+2*T,R+M*l+2*w,{textureIndex:219,color:C});let P=R+(M-1)*l+w;for(const t of v){let o=b+T+(S-t.length)*s/2;for(let n=0;n<t.length;++n){const r=t.charCodeAt(n);e.addGlyph(o,P,o+s,P+l,{textureIndex:r,color:I}),o+=s}P-=l}e.flush()}(e,t,o));o.gameMode!==fr.Mansion&&o.gameMode!==fr.MansionComplete||function(e,t,o){const n=o.hintMessage;if(0===n.length)return;const r=1,s=.25,a=Ta(t),l=t[0]/(a*ss),u=t[1]/(a*as),c=i.create(),d=(l-n.length)/-2,p=s+-(1.75+s);i.ortho(c,d,l+d,p,u+p,1,-1);const h=2953316360,m=4294967295;e.start(c,bo.Font),e.addGlyph(-r,-s,n.length+r,1+s,{textureIndex:ts.background.textureIndex,color:h,unlitColor:h}),La(e,0,n,m),e.flush()}(e,t,o);const r=o.textWindows[o.gameMode];void 0!==r&&r.render(e);if(function(e,t,o){const n=Ta(t),r=t[0]/(n*ss),s=t[1]/(n*as),a=i.create();i.ortho(a,0,r,0,s,1,-1),e.start(a,bo.Font),e.addGlyph(0,0,r,1,ts.background);let l=1;const u=o.gameMap.cells.atVec(o.player.pos).type==J.GroundWater&&o.player.turnsRemainingUnderwater>0;if(u){const t=ts.air.textureIndex;for(let n=0;n<ae-2;++n){const r=n<o.player.turnsRemainingUnderwater-1?vo:go;e.addGlyph(l,0,l+1,1,{textureIndex:t,color:r}),++l}}else{let t=o.healthBarState.size;const n=ts.heart.textureIndex;for(let r=0;r<o.player.healthMax;++r){const s=o.healthBarState.heartFlashRemaining[r],a=r<o.player.health?wa(ho,To,s):wa(go,So,s);e.addGlyph(l,0,l+t,t,{textureIndex:n,color:a}),l+=t}}++l;const c="Leap";o.leapToggleActive&&La(e,l,c,xo);l+=c.length;let d=r;const p=Math.floor(100*o.gameMap.fractionRevealed());if(p<100){let t="Map "+p+"%";d-=t.length+1,La(e,d,t,To)}else if(o.lootStolen<o.lootAvailable||o.gameMode!==fr.Mansion){let t="Loot "+o.lootStolen+"/"+o.lootAvailable;d-=t.length+1,La(e,d,t,Mo)}else{let t="Escape!";d-=t.length+1,La(e,d,t,Mo)}const h="Key";o.player.hasVaultKey&&(d-=h.length+1,La(e,d,h,vo));const m=o.fpsInfo.enabled?o.fpsInfo.msgFPS:"",f=(o.dailyRun?"Daily Lvl ":"Lvl ")+(o.level+1);let g=o.turns+"/"+_s(o);const y=0===o.levelStats.numSpottings;y||(g+="!");l=o.player.healthMax+c.length+2;const x=o.fpsInfo.enabled?2:1,v=(l+d-(f.length+g.length+m.length+x))/2;La(e,v,f,mo),La(e,v+f.length+1,g,go),""!==m&&La(e,v+f.length+g.length+2,m,mo);e.flush()}(e,t,o),ar===o.touchController){const n=i.create();i.ortho(n,0,t[0],0,t[1],1,-1),e.start(n,bo.Entity),function(e,t){for(const o in t.coreTouchTargets){if(!(o in t.controlStates))continue;const n=t.coreTouchTargets[o];if(!n.mouseable&&t.mouseActive)continue;if(null===n.tileInfo||0===n.rect[2]||0===n.rect[3])continue;const r=t.controlStates[o]?1:0;e.addGlyphLit(n.rect[0],n.rect[1],n.rect[0]+n.rect[2],n.rect[1]+n.rect[3],n.tileInfo,r)}e.flush()}(e,o.touchController),e.flush()}}(t,s,o),requestAnimationFrame((e=>Sa(e,t,o)))}function Ma(e,t,o,n,r,s){const i=a.create(),l=a.create();!function(e,t,o,n,r,s){const a=as*Ta(t),i=t[0],l=t[1]-a,u=Math.min(80,Math.floor(Math.min(i,l)/5))/(Math.max(is,ls)*o),c=i/(is*o),d=l/(ls*o);let p,h,m,f;p=c/2,h=e[0]-c/2,n&&i>l&&(p-=2*u,h+=2*u);p>h&&(p=h=e[0]/2);m=d/2,f=e[1]-d/2,n&&i<=l&&(m-=2*u,f+=2*u);m>f&&(m=f=e[1]/2);r[0]=p,r[1]=m,s[0]=h,s[1]=f}(e,t,o,n,i,l),r[0]=Math.max(i[0],Math.min(l[0],s[0]+.5)),r[1]=Math.max(i[1],Math.min(l[1],s[1]+.5))}function _a(e,t){const o=is*t,n=ls*t;return[e[0]/o,e[1]/n]}function Ta(e){const t=Math.max(1,e[0]/(56*ss)),o=Math.max(1,e[1]/(25*as)),n=Math.min(t,o);return Math.floor(2*n)/2}function wa(e,t,o){const n=255&e,r=e>>8&255,s=e>>16&255,a=e>>24&255,i=255&t,l=t>>8&255,u=t>>16&255,c=t>>24&255;return Math.max(0,Math.min(255,Math.trunc(n+(i-n)*o)))+(Math.max(0,Math.min(255,Math.trunc(r+(l-r)*o)))<<8)+(Math.max(0,Math.min(255,Math.trunc(s+(u-s)*o)))<<16)+(Math.max(0,Math.min(255,Math.trunc(a+(c-a)*o)))<<24)}function La(e,t,o,n){for(let r=0;r<o.length;++r){let s=o.charCodeAt(r);10===s&&(s=32),e.addGlyph(t,0,t+1,1,{textureIndex:s,color:n}),++t}}function Aa(e=null,t=!0){const o=e??new Date,n=t?o.getUTCFullYear():o.getFullYear(),r=1+(t?o.getUTCMonth():o.getMonth()),s=t?o.getUTCDate():o.getDate();return`${String(n)}/${String(r).padStart(2,"0")}/${String(s).padStart(2,"0")}`}
//# sourceMappingURL=index.293437db.js.map
