function e(e,t,o,n){Object.defineProperty(e,t,{get:o,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},r={},i=o.parcelRequire550f;null==i&&((i=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var o={id:e,exports:{}};return n[e]=o,t.call(o.exports,o,o.exports),o.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){r[e]=t},o.parcelRequire550f=i),i.register("27Lyk",(function(t,o){var n,r;e(t.exports,"register",(()=>n),(e=>n=e)),e(t.exports,"resolve",(()=>r),(e=>r=e));var i={};n=function(e){for(var t=Object.keys(e),o=0;o<t.length;o++)i[t[o]]=e[t[o]]},r=function(e){var t=i[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),i.register("cmoHh",(function(e,t){!function(e,t,o){function n(e){var t=this,o=function(){var e=4022871197,t=function(t){t=String(t);for(var o=0;o<t.length;o++){var n=.02519603282416938*(e+=t.charCodeAt(o));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=o(" "),t.s1=o(" "),t.s2=o(" "),t.s0-=o(e),t.s0<0&&(t.s0+=1),t.s1-=o(e),t.s1<0&&(t.s1+=1),t.s2-=o(e),t.s2<0&&(t.s2+=1),o=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var o=new n(e),i=t&&t.state,s=o.next;return s.int32=function(){return 4294967296*o.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,i&&("object"==typeof i&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.alea=i}(0,e,"function"==typeof define&&define)})),i.register("euRi5",(function(e,t){!function(e,t,o){function n(e){var t=this,o="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:o+=e;for(var n=0;n<o.length+64;n++)t.x^=0|o.charCodeAt(n),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&("object"==typeof i&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.xor128=i}(0,e,"function"==typeof define&&define)})),i.register("hDsEw",(function(e,t){!function(e,t,o){function n(e){var t=this,o="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:o+=e;for(var n=0;n<o.length+64;n++)t.x^=0|o.charCodeAt(n),n==o.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&("object"==typeof i&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.xorwow=i}(0,e,"function"==typeof define&&define)})),i.register("3J2Zm",(function(e,t){!function(e,t,o){function n(e){var t=this;t.next=function(){var e,o,n=t.x,r=t.i;return e=n[r],o=(e^=e>>>7)^e<<24,o^=(e=n[r+1&7])^e>>>10,o^=(e=n[r+3&7])^e>>>3,o^=(e=n[r+4&7])^e<<7,e=n[r+7&7],o^=(e^=e<<13)^e<<9,n[r]=o,t.i=r+1&7,o},function(e,t){var o,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,o=0;o<t.length;++o)n[7&o]=n[7&o]<<15^t.charCodeAt(o)+n[o+1&7]<<13;for(;n.length<8;)n.push(0);for(o=0;o<8&&0===n[o];++o);for(8==o?n[7]=-1:n[o],e.x=n,e.i=0,o=256;o>0;--o)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&(i.x&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.xorshift7=i}(0,e,"function"==typeof define&&define)})),i.register("6Px8M",(function(e,t){!function(e,t,o){function n(e){var t=this;t.next=function(){var e,o,n=t.w,r=t.X,i=t.i;return t.w=n=n+1640531527|0,o=r[i+34&127],e=r[i=i+1&127],o^=o<<13,e^=e<<17,o^=o>>>15,e^=e>>>12,o=r[i]=o^e,t.i=i,o+(n^n>>>16)|0},function(e,t){var o,n,r,i,s,a=[],l=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,l=Math.max(l,t.length)),r=0,i=-32;i<l;++i)t&&(n^=t.charCodeAt((i+32)%t.length)),0===i&&(s=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,i>=0&&(s=s+1640531527|0,r=0==(o=a[127&i]^=n+s)?r+1:0);for(r>=128&&(a[127&(t&&t.length||0)]=-1),r=127,i=512;i>0;--i)n=a[r+34&127],o=a[r=r+1&127],n^=n<<13,o^=o<<17,n^=n>>>15,o^=o>>>12,a[r]=n^o;e.w=s,e.X=a,e.i=r}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&(i.X&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.xor4096=i}(0,e,"function"==typeof define&&define)})),i.register("lDm0S",(function(e,t){!function(e,t,o){function n(e){var t=this,o="";t.next=function(){var e=t.b,o=t.c,n=t.d,r=t.a;return e=e<<25^e>>>7^o,o=o-n|0,n=n<<24^n>>>8^r,r=r-e|0,t.b=e=e<<20^e>>>12^o,t.c=o=o-n|0,t.d=n<<16^o>>>16^r,t.a=r-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):o+=e;for(var n=0;n<o.length+20;n++)t.b^=0|o.charCodeAt(n),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&("object"==typeof i&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.tychei=i}(0,e,"function"==typeof define&&define)})),i.register("kjyEk",(function(e,t){})),i.register("iTab4",(function(e,t){e.exports=new URL(i("27Lyk").resolve("ad61r"),import.meta.url).toString()})),i.register("87bT4",(function(e,t){e.exports=new URL(i("27Lyk").resolve("9uUvV"),import.meta.url).toString()})),i.register("eN2P4",(function(e,t){e.exports=new URL(i("27Lyk").resolve("3oZoP"),import.meta.url).toString()})),i.register("8A7kA",(function(e,t){e.exports=new URL(i("27Lyk").resolve("2TVOL"),import.meta.url).toString()})),i.register("9bbmx",(function(e,t){e.exports=new URL(i("27Lyk").resolve("8yHq5"),import.meta.url).toString()})),i.register("V8ahV",(function(e,t){e.exports=new URL(i("27Lyk").resolve("dYyjZ"),import.meta.url).toString()})),i.register("hadbD",(function(e,t){e.exports=new URL(i("27Lyk").resolve("l8Gs4"),import.meta.url).toString()})),i.register("dH5ka",(function(e,t){e.exports=new URL(i("27Lyk").resolve("91j7m"),import.meta.url).toString()})),i.register("3twvr",(function(e,t){e.exports=new URL(i("27Lyk").resolve("dyBrj"),import.meta.url).toString()})),i.register("bBbdi",(function(e,t){e.exports=new URL(i("27Lyk").resolve("kO5BQ"),import.meta.url).toString()})),i.register("kBrAM",(function(e,t){e.exports=new URL(i("27Lyk").resolve("9stv3"),import.meta.url).toString()})),i.register("k6Tdk",(function(e,t){e.exports=new URL(i("27Lyk").resolve("iFwHo"),import.meta.url).toString()})),i.register("vDQ5G",(function(e,t){e.exports=new URL(i("27Lyk").resolve("cUkcS"),import.meta.url).toString()})),i.register("7DVvx",(function(e,t){e.exports=new URL(i("27Lyk").resolve("3WoZq"),import.meta.url).toString()})),i.register("al4v1",(function(e,t){e.exports=new URL(i("27Lyk").resolve("4CRTl"),import.meta.url).toString()})),i.register("fO2Fk",(function(e,t){e.exports=new URL(i("27Lyk").resolve("byhsW"),import.meta.url).toString()})),i.register("kaxMC",(function(e,t){e.exports=new URL(i("27Lyk").resolve("9W38z"),import.meta.url).toString()})),i.register("lsnFy",(function(e,t){e.exports=new URL(i("27Lyk").resolve("4Xt2t"),import.meta.url).toString()})),i.register("iSQf2",(function(e,t){e.exports=new URL(i("27Lyk").resolve("7CMGD"),import.meta.url).toString()})),i.register("9W6vc",(function(e,t){e.exports=new URL(i("27Lyk").resolve("5OaqH"),import.meta.url).toString()})),i.register("h5cAV",(function(e,t){e.exports=new URL(i("27Lyk").resolve("eMbVa"),import.meta.url).toString()})),i.register("71dbC",(function(e,t){e.exports=new URL(i("27Lyk").resolve("3axOF"),import.meta.url).toString()})),i.register("iOIx8",(function(e,t){e.exports=new URL(i("27Lyk").resolve("e7FGC"),import.meta.url).toString()})),i.register("5HSVp",(function(e,t){e.exports=new URL(i("27Lyk").resolve("ePtUz"),import.meta.url).toString()})),i.register("gjhQR",(function(e,t){e.exports=new URL(i("27Lyk").resolve("54JTP"),import.meta.url).toString()})),i.register("9yWXC",(function(e,t){e.exports=new URL(i("27Lyk").resolve("f4kGs"),import.meta.url).toString()})),i.register("8wZYi",(function(e,t){e.exports=new URL(i("27Lyk").resolve("gIhaU"),import.meta.url).toString()})),i.register("lLaFn",(function(e,t){e.exports=new URL(i("27Lyk").resolve("lqqo8"),import.meta.url).toString()})),i.register("91Ssr",(function(e,t){e.exports=new URL(i("27Lyk").resolve("cLwSE"),import.meta.url).toString()})),i.register("iPqLJ",(function(e,t){e.exports=new URL(i("27Lyk").resolve("2KH0C"),import.meta.url).toString()})),i.register("aYURT",(function(e,t){e.exports=new URL(i("27Lyk").resolve("cpKKf"),import.meta.url).toString()})),i.register("28SI0",(function(e,t){e.exports=new URL(i("27Lyk").resolve("5MeQP"),import.meta.url).toString()})),i.register("2v7tx",(function(e,t){e.exports=new URL(i("27Lyk").resolve("2JDpK"),import.meta.url).toString()})),i.register("2ab9R",(function(e,t){e.exports=new URL(i("27Lyk").resolve("2zYEJ"),import.meta.url).toString()})),i.register("5mxOT",(function(e,t){e.exports=new URL(i("27Lyk").resolve("cGSNL"),import.meta.url).toString()})),i.register("6zU4W",(function(e,t){e.exports=new URL(i("27Lyk").resolve("iv3Fr"),import.meta.url).toString()})),i.register("c5gUn",(function(e,t){e.exports=new URL(i("27Lyk").resolve("iTJrg"),import.meta.url).toString()})),i.register("pgODr",(function(e,t){e.exports=new URL(i("27Lyk").resolve("6QPv3"),import.meta.url).toString()})),i.register("2CXE7",(function(e,t){e.exports=new URL(i("27Lyk").resolve("l0nd4"),import.meta.url).toString()})),i.register("6IDgr",(function(e,t){e.exports=new URL(i("27Lyk").resolve("2n0fD"),import.meta.url).toString()})),i.register("sYECX",(function(e,t){e.exports=new URL(i("27Lyk").resolve("fOp9V"),import.meta.url).toString()})),i.register("5SG7D",(function(e,t){e.exports=new URL(i("27Lyk").resolve("i4uwn"),import.meta.url).toString()})),i.register("b3a1B",(function(e,t){e.exports=new URL(i("27Lyk").resolve("bFVB0"),import.meta.url).toString()})),i.register("hNZg3",(function(e,t){e.exports=new URL(i("27Lyk").resolve("auuxb"),import.meta.url).toString()})),i.register("f54Wu",(function(e,t){e.exports=new URL(i("27Lyk").resolve("ejcPD"),import.meta.url).toString()})),i.register("lLVHT",(function(e,t){e.exports=new URL(i("27Lyk").resolve("dGQlG"),import.meta.url).toString()})),i.register("4n1uh",(function(e,t){e.exports=new URL(i("27Lyk").resolve("c1reW"),import.meta.url).toString()})),i.register("9h7xU",(function(e,t){e.exports=new URL(i("27Lyk").resolve("4kHlF"),import.meta.url).toString()})),i.register("jiU0R",(function(e,t){e.exports=new URL(i("27Lyk").resolve("UrS1Y"),import.meta.url).toString()})),i.register("alx6Z",(function(e,t){e.exports=new URL(i("27Lyk").resolve("la8N0"),import.meta.url).toString()})),i.register("ijwXJ",(function(e,t){e.exports=new URL(i("27Lyk").resolve("7cL8R"),import.meta.url).toString()})),i.register("a2kyU",(function(e,t){e.exports=new URL(i("27Lyk").resolve("2wBmK"),import.meta.url).toString()})),i.register("5d0DW",(function(e,t){e.exports=new URL(i("27Lyk").resolve("jALpK"),import.meta.url).toString()})),i.register("dxMYB",(function(e,t){e.exports=new URL(i("27Lyk").resolve("b9dEt"),import.meta.url).toString()})),i.register("baOJW",(function(e,t){e.exports=new URL(i("27Lyk").resolve("fFe5r"),import.meta.url).toString()})),i.register("k2iei",(function(e,t){e.exports=new URL(i("27Lyk").resolve("lbRhG"),import.meta.url).toString()})),i.register("3x4yY",(function(e,t){e.exports=new URL(i("27Lyk").resolve("fpGvS"),import.meta.url).toString()})),i.register("egNqT",(function(e,t){e.exports=new URL(i("27Lyk").resolve("1sKsl"),import.meta.url).toString()})),i.register("QVkvm",(function(e,t){e.exports=new URL(i("27Lyk").resolve("gm0uu"),import.meta.url).toString()})),i.register("ggzCL",(function(e,t){e.exports=new URL(i("27Lyk").resolve("gYm3j"),import.meta.url).toString()})),i.register("h8bVj",(function(e,t){e.exports=new URL(i("27Lyk").resolve("binTT"),import.meta.url).toString()})),i.register("1NOTS",(function(e,t){e.exports=new URL(i("27Lyk").resolve("kOvrs"),import.meta.url).toString()})),i.register("6wdzE",(function(e,t){e.exports=new URL(i("27Lyk").resolve("f7gll"),import.meta.url).toString()})),i.register("7Bgvb",(function(e,t){e.exports=new URL(i("27Lyk").resolve("kxaoK"),import.meta.url).toString()})),i.register("cc8Co",(function(e,t){e.exports=new URL(i("27Lyk").resolve("1IHGt"),import.meta.url).toString()})),i.register("3Vwq5",(function(e,t){e.exports=new URL(i("27Lyk").resolve("d1AT3"),import.meta.url).toString()})),i.register("bk6h6",(function(e,t){e.exports=new URL(i("27Lyk").resolve("iTS30"),import.meta.url).toString()})),i.register("7Du7Q",(function(e,t){e.exports=new URL(i("27Lyk").resolve("dgv1C"),import.meta.url).toString()})),i.register("aTKjT",(function(e,t){e.exports=new URL(i("27Lyk").resolve("3lODt"),import.meta.url).toString()})),i.register("8P0kg",(function(e,t){e.exports=new URL(i("27Lyk").resolve("nwoyO"),import.meta.url).toString()})),i.register("fyl73",(function(e,t){e.exports=new URL(i("27Lyk").resolve("hLJrX"),import.meta.url).toString()})),i.register("j5ffj",(function(e,t){e.exports=new URL(i("27Lyk").resolve("7NNoN"),import.meta.url).toString()})),i.register("40XLk",(function(e,t){e.exports=new URL(i("27Lyk").resolve("iYi3V"),import.meta.url).toString()})),i.register("k4RLX",(function(e,t){e.exports=new URL(i("27Lyk").resolve("7xPeO"),import.meta.url).toString()})),i.register("34gKi",(function(e,t){e.exports=new URL(i("27Lyk").resolve("1cPlO"),import.meta.url).toString()})),i.register("9L8Sg",(function(e,t){e.exports=new URL(i("27Lyk").resolve("aGpum"),import.meta.url).toString()})),i.register("5Fjgc",(function(e,t){e.exports=new URL(i("27Lyk").resolve("iOuyX"),import.meta.url).toString()})),i.register("7jABT",(function(e,t){e.exports=new URL(i("27Lyk").resolve("jjy9s"),import.meta.url).toString()})),i.register("fgE4t",(function(e,t){e.exports=new URL(i("27Lyk").resolve("8p5cP"),import.meta.url).toString()})),i.register("gGzmW",(function(e,t){e.exports=new URL(i("27Lyk").resolve("8Jj6R"),import.meta.url).toString()})),i.register("aUMGA",(function(e,t){e.exports=new URL(i("27Lyk").resolve("5u3ZN"),import.meta.url).toString()})),i.register("hAB2v",(function(e,t){e.exports=new URL(i("27Lyk").resolve("clDJP"),import.meta.url).toString()})),i.register("j1q3e",(function(e,t){e.exports=new URL(i("27Lyk").resolve("fnIha"),import.meta.url).toString()})),i.register("cp5Da",(function(e,t){e.exports=new URL(i("27Lyk").resolve("dxxv5"),import.meta.url).toString()})),i.register("k9vCo",(function(e,t){e.exports=new URL(i("27Lyk").resolve("bGEJc"),import.meta.url).toString()})),i.register("fzAkK",(function(e,t){e.exports=new URL(i("27Lyk").resolve("goGEv"),import.meta.url).toString()})),i.register("2mcEF",(function(e,t){e.exports=new URL(i("27Lyk").resolve("5phrJ"),import.meta.url).toString()})),i.register("2lUVX",(function(e,t){e.exports=new URL(i("27Lyk").resolve("hZpxD"),import.meta.url).toString()})),i.register("bR2Qq",(function(e,t){e.exports=new URL(i("27Lyk").resolve("kSjuO"),import.meta.url).toString()})),i.register("4tABs",(function(e,t){e.exports=new URL(i("27Lyk").resolve("814wp"),import.meta.url).toString()})),i.register("4eWcK",(function(e,t){e.exports=new URL(i("27Lyk").resolve("6XNTC"),import.meta.url).toString()})),i.register("2IlHA",(function(e,t){e.exports=new URL(i("27Lyk").resolve("eSN3y"),import.meta.url).toString()})),i.register("b4oBR",(function(e,t){e.exports=new URL(i("27Lyk").resolve("9fotz"),import.meta.url).toString()})),i.register("bEpX3",(function(e,t){e.exports=new URL(i("27Lyk").resolve("eseEk"),import.meta.url).toString()})),i.register("zO13n",(function(e,t){e.exports=new URL(i("27Lyk").resolve("fHEVh"),import.meta.url).toString()})),i.register("hPTSL",(function(e,t){e.exports=new URL(i("27Lyk").resolve("aR76A"),import.meta.url).toString()})),i.register("5TQSa",(function(e,t){e.exports=new URL(i("27Lyk").resolve("6SX6V"),import.meta.url).toString()})),i.register("h66m0",(function(e,t){e.exports=new URL(i("27Lyk").resolve("61mqx"),import.meta.url).toString()})),i.register("iXaO0",(function(e,t){e.exports=new URL(i("27Lyk").resolve("6vqpv"),import.meta.url).toString()})),i.register("kZ7gB",(function(e,t){e.exports=new URL(i("27Lyk").resolve("7YskR"),import.meta.url).toString()})),i.register("fBP7x",(function(e,t){e.exports=new URL(i("27Lyk").resolve("4GKs5"),import.meta.url).toString()})),i.register("4iRwq",(function(e,t){e.exports=new URL(i("27Lyk").resolve("1i2I4"),import.meta.url).toString()})),i.register("aQaIJ",(function(e,t){e.exports=new URL(i("27Lyk").resolve("kOipz"),import.meta.url).toString()})),i.register("jI1w6",(function(e,t){e.exports=new URL(i("27Lyk").resolve("f3MqY"),import.meta.url).toString()})),i.register("7OaPU",(function(e,t){e.exports=new URL(i("27Lyk").resolve("8Eo8p"),import.meta.url).toString()})),i.register("eAAPp",(function(e,t){e.exports=new URL(i("27Lyk").resolve("6Z9FR"),import.meta.url).toString()})),i.register("Z94uH",(function(e,t){e.exports=new URL(i("27Lyk").resolve("2BOzR"),import.meta.url).toString()})),i.register("2GAEF",(function(e,t){e.exports=new URL(i("27Lyk").resolve("iFNVa"),import.meta.url).toString()})),i.register("bl9NP",(function(e,t){e.exports=new URL(i("27Lyk").resolve("bb2lS"),import.meta.url).toString()})),i.register("avnp8",(function(e,t){e.exports=new URL(i("27Lyk").resolve("bJNpV"),import.meta.url).toString()})),i.register("2mxOl",(function(e,t){e.exports=new URL(i("27Lyk").resolve("bTEcp"),import.meta.url).toString()})),i.register("bvdYU",(function(e,t){e.exports=new URL(i("27Lyk").resolve("4m6Oj"),import.meta.url).toString()})),i.register("f5YJN",(function(e,t){e.exports=new URL(i("27Lyk").resolve("2keaG"),import.meta.url).toString()})),i.register("h733p",(function(e,t){e.exports=new URL(i("27Lyk").resolve("coxSt"),import.meta.url).toString()})),i.register("5iRGH",(function(e,t){e.exports=new URL(i("27Lyk").resolve("9mWWx"),import.meta.url).toString()})),i.register("bodaa",(function(e,t){e.exports=new URL(i("27Lyk").resolve("iS60i"),import.meta.url).toString()})),i.register("jnTTO",(function(e,t){e.exports=new URL(i("27Lyk").resolve("bFY2K"),import.meta.url).toString()})),i.register("2uhoz",(function(e,t){e.exports=new URL(i("27Lyk").resolve("aRgI5"),import.meta.url).toString()})),i.register("4bkfm",(function(e,t){e.exports=new URL(i("27Lyk").resolve("4VzTB"),import.meta.url).toString()})),i.register("cBYcL",(function(e,t){e.exports=new URL(i("27Lyk").resolve("9gJPN"),import.meta.url).toString()})),i.register("1ZzuO",(function(e,t){e.exports=new URL(i("27Lyk").resolve("fH358"),import.meta.url).toString()})),i.register("iYF5j",(function(e,t){e.exports=new URL(i("27Lyk").resolve("76xZF"),import.meta.url).toString()})),i.register("hSkKy",(function(e,t){e.exports=new URL(i("27Lyk").resolve("jaDSM"),import.meta.url).toString()})),i.register("iCpSW",(function(e,t){e.exports=new URL(i("27Lyk").resolve("eVH90"),import.meta.url).toString()})),i.register("9upNV",(function(e,t){e.exports=new URL(i("27Lyk").resolve("j31GE"),import.meta.url).toString()})),i.register("yZG5v",(function(e,t){e.exports=new URL(i("27Lyk").resolve("g59Cn"),import.meta.url).toString()})),i.register("f1guA",(function(e,t){e.exports=new URL(i("27Lyk").resolve("3M7dG"),import.meta.url).toString()})),i.register("83TDO",(function(e,t){e.exports=new URL(i("27Lyk").resolve("bodxv"),import.meta.url).toString()})),i.register("frVxF",(function(e,t){e.exports=new URL(i("27Lyk").resolve("aD9LH"),import.meta.url).toString()})),i.register("hCPR7",(function(e,t){e.exports=new URL(i("27Lyk").resolve("hiMs1"),import.meta.url).toString()})),i.register("4Za6U",(function(e,t){e.exports=new URL(i("27Lyk").resolve("5N2Ks"),import.meta.url).toString()})),i.register("3Xk6I",(function(e,t){e.exports=new URL(i("27Lyk").resolve("dxQIJ"),import.meta.url).toString()})),i.register("dosUm",(function(e,t){e.exports=new URL(i("27Lyk").resolve("35PQn"),import.meta.url).toString()})),i.register("4gdwQ",(function(e,t){e.exports=new URL(i("27Lyk").resolve("boWMm"),import.meta.url).toString()})),i.register("aLkfr",(function(e,t){e.exports=new URL(i("27Lyk").resolve("iI5Sk"),import.meta.url).toString()})),i.register("kSLiP",(function(e,t){e.exports=new URL(i("27Lyk").resolve("icWuP"),import.meta.url).toString()})),i.register("2IENo",(function(e,t){e.exports=new URL(i("27Lyk").resolve("8kRcq"),import.meta.url).toString()})),i.register("1CFiH",(function(e,t){e.exports=new URL(i("27Lyk").resolve("k6kBH"),import.meta.url).toString()})),i.register("llhgm",(function(e,t){e.exports=new URL(i("27Lyk").resolve("64BGF"),import.meta.url).toString()})),i.register("2eW7L",(function(e,t){e.exports=new URL(i("27Lyk").resolve("gdcwz"),import.meta.url).toString()})),i.register("kZcsz",(function(e,t){e.exports=new URL(i("27Lyk").resolve("4q8Ah"),import.meta.url).toString()})),i.register("2qpAR",(function(e,t){e.exports=new URL(i("27Lyk").resolve("9onoo"),import.meta.url).toString()})),i.register("cAyqi",(function(e,t){e.exports=new URL(i("27Lyk").resolve("93Pnl"),import.meta.url).toString()})),i.register("aEQTO",(function(e,t){e.exports=new URL(i("27Lyk").resolve("jpS1l"),import.meta.url).toString()})),i.register("ijfWN",(function(e,t){e.exports=new URL(i("27Lyk").resolve("8QomF"),import.meta.url).toString()})),i.register("7sWca",(function(e,t){e.exports=new URL(i("27Lyk").resolve("lqfpT"),import.meta.url).toString()})),i.register("fevkE",(function(e,t){e.exports=new URL(i("27Lyk").resolve("94dJT"),import.meta.url).toString()})),i.register("1B1JN",(function(e,t){e.exports=new URL(i("27Lyk").resolve("igW24"),import.meta.url).toString()})),i.register("jnuCJ",(function(e,t){e.exports=new URL(i("27Lyk").resolve("lqEqF"),import.meta.url).toString()})),i.register("cmvWY",(function(e,t){e.exports=new URL(i("27Lyk").resolve("8RJZ0"),import.meta.url).toString()})),i.register("hMHBo",(function(e,t){e.exports=new URL(i("27Lyk").resolve("dr5Sb"),import.meta.url).toString()})),i.register("9Nz7S",(function(e,t){e.exports=new URL(i("27Lyk").resolve("hrLmV"),import.meta.url).toString()})),i.register("9tCyg",(function(e,t){e.exports=new URL(i("27Lyk").resolve("9wrD0"),import.meta.url).toString()})),i.register("7ryfo",(function(e,t){e.exports=new URL(i("27Lyk").resolve("lSD3i"),import.meta.url).toString()})),i.register("eLXb8",(function(e,t){e.exports=new URL(i("27Lyk").resolve("2z5r6"),import.meta.url).toString()})),i.register("8uLuu",(function(e,t){e.exports=new URL(i("27Lyk").resolve("6WfXi"),import.meta.url).toString()})),i.register("io7hj",(function(e,t){e.exports=new URL(i("27Lyk").resolve("lOXp5"),import.meta.url).toString()})),i.register("8Mr4t",(function(e,t){e.exports=new URL(i("27Lyk").resolve("9T16N"),import.meta.url).toString()})),i.register("3gcK8",(function(e,t){e.exports=new URL(i("27Lyk").resolve("k7LDh"),import.meta.url).toString()})),i.register("3N27a",(function(e,t){e.exports=new URL(i("27Lyk").resolve("gLbJJ"),import.meta.url).toString()})),i.register("i8RlJ",(function(e,t){e.exports=new URL(i("27Lyk").resolve("4qtqX"),import.meta.url).toString()})),i.register("4vw0X",(function(e,t){e.exports=new URL(i("27Lyk").resolve("z6pdh"),import.meta.url).toString()})),i.register("6aNdh",(function(e,t){e.exports=new URL(i("27Lyk").resolve("boWBX"),import.meta.url).toString()})),i.register("i6vQ5",(function(e,t){e.exports=new URL(i("27Lyk").resolve("jChss"),import.meta.url).toString()})),i.register("5PMpx",(function(e,t){e.exports=new URL(i("27Lyk").resolve("6WkPY"),import.meta.url).toString()})),i.register("2DFDi",(function(e,t){e.exports=new URL(i("27Lyk").resolve("idVW7"),import.meta.url).toString()})),i.register("527nu",(function(e,t){e.exports=new URL(i("27Lyk").resolve("jhJBF"),import.meta.url).toString()})),i.register("54HwM",(function(e,t){e.exports=new URL(i("27Lyk").resolve("1RMnM"),import.meta.url).toString()})),i.register("4e6QO",(function(e,t){e.exports=new URL(i("27Lyk").resolve("aawqd"),import.meta.url).toString()})),i.register("7k3tw",(function(e,t){e.exports=new URL(i("27Lyk").resolve("7Azq2"),import.meta.url).toString()})),i.register("fcDaw",(function(e,t){e.exports=new URL(i("27Lyk").resolve("bO5O6"),import.meta.url).toString()})),i.register("fty2x",(function(e,t){e.exports=new URL(i("27Lyk").resolve("cMgfB"),import.meta.url).toString()})),i.register("jFsow",(function(e,t){e.exports=new URL(i("27Lyk").resolve("i0tVX"),import.meta.url).toString()})),i.register("cMmoo",(function(e,t){e.exports=new URL(i("27Lyk").resolve("haQJd"),import.meta.url).toString()})),i("27Lyk").register(JSON.parse('{"17fSe":"index.99d5e51f.js","dwPvt":"tiles31color.41882d14.png","kDrfW":"font.84b63647.png","8Qic0":"Minstrel_Dance.84f0fe17.mp3","aSqJ5":"level-requirement-1.1c09d439.mp3","hMICc":"level-requirement-2.d04a051d.mp3","cFOzA":"lose-game-over.be572349.mp3","iP5rH":"Minstrel Dance Easter Egg.9bfc149a.mp3","4cgQm":"footstep-wood.61af6a80.mp3","5uP20":"footstep-tile.2079c58b.mp3","koWqL":"footstep-water.9134aef9.mp3","drQCs":"footstep-gravel.9bd43b2f.mp3","aKQuT":"footstep-grass.5ff03075.mp3","ad61r":"creak.dd25daba.mp3","9uUvV":"creak-2.17e2351c.mp3","3oZoP":"creak-3.15dd3369.mp3","2TVOL":"creak-4.44ae5b0e.mp3","8yHq5":"creak-5.76edc19f.mp3","dYyjZ":"creak-6.e3a72d6e.mp3","l8Gs4":"squeak1.463f9d1d.wav","91j7m":"squeak2.be5c76a8.wav","dyBrj":"squeak3.f084da55.wav","kO5BQ":"squeak4.f2ef2e0b.wav","9stv3":"hit16.mp3.12db2307.flac","iFwHo":"hit17.mp3.f1f9a130.flac","cUkcS":"hit18.mp3.9e7af88b.flac","3WoZq":"hit19.mp3.d775e463.flac","4CRTl":"hit20.mp3.3b3594b6.flac","byhsW":"hit26.mp3.ad2a87c8.flac","9W38z":"hit27.mp3.68a7736d.flac","4Xt2t":"coin.27887bdc.mp3","7CMGD":"coin-2.e8e82d5c.mp3","5OaqH":"coin-3.004f8541.mp3","eMbVa":"coin-4.6a51959e.mp3","3axOF":"coin-5.035907c7.mp3","e7FGC":"grunt.a8cde342.mp3","ePtUz":"grunt-2.30849a22.mp3","54JTP":"grunt-3.687bdfee.mp3","f4kGs":"grunt-4.4776cbdb.mp3","gIhaU":"grunt-5.7ebbc883.mp3","lqqo8":"grunt-6.b692d76a.mp3","cLwSE":"grunt-7.9923b5b3.mp3","2KH0C":"grunt-8.1912db98.mp3","cpKKf":"douse.5dfe688a.mp3","5MeQP":"douse-2.01d5e3d6.mp3","2JDpK":"douse-3.5dfe688a.mp3","2zYEJ":"douse-4.b84da553.mp3","cGSNL":"ignite.d3dd60a8.mp3","iv3Fr":"ignite-2.9dbae47a.mp3","iTJrg":"hide.b8c99711.mp3","6QPv3":"hide-2.0fe6cda6.mp3","l0nd4":"hide-3.302dff53.mp3","2n0fD":"hide-4.a97e1fc7.mp3","fOp9V":"hide-5.9bfbd476.mp3","i4uwn":"hide-6.1cd4f3d7.mp3","bFVB0":"gate.d5f8126d.mp3","auuxb":"gate-2.0044fff9.mp3","ejcPD":"gate-3.5b7711d0.mp3","dGQlG":"gate-4.1e6a5d1b.mp3","c1reW":"gate-5.72c10f72.mp3","4kHlF":"jump.e55ef093.mp3","UrS1Y":"jump-2.6fe19da4.mp3","la8N0":"too high.9cb62710.mp3","7cL8R":"too high-2.e4f836e5.mp3","2wBmK":"Hmm.ab4666bb.mp3","jALpK":"What.15d09f65.mp3","b9dEt":"hey.53e8bfa8.mp3","fFe5r":"hey-2.e5982d2d.mp3","lbRhG":"hey-3.d3e5ca0c.mp3","fpGvS":"what was that.77a752f9.mp3","1sKsl":"what was that-2.d2d3ac5e.mp3","gm0uu":"what was that-3.d5e6d3bc.mp3","gYm3j":"what was that-4.0ba90c81.mp3","binTT":"what was that-5.4cee52fb.mp3","kOvrs":"who goes there.e12006f8.mp3","f7gll":"huh.0b84b50b.mp3","kxaoK":"wha.fed9d6c8.mp3","1IHGt":"wait.00b947d9.mp3","d1AT3":"who there.af08ce5f.mp3","iTS30":"what moved.5eb219b5.mp3","dgv1C":"what in the shadows.e4c09c64.mp3","3lODt":"shadow move.f9411514.mp3","nwoyO":"see something.8ae2c900.mp3","hLJrX":"hello.5375bd54.mp3","7NNoN":"ugh.d8bf005c.mp3","iYi3V":"quiet out.e6c9a6bb.mp3","7xPeO":"jumpy.8728c25d.mp3","1cPlO":"jumpin shadows.2393e9a2.mp3","aGpum":"ahh.d5b34b8b.mp3","iOuyX":"aww.afe83640.mp3","jjy9s":"rest me bones.b8117961.mp3","8p5cP":"oh well.4c7e171f.mp3","8Jj6R":"case of the jitters.d7950824.mp3","5u3ZN":"must be seeing.1cf0d466.mp3","clDJP":"what in my coffee.66632fce.mp3","fnIha":"coffee too strong.b8d95a1c.mp3","dxxv5":"hmm nothing.5e78dbae.mp3","bGEJc":"well I though I saw.a502b75d.mp3","goGEv":"nothing.0afb94af.mp3","5phrJ":"hopefully nothing.38c5aeda.mp3","hZpxD":"seeing things.a6f06709.mp3","kSjuO":"what-2.66b0ac41.mp3","814wp":"hark.c23476ea.mp3","6XNTC":"noise.b4e76638.mp3","eSN3y":"heard something.e9e5f3ce.mp3","9fotz":"cant hear now.d26c58c2.mp3","eseEk":"hearing things.369b6c03.mp3","fHEVh":"noise again.9bf45be9.mp3","aR76A":"someone there.5c5c2581.mp3","6SX6V":"who could that be.676f39e4.mp3","61mqx":"there it is again.9322fa48.mp3","6vqpv":"better check it out.ebf046f4.mp3","7YskR":"what keeps making those noises.acd58821.mp3","4GKs5":"better be rats.ebf6a701.mp3","1i2I4":"again.e6429fce.mp3","kOipz":"who that.e84cef75.mp3","f3MqY":"come out come out.beb4d769.mp3","8Eo8p":"guess nothing.d8004f20.mp3","6Z9FR":"wonder it was.d88b20b1.mp3","2BOzR":"back to post.c9710e8a.mp3","iFNVa":"quiet now.14ad7770.mp3","bb2lS":"sure I heard something.92884ce2.mp3","bJNpV":"not there anymore.d9adab1a.mp3","bTEcp":"probably nothing.61c0f4ca.mp3","4m6Oj":"i dont know why i work here.9c74a165.mp3","2keaG":"waste of my time.01eb2214.mp3","coxSt":"why do I even try.c223ca7c.mp3","9mWWx":"at least Im not on cleaning duty.a322a828.mp3","iS60i":"at least my shift ends soon.508eba67.mp3","bFY2K":"what do you want me to do about it.b4058cf6.mp3","aRgI5":"where.5c5c6f23.mp3","4VzTB":"coming.2427458c.mp3","9gJPN":"here I come.88f25611.mp3","fH358":"to arms.6c7d0469.mp3","76xZF":"what is it.60c0a58c.mp3","jaDSM":"i dont know how to whistle.ba7df287.mp3","eVH90":"whistle.3a7291de.mp3","j31GE":"whistle-2.476ef42b.mp3","g59Cn":"whistle-3.6bcc64ea.mp3","3M7dG":"get em.e4bd8211.mp3","bodxv":"intruder.d29f8600.mp3","aD9LH":"oh no its a thief.95ded24b.mp3","hiMs1":"we coming for you.72c3b24e.mp3","5N2Ks":"coming for you.7bb9dc69.mp3","dxQIJ":"halt.12eee447.mp3","35PQn":"see you.859510ce.mp3","boWMm":"ill get you.dce0b107.mp3","iI5Sk":"a goner.50561a6a.mp3","icWuP":"just you wait.d2b91fc0.mp3","8kRcq":"you wont get away.800811e0.mp3","k6kBH":"no you dont.4ac92675.mp3","64BGF":"thief.2115f040.mp3","gdcwz":"thief-2.9040a582.mp3","4q8Ah":"thief-3.b8074467.mp3","9onoo":"after them.b8ebaf41.mp3","93Pnl":"what is thy business.a4047487.mp3","jpS1l":"no mercy for the wicked.5762a3e4.mp3","8QomF":"lost em.a34a1d09.mp3","lqfpT":"must have run.7a11d2a0.mp3","94dJT":"where they go.ca451290.mp3","igW24":"his holiness.4d336ce3.mp3","lqEqF":"the boss.cc03678e.mp3","8RJZ0":"huff puff give up.2bb20f55.mp3","dr5Sb":"where did he go.95b776f4.mp3","hrLmV":"drats lost him.1c6956c9.mp3","9wrD0":"gone.c866fdd9.mp3","lSD3i":"come back here.c30d95e2.mp3","2z5r6":"rotten scoundrel.aa0b2e4c.mp3","6WfXi":"aargh.09fd695b.mp3","lOXp5":"not coming back.c1590d1d.mp3","9T16N":"blast.14fafb40.mp3","k7LDh":"dont come back.5b7087c8.mp3","gLbJJ":"wont get away next time.565245ee.mp3","4qtqX":"for his holiness.674bd7fc.mp3","z6pdh":"lousy day at work.96f55006.mp3","boWBX":"i give up.14ffb14e.mp3","jChss":"what do i do help me.1938fc64.mp3","6WkPY":"oh no he got away.1ec7c74a.mp3","idVW7":"guard rant.a80c9b54.mp3","jhJBF":"take that.89a1c776.mp3","1RMnM":"oof.0fbc8e69.mp3","aawqd":"uh.0f80062b.mp3","7Azq2":"ah.f85c33dd.mp3","bO5O6":"ah-2.5f33dd73.mp3","cMgfB":"ha ya.86d45e64.mp3","i0tVX":"ha ya-2.fc4fbee2.mp3","haQJd":"ha ya-3.78dc4818.mp3"}'));class s extends Array{constructor(...e){super(...e)}static fromValues(e,t){return new s(e,t)}static create(){return new s(0,0)}static clone(e){return new s(e[0],e[1])}equals(e){return this[0]===e[0]&&this[1]===e[1]}equalsValues(e,t){return this[0]===e&&this[1]===t}copy(e){this[0]=e[0],this[1]=e[1]}set(e,t){this[0]=e,this[1]=t}add(e){return s.fromValues(this[0]+e[0],this[1]+e[1])}subtract(e){return s.fromValues(this[0]-e[0],this[1]-e[1])}multiply(e){return s.fromValues(this[0]*e[0],this[1]*e[1])}scale(e){return s.fromValues(this[0]*e,this[1]*e)}scaleAndAdd(e,t){return s.fromValues(this[0]+e[0]*t,this[1]+e[1]*t)}distance(e){const t=this[0]-e[0],o=this[1]-e[1];return Math.hypot(t,o)}squaredDistance(e){const t=this[0]-e[0],o=this[1]-e[1];return t*t+o*o}len(){return Math.hypot(this[0],this[1])}squaredLen(e){const t=this[0],o=this[1];return t*t+o*o}negate(){return s.fromValues(-this[0],-this[1])}dot(e){return this[0]*e[0]+this[1]*e[1]}lerp(e,t){return s.fromValues(this[0]+t*(e[0]-this[0]),this[1]+t*(e[1]-this[1]))}zero(){this[0]=0,this[1]=0}static copy(e,t){e[0]=t[0],e[1]=t[1]}static set(e,t,o){e[0]=t,e[1]=o}static add(e,t,o){e[0]=t[0]+o[0],e[1]=t[1]+o[1]}static subtract(e,t,o){e[0]=t[0]-o[0],e[1]=t[1]-o[1]}static multiply(e,t,o){e[0]=t[0]*o[0],e[1]=t[1]*o[1]}static scale(e,t,o){e[0]=t[0]*o,e[1]=t[1]*o}static scaleAndAdd(e,t,o,n){e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n}static distance(e,t){const o=e[0]-t[0],n=e[1]-t[1];return Math.hypot(o,n)}static squaredDistance(e,t){const o=e[0]-t[0],n=e[1]-t[1];return o*o+n*n}static len(e){return Math.hypot(e[0],e[1])}static squaredLen(e){const t=e[0],o=e[1];return t*t+o*o}static negate(e,t){e[0]=-t[0],e[1]=-t[1]}static dot(e,t){return e[0]*t[0]+e[1]*t[1]}static lerp(e,t,o,n){e[0]=t[0]+n*(o[0]-t[0]),e[1]=t[1]+n*(o[1]-t[1])}static zero(e){e[0]=0,e[1]=0}}let a;var l;(l=a||(a={})).create=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},l.copy=function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]},l.ortho=function(e,t,o,n,r,i,s){const a=1/(t-o),l=1/(n-r),u=1/(i-s);e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+o)*a,e[13]=(r+n)*l,e[14]=(s+i)*u,e[15]=1};var u={},c=i("cmoHh"),d=i("euRi5"),p=i("hDsEw"),h=i("3J2Zm"),m=i("6Px8M"),f=i("lDm0S"),g={};!function(e,t,o){var n,r=256,s=6,a="random",l=o.pow(r,s),u=o.pow(2,52),c=2*u,d=r-1;function p(i,d,p){var g=[],_=y(f((d=1==d?{entropy:!0}:d||{}).entropy?[i,v(t)]:null==i?function(){try{var o;return n&&(o=n.randomBytes)?o=o(r):(o=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(o)),v(o)}catch(o){var i=e.navigator,s=i&&i.plugins;return[+new Date,e,s,e.screen,v(t)]}}():i,3),g),x=new h(g),w=function(){for(var e=x.g(s),t=l,o=0;e<u;)e=(e+o)*r,t*=r,o=x.g(1);for(;e>=c;)e/=2,t/=2,o>>>=1;return(e+o)/t};return w.int32=function(){return 0|x.g(4)},w.quick=function(){return x.g(4)/4294967296},w.double=w,y(v(x.S),t),(d.pass||p||function(e,t,n,r){return r&&(r.S&&m(r,x),e.state=function(){return m(x,{})}),n?(o[a]=e,t):e})(w,_,"global"in d?d.global:this==o,d.state)}function h(e){var t,o=e.length,n=this,i=0,s=n.i=n.j=0,a=n.S=[];for(o||(e=[o++]);i<r;)a[i]=i++;for(i=0;i<r;i++)a[i]=a[s=d&s+e[i%o]+(t=a[i])],a[s]=t;(n.g=function(e){for(var t,o=0,i=n.i,s=n.j,a=n.S;e--;)t=a[i=d&i+1],o=o*r+a[d&(a[i]=a[s=d&s+t])+(a[s]=t)];return n.i=i,n.j=s,o})(r)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var o,n=[],r=typeof e;if(t&&"object"==r)for(o in e)try{n.push(f(e[o],t-1))}catch(e){}return n.length?n:"string"==r?e:e+"\0"}function y(e,t){for(var o,n=e+"",r=0;r<n.length;)t[d&r]=d&(o^=19*t[d&r])+n.charCodeAt(r++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(y(o.random(),t),g){g=p;try{n=i("kjyEk")}catch(e){}}else"function"==typeof define&&define.amd?define((function(){return p})):o["seed"+a]=p}("undefined"!=typeof self?self:g,[],Math),g.alea=c,g.xor128=d,g.xorwow=p,g.xorshift7=h,g.xor4096=m,g.tychei=f,u=g;class y{constructor(e=""){""!==e?(this.seed=e,this.rng=t(u)(e)):(this.seed="",this.rng=t(u)())}reset(){this.rng=t(u)(this.seed)}random(){return this.rng()}randomInRange(e){return Math.floor(this.rng()*e)}shuffleArray(e){for(let t=e.length-1;t>0;--t){let o=this.randomInRange(t+1),n=e[t];e[t]=e[o],e[o]=n}}}function v(e){return Math.floor(Math.random()*e)}function _(e){for(let t=e.length-1;t>0;--t){let o=v(t+1),n=e[t];e[t]=e[o],e[o]=n}}let x;var w;(w=x||(x={}))[w.Damage=0]="Damage",w[w.GuardChase=1]="GuardChase",w[w.GuardSeeThief=2]="GuardSeeThief",w[w.GuardHearThief=3]="GuardHearThief",w[w.GuardHearGuard=4]="GuardHearGuard",w[w.GuardDownWarning=5]="GuardDownWarning",w[w.GuardAwakesWarning=6]="GuardAwakesWarning",w[w.GuardWarningResponse=7]="GuardWarningResponse",w[w.GuardInvestigate=8]="GuardInvestigate",w[w.GuardEndChase=9]="GuardEndChase",w[w.GuardFinishInvestigating=10]="GuardFinishInvestigating",w[w.GuardFinishLooking=11]="GuardFinishLooking",w[w.GuardFinishListening=12]="GuardFinishListening",w[w.GuardStirring=13]="GuardStirring";class S{constructor(){this.popups=[]}add(e,t){this.popups.push({popupType:e,posWorld:t})}clear(){this.popups.length=0}endOfUpdate(e){if(0===this.popups.length)return"";this.popups.sort(((e,t)=>e.popupType-t.popupType));return e[function(e){switch(e){case x.Damage:return"guardDamage";case x.GuardChase:return"guardChase";case x.GuardSeeThief:return"guardSeeThief";case x.GuardHearThief:return"guardHearThief";case x.GuardHearGuard:return"guardHearGuard";case x.GuardDownWarning:return"guardDownWarning";case x.GuardAwakesWarning:return"guardAwakesWarning";case x.GuardWarningResponse:return"guardWarningResponse";case x.GuardInvestigate:return"guardInvestigate";case x.GuardEndChase:return"guardEndChase";case x.GuardFinishInvestigating:return"guardFinishInvestigating";case x.GuardFinishLooking:return"guardFinishLooking";case x.GuardFinishListening:return"guardFinishListening";case x.GuardStirring:return"guardStirring"}}(this.popups[0].popupType)].play(.6).subtitle}}var T={},M={linear:function(e,t,o,n){return(o-t)*e/n+t},easeInQuad:function(e,t,o,n){return(o-t)*(e/=n)*e+t},easeOutQuad:function(e,t,o,n){return-(o-t)*(e/=n)*(e-2)+t},easeInOutQuad:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?r/2*e*e+t:-r/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,o,n){return(o-t)*(e/=n)*e*e+t},easeOutCubic:function(e,t,o,n){return(o-t)*((e=e/n-1)*e*e+1)+t},easeInOutCubic:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?r/2*e*e*e+t:r/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,o,n){return(o-t)*(e/=n)*e*e*e+t},easeOutQuart:function(e,t,o,n){return-(o-t)*((e=e/n-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?r/2*e*e*e*e+t:-r/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,o,n){return(o-t)*(e/=n)*e*e*e*e+t},easeOutQuint:function(e,t,o,n){return(o-t)*((e=e/n-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?r/2*e*e*e*e*e+t:r/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,o,n){var r=o-t;return-r*Math.cos(e/n*(Math.PI/2))+r+t},easeOutSine:function(e,t,o,n){return(o-t)*Math.sin(e/n*(Math.PI/2))+t},easeInOutSine:function(e,t,o,n){return-(o-t)/2*(Math.cos(Math.PI*e/n)-1)+t},easeInExpo:function(e,t,o,n){return 0==e?t:(o-t)*Math.pow(2,10*(e/n-1))+t},easeOutExpo:function(e,t,o,n){var r=o-t;return e==n?t+r:r*(1-Math.pow(2,-10*e/n))+t},easeInOutExpo:function(e,t,o,n){var r=o-t;return 0===e?t:e===n?t+r:(e/=n/2)<1?r/2*Math.pow(2,10*(e-1))+t:r/2*(2-Math.pow(2,-10*--e))+t},easeInCirc:function(e,t,o,n){return-(o-t)*(Math.sqrt(1-(e/=n)*e)-1)+t},easeOutCirc:function(e,t,o,n){return(o-t)*Math.sqrt(1-(e=e/n-1)*e)+t},easeInOutCirc:function(e,t,o,n){var r=o-t;return(e/=n/2)<1?-r/2*(Math.sqrt(1-e*e)-1)+t:r/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(e,t,o,n){var r,i,s,a=o-t;return s=1.70158,0===e?t:1==(e/=n)?t+a:((i=0)||(i=.3*n),(r=a)<Math.abs(a)?(r=a,s=i/4):s=i/(2*Math.PI)*Math.asin(a/r),-r*Math.pow(2,10*(e-=1))*Math.sin((e*n-s)*(2*Math.PI)/i)+t)},easeOutElastic:function(e,t,o,n){var r,i,s,a=o-t;return s=1.70158,0===e?t:1==(e/=n)?t+a:((i=0)||(i=.3*n),(r=a)<Math.abs(a)?(r=a,s=i/4):s=i/(2*Math.PI)*Math.asin(a/r),r*Math.pow(2,-10*e)*Math.sin((e*n-s)*(2*Math.PI)/i)+a+t)},easeInOutElastic:function(e,t,o,n){var r,i,s,a=o-t;return s=1.70158,0===e?t:2==(e/=n/2)?t+a:((i=0)||(i=n*(.3*1.5)),(r=a)<Math.abs(a)?(r=a,s=i/4):s=i/(2*Math.PI)*Math.asin(a/r),e<1?r*Math.pow(2,10*(e-=1))*Math.sin((e*n-s)*(2*Math.PI)/i)*-.5+t:r*Math.pow(2,-10*(e-=1))*Math.sin((e*n-s)*(2*Math.PI)/i)*.5+a+t)},easeInBack:function(e,t,o,n,r){return void 0===r&&(r=1.70158),(o-t)*(e/=n)*e*((r+1)*e-r)+t},easeOutBack:function(e,t,o,n,r){return void 0===r&&(r=1.70158),(o-t)*((e=e/n-1)*e*((r+1)*e+r)+1)+t},easeInOutBack:function(e,t,o,n,r){var i=o-t;return void 0===r&&(r=1.70158),(e/=n/2)<1?i/2*(e*e*((1+(r*=1.525))*e-r))+t:i/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t},easeInBounce:function(e,t,o,n){var r=o-t;return r-M.easeOutBounce(n-e,0,r,n)+t},easeOutBounce:function(e,t,o,n){var r=o-t;return(e/=n)<1/2.75?r*(7.5625*e*e)+t:e<2/2.75?r*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?r*(7.5625*(e-=2.25/2.75)*e+.9375)+t:r*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOutBounce:function(e,t,o,n){var r=o-t;return e<n/2?.5*M.easeInBounce(2*e,0,r,n)+t:.5*M.easeOutBounce(2*e-n,0,r,n)+.5*r+t}};T=M;class L{update(e){return!1}currentTile(){return{}}}class A extends L{constructor(e,t,o=0,n=0){super(),this.time=o,this.tileInfo=e,this.activeFrame=n,this.frameDuration=t}update(e){this.time+=e;const t=this.frameDuration instanceof Array?this.frameDuration[this.activeFrame]:this.frameDuration;return this.time>t&&(this.activeFrame++,this.activeFrame>=this.tileInfo.length&&(this.activeFrame=0),this.time=0),!1}currentTile(){return this.tileInfo[this.activeFrame]}}class b extends L{constructor(e,t){super(),this.time=0,this.offset=s.clone(e[0].pt0),this.tileInfo=t,this.activeFrame=0,this.frameStep=1,this.activePt=0,this.tweenSeq=e,this.removeOnFinish=!1}update(e){const t=this.tweenSeq[this.activePt].pt0,o=this.tweenSeq[this.activePt].pt1,n=this.tweenSeq[this.activePt].duration,r=this.tweenSeq[this.activePt].fn;return void 0===t||null==o||(this.time=Math.min(this.time+e,n),this.offset[0]=r(this.time,t[0],o[0],n),this.offset[1]=r(this.time,t[1],o[1],n),this.time==n&&(this.activePt++,this.time=0,this.activeFrame++),this.activeFrame>=this.tileInfo.length&&(this.activeFrame=0),this.activePt===this.tweenSeq.length)}currentTile(){return this.tileInfo[this.activeFrame]}}let R;var k;(k=R||(R={}))[k.idle=0]="idle",k[k.dimmed=1]="dimmed",k[k.off=2]="off";class H extends L{activeFrame=0;time=0;dimDuration=300;constructor(e,t,o,n,r,i,s){super(),this.idleTiles=r,this.dimTile=i,this.offTile=s,this.lightId=t,this.lightVector=o,this.state=e,this.item=n}update(e){if(null!==this.item&&(this.item.type===Z.TorchUnlit&&(this.state=R.off),this.item.type!==Z.TorchUnlit&&this.state===R.off&&(this.state=R.idle,this.lightVector[this.lightId]=0)),this.time+=e,this.state==R.off)return!1;let t=this.lightVector[this.lightId];if(0==t&&Math.random()>.995**(60*e)?(this.state=R.dimmed,t=3):t>0&&(t=Math.max(t-5*e,0)),0==t){this.state=R.idle;const e=this.idleTiles[this.activeFrame][1];this.time>=e&&(this.time=0,this.activeFrame++,this.activeFrame>=this.idleTiles.length&&(this.activeFrame=0))}return this.lightVector[this.lightId]=t,!1}currentTile(){return this.state==R.idle?this.idleTiles[this.activeFrame][0]:this.state==R.dimmed?this.dimTile:this.offTile}}let P;var C;let I;var E;(C=P||(P={}))[C.StoodStill=0]="StoodStill",C[C.Moved=1]="Moved",C[C.BumpedPlayer=2]="BumpedPlayer",(E=I||(I={}))[E.Patrol=0]="Patrol",E[E.Look=1]="Look",E[E.Listen=2]="Listen",E[E.ChaseVisibleTarget=3]="ChaseVisibleTarget",E[E.MoveToLastSighting=4]="MoveToLastSighting",E[E.MoveToLastSound=5]="MoveToLastSound",E[E.MoveToGuardShout=6]="MoveToGuardShout",E[E.MoveToDownedGuard=7]="MoveToDownedGuard",E[E.WakeGuard=8]="WakeGuard",E[E.MoveToTorch=9]="MoveToTorch",E[E.LightTorch=10]="LightTorch",E[E.Unconscious=11]="Unconscious";class W{dir=s.fromValues(1,0);mode=I.Patrol;angry=!1;hasTorch=!1;hasPurse=!1;hasVaultKey=!1;torchAnimation=null;speaking=!1;hasMoved=!1;heardThief=!1;heardThiefClosest=!1;hearingGuard=!1;heardGuard=!1;animation=null;modeTimeout=0;constructor(e,t){const o=e[t];this.pos=s.clone(o),this.heardGuardPos=s.clone(o),this.goal=s.clone(o),this.patrolPath=e,this.patrolPathIndex=t,this.updateDirInitial()}overheadIcon(){return this.mode===I.Unconscious?Q.Unconscious:this.mode===I.ChaseVisibleTarget?Q.Chasing:D(this.mode)?this.angry?Q.Angry:Q.Relaxed:Q.Alerted}movingWithPlayerPosition(e){switch(this.mode){case I.Patrol:const t=this.patrolPath[this.patrolPathIndex];if(t.equals(this.pos)){const o=(this.patrolPathIndex+1)%this.patrolPath.length,n=this.patrolPath[o];return!(n.equals(t)||n.equals(e))}return!0;case I.Look:case I.Listen:case I.ChaseVisibleTarget:case I.WakeGuard:case I.LightTorch:case I.Unconscious:return!1;case I.MoveToLastSighting:case I.MoveToLastSound:case I.MoveToGuardShout:return!this.pos.equals(this.goal);case I.MoveToDownedGuard:case I.MoveToTorch:return!this.cardinallyAdjacentTo(this.goal)}}moving(){switch(this.mode){case I.Patrol:const e=this.patrolPath[this.patrolPathIndex];if(e.equals(this.pos)){const t=(this.patrolPathIndex+1)%this.patrolPath.length;return!this.patrolPath[t].equals(e)}return!0;case I.Look:case I.Listen:case I.ChaseVisibleTarget:case I.WakeGuard:case I.LightTorch:case I.Unconscious:return!1;case I.MoveToLastSighting:case I.MoveToLastSound:case I.MoveToGuardShout:return!this.pos.equals(this.goal);case I.MoveToDownedGuard:case I.MoveToTorch:return!this.cardinallyAdjacentTo(this.goal)}}act(e,t,o,n){const r=this.mode,i=s.clone(this.pos);switch(this.mode!==I.Unconscious&&!D(this.mode)&&this.seesActor(e,o)&&(this.mode=I.ChaseVisibleTarget),this.mode){case I.Patrol:this.patrolStep(e,o);break;case I.Look:case I.Listen:this.modeTimeout-=1,0==this.modeTimeout&&this.enterPatrolMode(e);break;case I.ChaseVisibleTarget:if(s.copy(this.goal,o.pos),this.adjacentTo(o.pos)){if(V(this.dir,this.pos,this.goal),r==I.ChaseVisibleTarget){o.damagedLastTurn||t.add(x.Damage,this.pos);const e=s.create(),n=s.create();s.subtract(n,o.pos,this.pos),s.scale(n,n,.5),this.animation=new b([{pt0:e,pt1:n,duration:.1,fn:T.easeInQuad},{pt0:n,pt1:e,duration:.1,fn:T.easeOutQuad}],[]),o.applyDamage(1)}}else this.moveTowardPosition(this.goal,e,o);break;case I.MoveToLastSighting:case I.MoveToLastSound:case I.MoveToGuardShout:this.moveTowardPosition(this.goal,e,o)!==P.Moved&&(this.modeTimeout-=1),0==this.modeTimeout&&this.enterPatrolMode(e);break;case I.MoveToDownedGuard:this.cardinallyAdjacentTo(this.goal)?e.guards.find((e=>e.pos.equals(this.goal)&&e.mode===I.Unconscious))?(this.mode=I.WakeGuard,this.modeTimeout=3):(this.modeTimeout=0,this.enterPatrolMode(e)):this.moveTowardAdjacentToPosition(this.goal,e,o)!==P.Moved&&(this.modeTimeout-=1,0===this.modeTimeout&&this.enterPatrolMode(e));break;case I.WakeGuard:--this.modeTimeout,V(this.dir,this.pos,this.goal);const i=e.guards.find((e=>e.pos.equals(this.goal)&&e.mode===I.Unconscious));void 0!==i?this.modeTimeout<=0&&(i.modeTimeout=0,this.enterPatrolMode(e)):(this.modeTimeout=0,this.enterPatrolMode(e));break;case I.MoveToTorch:{const t=this.moveTowardAdjacentToPosition(this.goal,e,o);this.cardinallyAdjacentTo(this.goal)?(this.mode=I.LightTorch,this.modeTimeout=5):t===P.Moved?this.modeTimeout=3:(this.modeTimeout-=1,this.modeTimeout<=0&&this.enterPatrolMode(e))}break;case I.LightTorch:--this.modeTimeout,V(this.dir,this.pos,this.goal),this.modeTimeout<=0&&(!function(e,t,o){for(const o of e.items)o.type===Z.TorchUnlit&&o.pos.equals(t)&&(o.type=Z.TorchLit);e.computeLighting(e.cells.atVec(o.pos))}(e,this.goal,o),this.enterPatrolMode(e));break;case I.Unconscious:if(this.modeTimeout-=1,5===this.modeTimeout){const e=x.GuardStirring;t.add(e,this.pos)}else this.modeTimeout<=0&&(this.enterPatrolMode(e),this.modeTimeout=0,this.angry=!0,n.push({pos_shouter:this.pos,pos_target:this.pos,target:this}),t.add(x.GuardAwakesWarning,this.pos))}if(this.hasTorch&&!i.equals(this.pos)&&e.computeLighting(e.cells.at(o.pos[0],o.pos[1])),this.mode!==I.Unconscious){if(this.seesActor(e,o)?D(this.mode)&&!this.adjacentTo(o.pos)?(this.mode=I.Look,this.modeTimeout=2+v(4)):this.mode=I.ChaseVisibleTarget:this.mode===I.ChaseVisibleTarget&&(this.mode=I.MoveToLastSighting,this.modeTimeout=3),this.heardThief&&this.mode!==I.ChaseVisibleTarget&&(this.adjacentTo(o.pos)?this.mode=I.ChaseVisibleTarget:D(this.mode)&&!this.heardThiefClosest?(this.mode=I.Listen,this.modeTimeout=2+v(4)):this.mode!==I.MoveToDownedGuard&&(this.mode=I.MoveToLastSound,this.modeTimeout=2+v(4),s.copy(this.goal,o.pos))),this.heardGuard&&this.mode!==I.Look&&this.mode!==I.ChaseVisibleTarget&&this.mode!==I.MoveToLastSighting&&this.mode!==I.MoveToLastSound&&(this.mode=I.MoveToGuardShout,this.modeTimeout=2+v(4),s.copy(this.goal,this.heardGuardPos)),D(this.mode))for(let t of e.guards)if(t!==this&&t.mode===I.Unconscious&&this.seesActor(e,t)){s.copy(this.goal,t.pos),this.mode=I.MoveToDownedGuard,this.angry=!0,this.modeTimeout=3,n.push({pos_shouter:this.pos,pos_target:t.pos,target:t});break}if(this.mode===I.Patrol){const t=function(e,t){let o,n=65;for(const r of e.items)if(r.type===Z.TorchUnlit){const i=s.squaredDistance(r.pos,t);if(i>=n)continue;if(!B(e,t,r.pos))continue;n=i,o=r}return o}(e,this.pos);void 0!==t&&(s.copy(this.goal,t.pos),this.cardinallyAdjacentTo(this.goal)?(this.mode=I.LightTorch,this.modeTimeout=5):(this.mode=I.MoveToTorch,this.modeTimeout=3))}}this.heardThief=!1,this.heardThiefClosest=!1;const a=function(e,t){if(t==e)return;switch(t){case I.Patrol:switch(e){case I.Look:return x.GuardFinishLooking;case I.Listen:return x.GuardFinishListening;case I.MoveToLastSound:case I.MoveToGuardShout:return x.GuardFinishInvestigating;case I.MoveToLastSighting:return x.GuardEndChase;case I.Unconscious:return x.GuardAwakesWarning;default:return}case I.Look:return x.GuardSeeThief;case I.Listen:return x.GuardHearThief;case I.ChaseVisibleTarget:return e!=I.MoveToLastSighting?x.GuardChase:void 0;case I.MoveToLastSighting:return;case I.MoveToLastSound:return x.GuardInvestigate;case I.MoveToGuardShout:return x.GuardHearGuard;case I.MoveToDownedGuard:return x.GuardDownWarning}return}(r,this.mode);void 0!==a&&t.add(a,this.pos),this.mode===I.ChaseVisibleTarget&&r!==I.ChaseVisibleTarget&&n.push({pos_shouter:this.pos,pos_target:o.pos,target:o})}cardinallyAdjacentTo(e){const t=Math.abs(e[0]-this.pos[0]),o=Math.abs(e[1]-this.pos[1]);return 1==t&&0==o||0==t&&1==o}adjacentTo(e){const t=e[0]-this.pos[0],o=e[1]-this.pos[1];return Math.abs(t)<2&&Math.abs(o)<2}seesActor(e,t){const o=s.create();if(s.subtract(o,t.pos,this.pos),this.mode!==I.ChaseVisibleTarget&&s.dot(this.dir,o)<0)return!1;let n=e.cells.atVec(t.pos).lit>0;return!(s.squaredLen(o)>=this.sightCutoff(n))&&!((t.hidden(e)||!O(e,this.pos,t.pos))&&(D(this.mode)&&!this.angry||Math.abs(o[0])>=2||Math.abs(o[1])>=2))}hidden(){return!1}cutoffLit(){return D(this.mode)&&!this.angry?40:75}cutoffUnlit(){return D(this.mode)&&!this.angry?3:33}sightCutoff(e){return e?this.cutoffLit():this.cutoffUnlit()}enterPatrolMode(e){this.patrolPathIndex=e.patrolPathIndexForResume(this.patrolPath,this.patrolPathIndex,this.pos),this.mode=I.Patrol}patrolStep(e,t){this.patrolPath[this.patrolPathIndex].equals(this.pos)&&(this.patrolPathIndex=(this.patrolPathIndex+1)%this.patrolPath.length);const o=this.moveTowardPosition(this.patrolPath[this.patrolPathIndex],e,t);if(o===P.BumpedPlayer)this.mode=I.ChaseVisibleTarget,V(this.dir,this.pos,t.pos);else if(o===P.StoodStill){const t=this.tryGetPosLookAt(e);void 0!==t&&V(this.dir,this.pos,t)}}updateDirInitial(){const e=(this.patrolPathIndex+1)%this.patrolPath.length;V(this.dir,this.pos,this.patrolPath[e])}moveTowardPosition(e,t,o){const n=t.computeDistancesToPosition(e),r=t.posNextBest(n,this.pos);if(V(this.dir,this.pos,r),o.pos.equals(r))return P.BumpedPlayer;if(r.equals(this.pos))return P.StoodStill;const i=s.create();s.subtract(i,this.pos,r);const a=s.create();return this.animation=new b([{pt0:i,pt1:a,duration:.2,fn:T.linear}],[]),s.copy(this.pos,r),P.Moved}moveTowardAdjacentToPosition(e,t,o){const n=t.computeDistancesToAdjacentToPosition(e),r=t.posNextBest(n,this.pos);if(V(this.dir,this.pos,r),o.pos.equals(r))return P.BumpedPlayer;if(r.equals(this.pos))return P.StoodStill;const i=s.create();s.subtract(i,this.pos,r);const a=s.create();return this.animation=new b([{pt0:i,pt1:a,duration:.2,fn:T.linear}],[]),s.copy(this.pos,r),P.Moved}tryGetPosLookAt(e){const t=this.pos[0],o=this.pos[1];return t>0&&e.cells.at(t-1,o).type==j.OneWayWindowW?s.fromValues(t-1,o):t<e.cells.sizeX-1&&e.cells.at(t+1,o).type==j.OneWayWindowE?s.fromValues(t+1,o):o>0&&e.cells.at(t,o-1).type==j.OneWayWindowS?s.fromValues(t,o-1):o<e.cells.sizeY-1&&e.cells.at(t,o+1).type==j.OneWayWindowN?s.fromValues(t,o+1):void 0}}function D(e){return e===I.Patrol||e===I.MoveToTorch||e===I.LightTorch}function F(e,t){const o=t.items.find((e=>[Z.PortcullisEW,Z.PortcullisNS].includes(e.type)));return void 0!==o&&e.pos.equals(o.pos)}function G(e,t,o,n){for(const e of t.guards)e.heardGuard=e.hearingGuard,e.hearingGuard=!1,e.speaking=!1,e.hasMoved=!1;t.guards.sort(((e,t)=>{const o=e.moving(),r=t.moving();if(o&&!r)return 1;if(r&&!o)return-1;return Math.abs(e.pos[0]-n.pos[0])+Math.abs(e.pos[1]-n.pos[1])-(Math.abs(t.pos[0]-n.pos[0])+Math.abs(t.pos[1]-n.pos[1]))}));const r=[];let i=!1;for(const e of t.guards){const a=s.clone(e.pos);e.act(t,o,n,r),e.hasMoved=!0,i=i||F(e,t)&&!a.equals(e.pos)}for(const e of r)U(t,e);null===n.pickTarget||D(n.pickTarget.mode)&&n.pickTarget.cardinallyAdjacentTo(n.pos)||(n.pickTarget=null),i&&e.sounds.gate.play(.2)}function U(e,t){for(const o of e.guardsInEarshot(t.pos_shouter,25))o.pos[0]==t.pos_shouter[0]&&o.pos[1]==t.pos_shouter[1]||(o.hearingGuard=!0,t.target instanceof W&&(o.angry=!0),s.copy(o.heardGuardPos,t.pos_shouter))}function V(e,t,o){const n=s.create();s.subtract(n,o,t);const r=s.fromValues(-e[1],e[0]),i=s.dot(e,n),a=s.dot(r,n);i>=Math.abs(a)||(-i>Math.abs(a)?s.negate(e,e):a>=0?s.copy(e,r):s.negate(e,r))}function O(e,t,o){let n=t[0],r=t[1];const i=o[0]-n,s=o[1]-r;let a=Math.abs(i),l=Math.abs(s);const u=i>0?1:-1,c=s>0?1:-1;let d=l-a,p=a+l-1;for(a*=2,l*=2;p>0;){if(d>0)r+=c,d-=a;else{if(0===d&&e.cells.at(n,r+c).blocksSight)return!1;n+=u,d+=l}if(e.cells.at(n,r).blocksSight)return!1;--p}return!0}function z(e){return!!e.blocksSight||!!le(e.type)}function B(e,t,o){let n=t[0],r=t[1];const i=o[0]-n,s=o[1]-r;let a=Math.abs(i),l=Math.abs(s);const u=i>0?1:-1,c=s>0?1:-1;let d=l-a,p=a+l-1;for(a*=2,l*=2;p>0;){if(d>0)r+=c,d-=a;else{if(0===d&&z(e.cells.at(n,r+c)))return!1;n+=u,d+=l}const t=e.cells.at(n,r);if(t.blocksSight)return!1;if(le(t.type))return!1;--p}return!0}const N=[s.fromValues(-1,0),s.fromValues(1,0),s.fromValues(0,-1),s.fromValues(0,1)];class Y{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Uint8Array(e*t),this.fill(o)}fill(e){this.values.fill(e?1:0)}get(e,t){return 0!==this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o?1:0}}class X{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Int32Array(e*t),this.fill(o)}fill(e){this.values.fill(e)}get(e,t){return this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o}}class q{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Float64Array(e*t),this.fill(o)}fill(e){this.values.fill(e)}get(e,t){return this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o}}let j;var $;($=j||(j={}))[$.GroundNormal=0]="GroundNormal",$[$.GroundGrass=1]="GroundGrass",$[$.GroundWater=2]="GroundWater",$[$.GroundMarble=3]="GroundMarble",$[$.GroundWood=4]="GroundWood",$[$.GroundWoodCreaky=5]="GroundWoodCreaky",$[$.GroundVault=6]="GroundVault",$[$.Wall0000=7]="Wall0000",$[$.Wall0001=8]="Wall0001",$[$.Wall0010=9]="Wall0010",$[$.Wall0011=10]="Wall0011",$[$.Wall0100=11]="Wall0100",$[$.Wall0101=12]="Wall0101",$[$.Wall0110=13]="Wall0110",$[$.Wall0111=14]="Wall0111",$[$.Wall1000=15]="Wall1000",$[$.Wall1001=16]="Wall1001",$[$.Wall1010=17]="Wall1010",$[$.Wall1011=18]="Wall1011",$[$.Wall1100=19]="Wall1100",$[$.Wall1101=20]="Wall1101",$[$.Wall1110=21]="Wall1110",$[$.Wall1111=22]="Wall1111",$[$.OneWayWindowE=23]="OneWayWindowE",$[$.OneWayWindowW=24]="OneWayWindowW",$[$.OneWayWindowN=25]="OneWayWindowN",$[$.OneWayWindowS=26]="OneWayWindowS",$[$.PortcullisNS=27]="PortcullisNS",$[$.PortcullisEW=28]="PortcullisEW",$[$.DoorNS=29]="DoorNS",$[$.DoorEW=30]="DoorEW",$[$.GardenDoorNS=31]="GardenDoorNS",$[$.GardenDoorEW=32]="GardenDoorEW";class K{constructor(e,t){this.sizeX=e,this.sizeY=t;const o=e*t;this.values=new Array(o);for(let e=0;e<o;++e)this.values[e]=this.emptyCell()}at(e,t){if(e<0||e>=this.sizeX||t<0||t>=this.sizeY)return this.emptyCell();const o=this.sizeX*t+e;return this.values[o]}atVec(e){return this.at(e[0],e[1])}index(e,t){return this.sizeX*t+e}indexVec(e){return this.index(e[0],e[1])}emptyCell(){return{type:j.GroundGrass,moveCost:1/0,blocksPlayerMove:!1,blocksPlayerSight:!1,blocksSight:!1,blocksSound:!1,hidesPlayer:!1,lit:0,litAnim:0,litSrc:new Set,seen:!1,identified:!1}}}let Q;var J;let Z;var ee;function te(e){switch(e){case Z.Chair:return 4;case Z.Table:case Z.BedL:case Z.BedR:return 10;case Z.DrawersShort:case Z.DrawersTall:return 1/0;case Z.Bush:return 10;case Z.Coin:case Z.DoorNS:case Z.DoorEW:case Z.LockedDoorNS:case Z.LockedDoorEW:case Z.PortcullisNS:case Z.PortcullisEW:return 0;case Z.TorchUnlit:case Z.TorchLit:return 1/0;case Z.TorchCarry:case Z.PurseCarry:case Z.Key:case Z.KeyCarry:return 0}}(J=Q||(Q={}))[J.Relaxed=0]="Relaxed",J[J.Angry=1]="Angry",J[J.Alerted=2]="Alerted",J[J.Chasing=3]="Chasing",J[J.Unconscious=4]="Unconscious",(ee=Z||(Z={}))[ee.Chair=0]="Chair",ee[ee.Table=1]="Table",ee[ee.BedL=2]="BedL",ee[ee.BedR=3]="BedR",ee[ee.DrawersShort=4]="DrawersShort",ee[ee.DrawersTall=5]="DrawersTall",ee[ee.Bush=6]="Bush",ee[ee.Coin=7]="Coin",ee[ee.DoorNS=8]="DoorNS",ee[ee.DoorEW=9]="DoorEW",ee[ee.LockedDoorNS=10]="LockedDoorNS",ee[ee.LockedDoorEW=11]="LockedDoorEW",ee[ee.PortcullisNS=12]="PortcullisNS",ee[ee.PortcullisEW=13]="PortcullisEW",ee[ee.TorchUnlit=14]="TorchUnlit",ee[ee.TorchLit=15]="TorchLit",ee[ee.TorchCarry=16]="TorchCarry",ee[ee.PurseCarry=17]="PurseCarry",ee[ee.Key=18]="Key",ee[ee.KeyCarry=19]="KeyCarry";const oe=5;class ne{animation=null;pickTarget=null;constructor(e){this.pos=s.clone(e),this.dir=s.fromValues(0,-1),this.health=oe,this.loot=0,this.noisy=!1,this.hasVaultKey=!1,this.damagedLastTurn=!1,this.turnsRemainingUnderwater=0}applyDamage(e){this.health-=Math.min(e,this.health),this.damagedLastTurn=!0}hidden(e){if(void 0!==e.guards.find((e=>e.mode==I.ChaseVisibleTarget)))return!1;if(e.cells.atVec(this.pos).hidesPlayer)return!0;return e.cells.atVec(this.pos).type==j.GroundWater&&this.turnsRemainingUnderwater>0}}const re=[{lx:-1,ly:-1,rx:-1,ry:1,nx:-1,ny:0},{lx:-1,ly:1,rx:1,ry:1,nx:0,ny:1},{lx:1,ly:1,rx:1,ry:-1,nx:1,ny:0},{lx:1,ly:-1,rx:-1,ry:-1,nx:0,ny:-1}];function ie(e,t,o,n){return e*n>t*o}const se=[{dx:1,dy:0,cost:2},{dx:-1,dy:0,cost:2},{dx:0,dy:1,cost:2},{dx:0,dy:-1,cost:2},{dx:-1,dy:-1,cost:3},{dx:1,dy:-1,cost:3},{dx:-1,dy:1,cost:3},{dx:1,dy:1,cost:3}];class ae{constructor(e){this.cells=e,this.patrolRegions=[],this.patrolRoutes=[],this.items=[],this.guards=[],this.playerStartPos=s.create(),this.lightCount=0,this.adjacencies=[]}collectLootAt(e){let t=[];return this.items=this.items.filter((o=>o.type!=Z.Coin||!o.pos.equals(e)||(t.push(o),!1))),t}collectAllLoot(){let e=0;this.items=this.items.filter((t=>t.type!=Z.Coin||(++e,!1)));for(let t of this.guards)t.hasPurse&&(++e,t.hasPurse=!1);return e}identifyAdjacentCells(e){const t=Math.max(e[0]-1,0),o=Math.max(e[1]-1,0),n=Math.min(e[0]+2,this.cells.sizeX),r=Math.min(e[1]+2,this.cells.sizeY);for(let e=t;e<n;++e)for(let t=o;t<r;++t)this.cells.at(e,t).identified=!0}allSeen(){for(const e of this.cells.values)if(!e.seen)return!1;return!0}percentSeen(){let e=0;for(const t of this.cells.values)t.seen&&++e;return Math.floor(100*e/this.cells.values.length)}markAllSeen(){for(const e of this.cells.values)e.seen=!0,e.identified=!0}markAllUnseen(){for(const e of this.cells.values)e.seen=!1,e.identified=!1}recomputeVisibility(e){this.recomputeVisibilityFromPos(e);const t=s.create();for(const o of N)this.playerCanSeeInDirection(e,o)&&(s.add(t,e,o),this.recomputeVisibilityFromPos(t))}recomputeVisibilityFromPos(e){for(const t of re)this.computeVisibility(e[0],e[1],e[0],e[1],t.lx,t.ly,t.rx,t.ry)}playerCanSeeInDirection(e,t){const o=s.create();return s.add(o,e,t),o[0]<0||o[1]<0||o[0]>=this.cells.sizeX||o[1]>=this.cells.sizeY||!this.cells.at(o[0],o[1]).blocksPlayerSight}computeVisibility(e,t,o,n,r,i,s,a){if(o<0||n<0||o>=this.cells.sizeX||n>=this.cells.sizeY)return;const l=2*(o-e),u=2*(n-t);if(!(l*l+u*u>1600||(this.cells.at(o,n).seen=!0,this.cells.at(o,n).blocksPlayerSight))){for(let e=0;e<2;++e)for(let t=0;t<2;++t){let c=o+2*e-1,d=n+2*t-1,p=l+2*e-1,h=u+2*t-1;c>=0&&d>=0&&c<this.cells.sizeX&&d<this.cells.sizeY&&!ie(r,i,p,h)&&!ie(p,h,s,a)&&(this.cells.at(c,d).seen=!0)}for(const c of re){const d=l+c.lx,p=u+c.ly,h=l+c.rx,m=u+c.ry,[f,g]=ie(r,i,d,p)?[r,i]:[d,p],[y,v]=ie(s,a,h,m)?[h,m]:[s,a];ie(y,v,f,g)&&this.computeVisibility(e,t,o+c.nx,n+c.ny,f,g,y,v)}}}computeLighting(e=null){const t=new Set;null!==e&&t.add(e);for(let e of this.guards)t.add(this.cells.at(e.pos[0],e.pos[1]));for(const e of this.cells.values)e.lit=0,e.litSrc.clear();let o=0;for(const e of this.items)e.type==Z.TorchLit&&(this.castLight(e.pos,45,o,t),o++),e.type==Z.TorchUnlit&&o++;for(const e of this.guards)e.hasTorch&&(this.castLight(e.pos,15,o,t),o++);this.lightCount=o}castLight(e,t,o,n){this.cells.at(e[0],e[1]).lit=1;for(const r of re)this.castLightRecursive(e[0],e[1],e[0]+r.nx,e[1]+r.ny,r.lx,r.ly,r.rx,r.ry,t,o,n)}castLightRecursive(e,t,o,n,r,i,s,a,l,u,c){if(o<0||n<0||o>=this.cells.sizeX||n>=this.cells.sizeY)return;let d=o-e,p=n-t;if(d**2+p**2>l)return;d*=2,p*=2;const h=this.cells.at(o,n);if(!h.blocksSight||c.has(h)){if(!h.litSrc.has(u)){const r=(o-e)**2+(n-t)**2;h.lit+=1/(r+1),h.lit>1&&(h.lit=1),h.litSrc.add(u)}for(let l=0;l<2;++l)for(let c=0;c<2;++c){let h=o+2*l-1,m=n+2*c-1,f=d+2*l-1,g=p+2*c-1;if(h>=0&&m>=0&&h<this.cells.sizeX&&m<this.cells.sizeY&&!ie(r,i,f,g)&&!ie(f,g,s,a)){const o=this.cells.at(h,m);if(!o.blocksSight&&!o.litSrc.has(u)){const n=(h-e)**2+(m-t)**2;o.lit+=1/(n+1),o.lit>1&&(o.lit=1),o.litSrc.add(u)}}}for(const h of re){const m=d+h.lx,f=p+h.ly,g=d+h.rx,y=p+h.ry,[v,_]=ie(r,i,m,f)?[r,i]:[m,f],[x,w]=ie(s,a,g,y)?[g,y]:[s,a];ie(x,w,v,_)&&this.castLightRecursive(e,t,o+h.nx,n+h.ny,v,_,x,w,l,u,c)}}}allLootCollected(){return void 0===this.items.find((e=>e.type==Z.Coin))}isGuardAt(e,t){return null!=this.guards.find((o=>o.hasMoved&&o.pos.equalsValues(e,t)))}isGuardAtVec(e){return null!=this.guards.find((t=>t.hasMoved&&t.pos.equals(e)))}guardMoveCost(e,t){const o=this.cells.atVec(t).moveCost;return o===1/0||e[0]==t[0]||e[1]==t[1]||this.cells.at(e[0],t[1]).moveCost!==1/0&&this.cells.at(t[0],e[1]).moveCost!==1/0?o:1/0}posNextBest(e,t){let o=1/0,n=s.clone(t);const r=s.fromValues(Math.max(0,t[0]-1),Math.max(0,t[1]-1)),i=s.fromValues(Math.min(this.cells.sizeX,t[0]+2),Math.min(this.cells.sizeY,t[1]+2));for(let a=r[0];a<i[0];++a)for(let l=r[1];l<i[1];++l){const r=e.get(a,l);if(r==1/0)continue;let i=s.fromValues(a,l);this.guardMoveCost(t,i)!=1/0&&(this.isGuardAtVec(i)||r<o&&(o=r,n=i))}return n}patrolPathIndexForResume(e,t,o){const n=this.computeDistancesToPosition(o);let r=t;for(let t=0;t<e.length;++t){const t=e[r],o=this.posNextBest(n,t),i=e[(r+e.length-1)%e.length],a=s.create();s.subtract(a,t,o);const l=s.create();if(s.subtract(l,t,i),s.dot(a,l)>0)break;r=(r+1)%e.length}return r}computeDistancesToPosition(e){return console.assert(e[0]>=0),console.assert(e[1]>=0),console.assert(e[0]<this.cells.sizeX),console.assert(e[1]<this.cells.sizeY),this.computeDistanceField([{priority:0,pos:s.clone(e)}])}computeDistancesToAdjacentToPosition(e){const t=[];for(const o of N){const n=s.clone(e).add(o);if(n[0]<0||n[1]<0||n[0]>=this.cells.sizeX||n[1]>=this.cells.sizeY)continue;const r=this.cells.atVec(n);r.moveCost!==1/0&&t.push({priority:r.moveCost,pos:n})}return this.computeDistanceField(t)}computeDistanceField(e){let t=this.cells.sizeX,o=this.cells.sizeY;const n=[],r=new q(t,o,1/0);for(const t of e)de(n,t);for(;n.length>0;){const e=ce(n);if(!(e.priority>=r.get(e.pos[0],e.pos[1]))){r.set(e.pos[0],e.pos[1],e.priority);for(const i of se){const a=s.fromValues(e.pos[0]+i.dx,e.pos[1]+i.dy);if(a[0]<0||a[1]<0||a[0]>=t||a[1]>=o)continue;const l=this.guardMoveCost(e.pos,a);if(l==1/0)continue;const u=e.priority+l+i.cost;u<r.get(a[0],a[1])&&de(n,{priority:u,pos:a})}}}return r}guardsInEarshot(e,t){const o=this.coordsInEarshot(e,t);return this.guards.filter((e=>o.has(this.cells.sizeX*e.pos[1]+e.pos[0])))}coordsInEarshot(e,t){let o=this.cells.sizeX,n=this.cells.sizeY;const r=[],i=new q(o,n,1/0),a=new Set;for(de(r,{priority:0,pos:e});r.length>0;){const e=ce(r);if(!(e.priority>=i.get(e.pos[0],e.pos[1]))){i.set(e.pos[0],e.pos[1],e.priority),a.add(o*e.pos[1]+e.pos[0]);for(const a of se){const l=s.fromValues(e.pos[0]+a.dx,e.pos[1]+a.dy);if(l[0]<0||l[1]<0||l[0]>=o||l[1]>=n)continue;const u=e.priority+a.cost;u>t||(this.cells.at(l[0],l[1]).blocksSound||u>=i.get(l[0],l[1])||de(r,{priority:u,pos:l}))}}}return a}}function le(e){return e>=j.OneWayWindowE&&e<=j.OneWayWindowS}function ue(e){return e>=Z.DoorNS&&e<=Z.PortcullisEW}function ce(e){const t=e[0];e[0]=e[e.length-1],e.pop();let o=0;const n=e.length;for(;;){let t=o;const r=2*o+1;r<n&&e[r].priority<e[t].priority&&(t=r);const i=r+1;if(i<n&&e[i].priority<e[t].priority&&(t=i),t==o)break;[e[o],e[t]]=[e[t],e[o]],o=t}return t}function de(e,t){e.push(t);let o=e.length-1;for(;o>0;){const t=Math.floor((o-1)/2);if(e[o].priority>=e[t].priority)break;[e[o],e[t]]=[e[t],e[o]],o=t}}const pe=5,he=5,me=3,fe=[[3,3,2,2,6,6],[3,5,2,5,6,12],[3,5,2,6,9,15],[3,5,2,6,12,18],[3,7,3,6,15,21],[3,7,3,6,18,24],[3,7,3,6,21,30],[5,7,4,6,24,36],[5,9,4,6,30,42],[7,9,4,6,36,48]];let ge;var ye;function ve(e,t,o){const n=[];for(let t=0;t<e;++t){const e=new y("lvl"+t+o.random()),r=_e(t,e);n.push({numRoomsX:r[0],numRoomsY:r[1],totalLoot:0,rng:e,played:!1})}let r=0;for(const e of n){r+=e.numRoomsX*e.numRoomsY}let i=0;for(const e of n){const o=e.numRoomsX*e.numRoomsY,n=Math.floor(t*o/r);i+=n,e.totalLoot=n}return n[n.length-1].totalLoot+=t-i,n}function _e(e,t){let o,n,r,i,s,a;[o,n,r,i,s,a]=fe[e];const l=o+2*t.randomInRange(1+(n-o)/2);let u=r+t.randomInRange(1+i-r);return u=Math.min(Math.floor(a/l),u),u=Math.max(u,Math.ceil(s/l)),[l,u]}function xe(e,t){const o=t.rng;o.reset();const n=function(e,t,o){const n=new Y(e,t,!0),r=Math.floor((e+1)/2);for(let e=Math.floor(t*r/4);e>0;--e){const e=o.randomInRange(r),i=o.randomInRange(t);n.set(e,i,!1)}for(let o=0;o<t;++o)for(let t=r;t<e;++t)n.set(t,o,n.get(e-1-t,o));return n}(t.numRoomsX,t.numRoomsY,o),[r,i]=function(e,t,o,n){const r=o.sizeX,i=o.sizeY,s=new X(r+1,i,0),a=new X(r,i+1,0);for(let e=0;e<r+1;++e)for(let t=0;t<i;++t)s.set(e,t,n.randomInRange(3)-1);for(let e=0;e<r;++e)for(let t=0;t<i+1;++t)a.set(e,t,n.randomInRange(3)-1);for(let e=1;e<r;++e)for(let t=1;t<i;++t)0===n.randomInRange(2)?s.set(e,t,s.get(e,t-1)):a.set(e,t,a.get(e-1,t));if(e){if(0==(1&r)){const e=Math.floor(r/2);for(let t=0;t<i;++t)s.set(e,t,0)}for(let e=0;e<Math.floor((r+1)/2);++e)for(let t=0;t<i;++t)s.set(r-e,t,1-s.get(e,t));for(let e=0;e<Math.floor(r/2);++e)for(let t=0;t<i+1;++t)a.set(r-1-e,t,a.get(e,t))}if(t){if(0==(1&i)){const e=i/2;for(let t=0;t<r;++t)a.set(t,e,0)}for(let e=0;e<Math.floor((i+1)/2);++e)for(let t=0;t<r;++t)a.set(t,i-e,1-a.get(t,e));for(let e=0;e<Math.floor(i/2);++e)for(let t=0;t<r+1;++t)s.set(t,i-1-e,s.get(t,e))}for(let e=0;e<r+1;++e)for(let t=0;t<i;++t)s.set(e,t,s.get(e,t)+e*pe);for(let e=0;e<r;++e)for(let t=0;t<i+1;++t)a.set(e,t,a.get(e,t)+t*he);let l=Number.MIN_SAFE_INTEGER;for(let e=0;e<i;++e)l=Math.max(l,-s.get(0,e));l+=me;for(let e=0;e<r+1;++e)for(let t=0;t<i;++t)s.set(e,t,s.get(e,t)+l);let u=Number.MIN_SAFE_INTEGER;for(let e=0;e<r;++e)u=Math.max(u,-a.get(e,0));u+=me;for(let e=0;e<r;++e)for(let t=0;t<i+1;++t)a.set(e,t,a.get(e,t)+u);return[s,a]}(true,false,n,o),[a,l]=function(e,t,o){const n=e.sizeX,r=e.sizeY,i=new X(n,r,0),a=[];a.push({roomType:ge.Exterior,group:0,depth:0,posMin:s.fromValues(0,0),posMax:s.fromValues(0,0),edges:[]});for(let l=0;l<n;++l)for(let n=0;n<r;++n){let r=a.length;i.set(l,n,r),a.push({roomType:e.get(l,n)?ge.PublicRoom:ge.PublicCourtyard,group:r,depth:n+1,posMin:s.fromValues(t.get(l,n)+1,o.get(l,n)+1),posMax:s.fromValues(t.get(l+1,n),o.get(l,n+1)),edges:[]})}return[a,i]}(n,r,i),u=function(e,t,o,n,r,i){let a=i.sizeX,l=i.sizeY;const u=[];{const d=[];{const p=[];let h=0;for(let m=0;m<a;++m){let f=o.get(m,h),g=o.get(m+1,h),y=n.get(m,h);const v={origin:s.fromValues(f,y),dir:s.fromValues(1,0),length:g-f,roomLeft:r[i.get(m,h)],roomRight:r[0],nextMatching:null,door:!1};p.push(v),u.push(v)}d.push(p)}for(let _=1;_<l;++_){const x=[];function c(e,t,o,n,i){if(o-t<=0)return;const a={origin:s.fromValues(t,e),dir:s.fromValues(1,0),length:o-t,roomLeft:r[n],roomRight:r[i],nextMatching:null,door:!1};x.push(a),u.push(a)}let w=0,S=0;for(;w<o.sizeX&&S<o.sizeX;){const T=w<o.sizeX?o.get(w,_):1/0,M=S<o.sizeX?o.get(S,_-1):1/0,L=n.get(Math.max(0,Math.max(w,S)-1),_);if(T<M){c(L,T,Math.min(M,w+1<o.sizeX?o.get(w+1,_):1/0),w>=i.sizeX?0:i.get(w,_),S<=0?0:i.get(S-1,_-1)),++w}else{c(L,M,Math.min(T,S+1<o.sizeX?o.get(S+1,_-1):1/0),w<=0?0:i.get(w-1,_),S>=i.sizeX?0:i.get(S,_-1)),++S}}d.push(x)}{const A=[];let b=l;for(let R=0;R<a;++R){let k=o.get(R,b-1),H=o.get(R+1,b-1),P=n.get(R,b);const C={origin:s.fromValues(k,P),dir:s.fromValues(1,0),length:H-k,roomLeft:r[0],roomRight:r[i.get(R,b-1)],nextMatching:null,door:!1};A.push(C),u.push(C)}d.push(A)}if(e)for(let I=0;I<d.length;++I){let E=d[I],W=0,D=E.length-1;for(;W<=D;){let F=E[W],G=E[D];F.nextMatching=G,G.nextMatching=F,W!==D&&(s.scaleAndAdd(G.origin,G.origin,G.dir,G.length),s.negate(G.dir,G.dir),[G.roomLeft,G.roomRight]=[G.roomRight,G.roomLeft]),W+=1,D-=1}}if(t){let U=0,V=d.length-1;for(;U<V;){let O=d[U],z=d[V];console.assert(O.length==z.length);for(let B=0;B<O.length;++B){let N=O[B],Y=z[B];N.nextMatching=Y,Y.nextMatching=N}U+=1,V-=1}}}{let X=[];{const q=[];let j=0;for(let $=0;$<l;++$){let K=n.get(j,$),Q=n.get(j,$+1),J=o.get(j,$);const Z={origin:s.fromValues(J,K),dir:s.fromValues(0,1),length:Q-K,roomLeft:r[0],roomRight:r[i.get(j,$)],nextMatching:null,door:!1};q.push(Z),u.push(Z)}X.push(q)}for(let ee=1;ee<a;++ee){const te=[];function c(e,t,o,n,i){if(o-t<=0)return;const a={origin:s.fromValues(e,t),dir:s.fromValues(0,1),length:o-t,roomLeft:r[n],roomRight:r[i],nextMatching:null,door:!1};te.push(a),u.push(a)}let oe=0,ne=0;for(;oe<n.sizeY&&ne<n.sizeY;){const re=oe<n.sizeY?n.get(ee-1,oe):1/0,ie=ne<n.sizeY?n.get(ee,ne):1/0,se=o.get(ee,Math.max(0,Math.max(oe,ne)-1));if(re<ie){c(se,re,Math.min(ie,oe+1<n.sizeY?n.get(ee-1,oe+1):1/0),oe>=i.sizeY?0:i.get(ee-1,oe),ne<=0?0:i.get(ee,ne-1)),++oe}else{c(se,ie,Math.min(re,ne+1<n.sizeY?n.get(ee,ne+1):1/0),oe<=0?0:i.get(ee-1,oe-1),ne>=i.sizeY?0:i.get(ee,ne)),++ne}}X.push(te)}{const ae=[];let le=a;for(let ue=0;ue<l;++ue){let ce=n.get(le-1,ue),de=n.get(le-1,ue+1),pe=o.get(le,ue);const he={origin:s.fromValues(pe,ce),dir:s.fromValues(0,1),length:de-ce,roomLeft:r[i.get(le-1,ue)],roomRight:r[0],nextMatching:null,door:!1};ae.push(he),u.push(he)}X.push(ae)}if(t)for(let me=0;me<X.length;++me){let fe=X[me],ge=Math.floor(fe.length/2);for(let ye=0;ye<ge;++ye){let ve=fe[ye],_e=fe[fe.length-1-ye];ve.nextMatching=_e,_e.nextMatching=ve,s.scaleAndAdd(_e.origin,_e.origin,_e.dir,_e.length),s.negate(_e.dir,_e.dir),[_e.roomLeft,_e.roomRight]=[_e.roomRight,_e.roomLeft]}}if(e){let xe=0,we=X.length-1;for(;xe<we;){let Se=X[xe],Te=X[we];for(let Me=0;Me<Se.length;++Me){let Le=Se[Me],Ae=Te[Me];Le.nextMatching=Ae,Ae.nextMatching=Le}xe+=1,we-=1}}}return u}(true,false,r,i,a,l);!function(e){for(const t of e)t.roomLeft.edges.push(t),t.roomRight.edges.push(t)}(u);const c=function(e,t,o){const n=function(e,t){const o=[],n=new Set;for(const t of e){if(t.length<2)continue;if(n.has(t))continue;const e=t.nextMatching,r=new Set;r.add(t),n.add(t),null!==e&&(r.add(e),n.add(e)),o.push(r)}return t.shuffleArray(o),o}(t,o);for(const o of t){const t=o.roomLeft,n=o.roomRight;if(t.roomType!=ge.PublicCourtyard||n.roomType!=ge.PublicCourtyard)continue;if(o.length<2)continue;o.door=!0;we(e,t.group,n.group)}for(const t of n){let n=!1;for(const e of t){if(e.roomLeft.roomType!==ge.PublicRoom)break;if(e.roomRight.roomType!==ge.PublicRoom)break;(e.roomLeft.group!==e.roomRight.group||o.random()<.4)&&(n=!0);break}if(n)for(const o of t){const t=o.roomLeft,n=o.roomRight,r=t.group,i=n.group;o.door=!0,we(e,r,i)}}for(const t of n){let n=!1;for(const e of t){if(e.roomLeft.roomType===e.roomRight.roomType)break;if(e.roomLeft.roomType===ge.Exterior)break;if(e.roomRight.roomType===ge.Exterior)break;(e.roomLeft.group!==e.roomRight.group||o.random()<.4)&&(n=!0);break}if(n)for(const o of t){const t=o.roomLeft,n=o.roomRight,r=t.group,i=n.group;o.door=!0,we(e,r,i)}}let r=s.fromValues(0,0);const i=function(e){let t=null;for(const o of e)for(const e of o)0!=e.dir[0]&&(e.roomLeft.roomType===ge.Exterior&&e.roomRight.roomType!==ge.Exterior&&e.dir[0]<0&&(null===t||e.origin[1]<t.origin[1]||e.origin[1]===t.origin[1]&&e.origin[0]>t.origin[0])||e.roomLeft.roomType!==ge.Exterior&&e.roomRight.roomType===ge.Exterior&&e.dir[0]>0&&(null===t||e.origin[1]<t.origin[1]||e.origin[1]===t.origin[1]&&e.origin[0]>t.origin[0]))&&(t=e);return t}(n);if(null!==i){r[0]=i.origin[0]+i.dir[0]*Math.floor(i.length/2),r[1]=i.origin[1]-1,i.door=!0;let e=i.nextMatching;null!==e&&e!==i&&(i.nextMatching=null,e.nextMatching=null)}return r}(a,u,o);!function(e,t,o){let n=e.length;const r=[];for(const t of e)t.roomType!=ge.Exterior&&(1===t.depth?r.push(t):t.depth>1&&(t.depth=n));for(let e=0;e<r.length;++e){const t=r[e],o=t.depth+1;for(const e of t.edges){if(!e.door)continue;const n=e.roomLeft==t?e.roomRight:e.roomLeft;n.depth>o&&(n.depth=o,r.push(n))}}let i=0;for(const t of e)i=Math.max(i,t.depth);const s=Math.floor((e.length-1)/4);let a=0,l=i;for(;l>0;){for(const t of e)t.roomType!=ge.PublicRoom&&t.roomType!=ge.PublicCourtyard||t.depth==l&&(t.roomType=t.roomType==ge.PublicRoom?ge.PrivateRoom:ge.PrivateCourtyard,t.roomType==ge.PrivateRoom&&(a+=1));if(a>=s)break;l-=1}for(;;){let t=!1;for(const o of e)if(o.roomType==ge.PublicCourtyard)for(const e of o.edges){if((e.roomLeft!=o?e.roomLeft:e.roomRight).roomType==ge.PrivateCourtyard){o.roomType=ge.PrivateCourtyard,t=!0;break}}if(!t)break}if(t>4){const t=[];for(const o of e){if(o.roomType===ge.Exterior)continue;if(o.roomType===ge.PrivateCourtyard||o.roomType===ge.PublicCourtyard)continue;let e=0;for(const t of o.edges)t.door&&++e;e<=1&&t.push(o)}t.length>0&&(t[o.randomInRange(t.length)].roomType=ge.Vault)}for(const t of e){if(t.roomType!==ge.PrivateRoom)continue;const e=t.posMax[0]-t.posMin[0];if(e<3)continue;const o=t.posMax[1]-t.posMin[1];if(o<3)continue;if(e*o>25)continue;let n=0;for(const e of t.edges)e.door&&++n;n<=2&&(t.roomType=ge.Bedroom)}}(a,e,o),function(e,t,o){o.shuffleArray(t);for(let n=2*Math.floor(e.length/12);n>0;--n){const n=Se(t,o);if(void 0===n)return;Te(e,t,n)}}(a,u,o);const d=function(e){let t=0,o=0;for(const n of e)t=Math.max(t,n.posMax[0]),o=Math.max(o,n.posMax[1]);t+=me+1,o+=me+1;const n=new K(t,o);return new ae(n)}(a);!function(e,t,o){for(const o of e){const e=o.roomLeft.roomType,n=o.roomRight.roomType;if(!it(e)||!it(n))for(let e=0;e<o.length+1;++e){const n=s.create();s.scaleAndAdd(n,o.origin,o.dir,e),t.cells.atVec(n).type=j.Wall0000}}const n=new Set;for(const r of e){if(n.has(r))continue;n.add(r);const e=r.nextMatching;null!==e&&e!==r&&n.add(e);let i=[];i.push(r),null!==e&&e!==r&&i.push(e);const a=r.roomLeft.roomType,l=r.roomRight.roomType;if(!r.door&&a!==l)if(a==ge.Exterior||l==ge.Exterior){let e=2;const o=1+Math.floor(r.length/2);for(;e<o;){for(const o of i){if(o.roomLeft.roomType===ge.Vault||o.roomRight.roomType===ge.Vault)continue;const n=s.clone(o.dir);o.roomRight.roomType==ge.Exterior&&s.negate(n,n);const r=Ve(n),i=s.clone(o.origin).scaleAndAdd(o.dir,e),a=s.clone(o.origin).scaleAndAdd(o.dir,o.length-e);t.cells.atVec(i).type=r,t.cells.atVec(a).type=r}e+=2}}else if(it(a)||it(l)){let e=2;const o=1+Math.floor(r.length/2);for(;e<o;){for(const o of i){if(o.roomLeft.roomType===ge.Vault||o.roomRight.roomType===ge.Vault)continue;const n=s.clone(o.dir);it(o.roomRight.roomType)&&s.negate(n,n);const r=Ve(n),i=s.clone(o.origin).scaleAndAdd(o.dir,e),a=s.clone(o.origin).scaleAndAdd(o.dir,o.length-e);t.cells.atVec(i).type=r,t.cells.atVec(a).type=r}e+=2}}let u=o.random()<.3333,c=Math.floor(r.length/2);for(const e of i){if(!e.door)continue;const o=s.clone(e.origin).scaleAndAdd(e.dir,c);let n=0==e.dir[0],r=e.roomLeft.roomType,i=e.roomRight.roomType;r==ge.Exterior||i==ge.Exterior?(t.cells.atVec(o).type=n?j.PortcullisNS:j.PortcullisEW,et(t,o,n?Z.PortcullisNS:Z.PortcullisEW)):r===ge.Vault||i===ge.Vault?(t.cells.atVec(o).type=n?j.DoorNS:j.DoorEW,et(t,o,n?Z.LockedDoorNS:Z.LockedDoorEW)):it(r)&&it(i)?t.cells.atVec(o).type=n?j.GardenDoorNS:j.GardenDoorEW:r!=ge.PrivateRoom||i!=ge.PrivateRoom||u?(t.cells.atVec(o).type=n?j.DoorNS:j.DoorEW,et(t,o,n?Z.DoorNS:Z.DoorEW)):t.cells.atVec(o).type=n?j.DoorNS:j.DoorEW}}}(u,d,o),function(e,t,o,n){for(let r=1;r<t.length;++r){const i=t[r];let s;switch(i.roomType){case ge.Exterior:s=j.GroundNormal;break;case ge.PublicCourtyard:s=j.GroundGrass;break;case ge.PublicRoom:s=j.GroundWood;break;case ge.PrivateCourtyard:s=j.GroundGrass;break;case ge.PrivateRoom:s=j.GroundMarble;break;case ge.Vault:s=j.GroundVault;break;case ge.Bedroom:s=j.GroundMarble}ot(o,i.posMin[0],i.posMin[1],i.posMax[0],i.posMax[1],s),it(i.roomType)?Oe(o,i,e,n):i.roomType===ge.PublicRoom||i.roomType===ge.PrivateRoom?ze(o,i,e,n):i.roomType===ge.Vault?Be(o,i):i.roomType===ge.Bedroom&&Ne(o,i,n),s==j.GroundWood&&e>3&&Xe(o,i,n)}}(e,a,d,o),s.copy(d.playerStartPos,c);const p=function(e,t){const o=[],n=s.clone(t),r=s.fromValues(1,0);for(;;){o.push(s.clone(n));const i=s.fromValues(-r[1],r[0]),a=s.fromValues(r[1],-r[0]);if(e.cells.at(n[0]+r[0],n[1]+r[1]).type>=j.Wall0000)if(e.cells.at(n[0]+i[0],n[1]+i[1]).type<j.Wall0000)s.copy(r,i);else{if(!(e.cells.at(n[0]+a[0],n[1]+a[1]).type<j.Wall0000))break;s.copy(r,a)}else if(!nt(e,n))if(nt(e,s.fromValues(n[0]+i[0],n[1]+i[1])))s.copy(r,i);else{if(!nt(e,s.fromValues(n[0]+a[0],n[1]+a[1])))break;s.copy(r,a)}if(n.set(n[0]+r[0],n[1]+r[1]),n.equals(t))break;if(n[0]<0||n[1]<0||n[0]>=e.cells.sizeX||n[1]>=e.cells.sizeY)break}return o}(d,d.playerStartPos);!function(e,t,o){const n=e.cells.sizeX,r=e.cells.sizeY;for(const o of t)e.cells.atVec(o).type=j.GroundNormal;ot(e,0,0,n,me,j.GroundNormal);for(let t=0;t<n;++t)0==(1&t)&&o.random()<.8&&et(e,s.fromValues(t,r-1),Z.Bush);for(let t=me;t<r-me+1;++t)0!=(r-t&1)&&(o.random()<.8&&et(e,s.fromValues(0,t),Z.Bush),o.random()<.8&&et(e,s.fromValues(n-1,t),Z.Bush))}(d,p,o),function(e){let t=e.cells.sizeX-1,o=Math.floor(e.cells.sizeX/2);for(let n=me;n<o;n+=5)e.cells.at(n,1).type=j.Wall0000,e.cells.at(t-n,1).type=j.Wall0000}(d),function(e){for(let t=0;t<e.sizeX;++t)for(let o=0;o<e.sizeY;++o){e.at(t,o).type==j.Wall0000&&(e.at(t,o).type=at(ut(e,t,o)))}}(d.cells),function(e){let t=e.cells.sizeX,o=e.cells.sizeY;for(let n=0;n<t;++n)for(let t=0;t<o;++t){const o=e.cells.at(n,t),r=o.type,i=r>=j.Wall0000&&r<=j.Wall1111,s=le(r),a=r==j.GroundWater;o.moveCost=i||s||a?1/0:0,o.blocksPlayerMove=i,o.blocksPlayerSight=i,o.blocksSight=i,o.blocksSound=i,o.hidesPlayer=!1}for(const t of e.items){let o=e.cells.atVec(t.pos),n=t.type;o.moveCost=Math.max(o.moveCost,te(n)),n!==Z.DoorNS&&n!==Z.DoorEW&&n!==Z.LockedDoorNS&&n!==Z.LockedDoorEW||(o.blocksPlayerSight=!0),n!==Z.DoorNS&&n!==Z.DoorEW&&n!==Z.LockedDoorNS&&n!==Z.LockedDoorEW&&n!==Z.PortcullisNS&&n!==Z.PortcullisEW&&n!==Z.Bush&&n!==Z.DrawersTall||(o.blocksSight=!0),n!==Z.Table&&n!==Z.Bush||(o.hidesPlayer=!0),n===Z.DrawersTall&&(o.blocksPlayerMove=!0)}}(d);const h=function(e,t,o,n,r,i){const a=n.filter((e=>e.door&&e.roomLeft.roomType!==ge.Exterior&&e.roomRight.roomType!==ge.Exterior&&e.roomLeft.roomType!==ge.Vault&&e.roomRight.roomType!==ge.Vault));i.shuffleArray(a);const l=[],u=new Map;for(const e of o){const t={room:e,nodeNext:null,nodePrev:null,visited:!1};l.push(t),u.set(e,t)}for(const e of a){let t=u.get(e.roomLeft),o=u.get(e.roomRight);void 0!==t&&void 0!==o&&(null==t.nodeNext&&null==o.nodePrev?(t.nodeNext=o,o.nodePrev=t):null==o.nodeNext&&null==t.nodePrev?(o.nodeNext=t,t.nodePrev=o):null==t.nodeNext&&null==o.nodeNext?(be(o),t.nodeNext=o,o.nodePrev=t):null==t.nodePrev&&null==o.nodePrev&&(Re(t),t.nodeNext=o,o.nodePrev=t))}for(const t of l){if(t.visited)continue;if(Ce(t),He(t))continue;Ie(t,Math.max(3,10-e))}!function(e){const t=[...e];for(const e of t)e.visited=!1;for(const o of t){if(o.visited)continue;if(Ce(o),He(o))continue;const t=ke(o);let n=t.nodeNext,r=t;for(;null!==n&&null!==n.nodeNext;){const t={room:n.room,nodeNext:r,nodePrev:null,visited:!0};e.push(t),r.nodePrev=t,n=n.nodeNext,r=t}null!==n&&(r.nodePrev=n,n.nodeNext=r)}}(l);for(const e of a){const t=u.get(e.roomLeft),o=u.get(e.roomRight);if(void 0!==t&&void 0!==o)if(null==t.nodeNext&&null==t.nodePrev&&null!=o.nodeNext&&null!=o.nodePrev){const e=o.nodeNext,n={room:o.room,nodeNext:e,nodePrev:t,visited:!1};l.push(n),o.nodeNext=t,t.nodePrev=o,t.nodeNext=n,e.nodePrev=n}else if(null!=t.nodeNext&&null!=t.nodePrev&&null==o.nodeNext&&null==o.nodePrev){const e=t.nodeNext,n={room:t.room,nodeNext:e,nodePrev:o,visited:!1};l.push(n),t.nodeNext=o,o.nodeNext=n,o.nodePrev=t,e.nodePrev=n}}for(const e of l)e.visited=!1;const c=[];for(const e of l){if(e.visited)continue;if(null==e.nodeNext&&null==e.nodePrev){e.visited=!0;continue}const o=[];for(let n=ke(e);null!=n&&!n.visited;n=n.nodeNext){n.visited=!0;const e=n.nodeNext,r=n.nodePrev;if(null==e)continue;if(null==r)continue;const a=n.room,l=e.room,u=r.room,c=s.create();if(Ee(c,a,u,t),l===u){const e=De(t,a),n=s.create();e.length>0?s.copy(n,e[i.randomInRange(e.length)]):We(n,a,u,t);for(const e of Fe(t,c,n))o.push(e);o.push(s.clone(n)),o.push(s.clone(n)),o.push(s.clone(n)),s.copy(c,n)}const d=s.create();Ee(d,a,l,t);const p=Fe(t,c,d);for(const e of p)o.push(e)}c.push(Ae(o,i.randomInRange(o.length)))}if(i.shuffleArray(c),e>5){const e=r.length;c.push(Ae(r,Math.floor(.25*e))),c.push(Ae(r,Math.floor(.75*e)))}return c}(e,d,a,u,p,o),m=void 0!==d.items.find((e=>e.type===Z.LockedDoorNS||e.type===Z.LockedDoorEW)),f=h.length-(m?1:0),g=Math.min(Math.floor(e/3),Math.min(f,t.totalLoot));return function(e,t,o,n){let r=0;for(const i of t)if(i.roomType===ge.Vault)for(let t=n.randomInRange(3)+n.randomInRange(3);t>0&&!(r>=e);--t)tt(i.posMin,i.posMax,o,n)&&++r;for(const i of t){if(r>=e)break;if(i.roomType===ge.Exterior||i.roomType===ge.Vault)continue;if((i.roomType===ge.PublicCourtyard||i.roomType===ge.PrivateCourtyard)&&n.random()<.75)continue;let t=0;for(const e of i.edges)e.door&&(t+=1);t<2&&tt(i.posMin,i.posMax,o,n)&&++r}for(const i of t){if(r>=e)break;st(i.roomType)&&(n.random()<.5||tt(i.posMin,i.posMax,o,n)&&++r)}const i=t.filter((e=>e.roomType!==ge.Exterior&&!it(e.roomType)));n.shuffleArray(i);for(let t=0;t<1e3&&r<e;++t){const e=i[t%i.length];tt(e.posMin,e.posMax,o,n)&&++r}console.assert(r===e)}(t.totalLoot-g,a,d,o),function(e,t,o,n,r,i){if(e<=0)return;for(const s of o){const o=new W(s,0);e>1&&i.randomInRange(5+e)<e&&(o.hasTorch=!0),r?(r=!1,o.hasVaultKey=!0):n>0&&(o.hasPurse=!0,n--),t.guards.push(o)}console.assert(0===n)}(e,d,h,g,m,o),function(e){const t=new Y(e.cells.sizeX,e.cells.sizeY,!1),o=[e.playerStartPos];for(let n=0;n<o.length;++n){const r=o[n];if(!t.get(r[0],r[1])&&(t.set(r[0],r[1],!0),e.cells.atVec(r).seen=!0,!(e.cells.atVec(r).type>=j.Wall0000)))for(let n=-1;n<=1;++n)for(let i=-1;i<=1;++i){const a=s.fromValues(r[0]+n,r[1]+i);a[0]>=0&&a[1]>=0&&a[0]<e.cells.sizeX&&a[1]<e.cells.sizeY&&!t.get(a[0],a[1])&&o.push(a)}}}(d),d.computeLighting(),d.recomputeVisibility(d.playerStartPos),d.adjacencies=u,d}function we(e,t,o){if(t!=o)for(const n of e)n.group==t&&(n.group=o)}function Se(e,t){const o=[];for(const t of e){const e=t.roomLeft,n=t.roomRight;if(!t.door)continue;if(e.roomType===ge.Bedroom)continue;if(e.roomType!==n.roomType)continue;if(0===t.dir[1]){if(t.length!==e.posMax[0]-e.posMin[0]+1)continue;if(t.length!==n.posMax[0]-n.posMin[0]+1)continue}else{if(t.length!==e.posMax[1]-e.posMin[1]+1)continue;if(t.length!==n.posMax[1]-n.posMin[1]+1)continue}const r=Math.min(e.posMin[0],n.posMin[0]),i=Math.min(e.posMin[1],n.posMin[1]),s=(Math.max(e.posMax[0],n.posMax[0])-r)*(Math.max(e.posMax[1],n.posMax[1])-i);s>pe*he*3||o.push([t,s])}if(!(o.length<=0))return t.shuffleArray(o),o.sort(((e,t)=>e[1]-t[1])),o[0][0]}function Te(e,t,o){const n=o.roomLeft,r=o.roomRight;for(const e of r.edges)e!==o&&(n.edges.push(e),e.roomLeft===r?e.roomLeft=n:(console.assert(e.roomRight===r),e.roomRight=n));const i=s.fromValues(Math.min(n.posMin[0],r.posMin[0]),Math.min(n.posMin[1],r.posMin[1])),a=s.fromValues(Math.max(n.posMax[0],r.posMax[0]),Math.max(n.posMax[1],r.posMax[1]));s.copy(n.posMin,i),s.copy(n.posMax,a);const l=o.nextMatching;for(null!==l&&(l.nextMatching=null),Le(t,o),Le(n.edges,o),Le(e,r);Me(t,n););}function Me(e,t){for(const o of t.edges)for(const n of t.edges){if(o===n)continue;let r;if(o.roomLeft===t){if(!(n.roomLeft===t&&o.roomRight===n.roomRight&&o.dir[0]===n.dir[0]&&o.dir[1]===n.dir[1]||n.roomRight===t&&o.roomRight===n.roomLeft&&o.dir[0]===-n.dir[0]&&o.dir[1]===-n.dir[1]))continue;r=o.roomRight}else{if(!(n.roomRight===t&&o.roomLeft===n.roomLeft&&o.dir[0]===n.dir[0]&&n.dir[1]==n.dir[1]||n.roomLeft===t&&o.roomLeft===n.roomRight&&o.dir[0]===-n.dir[0]&&n.dir[1]===-n.dir[1]))continue;r=o.roomLeft}const i=o.dir[0]>=0?Math.min(o.origin[0],n.origin[0]):Math.max(o.origin[0],n.origin[0]),s=o.dir[1]>=0?Math.min(o.origin[1],n.origin[1]):Math.max(o.origin[1],n.origin[1]),a=o.length+n.length;return o.origin[0]=i,o.origin[1]=s,o.length=a,null!==o.nextMatching&&(o.nextMatching.nextMatching=null),null!==n.nextMatching&&(n.nextMatching.nextMatching=null),o.nextMatching=null,o.door=o.door||n.door,Le(t.edges,n),Le(r.edges,n),Le(e,n),!0}return!1}function Le(e,t){const o=e.indexOf(t);e.splice(o,1)}function Ae(e,t){const o=[];for(let n=t;n<e.length;++n)o.push(e[n]);for(let n=0;n<t;++n)o.push(e[n]);return o}function be(e){let t=null;for(;null!=e;){const o=e.nodePrev;e.nodeNext=o,e.nodePrev=t,t=e,e=o}}function Re(e){let t=null;for(;null!=e;){const o=e.nodeNext;e.nodePrev=o,e.nodeNext=t,t=e,e=o}}function ke(e){let t=e;for(;null!=t.nodePrev&&(t=t.nodePrev,t!=e););return t}function He(e){for(let t=e.nodeNext;null!=t;t=t.nodeNext)if(t==e)return!0;return!1}function Pe(e){let t=0,o=ke(e);for(let e=o;null!=e&&(++t,e.nodeNext!=o);e=e.nodeNext);return t}function Ce(e){let t=ke(e);for(let e=t;null!=e&&(e.visited=!0,e.nodeNext!=t);e=e.nodeNext);}function Ie(e,t){const o=ke(e);let n=o,r=0;for(;;){const e=n.nodeNext;if(null==e)break;if(Pe(n)<2*t)break;if(++r,r>=t&&(r=0,n.nodeNext=null,e.nodePrev=null),n=e,n==o)break}}function Ee(e,t,o,n){for(const r of t.edges)if(r.roomLeft===t&&r.roomRight===o||r.roomLeft===o&&r.roomRight===t){const t=s.create();for(let o=1;o<r.length;++o){s.scaleAndAdd(t,r.origin,r.dir,o);const i=n.cells.atVec(t).type;if(i>=j.PortcullisNS&&i<=j.GardenDoorEW)return void s.copy(e,t)}}s.zero(e)}function We(e,t,o,n){for(const r of t.edges){if(r.roomLeft===t&&r.roomRight===o){const i=s.create();Ee(i,t,o,n);const a=s.fromValues(-r.dir[1],r.dir[0]);return s.scaleAndAdd(e,i,a,2),void(0!=n.cells.at(e[0],e[1]).moveCost&&s.scaleAndAdd(e,i,a,1))}if(r.roomLeft===o&&r.roomRight===t){const i=s.create();Ee(i,t,o,n);const a=s.fromValues(r.dir[1],-r.dir[0]);return s.scaleAndAdd(e,i,a,2),void(0!=n.cells.at(e[0],e[1]).moveCost&&s.scaleAndAdd(e,i,a,1))}}s.zero(e)}function De(e,t){const o=[];for(let n=t.posMin[0];n<t.posMax[0];++n){if(t.posMin[1]>0){e.cells.at(n,t.posMin[1]-1).type==j.OneWayWindowS&&0===e.cells.at(n,t.posMin[1]).moveCost&&o.push(s.fromValues(n,t.posMin[1]))}if(t.posMax[1]<e.cells.sizeY){e.cells.at(n,t.posMax[1]).type==j.OneWayWindowN&&0===e.cells.at(n,t.posMax[1]-1).moveCost&&o.push(s.fromValues(n,t.posMax[1]-1))}}for(let n=t.posMin[1];n<t.posMax[1];++n){if(t.posMin[0]>0){e.cells.at(t.posMin[0]-1,n).type==j.OneWayWindowW&&0===e.cells.at(t.posMin[0],n).moveCost&&o.push(s.fromValues(t.posMin[0],n))}if(t.posMax[0]<e.cells.sizeX){e.cells.at(t.posMax[0],n).type==j.OneWayWindowE&&0===e.cells.at(t.posMax[0]-1,n).moveCost&&o.push(s.fromValues(t.posMax[0]-1,n))}}if(o.length>0)return o;for(const n of e.items)n.type==Z.Chair&&n.pos[0]>=t.posMin[0]&&n.pos[1]>=t.posMin[1]&&n.pos[0]<t.posMax[0]&&n.pos[1]<t.posMax[1]&&o.push(s.clone(n.pos));return o}function Fe(e,t,o){const n=e.computeDistancesToPosition(o),r=s.clone(t),i=[];for(;!r.equals(o);){i.push(s.clone(r));const t=Ge(e,n,r);if(t.equals(r))break;s.copy(r,t)}return i}function Ge(e,t,o){let n=1/0,r=s.clone(o);const i=s.fromValues(Math.max(0,o[0]-1),Math.max(0,o[1]-1)),a=s.fromValues(Math.min(e.cells.sizeX,o[0]+2),Math.min(e.cells.sizeY,o[1]+2));for(let l=i[0];l<a[0];++l)for(let u=i[1];u<a[1];++u){const i=t.get(l,u);if(i==1/0)continue;let a=s.fromValues(l,u);e.guardMoveCost(o,a)!=1/0&&(i<n&&(n=i,r=a))}if(r.equals(o)){console.log("failed to proceed");for(let e=i[0];e<a[0];++e)for(let o=i[1];o<a[1];++o){const n=t.get(e,o);console.log(e,o,n)}}return r}(ye=ge||(ge={}))[ye.Exterior=0]="Exterior",ye[ye.PublicCourtyard=1]="PublicCourtyard",ye[ye.PublicRoom=2]="PublicRoom",ye[ye.PrivateCourtyard=3]="PrivateCourtyard",ye[ye.PrivateRoom=4]="PrivateRoom",ye[ye.Vault=5]="Vault",ye[ye.Bedroom=6]="Bedroom";const Ue=[j.OneWayWindowS,j.OneWayWindowE,j.OneWayWindowN,j.OneWayWindowW];function Ve(e){return Ue[e[0]+2*Math.max(0,e[1])+1]}function Oe(e,t,o,n){const r=t.posMax[0]-t.posMin[0],i=t.posMax[1]-t.posMin[1];if(r>=5&&i>=5)ot(e,t.posMin[0]+1,t.posMin[1]+1,t.posMax[0]-1,t.posMax[1]-1,j.GroundWater);else if(r>=2&&i>=2){const a=[Z.Bush,Z.Bush,Z.Bush,Z.Bush];r>2&&i>2&&a.push(qe(o,n)),n.shuffleArray(a);const l=[s.fromValues(t.posMin[0],t.posMin[1]),s.fromValues(t.posMax[0]-1,t.posMin[1]),s.fromValues(t.posMin[0],t.posMax[1]-1),s.fromValues(t.posMax[0]-1,t.posMax[1]-1)];for(let t=0;t<l.length;++t){const o=l[t];e.cells.atVec(o).type==j.GroundGrass&&je(e,o,a[t])}}}function ze(e,t,o,n){const r=t.posMax[0]-t.posMin[0],i=t.posMax[1]-t.posMin[1];if(r>=5&&i>=5)t.roomType==ge.PrivateRoom&&ot(e,t.posMin[0]+2,t.posMin[1]+2,t.posMax[0]-2,t.posMax[1]-2,j.GroundWater),e.cells.at(t.posMin[0]+1,t.posMin[1]+1).type=j.Wall0000,e.cells.at(t.posMax[0]-2,t.posMin[1]+1).type=j.Wall0000,e.cells.at(t.posMin[0]+1,t.posMax[1]-2).type=j.Wall0000,e.cells.at(t.posMax[0]-2,t.posMax[1]-2).type=j.Wall0000;else if(5==r&&i>=3&&(t.roomType==ge.PublicRoom||n.random()<.33333)){const r=new Array(i-2).fill(Z.Table);r.push(qe(o,n)),n.shuffleArray(r);for(let o=1;o<i-1;++o)et(e,s.fromValues(t.posMin[0]+1,t.posMin[1]+o),Z.Chair),et(e,s.fromValues(t.posMin[0]+2,t.posMin[1]+o),r[o-1]),et(e,s.fromValues(t.posMin[0]+3,t.posMin[1]+o),Z.Chair)}else if(5==i&&r>=3&&(t.roomType==ge.PublicRoom||n.random()<.33333)){const i=new Array(r-2).fill(Z.Table);i.push(qe(o,n)),n.shuffleArray(i);for(let o=1;o<r-1;++o)et(e,s.fromValues(t.posMin[0]+o,t.posMin[1]+1),Z.Chair),et(e,s.fromValues(t.posMin[0]+o,t.posMin[1]+2),i[o-1]),et(e,s.fromValues(t.posMin[0]+o,t.posMin[1]+3),Z.Chair)}else if(r>i&&1==(1&i)&&n.random()<.66667){let r=Math.floor(t.posMin[1]+i/2);const a=t.roomType==ge.PublicRoom?Z.Table:Z.Chair,l=[qe(o,n),a];n.shuffleArray(l),je(e,s.fromValues(t.posMin[0]+1,r),l[0]),je(e,s.fromValues(t.posMax[0]-2,r),l[1])}else if(i>r&&1==(1&r)&&n.random()<.66667){let i=Math.floor(t.posMin[0]+r/2);const a=t.roomType==ge.PublicRoom?Z.Table:Z.Chair,l=[qe(o,n),a];n.shuffleArray(l),je(e,s.fromValues(i,t.posMin[1]+1),l[0]),je(e,s.fromValues(i,t.posMax[1]-2),l[1])}else if(r>3&&i>3){const r=t.roomType==ge.PublicRoom?Z.Table:Z.Chair,i=[qe(o,n),r,r,r];n.shuffleArray(i),je(e,s.fromValues(t.posMin[0],t.posMin[1]),i[0]),je(e,s.fromValues(t.posMax[0]-1,t.posMin[1]),i[1]),je(e,s.fromValues(t.posMin[0],t.posMax[1]-1),i[2]),je(e,s.fromValues(t.posMax[0]-1,t.posMax[1]-1),i[3])}}function Be(e,t){const o=t.posMax[0]-t.posMin[0],n=t.posMax[1]-t.posMin[1];o>=5&&n>=5&&(e.cells.at(t.posMin[0]+1,t.posMin[1]+1).type=j.Wall0000,e.cells.at(t.posMax[0]-2,t.posMin[1]+1).type=j.Wall0000,e.cells.at(t.posMin[0]+1,t.posMax[1]-2).type=j.Wall0000,e.cells.at(t.posMax[0]-2,t.posMax[1]-2).type=j.Wall0000)}function Ne(e,t,o){const n=[];for(let o=t.posMin[0];o<t.posMax[0]-1;++o)for(let r=t.posMin[1];r<t.posMax[1];++r){const t=s.fromValues(o,r),i=s.fromValues(o+1,r);(Qe(e.cells,t)||Qe(e.cells,i))&&(rt(e,t)||rt(e,i)||$e(e.cells,t)||$e(e.cells,i)||n.push(t))}if(n.length>0){const t=n[o.randomInRange(n.length)],r=s.fromValues(t[0]+1,t[1]);et(e,t,Z.BedL),et(e,r,Z.BedR)}for(const n of[Z.DrawersTall,Z.DrawersShort,Z.Chair,Z.Table]){const r=Ye(e,t);if(0===r.length)break;et(e,r[o.randomInRange(r.length)],n)}}function Ye(e,t){const o=[];for(let n=t.posMin[0];n<t.posMax[0];++n)for(let r=t.posMin[1];r<t.posMax[1];++r){const t=s.fromValues(n,r);Ke(e.cells,t)&&(rt(e,t)||$e(e.cells,t)||o.push(t))}return o}function Xe(e,t,o){for(let n=t.posMin[0];n<t.posMax[0];++n)for(let r=t.posMin[1];r<t.posMax[1];++r){if(e.cells.at(n,r).type!=j.GroundWood)continue;if($e(e.cells,s.fromValues(n,r)))continue;if(o.random()>=.02)continue;const i=n>t.posMin[0]&&n<t.posMax[0]-1&&e.cells.at(n-1,r).type==j.GroundWood&&e.cells.at(n+1,r).type==j.GroundWood,a=r>t.posMin[1]&&r<t.posMax[1]-1&&e.cells.at(n,r-1).type==j.GroundWood&&e.cells.at(n,r+1).type==j.GroundWood;(i||a)&&(e.cells.at(n,r).type=j.GroundWoodCreaky)}}function qe(e,t){return 0===e||t.random()<.5?Z.TorchUnlit:Z.TorchLit}function je(e,t,o){$e(e.cells,t)||(o!=Z.TorchUnlit&&o!=Z.TorchLit||!function(e,t){let[o,n]=t;return!!le(e.at(o-1,n).type)||(!!le(e.at(o+1,n).type)||(!!le(e.at(o,n-1).type)||!!le(e.at(o,n+1).type)))}(e.cells,t))&&et(e,t,o)}function $e(e,t){let[o,n]=t;return e.at(o-1,n).type>=j.PortcullisNS||(e.at(o+1,n).type>=j.PortcullisNS||(e.at(o,n-1).type>=j.PortcullisNS||e.at(o,n+1).type>=j.PortcullisNS))}function Ke(e,t){let[o,n]=t;return!!Je(e.at(o-1,n).type)||(!!Je(e.at(o+1,n).type)||(!!Je(e.at(o,n-1).type)||!!Je(e.at(o,n+1).type)))}function Qe(e,t){let[o,n]=t;return!!Ze(e.at(o-1,n).type)||(!!Ze(e.at(o+1,n).type)||(!!Ze(e.at(o,n-1).type)||!!Ze(e.at(o,n+1).type)))}function Je(e){return e>=j.Wall0000&&e<=j.Wall1111}function Ze(e){return e>=j.Wall0000&&e<=j.OneWayWindowS}function et(e,t,o){e.items.push({pos:s.clone(t),type:o})}function tt(e,t,o,n){let r=t[0]-e[0],i=t[1]-e[1];for(let t=1e3;t>0;--t){let t=s.fromValues(e[0]+n.randomInRange(r),e[1]+n.randomInRange(i)),a=o.cells.at(t[0],t[1]).type;if(!(a===j.GroundWater||a>=j.Wall0000)&&!rt(o,t))return et(o,t,Z.Coin),!0}return!1}function ot(e,t,o,n,r,i){for(let s=t;s<n;++s)for(let t=o;t<r;++t)e.cells.at(s,t).type=i}function nt(e,t){return!(e.cells.atVec(t).type>=j.Wall0000)&&(t[0]>=0&&e.cells.at(t[0]-1,t[1]).type>=j.Wall0000||(t[1]>=0&&e.cells.at(t[0],t[1]-1).type>=j.Wall0000||(t[0]+1<e.cells.sizeX&&e.cells.at(t[0]+1,t[1]).type>=j.Wall0000||t[1]+1<e.cells.sizeY&&e.cells.at(t[0],t[1]+1).type>=j.Wall0000)))}function rt(e,t){for(const o of e.items)if(o.pos.equals(t))return!0;for(const o of e.guards)if(o.pos.equals(t))return!0;return!1}function it(e){switch(e){case ge.Exterior:return!1;case ge.PublicCourtyard:return!0;case ge.PublicRoom:return!1;case ge.PrivateCourtyard:return!0;case ge.PrivateRoom:case ge.Vault:case ge.Bedroom:return!1}}function st(e){return e===ge.PrivateRoom||e===ge.Bedroom}function at(e){return j.Wall0000+e}function lt(e){return e>=j.Wall0000&&e<=j.DoorEW}function ut(e,t,o){const n=e.sizeX;let r=0;return o<e.sizeY-1&&lt(e.at(t,o+1).type)&&(r|=8),o>0&&lt(e.at(t,o-1).type)&&(r|=4),t<n-1&&lt(e.at(t+1,o).type)&&(r|=2),t>0&&lt(e.at(t-1,o).type)&&(r|=1),r}class ct{getScreenSize(e){}beginFrame=e=>{};start(e,t){}addGlyph(e,t,o,n,r,i=1){}flush(){}constructor(e,t,o){this.tileSet=t,this.fontTileSet=o;const n=e.getContext("webgl2",{alpha:!1,depth:!1}),r=[o.image,t.image].map((e=>function(e,t){const o=16,n=16,r=o*n,i=t.naturalWidth/o,s=t.naturalHeight/n,a=1,l=i*a,u=s*a,c=document.createElement("canvas");c.width=l,c.height=u*r;const d=c.getContext("2d");d.imageSmoothingEnabled=!1;for(let e=0;e<n;++e)for(let n=0;n<o;++n){const r=n*i,a=e*s,c=0,p=(o*e+n)*u;d.drawImage(t,r,a,i,s,c,p,l,u)}const p=d.getImageData(0,0,c.width,c.height),h=new Uint8Array(p.data.buffer),m=e.createTexture();return e.bindTexture(e.TEXTURE_2D_ARRAY,m),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.RGBA,l,u,r,0,e.RGBA,e.UNSIGNED_BYTE,h),m}(n,e))),i={vPosition:0,vTexcoord:1,vColor:2};function l(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function u(e){const[t,o,n,r]=e;return r<<24>>>0|n<<16>>>0|o<<8>>>0|t>>>0}const c=[t.tileSize[0]/t.cellSize[0],t.tileSize[1]/t.cellSize[1]],d=function(e,t,o,n){const r=dt(e,e.VERTEX_SHADER,t),i=dt(e,e.FRAGMENT_SHADER,o),s=e.createProgram();e.attachShader(s,r),e.attachShader(s,i);for(const t in n)e.bindAttribLocation(s,n[t],t);e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||alert("Unable to initialize the shader program: "+e.getProgramInfoLog(s));return s}(n,"#version 300 es\n            in vec2 vPosition;\n            in vec3 vTexcoord;\n            in vec4 vColor;\n\n            uniform mat4 uMatScreenFromWorld;\n\n            out highp vec3 fTexcoord;\n            out highp vec4 fColor;\n\n            void main() {\n                fTexcoord = vTexcoord;\n                fColor = vColor;\n                gl_Position = uMatScreenFromWorld * vec4(vPosition, 0, 1);\n            }\n        ","#version 300 es\n            in highp vec3 fTexcoord;\n            in highp vec4 fColor;\n\n            uniform highp sampler2DArray uOpacity;\n\n            out lowp vec4 fragColor;\n\n            void main() {\n                fragColor = fColor * texture(uOpacity, fTexcoord);\n            }\n        ",i),p=n.getUniformLocation(d,"uMatScreenFromWorld"),h=n.getUniformLocation(d,"uOpacity"),m=2*Float32Array.BYTES_PER_ELEMENT+2*Uint32Array.BYTES_PER_ELEMENT,f=m,g=new ArrayBuffer(256*m),y=new Float32Array(g),v=new Uint32Array(g),_=n.createBuffer();let x=0;const w=a.create(),S=n.createVertexArray();n.bindVertexArray(S),n.enableVertexAttribArray(i.vPosition),n.enableVertexAttribArray(i.vTexcoord),n.enableVertexAttribArray(i.vColor),n.bindBuffer(n.ARRAY_BUFFER,_),n.vertexAttribPointer(i.vPosition,2,n.FLOAT,!1,m,0),n.vertexAttribPointer(i.vTexcoord,3,n.UNSIGNED_BYTE,!1,m,8),n.vertexAttribPointer(i.vColor,4,n.UNSIGNED_BYTE,!0,m,12),n.bufferData(n.ARRAY_BUFFER,g,n.DYNAMIC_DRAW);!function(e,t){const o=new Uint16Array(6*t);for(let e=0;e<t;++e){let t=6*e,n=4*e;o[t+0]=n+0,o[t+1]=n+1,o[t+2]=n+2,o[t+3]=n+2,o[t+4]=n+1,o[t+5]=n+3}const n=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW)}(n,64);n.bindVertexArray(null),this.getScreenSize=e=>{const t=n.canvas;pt(t);const o=t.clientWidth,r=t.clientHeight;s.set(e,o,r)},this.start=(e,t)=>{a.copy(w,e),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D_ARRAY,r[t])},this.addGlyph=(e,t,o,n,r,i=1)=>{if(void 0!==r.textureIndex)if(x>=64&&this.flush(),o=e+(o-e)*c[0],n=t+(n-t)*c[1],"number"==typeof i){const s=l(r.color?r.color:4294967295),a=l(r.unlitColor?r.unlitColor:4283453520),c=i**.25,d=u([a[0]+c*(s[0]-a[0]),a[1]+c*(s[1]-a[1]),a[2]+c*(s[2]-a[2]),a[3]+c*(s[3]-a[3])]),p=x*f,h=r.textureIndex<<16;y[p+0]=e,y[p+1]=t,v[p+2]=h+256,v[p+3]=d,y[p+4]=o,y[p+5]=t,v[p+6]=h+257,v[p+7]=d,y[p+8]=e,y[p+9]=n,v[p+10]=h,v[p+11]=d,y[p+12]=o,y[p+13]=n,v[p+14]=h+1,v[p+15]=d,++x}else{const s=[];for(const e of i){const t=l(r.color?r.color:4294967295),o=l(r.unlitColor?r.unlitColor:4283453520),n=e**.25,i=u([o[0]+n*(t[0]-o[0]),o[1]+n*(t[1]-o[1]),o[2]+n*(t[2]-o[2]),o[3]+n*(t[3]-o[3])]);s.push(i)}const a=x*f,c=r.textureIndex<<16;y[a+0]=e,y[a+1]=t,v[a+2]=c+256,v[a+3]=s[0],y[a+4]=o,y[a+5]=t,v[a+6]=c+257,v[a+7]=s[1],y[a+8]=e,y[a+9]=n,v[a+10]=c,v[a+11]=s[2],y[a+12]=o,y[a+13]=n,v[a+14]=c+1,v[a+15]=s[3],++x}},this.flush=()=>{x<=0||(n.useProgram(d),n.bindVertexArray(S),n.uniform1i(h,0),n.uniformMatrix4fv(p,!1,w),n.bindBuffer(n.ARRAY_BUFFER,_),n.bufferSubData(n.ARRAY_BUFFER,0,y,0),n.drawElements(n.TRIANGLES,6*x,n.UNSIGNED_SHORT,0),n.bindVertexArray(null),x=0)},this.beginFrame=e=>{const t=n.canvas;pt(t);const o=t.clientWidth,r=t.clientHeight;n.viewport(0,0,o,r),n.clear(n.COLOR_BUFFER_BIT)},n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.enable(n.BLEND),n.clearColor(0,0,0,1)}}function dt(e,t,o){const n=e.createShader(t);return e.shaderSource(n,o),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(n)),e.deleteShader(n)),n}function pt(e){e.width===window.innerWidth&&e.height===window.innerHeight||(e.width=window.innerWidth,e.height=window.innerHeight)}const ht=4278190080,mt=4278190248,ft=4291875024,gt=4289243304,yt=4287660160,vt=4285550672,_t=4283760212,xt=4294901332,wt=4283760382,St=4291886846,Tt=4290834158,Mt=4294967295;var Lt;Lt=new URL(i("27Lyk").resolve("dwPvt"),import.meta.url).toString();function At(){return Ht}function bt(){return kt}function Rt(e){return 16*e[1]+e[0]}const kt={name:"Basic Font",imageSrc:new URL(i("27Lyk").resolve("kDrfW"),import.meta.url).toString(),image:new Image,tileSize:[16,16],offset:[0,0],letterMap:[],background:{textureIndex:219,color:4027584528},heart:{textureIndex:3},air:{textureIndex:9}},Ht={name:"31 Color Tileset",imageSrc:Lt,image:new Image,tileSize:[16,16],cellSize:[16,16],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:Rt([0,0])},namedTiles:{pickTarget:{textureIndex:188,color:4294967295},noise:{textureIndex:187,color:2164260863},crossHatch:{textureIndex:3,color:4294967295},patrolRoute:{textureIndex:31,color:4286644096}},touchButtons:{menu:{textureIndex:Rt([11,1]),color:2701131775,unlitColor:2164260863},up:{textureIndex:Rt([2,1]),color:2701131775,unlitColor:2164260863},down:{textureIndex:Rt([3,1]),color:2701131775,unlitColor:2164260863},left:{textureIndex:Rt([0,1]),color:2701131775,unlitColor:2164260863},right:{textureIndex:Rt([1,1]),color:2701131775,unlitColor:2164260863},wait:{textureIndex:Rt([4,1]),color:2701131775,unlitColor:2164260863},exitLevel:{textureIndex:Rt([9,1]),color:4278255615,unlitColor:4278255615},jump:{textureIndex:Rt([5,1]),color:2701131775,unlitColor:2164260863},zoomIn:{textureIndex:Rt([6,1]),color:2701131775,unlitColor:2164260863},zoomOut:{textureIndex:Rt([7,1]),color:2701131775,unlitColor:2164260863},heal:{textureIndex:Rt([8,1]),color:2701131775,unlitColor:2164260863},startLevel:{textureIndex:Rt([9,1]),color:2701131775,unlitColor:2164260863},nextLevel:{textureIndex:Rt([9,1]),color:2701131775,unlitColor:2164260863},restart:{textureIndex:Rt([10,1]),color:2701131775,unlitColor:2164260863},forceRestart:{textureIndex:Rt([10,1]),color:2701131775,unlitColor:2164260863},gamepadTouchOn:{textureIndex:Rt([12,1]),color:2701131775,unlitColor:4294967295},gamepadTouchOff:{textureIndex:Rt([12,1]),color:2701131775,unlitColor:2164260863},picker:{textureIndex:Rt([13,1]),color:4278255615,unlitColor:4278255615},fullscreen:{textureIndex:Rt([14,1]),color:2701131775,unlitColor:2164260863}},terrainTiles:[{textureIndex:Rt([5,4]),color:St,unlitColor:vt},{textureIndex:Rt([8,4]),color:St,unlitColor:vt},{textureIndex:Rt([10,4]),color:St,unlitColor:vt},{textureIndex:Rt([0,4]),color:St,unlitColor:vt},{textureIndex:Rt([7,4]),color:Tt,unlitColor:vt},{textureIndex:Rt([7,5]),color:Tt,unlitColor:vt},{textureIndex:Rt([5,4]),color:St,unlitColor:vt},{textureIndex:Rt([0,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([2,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([4,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([6,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([1,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([9,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([8,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([12,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([3,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([10,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([7,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([14,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([5,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([13,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([11,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([15,2]),color:Mt,unlitColor:yt},{textureIndex:Rt([0,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([2,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([3,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([1,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([12,3]),color:St,unlitColor:yt},{textureIndex:Rt([11,3]),color:St,unlitColor:yt},{textureIndex:Rt([8,3]),color:ft,unlitColor:yt},{textureIndex:Rt([5,3]),color:ft,unlitColor:yt},{textureIndex:Rt([8,4]),color:St,unlitColor:vt},{textureIndex:Rt([8,4]),color:St,unlitColor:vt}],itemTiles:[{textureIndex:Rt([3,13]),color:St,unlitColor:yt},{textureIndex:Rt([4,13]),color:St,unlitColor:yt},{textureIndex:Rt([7,14]),color:Mt,unlitColor:yt},{textureIndex:Rt([8,14]),color:Mt,unlitColor:yt},{textureIndex:Rt([10,14]),color:Mt,unlitColor:yt},{textureIndex:Rt([9,14]),color:Mt,unlitColor:yt},{textureIndex:Rt([2,13]),color:Mt,unlitColor:yt},{textureIndex:Rt([5,13]),color:Mt,unlitColor:4294967295},{textureIndex:Rt([7,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([4,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([9,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([6,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([12,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([11,3]),color:Mt,unlitColor:yt},{textureIndex:Rt([0,13]),color:Mt,unlitColor:4294967295},{textureIndex:Rt([1,13]),color:Mt,unlitColor:4294967295},{textureIndex:Rt([12,13]),color:St,unlitColor:4288704624},{textureIndex:Rt([0,15]),color:Mt,unlitColor:4294967295},{textureIndex:Rt([6,13]),color:Mt,unlitColor:4294967295},{textureIndex:Rt([1,15]),color:Mt,unlitColor:4294967295}],npcTiles:[{textureIndex:Rt([3,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([2,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([4,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([1,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([3,8]),color:vt},{textureIndex:Rt([2,8]),color:vt},{textureIndex:Rt([4,8]),color:vt},{textureIndex:Rt([1,8]),color:vt},{textureIndex:Rt([3,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([2,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([4,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([1,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([0,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([0,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([0,8]),color:Mt,unlitColor:vt},{textureIndex:Rt([0,8]),color:Mt,unlitColor:vt}],playerTiles:{normal:{textureIndex:Rt([1,9]),color:Mt,unlitColor:gt},wounded:{textureIndex:Rt([1,9]),color:4283716862,unlitColor:mt},hidden:{textureIndex:Rt([0,9]),color:vt,unlitColor:4284497984},noisy:{textureIndex:Rt([1,9]),color:gt,unlitColor:vt},unlit:{textureIndex:Rt([1,9]),color:Mt,unlitColor:gt},right:{textureIndex:Rt([2,9]),color:Mt,unlitColor:gt},left:{textureIndex:Rt([3,9]),color:Mt,unlitColor:gt},down:{textureIndex:Rt([1,9]),color:Mt,unlitColor:gt},up:{textureIndex:Rt([4,9]),color:Mt,unlitColor:gt},dead:{textureIndex:Rt([5,9]),color:Mt,unlitColor:gt}},guardStateTiles:[{textureIndex:Rt([0,11])},{textureIndex:Rt([1,11])},{textureIndex:Rt([2,11])},{textureIndex:Rt([3,11])},{textureIndex:Rt([4,11])}],ledgeTiles:[{textureIndex:Rt([12,0]),color:4285753415,unlitColor:4282922024},{textureIndex:Rt([13,0]),color:4285753415,unlitColor:4282922024},{textureIndex:Rt([14,0]),color:4285753415,unlitColor:4282922024},{textureIndex:Rt([15,0]),color:4285753415,unlitColor:4282922024}],waterAnimation:[{textureIndex:96,color:St,unlitColor:yt},{textureIndex:97,color:St,unlitColor:yt},{textureIndex:98,color:St,unlitColor:yt},{textureIndex:99,color:St,unlitColor:yt}],candleAnimation:[{textureIndex:224,color:St,unlitColor:yt},{textureIndex:225,color:St,unlitColor:yt},{textureIndex:226,color:St,unlitColor:yt},{textureIndex:227,color:St,unlitColor:yt},{textureIndex:208,color:St,unlitColor:yt}],torchAnimation:[{textureIndex:220},{textureIndex:221},{textureIndex:222},{textureIndex:223},{textureIndex:223}]};var Pt,Ct;
/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var o=this||t;if(e=parseFloat(e),o.ctx||c(),void 0!==e&&e>=0&&e<=1){if(o._volume=e,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var n=0;n<o._howls.length;n++)if(!o._howls[n]._webAudio)for(var r=o._howls[n]._getSoundIds(),i=0;i<r.length;i++){var s=o._howls[n]._soundById(r[i]);s&&s._node&&(s._node.volume=s._volume*e)}return o}return o._volume},mute:function(e){var o=this||t;o.ctx||c(),o._muted=e,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(e?0:o._volume,t.ctx.currentTime);for(var n=0;n<o._howls.length;n++)if(!o._howls[n]._webAudio)for(var r=o._howls[n]._getSoundIds(),i=0;i<r.length;i++){var s=o._howls[n]._soundById(r[i]);s&&s._node&&(s._node.muted=!!e||s._muted)}return o},stop:function(){for(var e=this||t,o=0;o<e._howls.length;o++)e._howls[o].stop();return e},unload:function(){for(var e=this||t,o=e._howls.length-1;o>=0;o--)e._howls[o].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,o=null;try{o="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!o||"function"!=typeof o.canPlayType)return e;var n=o.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator?e._navigator.userAgent:"",i=r.match(/OPR\/([0-6].)/g),s=i&&parseInt(i[0].split("/")[1],10)<33,a=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),l=r.match(/Version\/(.*?) /),u=a&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(s||!n&&!o.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(u||!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(u||!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var o=function(t){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(t){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var i=e._howls[r]._getSoundIds(),s=0;s<i.length;s++){var a=e._howls[r]._soundById(i[s]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",o,!0);for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var o=(new Audio).play();return o&&"undefined"!=typeof Promise&&(o instanceof Promise||"function"==typeof o.then)&&o.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var o=this||t;return e._unlocked&&o._html5AudioPool.push(e),o},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&t.usingWebAudio){for(var o=0;o<e._howls.length;o++)if(e._howls[o]._webAudio)for(var n=0;n<e._howls[o]._sounds.length;n++)if(!e._howls[o]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,n=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var o=this;return t.ctx||c(),o._autoplay=e.autoplay||!1,o._format="string"!=typeof e.format?e.format:[e.format],o._html5=e.html5||!1,o._muted=e.mute||!1,o._loop=e.loop||!1,o._pool=e.pool||5,o._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,o._rate=e.rate||1,o._sprite=e.sprite||{},o._src="string"!=typeof e.src?e.src:[e.src],o._volume=void 0!==e.volume?e.volume:1,o._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=e.onend?[{fn:e.onend}]:[],o._onfade=e.onfade?[{fn:e.onfade}]:[],o._onload=e.onload?[{fn:e.onload}]:[],o._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],o._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],o._onpause=e.onpause?[{fn:e.onpause}]:[],o._onplay=e.onplay?[{fn:e.onplay}]:[],o._onstop=e.onstop?[{fn:e.onstop}]:[],o._onmute=e.onmute?[{fn:e.onmute}]:[],o._onvolume=e.onvolume?[{fn:e.onvolume}]:[],o._onrate=e.onrate?[{fn:e.onrate}]:[],o._onseek=e.onseek?[{fn:e.onseek}]:[],o._onunlock=e.onunlock?[{fn:e.onunlock}]:[],o._onresume=[],o._webAudio=t.usingWebAudio&&!o._html5,void 0!==t.ctx&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&"none"!==o._preload&&o.load(),o},load:function(){var e=this,o=null;if(t.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var i,a;if(e._format&&e._format[n])i=e._format[n];else{if("string"!=typeof(a=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(a))||(i=/\.([^.]+)$/.exec(a.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&t.codecs(i)){o=e._src[n];break}}if(o)return e._src=o,e._state="loading","https:"===window.location.protocol&&"http:"===o.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new r(e),e._webAudio&&s(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,o){var n=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var i=0,s=0;s<n._sounds.length;s++)n._sounds[s]._paused&&!n._sounds[s]._ended&&(i++,r=n._sounds[s]._id);1===i?e=null:r=null}}var a=r?n._soundById(r):n._inactiveSound();if(!a)return null;if(r&&!e&&(e=a._sprite||"__default"),"loaded"!==n._state){a._sprite=e,a._ended=!1;var l=a._id;return n._queue.push({event:"play",action:function(){n.play(l)}}),l}if(r&&!a._paused)return o||n._loadQueue("play"),a._id;n._webAudio&&t._autoResume();var u=Math.max(0,a._seek>0?a._seek:n._sprite[e][0]/1e3),c=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-u),d=1e3*c/Math.abs(a._rate),p=n._sprite[e][0]/1e3,h=(n._sprite[e][0]+n._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var m=function(){a._paused=!1,a._seek=u,a._start=p,a._stop=h,a._loop=!(!a._loop&&!n._sprite[e][2])};if(!(u>=h)){var f=a._node;if(n._webAudio){var g=function(){n._playLock=!1,m(),n._refreshBuffer(a);var e=a._muted||n._muted?0:a._volume;f.gain.setValueAtTime(e,t.ctx.currentTime),a._playStart=t.ctx.currentTime,void 0===f.bufferSource.start?a._loop?f.bufferSource.noteGrainOn(0,u,86400):f.bufferSource.noteGrainOn(0,u,c):a._loop?f.bufferSource.start(0,u,86400):f.bufferSource.start(0,u,c),d!==1/0&&(n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),d)),o||setTimeout((function(){n._emit("play",a._id),n._loadQueue()}),0)};"running"===t.state&&"interrupted"!==t.ctx.state?g():(n._playLock=!0,n.once("resume",g),n._clearTimer(a._id))}else{var y=function(){f.currentTime=u,f.muted=a._muted||n._muted||t._muted||f.muted,f.volume=a._volume*t.volume(),f.playbackRate=a._rate;try{var r=f.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,m(),r.then((function(){n._playLock=!1,f._unlocked=!0,o?n._loadQueue():n._emit("play",a._id)})).catch((function(){n._playLock=!1,n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):o||(n._playLock=!1,m(),n._emit("play",a._id)),f.playbackRate=a._rate,f.paused)return void n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),d):(n._endTimers[a._id]=function(){n._ended(a),f.removeEventListener("ended",n._endTimers[a._id],!1)},f.addEventListener("ended",n._endTimers[a._id],!1))}catch(e){n._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===f.src&&(f.src=n._src,f.load());var v=window&&window.ejecta||!f.readyState&&t._navigator.isCocoonJS;if(f.readyState>=3||v)y();else{n._playLock=!0,n._state="loading";var _=function(){n._state="loaded",y(),f.removeEventListener(t._canPlayEvent,_,!1)};f.addEventListener(t._canPlayEvent,_,!1),n._clearTimer(a._id)}}return a._id}n._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var o=t._getSoundIds(e),n=0;n<o.length;n++){t._clearTimer(o[n]);var r=t._soundById(o[n]);if(r&&!r._paused&&(r._seek=t.seek(o[n]),r._rateSeek=0,r._paused=!0,t._stopFade(o[n]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"stop",action:function(){o.stop(e)}}),o;for(var n=o._getSoundIds(e),r=0;r<n.length;r++){o._clearTimer(n[r]);var i=o._soundById(n[r]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,o._stopFade(n[r]),i._node&&(o._webAudio?i._node.bufferSource&&(void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),o._cleanBuffer(i._node)):isNaN(i._node.duration)&&i._node.duration!==1/0||(i._node.currentTime=i._start||0,i._node.pause(),i._node.duration===1/0&&o._clearSound(i._node))),t||o._emit("stop",i._id))}return o},mute:function(e,o){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,o)}}),n;if(void 0===o){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var r=n._getSoundIds(o),i=0;i<r.length;i++){var s=n._soundById(r[i]);s&&(s._muted=e,s._interval&&n._stopFade(s._id),n._webAudio&&s._node?s._node.gain.setValueAtTime(e?0:s._volume,t.ctx.currentTime):s._node&&(s._node.muted=!!t._muted||e),n._emit("mute",s._id))}return n},volume:function(){var e,o,n,r=this,i=arguments;if(0===i.length)return r._volume;if(1===i.length||2===i.length&&void 0===i[1]?r._getSoundIds().indexOf(i[0])>=0?o=parseInt(i[0],10):e=parseFloat(i[0]):i.length>=2&&(e=parseFloat(i[0]),o=parseInt(i[1],10)),!(void 0!==e&&e>=0&&e<=1))return(n=o?r._soundById(o):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,i)}}),r;void 0===o&&(r._volume=e),o=r._getSoundIds(o);for(var s=0;s<o.length;s++)(n=r._soundById(o[s]))&&(n._volume=e,i[2]||r._stopFade(o[s]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,t.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*t.volume()),r._emit("volume",n._id));return r},fade:function(e,o,n,r){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,o,n,r)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),o=Math.min(Math.max(0,parseFloat(o)),1),n=parseFloat(n),i.volume(e,r);for(var s=i._getSoundIds(r),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if(r||i._stopFade(s[a]),i._webAudio&&!l._muted){var u=t.ctx.currentTime,c=u+n/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(o,c)}i._startFadeInterval(l,e,o,n,s[a],void 0===r)}}return i},_startFadeInterval:function(e,t,o,n,r,i){var s=this,a=t,l=o-t,u=Math.abs(l/.01),c=Math.max(4,u>0?n/u:n),d=Date.now();e._fadeTo=o,e._interval=setInterval((function(){var r=(Date.now()-d)/n;d=Date.now(),a+=l*r,a=Math.round(100*a)/100,a=l<0?Math.max(o,a):Math.min(o,a),s._webAudio?e._volume=a:s.volume(a,e._id,!0),i&&(s._volume=a),(o<t&&a<=o||o>t&&a>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,s.volume(o,e._id),s._emit("fade",e._id))}),c)},_stopFade:function(e){var o=this,n=o._soundById(e);return n&&n._interval&&(o._webAudio&&n._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(n._interval),n._interval=null,o.volume(n._fadeTo,e),n._fadeTo=null,o._emit("fade",e)),o},loop:function(){var e,t,o,n=this,r=arguments;if(0===r.length)return n._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(o=n._soundById(parseInt(r[0],10)))&&o._loop;e=r[0],n._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var i=n._getSoundIds(t),s=0;s<i.length;s++)(o=n._soundById(i[s]))&&(o._loop=e,n._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=e,e&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,n.playing(i[s])&&(n.pause(i[s],!0),n.play(i[s],!0)))));return n},rate:function(){var e,o,n,r=this,i=arguments;if(0===i.length)o=r._sounds[0]._id;else if(1===i.length){r._getSoundIds().indexOf(i[0])>=0?o=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),o=parseInt(i[1],10));if("number"!=typeof e)return(n=r._soundById(o))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,i)}}),r;void 0===o&&(r._rate=e),o=r._getSoundIds(o);for(var s=0;s<o.length;s++)if(n=r._soundById(o[s])){r.playing(o[s])&&(n._rateSeek=r.seek(o[s]),n._playStart=r._webAudio?t.ctx.currentTime:n._playStart),n._rate=e,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,t.ctx.currentTime):n._node&&(n._node.playbackRate=e);var a=r.seek(o[s]),l=1e3*((r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-a)/Math.abs(n._rate);!r._endTimers[o[s]]&&n._paused||(r._clearTimer(o[s]),r._endTimers[o[s]]=setTimeout(r._ended.bind(r,n),l)),r._emit("rate",n._id)}return r},seek:function(){var e,o,n=this,r=arguments;if(0===r.length)n._sounds.length&&(o=n._sounds[0]._id);else if(1===r.length){n._getSoundIds().indexOf(r[0])>=0?o=parseInt(r[0],10):n._sounds.length&&(o=n._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),o=parseInt(r[1],10));if(void 0===o)return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var i=n._soundById(o);if(i){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var s=n.playing(o)?t.ctx.currentTime-i._playStart:0,a=i._rateSeek?i._rateSeek-i._seek:0;return i._seek+(a+s*Math.abs(i._rate))}return i._node.currentTime}var l=n.playing(o);l&&n.pause(o,!0),i._seek=e,i._ended=!1,n._clearTimer(o),n._webAudio||!i._node||isNaN(i._node.duration)||(i._node.currentTime=e);var u=function(){l&&n.play(o,!0),n._emit("seek",o)};if(l&&!n._webAudio){var c=function(){n._playLock?setTimeout(c,0):u()};setTimeout(c,0)}else u()}return n},playing:function(e){var t=this;if("number"==typeof e){var o=t._soundById(e);return!!o&&!o._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,o=t._duration,n=t._soundById(e);return n&&(o=t._sprite[n._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,o=e._sounds,n=0;n<o.length;n++)o[n]._paused||e.stop(o[n]._id),e._webAudio||(e._clearSound(o[n]._node),o[n]._node.removeEventListener("error",o[n]._errorFn,!1),o[n]._node.removeEventListener(t._canPlayEvent,o[n]._loadFn,!1),o[n]._node.removeEventListener("ended",o[n]._endFn,!1),t._releaseHtml5Audio(o[n]._node)),delete o[n]._node,e._clearTimer(o[n]._id);var r=t._howls.indexOf(e);r>=0&&t._howls.splice(r,1);var s=!0;for(n=0;n<t._howls.length;n++)if(t._howls[n]._src===e._src||e._src.indexOf(t._howls[n]._src)>=0){s=!1;break}return i&&s&&delete i[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,o,n){var r=this["_on"+e];return"function"==typeof t&&r.push(n?{id:o,fn:t,once:n}:{id:o,fn:t}),this},off:function(e,t,o){var n=this,r=n["_on"+e],i=0;if("number"==typeof t&&(o=t,t=null),t||o)for(i=0;i<r.length;i++){var s=o===r[i].id;if(t===r[i].fn&&s||!t&&s){r.splice(i,1);break}}else if(e)n["_on"+e]=[];else{var a=Object.keys(n);for(i=0;i<a.length;i++)0===a[i].indexOf("_on")&&Array.isArray(n[a[i]])&&(n[a[i]]=[])}return n},once:function(e,t,o){return this.on(e,t,o,1),this},_emit:function(e,t,o){for(var n=this,r=n["_on"+e],i=r.length-1;i>=0;i--)r[i].id&&r[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,o)}.bind(n,r[i].fn),0),r[i].once&&n.off(e,r[i].fn,r[i].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var o=t._queue[0];o.event===e&&(t._queue.shift(),t._loadQueue()),e||o.action()}return t},_ended:function(e){var o=this,n=e._sprite;if(!o._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(o._ended.bind(o,e),100),o;var r=!(!e._loop&&!o._sprite[n][2]);if(o._emit("end",e._id),!o._webAudio&&r&&o.stop(e._id,!0).play(e._id),o._webAudio&&r){o._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);o._endTimers[e._id]=setTimeout(o._ended.bind(o,e),i)}return o._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,o._clearTimer(e._id),o._cleanBuffer(e._node),t._autoSuspend()),o._webAudio||r||o.stop(e._id,!0),o},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var o=t._soundById(e);o&&o._node&&o._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,o=0;o<t._sounds.length;o++)if(e===t._sounds[o]._id)return t._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new r(e)},_drain:function(){var e=this,t=e._pool,o=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&o++;for(n=e._sounds.length-1;n>=0;n--){if(o<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),o--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],o=0;o<this._sounds.length;o++)t.push(this._sounds[o]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=i[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),this},_cleanBuffer:function(e){var o=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),o))try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(e){this._parent=e,this.init()};r.prototype={init:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,o._sounds.push(e),e.create(),e},create:function(){var e=this,o=e._parent,n=t._muted||e._muted||e._parent._muted?0:e._volume;return o._webAudio?(e._node=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(n,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=o._src,e._node.preload=!0===o._preload?"auto":o._preload,e._node.volume=n*t.volume(),e._node.load()),e},reset:function(){var e=this,o=e._parent;return e._muted=o._muted,e._loop=o._loop,e._volume=o._volume,e._rate=o._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,o=e._parent;o._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(o._sprite).length&&(o._sprite={__default:[0,1e3*o._duration]}),"loaded"!==o._state&&(o._state="loaded",o._emit("load"),o._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var i={},s=function(e){var t=e._src;if(i[t])return e._duration=i[t].duration,void u(e);if(/^data:[^;]+;base64,/.test(t)){for(var o=atob(t.split(",")[1]),n=new Uint8Array(o.length),r=0;r<o.length;++r)n[r]=o.charCodeAt(r);l(n.buffer,e)}else{var s=new XMLHttpRequest;s.open(e._xhr.method,t,!0),s.withCredentials=e._xhr.withCredentials,s.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){s.setRequestHeader(t,e._xhr.headers[t])})),s.onload=function(){var t=(s.status+"")[0];"0"===t||"2"===t||"3"===t?l(s.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+s.status+".")},s.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete i[t],e.load())},a(s)}},a=function(e){try{e.send()}catch(t){e.onerror()}},l=function(e,o){var n=function(){o._emit("loaderror",null,"Decoding audio data failed.")},r=function(e){e&&o._sounds.length>0?(i[o._src]=e,u(o,e)):n()};"undefined"!=typeof Promise&&1===t.ctx.decodeAudioData.length?t.ctx.decodeAudioData(e).then(r).catch(n):t.ctx.decodeAudioData(e,r,n)},u=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){if(t.usingWebAudio){try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),o=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=o?parseInt(o[1],10):null;if(e&&n&&n<9){var r=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!r&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};"function"==typeof define&&define.amd&&define([],(function(){return{Howler:t,Howl:n}})),Pt=t,Ct=n,void 0!==o?(o.HowlerGlobal=e,o.Howler=t,o.Howl=n,o.Sound=r):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=r)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var o=t._howls.length-1;o>=0;o--)t._howls[o].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,o){var n=this;return n.ctx&&n.ctx.listener?(t="number"!=typeof t?n._pos[1]:t,o="number"!=typeof o?n._pos[2]:o,"number"!=typeof e?n._pos:(n._pos=[e,t,o],void 0!==n.ctx.listener.positionX?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]),n)):n},HowlerGlobal.prototype.orientation=function(e,t,o,n,r,i){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,o="number"!=typeof o?a[2]:o,n="number"!=typeof n?a[3]:n,r="number"!=typeof r?a[4]:r,i="number"!=typeof i?a[5]:i,"number"!=typeof e?a:(s._orientation=[e,t,o,n,r,i],void 0!==s.ctx.listener.forwardX?(s.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(o,Howler.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(i,Howler.ctx.currentTime,.1)):s.ctx.listener.setOrientation(e,t,o,n,r,i),s)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var o=this;return o._orientation=t.orientation||[1,0,0],o._stereo=t.stereo||null,o._pos=t.pos||null,o._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},o._onstereo=t.onstereo?[{fn:t.onstereo}]:[],o._onpos=t.onpos?[{fn:t.onpos}]:[],o._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,o){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,o)}}),n;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===o){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var i=n._getSoundIds(o),s=0;s<i.length;s++){var a=n._soundById(i[s]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,r),"spatial"===r?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",a._id)}}return n},Howl.prototype.pos=function(e,o,n,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(e,o,n,r)}}),i;if(o="number"!=typeof o?0:o,n="number"!=typeof n?-.5:n,void 0===r){if("number"!=typeof e)return i._pos;i._pos=[e,o,n]}for(var s=i._getSoundIds(r),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,o,n],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setPosition(e,o,n)),i._emit("pos",l._id)}}return i},Howl.prototype.orientation=function(e,o,n,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(e,o,n,r)}}),i;if(o="number"!=typeof o?i._orientation[1]:o,n="number"!=typeof n?i._orientation[2]:n,void 0===r){if("number"!=typeof e)return i._orientation;i._orientation=[e,o,n]}for(var s=i._getSoundIds(r),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,o,n],l._node&&(l._panner||(l._pos||(l._pos=i._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setOrientation(e,o,n)),i._emit("orientation",l._id)}}return i},Howl.prototype.pannerAttr=function(){var e,o,n,r=this,i=arguments;if(!r._webAudio)return r;if(0===i.length)return r._pannerAttr;if(1===i.length){if("object"!=typeof i[0])return(n=r._soundById(parseInt(i[0],10)))?n._pannerAttr:r._pannerAttr;e=i[0],void 0===o&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:r._panningModel})}else 2===i.length&&(e=i[0],o=parseInt(i[1],10));for(var s=r._getSoundIds(o),a=0;a<s.length;a++)if(n=r._soundById(s[a])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=n._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(n._pos||(n._pos=r._pos||[0,0,-.5]),t(n,"spatial"))}return r},Sound.prototype.init=function(e){return function(){var t=this,o=t._parent;t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,e.call(this),t._stereo?o.stereo(t._stereo):t._pos&&o.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,o=t._parent;return t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,t._stereo?o.stereo(t._stereo):t._pos?o.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,o._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();var It={};It=new URL(i("27Lyk").resolve("8Qic0"),import.meta.url).toString();var Et={};Et=new URL(i("27Lyk").resolve("aSqJ5"),import.meta.url).toString();var Wt={};Wt=new URL(i("27Lyk").resolve("hMICc"),import.meta.url).toString();var Dt={};Dt=new URL(i("27Lyk").resolve("cFOzA"),import.meta.url).toString();var Ft={};Ft=new URL(i("27Lyk").resolve("iP5rH"),import.meta.url).toString();var Gt={};Gt=new URL(i("27Lyk").resolve("4cgQm"),import.meta.url).toString();var Ut={};Ut=new URL(i("27Lyk").resolve("5uP20"),import.meta.url).toString();var Vt={};Vt=new URL(i("27Lyk").resolve("koWqL"),import.meta.url).toString();var Ot={};Ot=new URL(i("27Lyk").resolve("drQCs"),import.meta.url).toString();var zt={};zt=new URL(i("27Lyk").resolve("aKQuT"),import.meta.url).toString();const Bt=[i("iTab4"),i("87bT4"),i("eN2P4"),i("8A7kA"),i("9bbmx"),i("V8ahV"),i("hadbD"),i("dH5ka"),i("3twvr"),i("bBbdi")],Nt=[i("kBrAM"),i("k6Tdk"),i("vDQ5G"),i("7DVvx"),i("al4v1"),i("fO2Fk"),i("kaxMC")],Yt=[i("fO2Fk")],Xt=[i("lsnFy"),i("iSQf2"),i("9W6vc"),i("h5cAV"),i("71dbC")],qt=[i("iOIx8"),i("5HSVp"),i("gjhQR"),i("9yWXC"),i("8wZYi"),i("lLaFn"),i("91Ssr"),i("iPqLJ")],jt=[i("aYURT"),i("28SI0"),i("2v7tx"),i("2ab9R")],$t=[i("5mxOT"),i("6zU4W")],Kt=[i("c5gUn"),i("pgODr"),i("2CXE7"),i("6IDgr"),i("sYECX"),i("5SG7D")],Qt=[i("b3a1B"),i("hNZg3"),i("f54Wu"),i("lLVHT"),i("4n1uh")],Jt=[i("9h7xU"),i("jiU0R")],Zt=[i("alx6Z"),i("ijwXJ")],eo=[[i("a2kyU"),"Hmm..."],[i("5d0DW"),"What?"],[i("dxMYB"),"Hey!"],[i("baOJW"),"Hey!"],[i("k2iei"),"Hey!"],[i("3x4yY"),"What was that?"],[i("egNqT"),"What was that?"],[i("QVkvm"),"What was that?"],[i("ggzCL"),"What was that?"],[i("h8bVj"),"What was that?"],[i("1NOTS"),"Who goes there?"],[i("6wdzE"),"Huh?"],[i("5d0DW"),"What?"],[i("7Bgvb"),"Wha..."],[i("cc8Co"),"Wait!"],[i("3Vwq5"),"Who's out there?"],[i("bk6h6"),"What moved?"],[i("7Du7Q"),"What' in the shadows?"],[i("aTKjT"),"Did the shadows move?"],[i("8P0kg"),"Did I see something?"],[i("fyl73"),"Hello?"],[i("j5ffj"),"Ugh..."]],to=[[i("a2kyU"),"Hmm..."],[i("5d0DW"),"What?"],[i("3x4yY"),"What was that?"],[i("40XLk"),"Quiet out..."],[i("k4RLX"),"Jumpy tonight..."],[i("34gKi"),"I'm jumpin' at shadows..."],[i("9L8Sg"),"Ahh..."],[i("9L8Sg"),"Ahh..."],[i("a2kyU"),"Hmm..."],[i("5Fjgc"),"Aww..."],[i("7jABT"),"Rest me bones..."],[i("fgE4t"),"Oh well..."],[i("gGzmW"),"Case of the jitters..."],[i("aUMGA"),"Must be seeing..."],[i("hAB2v"),"What's in my coffee today?"],[i("j1q3e"),"Coffee must be too strong!"],[i("cp5Da"),"Hmm nothing..."],[i("k9vCo"),"Well I though I saw something."],[i("fzAkK"),"Nothing..."],[i("2mcEF"),"Hopefully nothing."],[i("2lUVX"),"Must be seeing things..."],[i("2lUVX"),"I must be seeing things."]],oo=[[i("a2kyU"),"Hmm..."],[i("5d0DW"),"What?"],[i("bR2Qq"),"What?"],[i("dxMYB"),"Hey!"],[i("baOJW"),"Hey!"],[i("k2iei"),"Hey!"],[i("3x4yY"),"What was that?"],[i("egNqT"),"What was that?"],[i("QVkvm"),"What was that?"],[i("ggzCL"),"What was that?"],[i("h8bVj"),"What was that?"],[i("6wdzE"),"Huh?"],[i("5d0DW"),"What?"],[i("7Bgvb"),"Wha..."],[i("cc8Co"),"Wait!"],[i("3Vwq5"),"Who's out there?"],[i("fyl73"),"Hello?"],[i("j5ffj"),"Ugh..."],[i("4tABs"),"Hark?"],[i("4eWcK"),"What was that noise?"],[i("2IlHA"),"I heard something..."]],no=[[i("a2kyU"),"Hmm..."],[i("3x4yY"),"What was that?"],[i("40XLk"),"Quiet out..."],[i("k4RLX"),"Jumpy tonight..."],[i("9L8Sg"),"Ahh..."],[i("9L8Sg"),"Ahh..."],[i("a2kyU"),"Hmm..."],[i("5Fjgc"),"Aww..."],[i("7jABT"),"Rest me bones..."],[i("fgE4t"),"Oh well..."],[i("gGzmW"),"Case of the jitters..."],[i("hAB2v"),"What's in my coffee today?"],[i("j1q3e"),"Coffee must be too strong!"],[i("cp5Da"),"Hmm nothing..."],[i("b4oBR"),"Can't hear it now."],[i("fzAkK"),"Nothing..."],[i("2mcEF"),"Hopefully nothing."],[i("bEpX3"),"I must be hearing things."]],ro=[[i("a2kyU"),"Hmm..."],[i("dxMYB"),"Hey!"],[i("baOJW"),"Hey!"],[i("k2iei"),"Hey!"],[i("5d0DW"),"What?"],[i("zO13n"),"That noise again?"],[i("hPTSL"),"Someone there?"],[i("5TQSa"),"Who could that be?"],[i("h66m0"),"There it is again."],[i("iXaO0"),"Better check it out."],[i("kZ7gB"),"What keeps making those noises?"],[i("fBP7x"),"Better be rats!"],[i("4iRwq"),"Again!?"],[i("aQaIJ"),"Who is that?"],[i("jI1w6"),"Come out, Come out!"]],io=[[i("a2kyU"),"Hmm..."],[i("34gKi"),"Jumpin' at shadows!"],[i("k4RLX"),"Jumpy!"],[i("fgE4t"),"Oh, well."],[i("7OaPU"),"Guess it was nothing."],[i("eAAPp"),"Wonder what it was."],[i("Z94uH"),"Back to my post."],[i("2GAEF"),"All quiet now."],[i("bl9NP"),"I'm sure I heard something."],[i("avnp8"),"Not there anymore."],[i("2mxOl"),"Probably nothing."],[i("cp5Da"),"Hmm, nothing."],[i("bvdYU"),"I dont know why I work here."],[i("f5YJN"),"Waste of my time."],[i("h733p"),"Why do I even try."],[i("5iRGH"),"At least I'm not on cleaning duty."],[i("bodaa"),"At least my shift ends soon."],[i("jnTTO"),"What do you want me to do about it?"]],so=[[i("k2iei"),"(To other guard) Hey!"],[i("5d0DW"),"(To other guard) What?"],[i("2uhoz"),"(To other guard) Where!?"],[i("4bkfm"),"(To other guard) Coming!"],[i("cBYcL"),"(To other guard) Here I come!"],[i("1ZzuO"),"(To other guard) To arms!"],[i("iYF5j"),"(To other guard) What is it!?"],[i("hSkKy"),"(To other guard) I dont know how to whistle."]],ao=[[i("iCpSW"),"(Whistles to other guards)"],[i("9upNV"),"(Whistles to other guards)"],[i("yZG5v"),"(Whistles to other guards)"],[i("f1guA"),"(Yells) Get 'em!"],[i("83TDO"),"(Yells) Intruder!"],[i("frVxF"),"(Yells) Oh no... it's a thief."],[i("hCPR7"),"(Yells) We're coming for you!"],[i("4Za6U"),"(Yells) Coming for you!"],[i("3Xk6I"),"(Yells) Halt!"],[i("dosUm"),"(Yells) We see you!"],[i("4gdwQ"),"(Yells) I'll get you!"],[i("aLkfr"),"(Yells) You're a goner!"],[i("kSLiP"),"(Yells) Just you wait!"],[i("2IENo"),"(Yells) You won't get away!"],[i("1CFiH"),"(Yells) No you dont!"],[i("llhgm"),"(Yells) Thief!"],[i("2eW7L"),"(Yells) Thief!"],[i("kZcsz"),"(Yells) Thief!"],[i("2qpAR"),"(Yells) After them!"],[i("cAyqi"),"(Yells) What is thy business with this gold?"],[i("aEQTO"),"(Yells) No mercy for the wicked!"]],lo=[[i("ijfWN"),"Lost 'em!"],[i("7sWca"),"Must have run off..."],[i("fgE4t"),"Oh, well..."],[i("fevkE"),"Where did they go?"],[i("1B1JN"),"His Holiness would not be pleased!"],[i("jnuCJ"),"The boss will not be pleased!"],[i("cmvWY"),"(Huffing) I give up!"],[i("hMHBo"),"Where did he go!?"],[i("9Nz7S"),"Drats lost him!"],[i("9tCyg"),"Gone!"],[i("7ryfo"),"Come back here!"],[i("eLXb8"),"Rotten scoundrel!"],[i("8uLuu"),"Aargh!!"],[i("io7hj"),"He's not coming back!"],[i("8Mr4t"),"Blast!"],[i("3gcK8"),"Don't come back!"],[i("3N27a"),"You won't get away next time!"],[i("i8RlJ"),"His Holiness is a lord of mercy!"],[i("4vw0X"),"What a lousy day at work!"],[i("6aNdh"),"I give up..."],[i("i6vQ5"),"What do I do help me, help me..."],[i("5PMpx"),"Oh no, he got away!"],[i("2DFDi"),"(Guard rant)"]],uo=[[i("9L8Sg"),"(Yelling) Someone smacked me!"],[i("9L8Sg"),"(Yelling) Someone hit me!"],[i("9L8Sg"),"(Yelling) Who hit me!?"]],co=[[i("9L8Sg"),"(Yelling) We have a guard down"],[i("9L8Sg"),"(Yelling) Man down!"],[i("9L8Sg"),"(Yelling) Guard down!"]],po=[[i("9L8Sg"),"(Guard stirring) Ahh..."]],ho=[[i("83TDO"),"We must have an intruder!"],[i("83TDO"),"I will keep an eye out!"]],mo=[[i("527nu"),"Take that!!"],[i("54HwM"),"Oof!!"],[i("4e6QO"),"Ugg!!"],[i("7k3tw"),"Ahh!!"],[i("fcDaw"),"Ahh!!"],[i("fty2x"),"Hi-yah!"],[i("jFsow"),"Hi-yah!"],[i("cMmoo"),"Hi-yah!"]];class fo{constructor(){this.activeHowls=[],this.activeLimit=2,this.fadeTime=1e3}setFadetime(e=1e3){return this.fadeTime=e,this}fade(e,t){return this.fadeTime>0?(e.fade(1,0,this.fadeTime,t),setTimeout((()=>e.stop(t)),this.fadeTime)):e.stop(t),this}empty(){for(let e of this.activeHowls)this.fade(...e);return this.activeHowls=[],this}queue(e,t){if(this.activeHowls.unshift([e,t]),this.activeHowls.length>this.activeLimit){const e=this.activeHowls.pop();this.fade(...e)}return this.activeHowls=this.activeHowls.slice(0,this.activeLimit),this}}class go{constructor(e,t=null){this.howls=e.map((e=>new Ct({src:[e]}))),this.howlNum=0,this.soundPool=t,_(this.howls)}play(e){const t=this.next();t.volume(e);try{const e=t.play();return null!==this.soundPool&&this.soundPool.queue(t,e),e}catch(e){console.log(`Audio playback error ${t}`,e)}return-1}next(){return this.howlNum++,this.howlNum==this.howls.length&&(this.howlNum=0,_(this.howls)),this.howls[this.howlNum]}}class yo{constructor(e,t=null){this.sounds=e.map(vo),this.soundNum=0,this.soundPool=t,this.mute=!1,_(this.sounds)}play(e){const t=this.next();if(!this.mute){t.sound.volume(e);const o=t.sound.play();null!==this.soundPool&&this.soundPool.queue(t.sound,o)}return t}next(){const e=this.sounds[this.soundNum];return++this.soundNum,this.soundNum===this.sounds.length&&(this.soundNum=0,_(this.sounds)),e}}function vo(e){return{sound:new Ct({src:[e[0]]}),subtitle:e[1]}}function _o(e,t,o){e.footstepWood=new go([Gt]),e.footstepTile=new go([Ut]),e.footstepWater=new go([Vt]),e.footstepGravel=new go([Ot]),e.footstepGrass=new go([zt]),e.footstepCreaky=new go(Bt),e.victorySong=new go([It]),e.levelRequirementJingle=new go([Et],o),e.levelCompleteJingle=new go([Wt],o),e.gameOverJingle=new go([Dt],o),e.easterEgg=new go([Ft],o),e.hitPlayer=new go(Nt),e.hitGuard=new go(Yt),e.coin=new go(Xt),e.grunt=new go(qt),e.douse=new go(jt),e.ignite=new go($t),e.hide=new go(Kt),e.gate=new go(Qt),e.jump=new go(Jt),e.tooHigh=new go(Zt),t.guardInvestigate=new yo(ro,o),t.guardFinishInvestigating=new yo(io,o),t.guardSeeThief=new yo(eo),t.guardFinishLooking=new yo(to,o),t.guardChase=new yo(ao,o),t.guardEndChase=new yo(lo,o),t.guardHearGuard=new yo(so,o),t.guardHearThief=new yo(oo,o),t.guardAwakesWarning=new yo(uo,o),t.guardDownWarning=new yo(co,o),t.guardWarningResponse=new yo(ho,o),t.guardFinishListening=new yo(no,o),t.guardDamage=new yo(mo,o),t.guardStirring=new yo(po,o)}const xo={left:!1,right:!1,up:!1,down:!1,jumpLeft:!1,jumpRight:!1,jumpUp:!1,jumpDown:!1,los:!1,wait:!1,jump:!1,zoomIn:!1,zoomOut:!1,snapToPlayer:!1,panUp:!1,panDown:!1,panLeft:!1,panRight:!1,menu:!1,menuNext:!1,menuPrev:!1,menuClose:!1,home:!1,homePlay:!1,homeDaily:!1,homeStats:!1,homeOptions:!1,jumpToggle:!1,restart:!1,heal:!1,startLevel:!1,exitLevel:!1,guardMute:!1,volumeMute:!1,volumeDown:!1,volumeUp:!1,forceRestart:!1,resetState:!1,seeAll:!1,collectLoot:!1,markSeen:!1,guardSight:!1,guardPatrols:!1,nextLevel:!1,prevLevel:!1,gamepadStyleTouch:!1,fullscreen:!1,serverConfig:!1,today:!1,priorDay:!1,nextDay:!1,scrollUp:!1,scrollDown:!1},wo={...xo};var So=null;const To={BracketLeft:["zoomOut"],BracketRight:["zoomIn"],ArrowLeft:["left","menuPrev"],KeyA:["left","menuPrev"],Numpad4:["left","menuPrev"],ArrowRight:["right","menuNext"],KeyX:["home"],KeyP:["homePlay"],KeyO:["homeOptions"],KeyD:["right","homeDaily","menuNext"],Numpad6:["right","menuNext"],KeyL:["right","menuNext"],ArrowUp:["up"],KeyW:["up"],Numpad8:["up"],KeyK:["up"],ArrowDown:["down"],KeyS:["down","homeStats"],Numpad2:["down"],KeyJ:["down"],Period:["wait"],Space:["wait"],KeyZ:["wait"],Shift:["jump"],KeyF:["jumpToggle","fullscreen"],NumpadAdd:["jumpToggle","nextDay"],NumpadSubtract:["priorDay"],KeyT:["gamepadStyleTouch"],Escape:["menu","menuClose"],Slash:["menu","menuClose"],KeyR:["restart"],KeyC:["copyScore"],"Control+KeyC":["copyScore"],KeyH:["heal"],KeyN:["startLevel"],Digit9:["guardMute"],Digit0:["volumeMute","today"],Minus:["volumeDown","priorDay"],Equal:["volumeUp","nextDay"],PageUp:["scrollUp"],PageDown:["scrollDown"],"Control+Space":["snapToPlayer"],"Control+Period":["snapToPlayer"],"Control+ArrowUp":["panUp"],"Control+KeyW":["panUp"],"Control+KeyJ":["panUp"],"Control+Numpad8":["panUp"],"Control+ArrowDown":["panDown"],"Control+KeyS":["panDown"],"Control+KeyK":["panDown"],"Control+Numpad2":["panDown"],"Control+ArrowLeft":["panLeft"],"Control+KeyA":["panLeft"],"Control+KeyH":["panLeft"],"Control+Numpad4":["panLeft"],"Control+ArrowRight":["panRight"],"Control+KeyD":["panRight"],"Control+KeyL":["panRight"],"Control+Numpad6":["panRight"],"Control+KeyR":["forceRestart"],"Alt+KeyR":["resetState"],"Alt+KeyA":["seeAll"],"Alt+KeyC":["collectLoot"],"Alt+KeyS":["markSeen"],"Alt+KeyV":["guardSight"],"Alt+KeyP":["guardPatrols"],"Alt+Comma":["prevLevel"],"Alt+Period":["nextLevel"]};class Mo extends Array{constructor(e=0,t=0,o=0,n=0){super(e,t,o,n)}collide(e,t,o=0,n=0){return this[0]<e+o&&this[0]+this[2]>e&&this[1]<t+n&&this[1]+this[3]>t}}class Lo{preventDefault=!0;currentFramePresses=new Set;currentFrameReleases=new Set;constructor(){this.controlStates={...wo},this.controlTimes={};for(const e in this.controlStates)this.controlTimes[e]=Date.now()}set(e,t=!0,o=!0){this.controlStates[e]=t,xo[e]=t,this.controlTimes[e]=Date.now(),o&&(t?this.currentFramePresses.add(e):this.currentFrameReleases.add(e)),So=this}endFrame(){this.currentFramePresses.clear(),this.currentFrameReleases.clear()}vibrate(e,t,o){}}class Ao extends Lo{constructor(e=null){super(),null==e&&(e=To),this.keyMap=e;let t=this;const o=document.querySelector("html");o&&(o.onkeydown=function(e){t.keyDownHandler(e)},o.onkeyup=function(e){t.keyUpHandler(e)})}getCode(e,t=!1){let o=e.code;return e.altKey&&"AltLeft"!==e.code&&"AltRight"!==e.code&&(o="Alt+"+o),e.shiftKey&&t&&"ShiftLeft"!==e.code&&"ShiftRight"!==e.code&&(o="Shift+"+o),e.ctrlKey&&"ControlLeft"!==e.code&&"ControlRight"!==e.code&&(o="Control+"+o),"AltLeft"!=e.code&&"AltRight"!=e.code||(o="Alt"),"ShiftLeft"!=e.code&&"ShiftRight"!=e.code||(o="Shift"),"ControlLeft"!=e.code&&"ControlRight"!=e.code||(o="Control"),o}updateModifierDown(e){for(let t in this.keyMap){const o=this.keyMap[t];for(let n of o)!t.includes(e)&&this.controlStates[n]&&(this.controlStates[n]=!1)}}updateModifierUp(e){for(let t in this.keyMap){const o=this.keyMap[t];for(let n of o)t.includes(e)&&this.controlStates[n]&&(this.controlStates[n]=!1)}}keyDownHandler(e){So=this;const t=this.getCode(e);if(["Alt","Control"].includes(t)&&this.updateModifierDown(t),t in this.keyMap){this.preventDefault&&e.preventDefault();const o=this.keyMap[t];for(let e of o)this.controlStates[e]||this.set(e,!0)}}keyUpHandler(e){const t=this.getCode(e);if(["Alt","Control"].includes(t)&&this.updateModifierUp(t),t in this.keyMap){this.preventDefault&&e.preventDefault();const o=this.keyMap[t];for(let e of o)this.set(e,!1)}}}class bo extends Lo{constructor(e){super(),this.gamepad=e,this.thresh=.4,this.internalStates={...this.controlStates}}set(e,t=!0){this.internalStates[e]!=t&&(this.internalStates[e]=t,super.set(e,t))}vibrate(e,t,o){}}class Ro{constructor(){let e=this;window.addEventListener("gamepadconnected",(function(t){e.connected(t)})),window.addEventListener("gamepaddisconnected",(function(t){e.disconnected(t)})),this.gamepads={}}connected(e){this.gamepads[e.gamepad.index]=new bo(e.gamepad)}disconnected(e){this.gamepads[e.gamepad.index];delete this.gamepads[e.gamepad.index]}updateGamepadStates(){let e=navigator.getGamepads();if(null!=e)for(let t of e){if(null==t)continue;let e=this.gamepads[t.index];e.gamepad=t,e.set("jump",ko(t,0)),e.set("wait",ko(t,2)),e.set("zoomIn",ko(t,6)),e.set("zoomOut",ko(t,7)),e.set("fullscreen",ko(t,8)),e.set("menu",ko(t,9)),e.set("left",ko(t,14)||t.axes[0]<-e.thresh&&t.axes[0]<-.5*Math.abs(t.axes[1])),e.set("right",ko(t,15)||t.axes[0]>e.thresh&&t.axes[0]>.5*Math.abs(t.axes[1])),e.set("up",ko(t,12)||t.axes[1]<-e.thresh&&t.axes[1]<-.5*Math.abs(t.axes[0])),e.set("down",ko(t,13)||t.axes[1]>e.thresh&&t.axes[1]>-.5*Math.abs(t.axes[0])),e.set("panLeft",t.axes[2]<-e.thresh&&t.axes[2]<-.5*Math.abs(t.axes[3])),e.set("panRight",t.axes[2]>e.thresh&&t.axes[2]>.5*Math.abs(t.axes[3])),e.set("panUp",t.axes[3]<-e.thresh&&t.axes[3]<-.5*Math.abs(t.axes[2])),e.set("panDown",t.axes[3]>e.thresh&&t.axes[3]>-.5*Math.abs(t.axes[2]))}}}function ko(e,t){return t<e.buttons.length&&e.buttons[t].pressed}class Ho extends Lo{mouseActive=!1;targetOnTouchDown=null;constructor(e,t){super(),this.canvas=e;let o=this;e.addEventListener("touchstart",(function(e){o.process_touchstart(e)}),!0),e.addEventListener("touchmove",(function(e){o.process_touchmove(e)}),!0),e.addEventListener("touchcancel",(function(e){o.process_touchend(e)}),!0),e.addEventListener("touchend",(function(e){o.process_touchend(e)}),!0),e.addEventListener("mousedown",(function(e){o.process_mousedown(e)}),!0),e.addEventListener("mouseup",(function(e){o.process_mouseup(e)}),!0),e.addEventListener("mousemove",(function(e){o.process_mousemove(e)}),!0);this.screenDimensions=[0,0],this.lastMotion={id:-1,active:!1,x0:0,y0:0,x:0,y:0},this.coreTouchTargets={up:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},down:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},left:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},right:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jumpUp:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jumpDown:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jumpLeft:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jumpRight:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},wait:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},exitLevel:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jump:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},pan:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},zoomIn:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},zoomOut:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},restart:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},forceRestart:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},menu:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},fullscreen:{id:-1,active:!0,view:new Mo,game:new Mo,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null}},this.touchTargets=this.coreTouchTargets,this.setTouchConfig(t)}setTouchConfig(e){if(e){for(let e of["up","down","left","right","wait","jump","pan"])this.coreTouchTargets[e].trigger="press",this.coreTouchTargets[e].show="always";for(let e of["jumpUp","jumpDown","jumpLeft","jumpRight"])this.coreTouchTargets[e].trigger="press",this.coreTouchTargets[e].show="press"}else{for(let e of["exitLevel"])this.coreTouchTargets[e].trigger="press",this.coreTouchTargets[e].show="always";for(let e of["up","down","left","right","pan","jumpUp","jumpDown","jumpLeft","jumpRight","wait","jump"])this.coreTouchTargets[e].trigger="release",this.coreTouchTargets[e].show="press"}}clearMotion(){this.lastMotion.active=!1,this.lastMotion.id=-1,this.lastMotion.x0=0,this.lastMotion.y0=0,this.lastMotion.x=0,this.lastMotion.y=0,this.targetOnTouchDown=null}updateCoreTouchTarget(e,t,o,n){const r=this.coreTouchTargets[e];r.view=o,r.game=t,r.tileInfo=n,r.view.collide(r.touchXY[0],this.canvas.clientHeight-r.touchXY[1])||this.controlStates[e]&&-1!=r.id&&(this.set(e,!1,!1),r.id=-1)}activateTouchTargets(e){this.touchTargets=void 0===e?this.coreTouchTargets:{...this.coreTouchTargets,...e}}process_mousedown(e){So=this,this.mouseActive=!0,this.lastMotion.id=-2,this.lastMotion.active=!1,this.lastMotion.x0=e.clientX,this.lastMotion.y0=this.canvas.clientHeight-e.clientY,this.lastMotion.x=e.clientX,this.lastMotion.y=this.canvas.clientHeight-e.clientY,this.targetOnTouchDown=null;for(let t in this.touchTargets){let o=this.touchTargets[t];o.view.collide(e.clientX,this.canvas.clientHeight-e.clientY)&&(o.touchXY=[e.clientX,e.clientY],o.id=-2,this.set(t,!0),this.targetOnTouchDown=t)}this.preventDefault&&e.preventDefault()}process_mousemove(e){So=this,this.mouseActive=!0,-2==this.lastMotion.id&&(this.lastMotion.active=!0,this.lastMotion.x=e.clientX,this.lastMotion.y=this.canvas.clientHeight-e.clientY);for(let t in this.touchTargets){let o=this.touchTargets[t];if(-2==o.id){o.view.collide(e.clientX,this.canvas.clientHeight-e.clientY)?o.touchXY=[e.clientX,e.clientY]:(this.set(t,!1,!1),o.id=-1)}else if("release"==o.trigger&&(null==this.targetOnTouchDown||this.targetOnTouchDown==t)){o.view.collide(e.clientX,this.canvas.clientHeight-e.clientY)&&(o.touchXY=[e.clientX,e.clientY],this.set(t,!0),o.id=-2)}}this.preventDefault&&e.preventDefault()}process_mouseup(e){for(const e in this.touchTargets){const t=this.touchTargets[e];this.controlStates[e]&&(t.id=-1,this.set(e,!1,"press"===t.trigger||e===this.targetOnTouchDown),this.controlTimes[e]=0)}this.clearMotion(),this.preventDefault&&e.preventDefault()}process_touchstart(e){So=this,this.mouseActive=!1,this.targetOnTouchDown=null;for(let t of e.changedTouches){this.lastMotion.id=t.identifier,this.lastMotion.active=!1,this.lastMotion.x0=t.clientX,this.lastMotion.y0=this.canvas.clientHeight-t.clientY,this.lastMotion.x=t.clientX,this.lastMotion.y=this.canvas.clientHeight-t.clientY;for(let e in this.touchTargets){let o=this.touchTargets[e];o.view.collide(t.clientX,this.canvas.clientHeight-t.clientY)&&(o.touchXY=[t.clientX,t.clientY],o.id=t.identifier,this.targetOnTouchDown=e,this.set(e,!0))}}this.preventDefault&&e.preventDefault()}process_touchmove(e){this.mouseActive=!1;for(let t of e.changedTouches){this.lastMotion.id==t.identifier&&(this.lastMotion.active=!0,this.lastMotion.x=t.clientX,this.lastMotion.y=this.canvas.clientHeight-t.clientY);for(let e in this.touchTargets){let o=this.touchTargets[e];if(o.id==t.identifier){o.view.collide(t.clientX,this.canvas.clientHeight-t.clientY)?o.touchXY=[t.clientX,t.clientY]:(o.id=-1,this.set(e,!1,!1))}else if(-1==o.id&&"release"==o.trigger&&(null==this.targetOnTouchDown||this.targetOnTouchDown==e)){o.view.collide(t.clientX,this.canvas.clientHeight-t.clientY)&&(o.touchXY=[t.clientX,t.clientY],o.id=t.identifier,this.set(e,!0))}}}this.preventDefault&&e.preventDefault()}process_touchend(e){this.mouseActive=!1;for(let t of e.changedTouches){for(const e in this.touchTargets){const o=this.touchTargets[e];o.id==t.identifier&&(o.id=-1,this.set(e,!1,"press"===o.trigger||e===this.targetOnTouchDown),this.controlTimes[e]=0)}this.lastMotion.id==t.identifier&&this.clearMotion()}this.preventDefault&&e.preventDefault()}vibrate(e,t,o){window.navigator.vibrate(o)}}let Po;var Co;function Io(e){const t=e.lootStolen,o=e.maxLootStolen,n=e.ghostBonuses,r=e.maxGhostBonuses,i=e.timeBonuses,s=e.maxTimeBonuses,a=e.lootSpent,l=e.loot,u=e.turns,c=e.level,d=e.win,p=e.daily,h=null!==p?"📅 Daily run for "+p:"🎲 Random game",m=d?"Completed mission in "+u+" turns.":"💀 Died in mansion "+c+" after "+u+" turns.",f=d?`Walked away with ${l} 🪙.`:`Guards recovered ${l} 🪙 that you stole.`;navigator.clipboard.writeText(`🏛️ Lurk Leap Loot 🏛️\n${h}\n${m}\n🪙 stolen:   ${t} / ${o}\n🥷 bonuses:  ${n} / ${r}\n🕰️ bonuses:  ${i} / ${s}\n🪙 spent:    ${a}\n\n`+f)}(Co=Po||(Po={}))[Co.HomeScreen=0]="HomeScreen",Co[Co.StatsScreen=1]="StatsScreen",Co[Co.OptionsScreen=2]="OptionsScreen",Co[Co.Mansion=3]="Mansion",Co[Co.BetweenMansions=4]="BetweenMansions",Co[Co.Dead=5]="Dead",Co[Co.Win=6]="Win",Co[Co.DailyHub=7]="DailyHub",Co[Co.ServerConfig=8]="ServerConfig";class Eo{pages=[];activePage=0;activePageData=[];highlightedAction=-1;actionSequence=[];cachedPageText="";touchTargetsDirty=!1;state={};glyphs=[];maxLineLength=0;scaleLargestX=0;scaleLargestY=0;scaleFactor=0;pixelsPerCharX=0;pixelsPerCharY=0;linesPixelSizeX=0;linesPixelSizeY=0;numCharsX=0;numCharsY=0;offsetX=0;offsetY=0;textW=8;textH=16;constructor(){this.mat=a.create(),this.screenSize=s.create(),this.touchTargets={}}initAction(e){this.touchTargets[e]={id:-1,active:!0,game:new Mo(0,0,0,0),view:new Mo(0,0,0,0),trigger:"release",tileInfo:{},show:"always",touchXY:[-1,-1]}}nextPage(){this.activePage=Math.min(this.pages.length-1,this.activePage+1),this.touchTargetsDirty=!0}prevPage(){this.activePage=Math.max(0,this.activePage-1),this.touchTargetsDirty=!0}parseImage(e,t,o,n){const r=e.slice(t+2).indexOf("#");if(r<0)return[e,t];const i=Number(e.slice(t+1,t+2+r));return Number.isNaN(i)?[e,t]:(this.glyphs.push([i,new Mo(t,n-o-.875,2,1)]),[e=e.slice(0,t)+"  "+e.slice(t+3+r),t+1])}parseButton(e,t,o,n){const r=t;let i,s;for(;;){if(i=e.slice(t).indexOf("|"),i<0)return[e,t];if(i+=t,s=e.slice(i+1).indexOf("]"),s<0)return[e,t];if(s+=i+1,t===i)break;"#"===e[t]&&([e,t]=this.parseImage(e,t,o,n)),t+=1}const a=e.slice(i+1,s);if(void 0!==a&&""!==a){a in this.touchTargets||this.initAction(a);const e=[r,t+1,o],[i,s]=[e[0],e[2]-1/8],[l,u]=[e[1],e[2]+1];this.touchTargets[a].game=new Mo(i,n-u,l-i,u-s),this.actionSequence.push(a)}return[e=e.slice(0,i)+e.slice(s),t=i]}parseUI(){let e=this.pages[this.activePage];const t=this.state;for(const o in t)e=e.replace("$"+o+"$",String(t[o]));if(e===this.cachedPageText)return;this.cachedPageText=e,this.activePageData=e.split("\n");const o=this.activePageData;this.glyphs.length=0,this.actionSequence=[],this.touchTargets={};for(let e=0;e<o.length;++e){let t=o[e],n=0;for(;n<t.length;){switch(t[n]){case"#":[t,n]=this.parseImage(t,n,e,o.length);break;case"[":[t,n]=this.parseButton(t,n,e,o.length)}n+=1}o[e]=t}}updateScreenSize(e){this.screenSize=e,this.maxLineLength=0;for(const e of this.activePageData)this.maxLineLength=Math.max(this.maxLineLength,e.length);this.scaleLargestX=Math.max(1,Math.floor(e[0]/(65*this.textW))),this.scaleLargestY=Math.max(1,Math.floor(e[1]/(22*this.textH))),this.scaleFactor=Math.min(this.scaleLargestX,this.scaleLargestY),this.pixelsPerCharX=8*this.scaleFactor,this.pixelsPerCharY=16*this.scaleFactor,this.linesPixelSizeX=this.maxLineLength*this.pixelsPerCharX,this.linesPixelSizeY=this.activePageData.length*this.pixelsPerCharY,this.numCharsX=e[0]/this.pixelsPerCharX,this.numCharsY=e[1]/this.pixelsPerCharY,this.offsetX=Math.floor((e[0]-this.linesPixelSizeX)/-2)/this.pixelsPerCharX,this.offsetY=Math.floor((e[1]-this.linesPixelSizeY)/-2)/this.pixelsPerCharY,this.mat=a.create(),a.ortho(this.mat,this.offsetX,this.offsetX+this.numCharsX,this.offsetY,this.offsetY+this.numCharsY,1,-1)}pixelCoords(e){return[(e[0]-this.offsetX)*this.pixelsPerCharX,(e[1]-this.offsetY)*this.pixelsPerCharY]}textCoords(e){return[e[0]/this.pixelsPerCharX+this.offsetX,e[1]/this.pixelsPerCharY+this.offsetY]}getTouchData(){for(let e in this.touchTargets){const t=this.touchTargets[e],o=t.game,[n,r]=this.pixelCoords([o[0],o[1]]),[i,s]=this.pixelCoords([o[2]+o[0],o[3]+o[1]]);t.view=new Mo(n,r,i-n-1,s-r-1)}return this.touchTargets}render(e){const t=this.activePageData,o=this.mat,n=this.maxLineLength,r=bt().background;e.start(o,0),e.addGlyph(-2,-1,n+2,t.length+1,r),e.flush(),e.start(o,0);for(let t in this.touchTargets){const o=this.touchTargets[t].game;if(So?.controlStates[t]&&(this.highlightedAction=this.actionSequence.indexOf(t)),this.touchTargets[t].active){const n=this.actionSequence[this.highlightedAction]===t?4291829936:4286586976;e.addGlyph(o[0],o[1],o[0]+o[2],o[1]+o[3],{textureIndex:r.textureIndex,color:n})}else this.actionSequence[this.highlightedAction]===t&&e.addGlyph(o[0],o[1],o[0]+o[2],o[1]+o[3],{textureIndex:r.textureIndex,color:4285558896})}e.flush(),e.start(o,1);for(const t of this.glyphs){const o=t[1];e.addGlyph(o[0],o[1],o[2]+o[0],o[3]+o[1],{textureIndex:t[0],color:Mt})}e.flush(),e.start(o,0);for(let o=0;o<t.length;++o){const n=t.length-(1+o);for(let r=0;r<t[o].length;++r){const i=r;if(" "===t[o])continue;const s=t[o].charCodeAt(r);e.addGlyph(i,n,i+1,n+1,{textureIndex:s,color:4293849343})}}e.flush()}updateData(e){}update(e){}navigateUI(e){let t="";return e("up")?(this.highlightedAction--,this.highlightedAction<0&&(this.highlightedAction=this.actionSequence.length-1)):e("down")?(this.highlightedAction++,this.highlightedAction>=this.actionSequence.length&&(this.highlightedAction=0)):(this.highlightedAction>=0&&this.touchTargets[this.actionSequence[this.highlightedAction]]?.active&&e("wait")||e("jump"))&&(t=this.actionSequence[this.highlightedAction]),t}onControls(e,t){}}class Wo extends Eo{pages=["             Lurk Leap Loot\n     James McNeill and Damien Moore       \n\n            [P|homePlay]:        Play game\n            [D|homeDaily]:  Daily challenge\n            [S|homeStats]:       Statistics\n            [O|homeOptions]:          Options"];constructor(){super()}update(e){}onControls(e,t){const o=this.navigateUI(t);(t("homePlay")||"homePlay"==o)&&(e.rng=new y,e.dailyRun=null,En(e)),t("homeDaily")||"homeDaily"==o?e.gameMode=Po.DailyHub:t("homeStats")||"homeStats"==o?e.gameMode=Po.StatsScreen:(t("homeOptions")||"homeOptions"==o)&&(e.gameMode=Po.OptionsScreen)}}class Do extends Eo{pages=["                  Options\n\n[T|gamepadStyleTouch]      Touch controls as $touchMode$\n[Ctrl+R|forceRestart] Reset data\n\n[Esc|menu]    Back to menu"];update(e){let t=window.localStorage.getItem("LLL/touchMode");null===t&&(t=e.touchAsGamepad?"Gamepad":"Mouse",window.localStorage.setItem("LLL/touchMode",t)),this.state.touchMode=t}onControls(e,t){const o=this.navigateUI(t);if(t("menu")||"menu"==o)e.gameMode=Po.HomeScreen;else if(t("gamepadStyleTouch")||"gamepadStyleTouch"==o){"Gamepad"==window.localStorage.getItem("LLL/touchMode")?(e.touchAsGamepad=!1,e.touchController.setTouchConfig(!1),window.localStorage.setItem("LLL/touchMode","Mouse")):(e.touchAsGamepad=!0,e.touchController.setTouchConfig(!0),window.localStorage.setItem("LLL/touchMode","Gamepad"))}else if(t("forceRestart")||"forceRestart"==o){for(let e=0;e<window.localStorage.length;e++){const t=window.localStorage.key(e);t?.startsWith("LLL/")&&window.localStorage.removeItem(t)}e.stats=Pn(),e.gameMode=Po.HomeScreen}}}class Fo extends Eo{pages=["            Daily Challenge for $date$\n\n            $dailyStatus$\n            $playMode$\n\n            Last game played:   $lastPlayed$\n            Last score:         $lastScore$\n            [C|copyScore] Copy last game to clipboard\n            $copyState$\n            Best winning score: $bestScore$\n            Total daily runs:   $dailyPlays$\n            Total daily wins:   $dailyWins$\n            Perfect runs:       $dailyPerfect$\n            Win streak:         $dailyWinStreak$\n\n\n                                        [Esc|menuClose] Back to menu"];scoreTablePos=0;scoreTableCount=8;scoreTableDate=null;endTimeForDate(e){const t=new Date(e);return t.setUTCHours(24,0,0,0),t}prevDay(e){const t=new Date(e);return t.setDate(t.getDate()-1),t}nextDay(e){const t=new Date(e);t.setDate(t.getDate()+1);const o=new Date;return o.setUTCHours(24,0,0,0),t>o?e:t}timeToMidnightUTC(){const e=new Date,t=new Date(e);t.setUTCHours(24,0,0,0);const o=t.getTime()-e.getTime();Math.floor(o%1e3/100);var n=Math.floor(o/1e3%60),r=Math.floor(o/6e4%60);return Math.floor(o/36e5%24).toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")}update(e){const t=window.localStorage.getItem("LLL/lastDaily");null!==t&&t===On()?(this.state.dailyStatus="Today's game completed\n            Time to next game: "+this.timeToMidnightUTC(),this.state.playMode="[P|homePlay] Play it again"):(this.state.dailyStatus="[P|homePlay] Play daily game now\n            Time left to play: "+this.timeToMidnightUTC(),this.state.playMode=""),0==this.activePage&&(this.state.date=On()+" UTC",this.state.lastPlayed=e.stats.lastDaily.date,this.state.lastScore=e.stats.lastDaily.score,this.state.bestScore=e.stats.bestDailyScore,this.state.dailyPlays=e.stats.dailyPlays,this.state.dailyWins=e.stats.dailyWins,this.state.dailyPerfect=e.stats.dailyPerfect,this.state.dailyWinStreak=e.stats.dailyWinStreak,"copyState"in this.state||(this.state.copyState=""))}onControls(e,t){const o=this.navigateUI(t);if(t("menu")||"menu"==o||t("menuClose")||"menuClose"==o)e.gameMode=Po.HomeScreen;else if(t("homePlay")||"homePlay"==o){let t=On();if(e.rng=new y("Daily "+t),"T"!==this.state.dailyStatus[0]){window.localStorage.setItem("LLL/lastDaily",t),e.dailyRun=t}else e.dailyRun=null;En(e)}else if(t("copyScore")||"copyScore"==o){const e=kn("lastDaily");e.daily=e.daily??null,e.ghostBonuses=e.ghostBonuses??0,e.maxGhostBonuses=e.maxGhostBonuses??0,e.timeBonuses=e.timeBonuses??0,e.maxTimeBonuses=e.maxTimeBonuses??0,e.lootStolen=e.lootStolen??0,e.maxLootStolen=e.maxLootStolen??0,e.lootSpent=e.lootSpent??0,e.turns=e.turns??0,e.win=e.win??!1,e.level=e.level??1,e.loot=e.loot??0,Io(e),this.state.copyState="    COPIED!",setTimeout((()=>{this.state.copyState=""}),3e3)}}}class Go extends Eo{pages=[`                   Play Statistics\n\n            Total plays:             $totalPlays$\n            Total wins:              $totalWins$\n            Total loot:              $totalGold$\n            Total mansions ghosted:  $totalGhosts$\n            Total mansions looted:   $totalLootSweeps$\n            Best winning score:      $bestScore$\n\n1/2    [#${zo}#|menuPrev] Prev     [#${Bo}#|menuNext] Next     [Esc|menuClose] Back to menu`,`                     Achievements\n\n$achievements$\n\n2/2    [#${zo}#|menuPrev] Prev     [#${Bo}#|menuNext] Next     [Esc|menuClose] Back to menu`];update(e){0==this.activePage?(this.state.totalPlays=e.stats.totalPlays,this.state.totalWins=e.stats.totalWins,this.state.totalGold=e.stats.totalGold,this.state.totalGhosts=e.stats.totalGhosts,this.state.totalLootSweeps=e.stats.totalLootSweeps,this.state.bestScore=e.stats.bestScore):1==this.activePage&&(this.state.achievements="")}onControls(e,t){const o=this.navigateUI(t);t("menu")||"menu"==o||t("menuClose")||"menuClose"==o?e.gameMode=Po.HomeScreen:t("left")||"left"==o||t("menuPrev")||"menuPrev"==o?this.prevPage():(t("right")||"right"==o||t("menuNext")||"menuNext"==o)&&this.nextPage()}}class Uo extends Eo{pages=["   Mansion $level$ Complete!\n\nMansion Statistics\nLoot stolen:     $lootStolen$ / $lootAvailable$\nGhost bonus:     $ghostBonus$\nTimely delivery: $timeBonus$\nMansion total:   $totalScore$\n\nCurrent loot:    $loot$\n[H|heal]: Heal one heart for $$healCost$\n[N|startLevel]: Next mansion"];update(e){this.state.level=e.level+1,this.state.lootStolen=e.lootStolen,this.state.lootAvailable=e.lootAvailable,this.state.ghostBonus=e.ghostBonus,this.state.timeBonus=an(e),this.state.totalScore=this.state.lootStolen+this.state.timeBonus+this.state.ghostBonus,this.state.loot=e.player.loot,this.state.healCost=e.healCost}onControls(e,t){const o=this.navigateUI(t);t("zoomIn")||"zoomIn"==o?(e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1):t("zoomOut")||"zoomOut"==o?(e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1):t("restart")||"restart"==o?(e.rng=new y,e.dailyRun=null,En(e)):t("heal")||"heal"==o?function(e){if(e.player.health>=oe)return;if(e.player.loot<e.healCost)return;e.player.loot-=e.healCost,e.gameStats.lootSpent+=e.healCost,e.player.health+=1,e.healCost*=2}(e):t("startLevel")||"startLevel"==o?sn(e,e.level+1):(t("menu")||"menu"==o)&&(e.helpActive=!0)}}class Vo extends Eo{pages=["         You are dead!\n\nStatistics\nLoot stolen:   $lootStolen$ / $maxLootStolen$\nGhost bonuses: $ghostBonuses$ / $maxGhostBonuses$\nTime bonuses:  $timeBonuses$ / $maxTimeBonuses$\nLoot spent:    $lootSpent$\n\nFinal loot:    $loot$\n\n[R|restart]:   Start new game\n[C|copyScore]:   Copy score to clipboard\n$copyState$\n[Esc|menu]: Exit to home screen"];update(e){this.state.lootStolen=e.gameStats.lootStolen,this.state.maxLootStolen=e.gameStats.maxLootStolen,this.state.ghostBonuses=e.gameStats.ghostBonuses,this.state.maxGhostBonuses=e.gameStats.maxGhostBonuses,this.state.timeBonuses=e.gameStats.timeBonuses,this.state.maxTimeBonuses=e.gameStats.maxTimeBonuses,this.state.lootSpent=e.gameStats.lootSpent,this.state.loot=e.player.loot,"copyState"in this.state||(this.state.copyState="")}onControls(e,t){const o=this.navigateUI(t);t("zoomIn")||"zoomIn"==o?(e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1):t("zoomOut")||"zoomOut"==o?(e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1):t("restart")||"restart"==o?(e.rng=new y,e.dailyRun=null,En(e)):t("menu")||"menu"==o?e.gameMode=Po.HomeScreen:(t("copyScore")||"copyScore"==o)&&(Io(e.gameStats),this.state.copyState="       COPIED!",setTimeout((()=>{this.state.copyState=""}),3e3))}}class Oo extends Eo{pages=["   Mission Complete!\n\nStatistics\nLoot stolen:   $lootStolen$ / $maxLootStolen$\nGhost bonuses: $ghostBonuses$ / $maxGhostBonuses$\nTime bonuses:  $timeBonuses$ / $maxTimeBonuses$\nLoot spent:    $lootSpent$\n\nScore:         $loot$\n\n[R|restartGame]:   Start new game\n[C|copyScore]:   Copy score to clipboard\n$copyState$\n[Esc|menu]: Exit to home screen"];update(e){this.state.lootStolen=e.gameStats.lootStolen,this.state.maxLootStolen=e.gameStats.maxLootStolen,this.state.ghostBonuses=e.gameStats.ghostBonuses,this.state.maxGhostBonuses=e.gameStats.maxGhostBonuses,this.state.timeBonuses=e.gameStats.timeBonuses,this.state.maxTimeBonuses=e.gameStats.maxTimeBonuses,this.state.lootSpent=e.gameStats.lootSpent,this.state.loot=e.player.loot,"copyState"in this.state||(this.state.copyState="")}onControls(e,t){const o=this.navigateUI(t);t("zoomIn")||"zoomIn"==o?(e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1):t("zoomOut")||"zoomOut"==o?(e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1):t("restart")||"restart"==o?(e.rng=new y,e.dailyRun=null,En(e)):t("menu")||"menu"==o?e.gameMode=Po.HomeScreen:(t("copyScore")||"copyScore"==o)&&(Io(e.gameStats),this.state.copyState="       COPIED!",setTimeout((()=>{this.state.copyState=""}),3e3))}}const zo=At().touchButtons.left.textureIndex,Bo=At().touchButtons.right.textureIndex;class No extends Eo{pages=[`Lurk Leap Loot\n\nYour mission from the thieves' guild is to\nmap $numGameMaps$ mansions. You can keep any loot you\nfind ($totalGameLoot$ total).\n\nMansion bonuses:\n- Up to 5 gold for a timely map delivery.\n- 5 gold if you avoid alerting guards.\n\n[X|home] Exit to home screen (abort game)\n\n1/4    [#${zo}#|menuPrev] Prev     [#${Bo}#|menuNext] Next     [Esc|menuClose] Close`,`Keyboard controls\n\n  Move: Arrows / WASD / HJKL\n  Wait: Space / Z / Period / Numpad5\n  Leap: Shift + move\n  Leap (Toggle): F / Numpad+\n  Zoom View: [ / ]\n  Volume: (Mute/Down/Up) 0 / - / =\n  Guard Mute (Toggle): 9\n\nDisable NumLock if using numpad\nMouse, touch and gamepad also supported\n\n2/4    [#${zo}#|menuPrev] Prev     [#${Bo}#|menuNext] Next     [Esc|menuClose] Close`,`Key \n\n#${At().playerTiles.normal.textureIndex}# Thief: You!\n#${At().npcTiles[3].textureIndex}# Guard: Avoid them!\n#${At().itemTiles[Z.Coin].textureIndex}# Loot: Collect for score, or spend to heal\n#${At().itemTiles[Z.Bush].textureIndex}# Tree: Hiding place\n#${At().itemTiles[Z.Table].textureIndex}# Table: Hiding place\n#${At().itemTiles[Z.Chair].textureIndex}# Stool: Not a hiding place\n#${At().itemTiles[Z.TorchLit].textureIndex}# Torch: Guards want them lit\n#${At().terrainTiles[j.OneWayWindowN].textureIndex}# Window: One-way escape route\n#${At().terrainTiles[j.GroundWoodCreaky].textureIndex}# Creaky floorboard: Alerts guards if stepped on\n\n\n3/4    [#${zo}#|menuPrev] Prev     [#${Bo}#|menuNext] Next     [Esc|menuClose] Close`,`Made for 2023 Seven-Day Roguelike Challenge\n\nby James McNeill and Damien Moore\n\nAdditional voices by Evan Moore\nAdditional assistance by Mike Gaffney\nTesting by Tom Elmer\nSpecial thanks to Mendi Carroll\n\n\n\n\n\n4/4    [#${zo}#|menuPrev] Prev     [#${Bo}#|menuNext] Next     [Esc|menuClose] Close`];update(e){this.state.numGameMaps=Yo.numGameMaps,this.state.totalGameLoot=Yo.totalGameLoot}onControls(e,t){const o=this.navigateUI(t);(t("home")||"home"==o)&&(this.activePage=0,e.helpActive=!1,e.gameMode=Po.HomeScreen),t("menu")||"menu"==o||t("menuClose")||"menuClose"==o?(this.activePage=0,e.helpActive=!1):t("zoomIn")||"zoomIn"==o?(e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1):t("zoomOut")||"zoomOut"==o?(e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1):t("fullscreen")||"fullscreen"==o?document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen():t("forceRestart")||"forceRestart"==o?(e.rng=new y,e.dailyRun=null,En(e)):t("gamepadStyleTouch")||"gamepadStyleTouch"==o?(e.touchAsGamepad=!e.touchAsGamepad,e.touchController.setTouchConfig(e.touchAsGamepad),e.topStatusMessage=e.touchAsGamepad?"Touch gamepad enabled":"Touch gamepad disabled (touch map to move)"):t("left")||"left"==o||t("menuPrev")||"menuPrev"==o?this.prevPage():(t("right")||"right"==o||t("menuNext")||"menuNext"==o)&&this.nextPage()}}const Yo={numGameMaps:10,totalGameLoot:100};let Xo;var qo;(qo=Xo||(Xo={}))[qo.Creak=0]="Creak",qo[qo.Splash=1]="Splash";const jo=At(),$o=bt();window.onload=function(){Promise.all([Tn($o.imageSrc,$o.image),Tn(jo.imageSrc,jo.image)]).then(on)};const Ko=65,Qo=8,Jo=16,Zo=16,en=16,tn="Esc or / for help";function on(e){const t=document.querySelector("#canvas");document.body.addEventListener("keydown",(function(e){0==Object.keys(n.sounds).length&&(_o(n.sounds,n.subtitledSounds,n.activeSoundPool),e.preventDefault())})),t.addEventListener("mousedown",(function(e){0==Object.keys(n.sounds).length&&(_o(n.sounds,n.subtitledSounds,n.activeSoundPool),e.preventDefault())})),t.addEventListener("touchstart",(function(e){0==Object.keys(n.sounds).length&&(_o(n.sounds,n.subtitledSounds,n.activeSoundPool),e.preventDefault())}));const o=new ct(t,jo,$o),n=function(e,t,o,n){const r=new y,i=0,s=ve(Yo.numGameMaps,Yo.totalGameLoot,r),a=xe(i,s[i]),l=Pn(),u="Gamepad"===(window.localStorage.getItem("LLL/touchMode")??"Gamepad");return{gameStats:{loot:0,lootStolen:0,lootSpent:0,ghostBonuses:0,timeBonuses:0,maxGhostBonuses:0,maxTimeBonuses:0,maxLootStolen:0,turns:0,level:0,win:!1,daily:null},lightStates:[],particles:[],stats:l,tLast:void 0,dt:0,idleTimer:0,initialSeen:0,rng:r,dailyRun:null,leapToggleActive:!1,gameMode:Po.HomeScreen,helpScreen:new No,textWindows:{[Po.HomeScreen]:new Wo,[Po.OptionsScreen]:new Do,[Po.StatsScreen]:new Go,[Po.DailyHub]:new Fo,[Po.BetweenMansions]:new Uo,[Po.Dead]:new Vo,[Po.Win]:new Oo},helpActive:!1,player:new ne(a.playerStartPos),topStatusMessage:tn,topStatusMessageSticky:!0,finishedLevel:!1,healCost:1,zoomLevel:3,seeAll:!1,seeGuardSight:!1,seeGuardPatrols:!1,camera:Rn(a.playerStartPos),level:i,turns:0,totalTurns:0,lootStolen:0,lootSpent:0,lootAvailable:s[i].totalLoot,ghostBonus:5,maxTimeBonus:5,gameMapRoughPlans:s,gameMap:a,sounds:e,subtitledSounds:t,activeSoundPool:o,guardMute:!1,volumeMute:!1,touchAsGamepad:u,touchController:n,gamepadManager:new Ro,keyboardController:new Ao,popups:new S}}({},{},new fo,new Ho(t,!0));function r(){requestAnimationFrame((e=>Wn(e,o,n)))}window.addEventListener("resize",(function(){r()})),r()}function nn(e){if(e.gamepadManager.updateGamepadStates(),null!==So){e.helpActive?e.helpScreen.onControls(e,t):e.gameMode==Po.Mansion?function(o){e.camera.panning&&(e.camera.velocity[0]=0,e.camera.velocity[1]=0);o.controlStates.panLeft&&(e.camera.panning=!0,e.camera.velocity[0]=-1e3*e.dt);o.controlStates.panRight&&(e.camera.panning=!0,e.camera.velocity[0]=1e3*e.dt);o.controlStates.panUp&&(e.camera.panning=!0,e.camera.velocity[1]=1e3*e.dt);o.controlStates.panDown&&(e.camera.panning=!0,e.camera.velocity[1]=-1e3*e.dt);o.controlStates.snapToPlayer&&(e.camera.panning=!1,e.camera.snapped=!1);if(t("left")||t("heal"))e.leapToggleActive||o.controlStates.jump?yn(e,-1,0):gn(e,-1,0);else if(t("right"))e.leapToggleActive||o.controlStates.jump?yn(e,1,0):gn(e,1,0);else if(t("down"))e.leapToggleActive||o.controlStates.jump?yn(e,0,-1):gn(e,0,-1);else if(t("up"))e.leapToggleActive||o.controlStates.jump?yn(e,0,1):gn(e,0,1);else if(t("jumpLeft"))yn(e,-1,0);else if(t("jumpRight"))yn(e,1,0);else if(t("jumpDown"))yn(e,0,-1);else if(t("jumpUp"))yn(e,0,1);else if(t("wait"))!function(e){const t=e.player;if(t.health<=0)return;e.idleTimer=5,e.camera.panning=!1,e.touchController.clearMotion(),xn(e),e.gameMap.identifyAdjacentCells(t.pos),t.pickTarget=null,wn(e)}(e);else if(t("exitLevel"))e.level>=Yo.numGameMaps-1?un(e):ln(e);else if(t("menu"))e.player.health>0?e.helpActive=!0:e.gameMode=Po.Dead;else if(t("jumpToggle"))e.leapToggleActive=!e.leapToggleActive;else if(t("seeAll"))e.seeAll=!e.seeAll;else if(t("collectLoot")){const t=e.gameMap.collectAllLoot();e.player.loot+=t,e.lootStolen+=t,Sn(e)}else if(t("forceRestart"))e.rng=new y,e.dailyRun=null,En(e);else if(t("nextLevel"))e.level<e.gameMapRoughPlans.length-1&&(rn(e),sn(e,e.level+1));else if(t("resetState"))!function(e){const t=xe(e.level,e.gameMapRoughPlans[e.level]);e.lightStates=Array(t.lightCount).fill(0),In(t,e),Cn(t,e),e.turns=0,e.totalTurns=0,e.lootStolen=0,e.lootSpent=0,e.lootAvailable=e.gameMapRoughPlans[e.level].totalLoot,e.ghostBonus=5,e.maxTimeBonus=5,e.initialSeen=t.percentSeen()/100,e.topStatusMessage=tn,e.topStatusMessageSticky=!0,e.finishedLevel=!1,e.player=new ne(t.playerStartPos),e.camera=Rn(t.playerStartPos),e.gameMap=t,e.popups.clear(),e.activeSoundPool.empty()}(e);else if(t("prevLevel"))e.level>0&&(rn(e),sn(e,e.level-1));else if(t("guardSight"))e.seeGuardSight=!e.seeGuardSight;else if(t("guardPatrols"))e.seeGuardPatrols=!e.seeGuardPatrols;else if(t("markSeen"))e.gameMap.markAllSeen(),Sn(e);else if(t("zoomIn"))e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1;else if(t("zoomOut"))e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1;else if(t("seeAll"))e.seeAll=!e.seeAll;else if(t("guardMute")){e.guardMute=!e.guardMute;for(const t in e.subtitledSounds)e.subtitledSounds[t].mute=e.guardMute}else if(t("volumeMute"))e.volumeMute=!e.volumeMute,Pt.mute(e.volumeMute);else if(t("volumeDown")){const e=Pt.volume();Pt.volume(Math.max(e-.1,.1))}else if(t("volumeUp")){const e=Pt.volume();Pt.volume(Math.max(e+.1,1))}}(So):e.textWindows[e.gameMode]?.onControls(e,(function(t){let o=!1;if(null===So)return!1;const n=So.controlStates;if(!(t in n))return!1;if(So===e.touchController){const n=e.touchController;if(t in n.touchTargets&&"release"==n.touchTargets[t].trigger)return o=So.currentFrameReleases.has(t),o&&(So.controlTimes[t],Date.now()),o}o=So.currentFramePresses.has(t),o&&(So.controlTimes[t],Date.now());return o})),e.touchController.endFrame(),e.keyboardController.endFrame();for(const t in e.gamepadManager.gamepads)e.gamepadManager.gamepads[t].endFrame()}function t(t){let o=!1;if(null===So)return!1;const n=So.controlStates;if(!(t in n))return!1;if(So===e.touchController){const n=e.touchController;if(t in n.touchTargets&&"release"==n.touchTargets[t].trigger)return o=So.currentFrameReleases.has(t),o&&(So.controlTimes[t]=Date.now()),o}return o=So.currentFramePresses.has(t)||n[t]&&Date.now()-So.controlTimes[t]>250,o&&(So.controlTimes[t]=Date.now()),o}}function rn(e){if(!e.gameMapRoughPlans[e.level].played){const t=an(e);e.player.loot+=t+e.ghostBonus;const o=e.gameStats;o.daily=e.dailyRun,o.loot=e.player.loot,o.turns=e.totalTurns,o.level=e.level+1,o.win=9===e.level&&e.player.health>0,o.lootStolen+=e.lootStolen,o.maxLootStolen+=e.lootAvailable,o.ghostBonuses+=e.ghostBonus,o.maxGhostBonuses+=5,o.timeBonuses+=an(e),o.maxTimeBonuses+=e.maxTimeBonus,o.lootSpent+=e.lootSpent,e.gameMapRoughPlans[e.level].played=!0}}function sn(e,t){e.level=t,e.level>=Yo.numGameMaps?En(e):(e.activeSoundPool.empty(),e.gameMap=xe(e.level,e.gameMapRoughPlans[e.level]),e.lightStates=new Array(e.gameMap.lightCount).fill(0),In(e.gameMap,e),Cn(e.gameMap,e),e.topStatusMessage=tn,e.topStatusMessageSticky=!0,e.finishedLevel=!1,e.healCost+=1,e.turns=0,e.lootStolen=0,e.lootSpent=0,e.lootAvailable=e.gameMapRoughPlans[e.level].totalLoot,e.ghostBonus=5,e.maxTimeBonus=5,e.player.pos=e.gameMap.playerStartPos,e.player.dir=s.fromValues(0,-1),e.player.noisy=!1,e.player.hasVaultKey=!1,e.player.damagedLastTurn=!1,e.player.turnsRemainingUnderwater=0,e.popups.clear(),e.camera=Rn(e.gameMap.playerStartPos),e.gameMode=Po.Mansion)}function an(e){const t=e.gameMap.cells,o=Math.ceil(t.sizeX*t.sizeY*(1-e.initialSeen)/4),n=e.turns;return Math.max(5-Math.max(Math.floor(n/o)-1,0),0)}function ln(e){rn(e),e.activeSoundPool.empty(),e.sounds.levelCompleteJingle.play(.35),e.gameMode=Po.BetweenMansions,e.lootStolen===e.lootAvailable&&(e.stats.totalLootSweeps++,Hn("totalLootSweeps",e.stats.totalLootSweeps)),e.ghostBonus>0&&(e.stats.totalGhosts++,Hn("totalGhosts",e.stats.totalGhosts)),e.topStatusMessage="",e.topStatusMessageSticky=!1}function un(e){rn(e),e.activeSoundPool.empty(),e.player.loot>95&&Math.random()>.9?e.sounds.easterEgg.play(.5):e.sounds.victorySong.play(.5),e.stats.totalWins++,Hn("totalWins",e.stats.totalWins),e.stats.bestScore=Math.max(e.stats.bestScore,e.player.loot),Hn("bestScore",e.stats.bestScore),e.stats.totalGold+=e.player.loot,Hn("totalGold",e.stats.totalGold);const t={score:e.player.loot,date:On(),turns:e.totalTurns,level:e.level+1};e.stats.highScores.push(t),e.dailyRun&&(e.stats.bestDailyScore=Math.max(e.stats.bestDailyScore,e.player.loot),Hn("bestDailyScore",e.stats.bestDailyScore),e.stats.dailyWins++,Hn("dailyWins",e.stats.dailyWins),e.stats.dailyWinStreak++,Hn("dailyWinStreak",e.stats.dailyWinStreak),200==e.player.loot&&(e.stats.dailyPerfect++,Hn("dailyPerfect",e.stats.dailyPerfect)),Hn("lastDaily",e.gameStats)),e.gameMode=Po.Win,e.topStatusMessage="",e.topStatusMessageSticky=!1}function cn(e,t,o){const n=e.gameMap.collectLootAt(t);n.length>0&&e.sounds.coin.play(1);for(const t of n){++e.player.loot,++e.lootStolen;const n=s.create(),r=s.fromValues(o[0]-t.pos[0],o[1]-t.pos[1]),i=r.scale(.3333).add(s.fromValues(0,.5)),a=new b([{pt0:n,pt1:i,duration:.1,fn:T.easeOutQuad},{pt0:i,pt1:r,duration:.1,fn:T.easeInQuad}],[jo.itemTiles[Z.Coin],jo.itemTiles[Z.Coin]]);a.removeOnFinish=!0,t.animation=a,e.particles.push(t)}}function dn(e,t){if((t[0]<0||t[0]>=e.gameMap.cells.sizeX||t[1]<0||t[1]>=e.gameMap.cells.sizeY)&&!e.finishedLevel)return!1;const o=e.gameMap.cells.atVec(t);return!o.blocksPlayerMove&&(!vn(o.type)&&(o.type!==j.PortcullisNS&&o.type!==j.PortcullisEW&&((o.type!==j.DoorNS&&o.type!==j.DoorEW||!e.gameMap.items.find((e=>e.pos.equals(t)&&ue(e.type))))&&(!e.gameMap.items.find((e=>e.pos.equals(t)&&!function(e){switch(e){case Z.BedL:case Z.BedR:case Z.DrawersShort:case Z.TorchUnlit:case Z.TorchLit:return!1;default:return!0}}(e.type)))&&!e.gameMap.guards.find((o=>o.pos.equals(t)&&!o.movingWithPlayerPosition(e.player.pos)))))))}function pn(e,t,o){if(o.hidesPlayer)return void e.sounds.hide.play(.2);const n=.5+Math.random()/2,r=t.type!==o.type;switch(o.type){case j.GroundWoodCreaky:e.sounds.footstepCreaky.play(.15*n);break;case j.GroundWood:(r||Math.random()>.9)&&e.sounds.footstepWood.play(.15*n);break;case j.GroundNormal:(r||Math.random()>.5)&&e.sounds.footstepGravel.play(.03*n);break;case j.GroundGrass:(r||Math.random()>.75)&&e.sounds.footstepGrass.play(.05*n);break;case j.GroundWater:(r||Math.random()>.6)&&e.sounds.footstepWater.play(.02*n);break;case j.GroundMarble:case j.GroundVault:(r||Math.random()>.8)&&e.sounds.footstepTile.play(.05*n);break;default:(r||Math.random()>.8)&&e.sounds.footstepTile.play(.02*n)}}function hn(e,t,o){const n=s.create(),r=s.fromValues(t/4,o/4);e.player.animation=new b([{pt0:n,pt1:r,duration:.05,fn:T.linear},{pt0:r,pt1:n,duration:.05,fn:T.linear}],[jo.playerTiles.normal])}function mn(e,t,o){e.sounds.footstepTile.play(.1),hn(e,t,o)}function fn(e,t,o,n){let r=null;if(t.pickTarget=null,o.hasPurse&&(o.hasPurse=!1,t.loot+=1,e.lootStolen+=1,r={pos:s.clone(o.pos),type:Z.Coin}),o.hasVaultKey&&(o.hasVaultKey=!1,t.hasVaultKey=!0,r={pos:s.clone(o.pos),type:Z.Key}),r){const t=s.create(),o=n.subtract(r.pos),i=o.scale(.3333).add(s.fromValues(0,.5)),a=new b([{pt0:t,pt1:i,duration:.1,fn:T.easeOutQuad},{pt0:i,pt1:o,duration:.1,fn:T.easeInQuad}],[jo.itemTiles[r.type],jo.itemTiles[r.type]]);a.removeOnFinish=!0,r.animation=a,e.particles.push(r),e.sounds.coin.play(1)}}function gn(e,t,o){const n=e.player;if(n.health<=0)return;e.idleTimer=5,e.camera.panning=!1,e.touchController.clearMotion();const r=s.clone(n.pos),i=s.fromValues(n.pos[0]+t,n.pos[1]+o);if(i[0]<0||i[0]>=e.gameMap.cells.sizeX||i[1]<0||i[1]>=e.gameMap.cells.sizeY)return void(e.finishedLevel?e.level>=Yo.numGameMaps-1?(xn(e),un(e)):(xn(e),ln(e)):mn(e,t,o));const a=e.gameMap.cells.atVec(i);if(a.blocksPlayerMove)return void mn(e,t,o);if(a.type==j.OneWayWindowE&&i[0]<=r[0]||a.type==j.OneWayWindowW&&i[0]>=r[0]||a.type==j.OneWayWindowN&&i[1]<=r[1]||a.type==j.OneWayWindowS&&i[1]>=r[1])return e.topStatusMessage="Window cannot be accessed from outside",e.topStatusMessageSticky=!1,0===e.level&&setTimeout((()=>e.sounds.tooHigh.play(.3)),250),void mn(e,t,o);if(vn(a.type))return e.topStatusMessage="Shift+move to leap",e.topStatusMessageSticky=!1,0===e.level&&setTimeout((()=>e.sounds.jump.play(.3)),250),void mn(e,t,o);for(const a of e.gameMap.items.filter((e=>e.pos.equals(i))))switch(a.type){case Z.DrawersShort:return dn(e,s.fromValues(r[0]+2*t,r[1]+2*o))&&(e.topStatusMessage="Shift+move to leap",e.topStatusMessageSticky=!1),void mn(e,t,o);case Z.TorchUnlit:return xn(e),e.sounds.ignite.play(.08),a.type=Z.TorchLit,n.pickTarget=null,hn(e,t,o),void wn(e);case Z.TorchLit:return xn(e),e.sounds.douse.play(.05),a.type=Z.TorchUnlit,n.pickTarget=null,hn(e,t,o),void wn(e);case Z.PortcullisEW:case Z.PortcullisNS:return e.topStatusMessage="Shift+move to leap",e.topStatusMessageSticky=!1,e.sounds.gate.play(.3),0===e.level&&setTimeout((()=>e.sounds.jump.play(.3)),1e3),void hn(e,t,o);case Z.LockedDoorEW:case Z.LockedDoorNS:if(!n.hasVaultKey)return e.topStatusMessage="Locked!",e.topStatusMessageSticky=!1,void mn(e,t,o)}const l=e.gameMap.guards.find((e=>e.pos.equals(i)));let u=!1;if(void 0===l)n.pickTarget=null;else if(l.mode===I.Unconscious)n.pickTarget=null,function(e,t){const o=s.clone(t.pos),n=s.clone(e.player.pos),r=s.create();s.subtract(r,o,n),s.add(r,r,o);let i=!1;(r[0]<0||r[1]<0||r[0]>=e.gameMap.cells.sizeX||r[1]>=e.gameMap.cells.sizeY||e.gameMap.cells.atVec(r).moveCost===1/0||e.gameMap.guards.find((e=>e.pos.equals(r))))&&(s.copy(r,n),i=!0),s.copy(t.pos,r),e.gameMap.cells.atVec(t.pos).type===j.GroundWater&&(t.modeTimeout=0);const a=s.clone(o).subtract(t.pos),l=s.create();let u;if(i)u=[{pt0:a,pt1:l,duration:.2,fn:T.easeOutQuad}];else{const e=s.fromValues(.5*(o[0]-t.pos[0]),.5*(o[1]-t.pos[1]));u=[{pt0:a,pt1:e,duration:.2,fn:T.easeInQuad},{pt0:e,pt1:l,duration:.1,fn:T.easeOutQuad}]}t.animation=new b(u,[])}(e,l);else{if(l.mode===I.ChaseVisibleTarget)return void mn(e,t,o);if(D(l.mode)?(l.hasPurse||l.hasVaultKey)&&(n.pickTarget===l?u=!0:n.pickTarget=l):n.pickTarget=null,!l.movingWithPlayerPosition(n.pos))return u&&fn(e,n,l,r),xn(e),void wn(e);u&&fn(e,n,l,i)}xn(e),s.copy(n.pos,i),e.gameMap.identifyAdjacentCells(n.pos);const c=s.clone(r).subtract(i),d=s.create();let p=c.add(d).scale(.5).add(s.fromValues(0,.125));const h=n.hidden(e.gameMap),m=t<0?jo.playerTiles.left:t>0?jo.playerTiles.right:o>0?jo.playerTiles.up:jo.playerTiles.down;let f;if(void 0!==l&&l.mode===I.Unconscious){const e=s.fromValues(.5*(r[0]-i[0]),.5*(r[1]-i[1]));f=[{pt0:c,pt1:e,duration:.2,fn:T.easeInQuad},{pt0:e,pt1:d,duration:.1,fn:T.easeOutQuad}]}else f=[{pt0:c,pt1:p,duration:.1,fn:T.easeInQuad},{pt0:p,pt1:d,duration:.1,fn:T.easeOutQuad},{pt0:d,pt1:d,duration:o>0&&!h?.5:.1,fn:T.easeOutQuad}],o>0&&!h&&f.push({pt0:d,pt1:d,duration:.1,fn:T.easeOutQuad});const g=h?jo.playerTiles.hidden:m;n.animation=new b(f,[m,g,g,jo.playerTiles.left]),cn(e,n.pos,i),a.type===j.GroundWoodCreaky&&_n(e.gameMap,n,Xo.Creak,17,e.sounds),wn(e),pn(e,e.gameMap.cells.atVec(r),a)}function yn(e,t,o){const n=e.player;if(n.health<=0)return;e.idleTimer=5,e.camera.panning=!1,e.touchController.clearMotion();const r=s.clone(n.pos),i=s.fromValues(n.pos[0]+t,n.pos[1]+o),a=s.fromValues(n.pos[0]+2*t,n.pos[1]+2*o),l=e.gameMap.guards.find((e=>e.pos.equals(i)&&e.mode!==I.Unconscious&&e.mode!==I.ChaseVisibleTarget));if(l)return xn(e),l.mode=I.Unconscious,l.modeTimeout=Math.max(1,40-2*e.level)+v(20),(l.hasPurse||l.hasVaultKey)&&fn(e,n,l,r),n.pickTarget=null,e.sounds.hitGuard.play(.25),wn(e),void hn(e,t,o);if(e.gameMap.cells.atVec(r).type===j.GroundWater)return void gn(e,t,o);if(i[0]<0||i[1]<0||i[0]>=e.gameMap.cells.sizeX||i[1]>=e.gameMap.cells.sizeY)return void gn(e,t,o);const u=e.gameMap.cells.atVec(i);if(u.blocksPlayerMove)return void gn(e,t,o);if((u.type===j.DoorNS||u.type===j.DoorEW)&&e.gameMap.items.find((e=>e.pos.equals(i)&&ue(e.type))))return void gn(e,t,o);if(u.type==j.OneWayWindowE&&a[0]<=r[0]||u.type==j.OneWayWindowW&&a[0]>=r[0]||u.type==j.OneWayWindowN&&a[1]<=r[1]||u.type==j.OneWayWindowS&&a[1]>=r[1])return void gn(e,t,o);if(!dn(e,a))return void(!function(e,t){if((t[0]<0||t[0]>=e.gameMap.cells.sizeX||t[1]<0||t[1]>=e.gameMap.cells.sizeY)&&!e.finishedLevel)return!1;const o=e.gameMap.cells.atVec(t);if(o.blocksPlayerMove)return!1;if(vn(o.type))return!1;for(const o of e.gameMap.items.filter((e=>e.pos.equals(t))))switch(o.type){case Z.DrawersShort:case Z.TorchUnlit:case Z.TorchLit:case Z.PortcullisEW:case Z.PortcullisNS:return!1}return!e.gameMap.guards.find((e=>e.pos.equals(t)))}(e,i)?mn(e,t,o):gn(e,t,o));const c=e.gameMap.guards.find((e=>e.pos.equals(a)));if(void 0===c||!c.hasPurse&&!c.hasVaultKey?n.pickTarget=null:n.pickTarget=c,xn(e),cn(e,i,a),a[0]<0||a[1]<0||a[0]>=e.gameMap.cells.sizeX||a[1]>=e.gameMap.cells.sizeY)return void(e.level>=Yo.numGameMaps-1?un(e):ln(e));s.copy(n.pos,a);const d=e.gameMap.cells.atVec(a);d.identified=!0;const p=s.clone(r).subtract(a),h=s.create();let m=p.add(h).scale(.5).add(s.fromValues(0,.5));const f=t<0?jo.playerTiles.left:t>0?jo.playerTiles.right:o>0?jo.playerTiles.up:jo.playerTiles.down,g=n.hidden(e.gameMap),y=[{pt0:p,pt1:m,duration:.1,fn:T.easeInQuad},{pt0:m,pt1:h,duration:.1,fn:T.easeOutQuad},{pt0:h,pt1:h,duration:o>0&&!g?.5:.1,fn:T.easeOutQuad}];o>0&&!g&&y.push({pt0:h,pt1:h,duration:.1,fn:T.easeOutQuad});const _=g?jo.playerTiles.hidden:f;n.animation=new b(y,[f,_,_,jo.playerTiles.left]),cn(e,a,a),d.type===j.GroundWoodCreaky?_n(e.gameMap,n,Xo.Creak,17,e.sounds):d.type===j.GroundWater&&_n(e.gameMap,n,Xo.Splash,17,e.sounds),wn(e),pn(e,e.gameMap.cells.atVec(r),d),u.type!==j.PortcullisNS&&u.type!==j.PortcullisEW||e.sounds.gate.play(.3)}function vn(e){switch(e){case j.OneWayWindowE:case j.OneWayWindowW:case j.OneWayWindowN:case j.OneWayWindowS:return!0;default:return!1}}function _n(e,t,o,n,r){switch(t.noisy=!0,o){case Xo.Creak:r.footstepCreaky.play(.6);case Xo.Splash:}let i=1/0,s=null;for(const o of e.guardsInEarshot(t.pos,n)){o.heardThief=!0;const e=t.pos.squaredDistance(o.pos);e<i&&D(o.mode)&&(i=e,s=o)}null!==s&&(s.heardThiefClosest=!0)}function xn(e){e.topStatusMessageSticky||(e.topStatusMessage=""),e.popups.clear(),e.player.noisy=!1,e.player.damagedLastTurn=!1}function wn(e){let t=e.player.health;e.turns++,e.totalTurns++,e.gameMap.cells.atVec(e.player.pos).type==j.GroundWater?e.player.turnsRemainingUnderwater>0&&--e.player.turnsRemainingUnderwater:e.player.turnsRemainingUnderwater=7,e.gameMap.computeLighting(e.gameMap.cells.atVec(e.player.pos)),G(e,e.gameMap,e.popups,e.player),void 0!==e.gameMap.guards.find((e=>e.mode===I.ChaseVisibleTarget||e.mode===I.Unconscious))&&(e.ghostBonus=0),e.gameMap.recomputeVisibility(e.player.pos),Sn(e),t>e.player.health&&(e.sounds.hitPlayer.play(.5),e.player.health<=0&&(setTimeout((()=>e.sounds.gameOverJingle.play(.5)),1e3),rn(e),e.dailyRun&&(e.stats.dailyWinStreak=0,Hn("dailyWinStreak",e.stats.dailyWinStreak),Hn("lastDaily",e.gameStats)),e.topStatusMessage="You were killed. Press Escape/Menu to see score.",e.topStatusMessageSticky=!0))}function Sn(e){e.gameMap.allSeen()&&(e.finishedLevel||e.sounds.levelRequirementJingle.play(.5),e.finishedLevel=!0);const t=e.popups.endOfUpdate(e.subtitledSounds);""!==t?(e.topStatusMessage=t,e.topStatusMessageSticky=!0):e.finishedLevel&&(e.lootAvailable>e.lootStolen?e.topStatusMessage="Mansion fully mapped! You may exit any side but loot remains.":e.topStatusMessage="Mansion fully mapped and looted! Exit any side.",e.topStatusMessageSticky=!0)}function Tn(e,t){return new Promise(((o,n)=>{t.onload=()=>o(t),t.onerror=n,t.src=e}))}function Mn(e,t,o,n){if(0==o.size)return e;if(!n)return 0;let r=0;for(let e of[...o])r+=t[e];return e**(1+r/o.size)}function Ln(e,t,o,n,r){const i=o.at(e-1,t-1).litAnim,s=o.at(e,t-1).litAnim,a=o.at(e+1,t-1).litAnim,l=o.at(e-1,t).litAnim,u=o.at(e,t).litAnim,c=o.at(e+1,t).litAnim,d=o.at(e-1,t+1).litAnim,p=o.at(e,t+1).litAnim;return[(i+s+l+u)/4,(a+s+c+u)/4,(d+p+l+u)/4,(o.at(e+1,t+1).litAnim+p+c+u)/4]}function An(e,t){const o={};for(let t of e.gameMap.items){const n=e.gameMap.cells.indexVec(t.pos);n in o?o[n].push(t):o[n]=[t]}!function(e,t,o){for(let n=0;n<e.sizeX;n++)for(let r=0;r<e.sizeY;r++){const i=e.at(n,r);e.at(n,r).litAnim=Mn(i.lit,t,i.litSrc,o||i.seen)}}(e.gameMap.cells,e.lightStates,e.seeAll);for(let n=0;n<e.gameMap.cells.sizeX;++n)for(let r=e.gameMap.cells.sizeY-1;r>=0;--r){const i=e.gameMap.cells.at(n,r);if(!i.seen&&!e.seeAll)continue;let s=i.type;s!=j.GroundWoodCreaky||i.lit||i.identified||(s=j.GroundWood);const a=Ln(n,r,e.gameMap.cells,e.lightStates,e.seeAll);if([j.PortcullisEW].includes(s)&&e.gameMap.guards.find((e=>e.pos[0]==n&&e.pos[1]==r)))t.addGlyph(n,r,n+1,r+1,t.tileSet.terrainTiles[j.PortcullisNS],a);else{const e=i.animation?i.animation.currentTile():t.tileSet.terrainTiles[s];t.addGlyph(n,r,n+1,r+1,e,a)}if(s===j.GroundWater){const o=t.tileSet.ledgeTiles;let i=0;for(let s of[[0,1],[0,-1],[-1,0],[1,0]]){e.gameMap.cells.at(n+s[0],r+s[1]).type!==j.GroundWater&&t.addGlyph(n,r,n+1,r+1,o[i],a),i++}}const l=e.gameMap.cells.index(n,r);if(l in o)for(let i of o[l]){const o=Ln(n,r,e.gameMap.cells,e.lightStates,e.seeAll);if([j.PortcullisEW].includes(s)&&e.gameMap.guards.find((e=>e.pos[0]==n&&e.pos[1]==r)))t.addGlyph(n,r,n+1,r+1,t.tileSet.itemTiles[Z.PortcullisNS],o);else{if([j.DoorEW,j.DoorNS].includes(s)&&(e.gameMap.guards.find((e=>e.pos[0]==n&&e.pos[1]==r))||e.player.pos[0]==n&&e.player.pos[1]==r))continue;const a=i.animation?i.animation.currentTile():t.tileSet.itemTiles[i.type];if(i.animation instanceof b){const e=i.animation.offset;t.addGlyph(n+e[0],r+e[1],n+e[0]+1,r+e[1]+1,a,o)}else t.addGlyph(n,r,n+1,r+1,a,o)}}}}function bn(e){return e[1]>0?1:e[1]<0?3:e[0]>0?0:e[0]<0?2:3}function Rn(e){const t={position:s.create(),velocity:s.create(),anchor:s.create(),snapped:!1,panning:!1};return s.copy(t.position,e),s.zero(t.velocity),t}function kn(e){return JSON.parse(String(window.localStorage.getItem("LLL/stat/"+e)))}function Hn(e,t){window.localStorage.setItem("LLL/stat/"+e,JSON.stringify(t))}function Pn(){return{highScores:kn("highScores")??[],dailyScores:kn("dailyScores")??[],bestScore:kn("bestScore")??0,bestDailyScore:kn("bestDailyScores")??0,lastDaily:kn("lastDaily")??{score:0,date:""},dailyWinStreak:kn("dailyWinStreak")??0,dailyPlays:kn("dailyPlays")??0,dailyWins:kn("dailyWins")??0,dailyPerfect:kn("dailyPerfect")??0,totalGold:kn("totalGold")??0,totalPlays:kn("totalPlays")??0,totalWins:kn("totalWins")??0,totalPerfect:kn("totalPerfect")??0,totalGhosts:kn("totalGhosts")??0,totalLootSweeps:kn("totalLootSweeps")??0,achievements:kn("achievements")??new Set}}function Cn(e,t){for(let t of e.cells.values)t.type===j.GroundWater&&(t.animation=new A(jo.waterAnimation,.5))}function In(e,t){let o=0;if(jo.candleAnimation.length>=3){const n=jo.candleAnimation.slice(0,3).map((e=>[e,.5])),r=jo.candleAnimation.at(-2),i=jo.candleAnimation.at(-1);for(let s of e.items)s.type===Z.TorchLit?(s.animation=new H(R.idle,o,t.lightStates,s,n,r,i),o++):s.type===Z.TorchUnlit&&(s.animation=new H(R.off,o,t.lightStates,s,n,r,i),o++)}if(jo.torchAnimation.length>=3){const n=jo.torchAnimation.slice(0,3).map((e=>[e,.5])),r=jo.torchAnimation.at(-2),i=jo.torchAnimation.at(-1);for(let s of e.guards)s.hasTorch&&(s.torchAnimation=new H(R.idle,o,t.lightStates,null,n,r,i),o++)}}function En(e){e.gameMapRoughPlans=ve(Yo.numGameMaps,Yo.totalGameLoot,e.rng),e.level=0,e.stats.totalPlays++,Hn("totalPlays",e.stats.totalPlays),e.dailyRun&&(e.stats.dailyPlays++,Hn("dailyPlays",e.stats.dailyPlays)),e.gameStats={loot:0,lootStolen:0,lootSpent:0,ghostBonuses:0,timeBonuses:0,maxGhostBonuses:0,maxTimeBonuses:0,maxLootStolen:0,turns:0,level:0,win:!1,daily:e.dailyRun};const t=xe(e.level,e.gameMapRoughPlans[e.level]);e.lightStates=Array(t.lightCount).fill(0),In(t,e),Cn(t),e.gameMode=Po.Mansion,e.topStatusMessage=tn,e.topStatusMessageSticky=!0,e.finishedLevel=!1,e.healCost=1,e.turns=0,e.totalTurns=0,e.lootStolen=0,e.lootSpent=0,e.lootAvailable=e.gameMapRoughPlans[e.level].totalLoot,e.ghostBonus=5,e.maxTimeBonus=5,e.initialSeen=t.percentSeen()/100,e.player=new ne(t.playerStartPos),e.camera=Rn(t.playerStartPos),e.gameMap=t,e.activeSoundPool.empty(),e.popups.clear()}function Wn(e,t,o){const n=e/1e3,r=void 0===o.tLast?0:Math.min(1/30,n-o.tLast);o.dt=r,o.tLast=n,function(e,t){if(e.idleTimer-=t,e.idleTimer<=0&&e.player.health>0&&null===e.player.animation){e.idleTimer=5;const t=e.player,o=s.create(),n=s.fromValues(-.125,0),r=s.fromValues(.125,0),i=s.fromValues(0,.125),a=t.hidden(e.gameMap),l=jo.playerTiles;let u,c;a||Math.random()>.5?(u=[{pt0:o,pt1:i,duration:.1,fn:T.easeInQuad},{pt0:i,pt1:o,duration:.05,fn:T.easeOutQuad},{pt0:o,pt1:o,duration:.1,fn:T.easeOutQuad},{pt0:o,pt1:i,duration:.1,fn:T.easeInQuad},{pt0:i,pt1:o,duration:.05,fn:T.easeOutQuad}],c=a?[l.hidden]:[l.normal]):(u=[{pt0:o,pt1:n,duration:.1,fn:T.easeOutQuad},{pt0:n,pt1:n,duration:.5,fn:T.easeOutQuad},{pt0:n,pt1:o,duration:.1,fn:T.easeInQuad},{pt0:o,pt1:r,duration:.1,fn:T.easeOutQuad},{pt0:r,pt1:r,duration:.5,fn:T.easeOutQuad},{pt0:r,pt1:o,duration:.1,fn:T.easeInQuad}],c=[l.left,l.left,l.normal,l.right,l.right,l.normal]),t.animation=new b(u,c)}}(o,r);const i=s.create();t.getScreenSize(i),o.camera.snapped||(o.camera.panning=!1,o.camera.snapped=!0,function(e,t){Dn(e.camera.position,s.fromValues(e.gameMap.cells.sizeX,e.gameMap.cells.sizeY),e.zoomLevel,t,e.player.pos),s.zero(e.camera.velocity)}(o,i)),nn(o),r>0&&function(e,t,o){!function(e,t,o){const n=s.create();if(!e.camera.panning){const r=s.create();Dn(r,s.fromValues(e.gameMap.cells.sizeX,e.gameMap.cells.sizeY),e.zoomLevel,t,e.player.pos);const i=s.create();s.subtract(i,r,e.camera.position);const a=s.create();s.negate(a,e.camera.velocity);const l=8,u=s.create();s.scale(u,i,l**2),s.scaleAndAdd(u,u,a,2*l),s.scaleAndAdd(n,e.camera.velocity,u,o)}s.scaleAndAdd(e.camera.position,e.camera.position,e.camera.velocity,.5*o),s.scaleAndAdd(e.camera.position,e.camera.position,n,.5*o),s.copy(e.camera.velocity,n)}(e,t,o)}(o,i,r),o.player.animation&&o.player.animation.update(r)&&(o.player.animation=null);for(let e of o.gameMap.cells.values)e.animation?.update(r);for(let e of o.gameMap.guards)e.animation?.update(r)&&(e.animation=null),e.torchAnimation?.update(r)&&(e.torchAnimation=null);if(o.gameMap.items=o.gameMap.items.filter((e=>{const t=e.animation?.update(r);return!(e.animation instanceof b)||!(e.animation.removeOnFinish&&t)})),o.particles=o.particles.filter((e=>{const t=e.animation?.update(r);return!(e.animation instanceof b)||!(e.animation.removeOnFinish&&t)})),o.helpActive){const e=o.helpScreen;e.update(o),e.parseUI(),e.updateScreenSize(i)}else{const e=o.textWindows[o.gameMode];void 0!==e&&(e.update(o),e.parseUI(),e.updateScreenSize(i))}!function(e,t,o,n){if(So!==e)return;const r=n.helpActive?n.helpScreen:n.textWindows[n.gameMode],i=s.fromValues(n.gameMap.cells.sizeX,n.gameMap.cells.sizeY),a=(Gn(o[0]),o[0]),l=o[1]-2*Jo,u=function(e,t,o,n){const r=t[0],i=t[1],a=Jo*Gn(e[0]),l=s.fromValues(e[0],e[1]-2*a),u=l[0],c=l[1],d=Fn(l,r,i,n),p=d[0],h=d[1],m=o[0],f=o[1];return{screenToWorld:e=>s.fromValues((e[0]-u/2)*p/u+m,(e[1]-c/2-2*Jo)*h/c+f),worldToScreen:e=>s.fromValues((e[0]-m)*u/p+u/2,(e[1]-f)*c/h+c/2+2*Jo)}}(o,i,n.camera.position,n.zoomLevel);if(-1!==e.lastMotion.id&&void 0===r&&null===e.targetOnTouchDown&&e.lastMotion.active){const t=u.screenToWorld(s.fromValues(e.lastMotion.x0,e.lastMotion.y0)),o=u.screenToWorld(s.fromValues(e.lastMotion.x,e.lastMotion.y));n.camera.panning=!0;let r=o.subtract(t);n.camera.position[0]-=r[0]-n.camera.anchor[0],n.camera.position[1]-=r[1]-n.camera.anchor[1],n.camera.anchor[0]=r[0],n.camera.anchor[1]=r[1]}else n.camera.anchor[0]=0,n.camera.anchor[1]=0;const c=Math.floor(Math.min(l,a)/6),d=u.screenToWorld(s.fromValues(0,0)),p=u.screenToWorld(s.fromValues(c,c)),h=u.screenToWorld(s.fromValues(a,l)),m=d[0],f=d[1],g=h[0]-m,y=h[1]-f,v=p[0]-m,_=p[1]-f,x=n.helpActive||n.gameMode!=Po.Mansion?100:0,w=(n.helpActive||(n.gameMode,Po.BetweenMansions),!n.helpActive&&[Po.Dead,Po.Win].includes(n.gameMode)?0:100),S=n.helpActive?0:100;let T=t.tileSet.touchButtons;void 0===T&&(T={});const M=n.touchAsGamepad&&!(So===n.touchController&&n.touchController.mouseActive);if(n.touchController.setTouchConfig(M),M)var L={menu:{game:new Mo(m,f+y-_,v,_),view:new Mo,tileInfo:T.menu},zoomIn:{game:new Mo(m+g-v+x,f+y-2*_,v,_),view:new Mo,tileInfo:T.zoomIn},zoomOut:{game:new Mo(m+g-v+x,f+y-_,v,_),view:new Mo,tileInfo:T.zoomOut},fullscreen:{game:new Mo(m+g-v+S,f+y-_,v,_),view:new Mo,tileInfo:T.fullscreen},restart:{game:new Mo(m+g-v+w,f+y-_,v,_),view:new Mo,tileInfo:T.restart},forceRestart:{game:new Mo(m+g-v+S,f+y-2*_,v,_),view:new Mo,tileInfo:T.restart},left:{game:new Mo(m,f+_,v,_),view:new Mo,tileInfo:T.left},right:{game:new Mo(m+2*v,f+_,v,_),view:new Mo,tileInfo:T.right},up:{game:new Mo(m+v,f+2*_,v,_),view:new Mo,tileInfo:T.up},down:{game:new Mo(m+v,f,v,_),view:new Mo,tileInfo:T.down},wait:{game:new Mo(m+v,f+_,v,_),view:new Mo,tileInfo:T.wait},jump:{game:new Mo(m+g-1.5*v,f+.75*v,1.5*v,1.5*_),view:new Mo,tileInfo:T.jump}};else{const e=4/n.zoomLevel;L={menu:{game:new Mo(m,f+y-1.5*e,e,e),view:new Mo,tileInfo:T.menu},zoomIn:{game:new Mo(m,f+y-2.5*e,e,e),view:new Mo,tileInfo:T.zoomIn},zoomOut:{game:new Mo(m,f+y-3.5*e,e,e),view:new Mo,tileInfo:T.zoomOut},fullscreen:{game:new Mo(m+S,f+y-4.5*e,e,e),view:new Mo,tileInfo:T.fullscreen},restart:{game:new Mo(m+w,f+y-5.5*e,e,e),view:new Mo,tileInfo:T.restart},forceRestart:{game:new Mo(m+S,f+y-6.5*e,e,e),view:new Mo,tileInfo:T.restart}};const t=n.player.pos;L.wait=n.gameMode!=Po.Mansion||n.helpActive?{game:new Mo(-2,1,1),view:new Mo,tileInfo:T.wait}:{game:new Mo(...t,1,1),view:new Mo,tileInfo:T.wait},!n.finishedLevel||n.gameMode!=Po.Mansion||n.helpActive||0!=t[0]&&0!=t[1]&&t[0]!=i[0]-1&&t[1]!=i[1]-1?L.exitLevel={game:new Mo(-1,-1,0,0),view:new Mo,tileInfo:T.exitLevel}:L.exitLevel={game:new Mo(m,f+y-4.5*e,e,e),view:new Mo,tileInfo:T.exitLevel},L.jump={game:new Mo(-1,-1,0,0),view:new Mo,tileInfo:T.jump};for(const e of[["left",[-1,0]],["right",[1,0]],["up",[0,1]],["down",[0,-1]]]){const o=e[0],r=e[1],a=s.fromValues(t[0]+r[0],t[1]+r[1]);a[0]<0||a[1]<0||a[0]>=i[0]||a[1]>=i[1]||(n.gameMode!=Po.Mansion||n.helpActive||n.gameMap.cells.atVec(a).blocksPlayerMove||n.gameMap.cells.atVec(a).type==j.OneWayWindowE||n.gameMap.cells.atVec(a).type==j.OneWayWindowW||n.gameMap.cells.atVec(a).type==j.OneWayWindowN||n.gameMap.cells.atVec(a).type==j.OneWayWindowS||n.gameMap.items.find((e=>e.pos.equals(a)&&[Z.PortcullisEW,Z.PortcullisNS].includes(e.type)))||n.gameMap.guards.find((e=>e.pos.equals(a)))?L[o]={game:new Mo(-1,-1,0,0),view:new Mo,tileInfo:T.picker}:L[o]={game:new Mo(...a,1,1),view:new Mo,tileInfo:T.picker})}for(const e of[["jumpLeft",[-1,0]],["jumpRight",[1,0]],["jumpUp",[0,1]],["jumpDown",[0,-1]]]){const o=e[0],r=s.fromValues(...e[1]),a=t.add(r),l=t.scaleAndAdd(r,2);n.gameMode!=Po.Mansion||n.helpActive||a[0]<0||a[1]<0||a[0]>=i[0]||a[1]>=i[1]||l[0]<0||l[1]<0||l[0]>=i[0]||l[1]>=i[1]||n.gameMap.cells.atVec(a).blocksPlayerMove||n.gameMap.cells.atVec(l).blocksPlayerMove||n.gameMap.cells.atVec(a).type==j.OneWayWindowE&&"jumpLeft"==o||n.gameMap.cells.atVec(a).type==j.OneWayWindowW&&"jumpRight"==o||n.gameMap.cells.atVec(a).type==j.OneWayWindowN&&"jumpDown"==o||n.gameMap.cells.atVec(a).type==j.OneWayWindowS&&"jumpUp"==o||n.gameMap.items.find((e=>e.pos.equals(l)&&[Z.PortcullisEW,Z.PortcullisNS].includes(e.type)))||n.gameMap.guards.find((e=>e.pos.equals(l)))?L[o]={game:new Mo(-1,-1,0,0),view:new Mo,tileInfo:T.picker}:L[o]={game:new Mo(...l,1,1),view:new Mo,tileInfo:T.picker}}}for(const t in L){const o=L[t],n=o.game,r=u.worldToScreen(s.fromValues(n[0],n[1])),i=u.worldToScreen(s.fromValues(n[0]+n[2],n[1]+n[3]));e.updateCoreTouchTarget(t,n,new Mo(r[0],r[1],i[0]-r[0],i[1]-r[1]),o.tileInfo)}r&&e.activateTouchTargets(r.getTouchData())}(o.touchController,t,i,o),function(e,t,o){e.beginFrame(t);const n=a.create();(function(e,t,o){const n=e.gameMap.cells.sizeX,r=e.gameMap.cells.sizeY,i=Jo*Gn(t[0]),l=s.fromValues(t[0],t[1]-2*i),[u,c]=Fn(l,n,r,e.zoomLevel),d=e.camera.position[0],p=e.camera.position[1],h=e.zoomLevel,m=i/(en*h),f=Math.floor(Zo*(d-u/2))/Zo,g=Math.floor(en*(p-c/2))/en;a.ortho(o,f,f+u,g-m,g+c+m,1,-1)})(o,t,n),e.start(n,1),An(o,e),o.gameMode===Po.Mansion&&(function(e,t){if(!e.seeGuardSight)return;const o=e.gameMap.cells.sizeX,n=e.gameMap.cells.sizeY,r=new Y(o,n,!1),i=s.create(),a=s.create();for(const t of e.gameMap.guards){const l=3,u=Math.max(0,Math.floor(t.pos[0]-l)),c=Math.min(o,Math.floor(t.pos[0]+l)+1),d=Math.max(0,Math.floor(t.pos[1]-l)),p=Math.min(n,Math.floor(t.pos[1]+l)+1);for(let o=d;o<p;++o)for(let n=u;n<c;++n){s.set(i,n,o),s.subtract(a,i,t.pos);const l=e.gameMap.cells.at(n,o);r.get(n,o)||l.blocksPlayerMove||(e.seeAll||l.seen)&&(s.dot(t.dir,a)<0||s.squaredLen(a)>=t.sightCutoff(l.lit>0)||O(e.gameMap,t.pos,i)&&r.set(n,o,!0))}}for(let o=0;o<e.gameMap.cells.sizeY;++o)for(let n=0;n<e.gameMap.cells.sizeX;++n)r.get(n,o)&&t.addGlyph(n,o,n+1,o+1,jo.namedTiles.crossHatch,1)}(o,e),function(e,t){if(e.seeGuardPatrols)for(const o of e.gameMap.guards)for(const e of o.patrolPath)t.addGlyph(e[0],e[1],e[0]+1,e[1]+1,jo.namedTiles.patrolRoute,1)}(o,e));(function(e,t){for(const o of e.gameMap.guards){let n=0+bn(o.dir);const r=e.gameMap.cells.atVec(o.pos);let i=Mn(r.lit,e.lightStates,r.litSrc,e.seeAll||r.seen);const a=e.seeAll||r.seen||o.speaking;if(!a&&s.squaredDistance(e.player.pos,o.pos)>36)continue;a||o.mode===I.Unconscious?o.mode!==I.Patrol||o.speaking||0!=r.lit?o.mode===I.Unconscious?n+=12:n+=8:i=0:n+=4;const l=t.tileSet.npcTiles[n],u=e.gameMap.items.find((e=>[Z.PortcullisEW,Z.PortcullisNS].includes(e.type))),c=void 0!==u&&u.pos.equals(o.pos)?.25:0;let d=o.animation?.offset??s.create();const p=o.pos[0]+d[0]+c,h=o.pos[1]+d[1];if(o.hasTorch||o.hasPurse||o.hasVaultKey){let e=p+.375*o.dir[0]+.375*o.dir[1],n=h-.125;const r=o.torchAnimation?.currentTile()??t.tileSet.itemTiles[Z.TorchCarry];let s=p-.25*o.dir[0]+(o.dir[1]<0?.375:0),a=h-.125;const u=o.hasVaultKey?jo.itemTiles[Z.KeyCarry]:t.tileSet.itemTiles[Z.PurseCarry];o.dir[1]>0?(o.hasTorch&&t.addGlyph(e,n,e+1,n+1,r,i),t.addGlyph(p,h,p+1,h+1,l,i),(o.hasPurse||o.hasVaultKey)&&t.addGlyph(s,a,s+1,a+1,u,i)):o.dir[1]<0?((o.hasPurse||o.hasVaultKey)&&t.addGlyph(s,a,s+1,a+1,u,i),t.addGlyph(p,h,p+1,h+1,l,i),o.hasTorch&&t.addGlyph(e,n,e+1,n+1,r,i)):(t.addGlyph(p,h,p+1,h+1,l,i),o.hasTorch&&t.addGlyph(e,n,e+1,n+1,r,i),(o.hasPurse||o.hasVaultKey)&&t.addGlyph(s,a,s+1,a+1,u,i))}else t.addGlyph(p,h,p+1,h+1,l,i)}})(o,e),(o.gameMode===Po.Mansion||o.gameMode===Po.Dead)&&(function(e,t){const o=e.player,n=e.player.animation,r=n&&n instanceof b?n.offset:s.create(),i=o.pos[0]+r[0],a=o.pos[1]+r[1],l=o.pos[0],u=o.pos[1],c=e.gameMap.cells.at(l,u),d=Mn(c.lit,e.lightStates,c.litSrc,e.seeAll||c.seen),p=o.hidden(e.gameMap),h=t.tileSet.playerTiles;let m;m=e.player.animation?e.player.animation.currentTile():o.health<=0?h.dead:o.damagedLastTurn?h.wounded:o.noisy?h.noisy:p?h.hidden:d?h.normal:h.unlit,t.addGlyph(i,a,i+1,a+1,m,d)}(o,e),function(e,t){for(let o of e.particles)if(o.animation){const e=o.animation,n=e instanceof b?e.offset:s.create(),r=o.pos[0]+n[0],i=o.pos[1]+n[1],a=e.currentTile();t.addGlyph(r,i,r+1,i+1,a)}}(o,e));o.gameMode===Po.Mansion&&function(e,t){const o=e.player;for(const n of e.gameMap.guards){const r=e.gameMap.cells.atVec(n.pos);if(!(e.seeAll||r.seen||n.speaking)&&s.squaredDistance(e.player.pos,n.pos)>36)continue;const i=n.overheadIcon();let a;if(i!==Q.Relaxed)a=t.tileSet.guardStateTiles[i];else{if(n!==o.pickTarget)continue;a=jo.namedTiles.pickTarget}let l=n.animation?.offset??s.create();const u=n.pos[0]+l[0],c=n.pos[1]+l[1]+.625;t.addGlyph(u,c,u+1,c+1,a,1)}if(o.noisy){const e=o.pos[0],n=o.pos[1]-.5;t.addGlyph(e,n,e+1,n+1,jo.namedTiles.noise,1)}}(o,e);e.flush();const r=o.textWindows[o.gameMode];void 0!==r&&r.render(e);o.gameMode!==Po.Mansion&&o.gameMode!==Po.BetweenMansions||(o.helpActive?(o.helpScreen.render(e),Vn(e,t,o)):(!function(e,t,o,n){const r=Gn(t[0]),i=r*Jo,s=t[0]/(r*Qo),l=t[1]/i,u=1-l,c=a.create();a.ortho(c,0,s,u,l+u,1,-1),e.start(c,0);const d=Math.ceil(s);e.addGlyph(0,0,d,1,$o.background),n.dailyRun&&Un(e,0,"Daily run",wt);const p=Math.floor((d-o.length)/2+.5);Un(e,p,o,gt),e.flush()}(e,t,o.topStatusMessage,o),Vn(e,t,o)));So===o.touchController&&(e.start(n,1),function(e,t,o){for(const t in o.coreTouchTargets){if(!(t in o.controlStates))continue;const n=o.coreTouchTargets[t],r=o.controlStates[t]&&o.targetOnTouchDown===t?1:0;null!==n.tileInfo&&("always"==n.show||"press"==n.show&&-1!=n.id)&&e.addGlyph(n.game[0],n.game[1],n.game[0]+n.game[2],n.game[1]+n.game[3],n.tileInfo,r)}e.flush()}(e,0,o.touchController),e.flush())}(t,i,o),requestAnimationFrame((e=>Wn(e,t,o)))}function Dn(e,t,o,n,r){const i=s.create(),a=s.create();!function(e,t,o,n,r){const i=e[0],a=e[1],l=Jo*Gn(t[0]),u=s.fromValues(t[0],t[1]-2*l),[c,d]=Fn(u,i,a,o);let p=c/2,h=e[0]-c/2;p>h&&(p=h=e[0]/2);let m=d/2,f=e[1]-d/2;m>f&&(m=f=e[1]/2);n[0]=p,n[1]=m,r[0]=h,r[1]=f}(t,n,o,i,a),e[0]=Math.max(i[0],Math.min(a[0],r[0]+.5)),e[1]=Math.max(i[1],Math.min(a[1],r[1]+.5))}function Fn(e,t,o,n){const r=Zo*n,i=en*n;return[e[0]/r,e[1]/i]}function Gn(e){return Math.min(2,Math.max(1,Math.floor(e/(Ko*Qo))))}function Un(e,t,o,n){for(let r=0;r<o.length;++r){const i=o.charCodeAt(r);e.addGlyph(t+r,0,t+r+1,1,{textureIndex:i,color:n})}}function Vn(e,t,o){const n=Gn(t[0]),r=t[0]/(n*Qo),i=t[1]/(n*Jo),s=a.create();a.ortho(s,0,r,0,i,1,-1),e.start(s,0);const l=Math.ceil(r);e.addGlyph(0,0,l,1,$o.background);Un(e,1,"Health",mt);const u=$o.heart.textureIndex;for(let t=0;t<oe;++t){const n=t<o.player.health?mt:ht;e.addGlyph(t+1+7,0,t+1+8,1,{textureIndex:u,color:n})}if(o.gameMap.cells.at(o.player.pos[0],o.player.pos[1]).type==j.GroundWater&&o.player.turnsRemainingUnderwater>0){const t=1+oe+10;Un(e,t,"Air",xt);const n=$o.air.textureIndex;for(let r=0;r<o.player.turnsRemainingUnderwater;++r)e.addGlyph(t+4+r,0,t+5+r,1,{textureIndex:n,color:xt})}const c=o.gameMap.percentSeen(),d=an(o),p=o.gameMap.cells,h=Math.ceil(p.sizeX*p.sizeY*(1-o.initialSeen)/4);let m=(6-d)*h+h-1-o.turns;const f=d>0?"Timer "+m+" (+"+d+")":"Turns "+o.turns+" (--)",g="Mansion "+(o.level+1)+" - "+c+"% Mapped - "+f;Un(e,Math.floor((l-g.length)/2+.5),g,gt);let y="Loot "+o.player.loot;const v=l-(y.length+1);if(Un(e,v,y,wt),o.player.hasVaultKey){Un(e,v-4,"Key",xt)}if(o.leapToggleActive){const t="Leap";Un(e,v-(t.length+2),t,_t)}e.flush()}function On(e=null,t=!0){const o=e??new Date,n=t?o.getUTCFullYear():o.getFullYear(),r=1+(t?o.getUTCMonth():o.getMonth()),i=t?o.getUTCDate():o.getDate();return`${String(n)}/${String(r).padStart(2,"0")}/${String(i).padStart(2,"0")}`}
//# sourceMappingURL=index.99d5e51f.js.map
